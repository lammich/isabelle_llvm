<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Code/code_scala.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Code/code_scala.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      Tools/Code/code_scala.ML
    Author:     Florian Haftmann, TU Muenchen

Serializer for Scala.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>CODE_SCALA</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> target</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Code_Scala</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>CODE_SCALA</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Basic_Code_Symbol</span><span class="main"><span>;</span></span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Basic_Code_Thingol</span><span class="main"><span>;</span></span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Code_Printer</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>infixr</span></span></span><span> </span><span class="inner_numeral"><span>5</span></span><span> @@</span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>infixr</span></span></span><span> </span><span class="inner_numeral"><span>5</span></span><span> @|</span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(** Scala serializer **)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>target</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Scala"</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>print_scala_string</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>chr</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"\\u"</span></span><span> </span><span>^</span><span> </span><span>align_right</span><span> </span><span class="inner_quoted"><span>"0"</span></span><span> </span><span class="inner_numeral"><span>4</span></span><span> </span><span class="main"><span>(</span></span><span>Int.fmt</span><span> </span><span>StringCvt.HEX</span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>char</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"'"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"\\'"</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"\""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"\\\""</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"\\"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"\\\\"</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>ord</span><span> </span><span class="entity"><span>c</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>&lt;</span><span> </span><span class="inner_numeral"><span>32</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>126</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>chr</span></span><span> </span><span class="entity"><span>i</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>&gt;=</span><span> </span><span class="inner_numeral"><span>128</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"non-ASCII byte in Scala string literal"</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>c</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>quote</span><span> </span><span>o</span><span> </span><span>translate_string</span><span> </span><span class="entity"><span>char</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>scala_stmt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Fun</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> typscheme * </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>iterm list * iterm</span><span class="main"><span>)</span></span><span> * </span><span class="main"><span>(</span></span><span>thm option * bool</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> list
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Datatype</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> vname list * </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>string * vname list</span><span class="main"><span>)</span></span><span> * itype list</span><span class="main"><span>)</span></span><span> list
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Class</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span>vname * </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>class * class</span><span class="main"><span>)</span></span><span> list * </span><span class="main"><span>(</span></span><span>string * itype</span><span class="main"><span>)</span></span><span> list</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      * </span><span class="main"><span>(</span></span><span>string * </span><span class="main"><span>{</span></span><span> vs</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>vname * sort</span><span class="main"><span>)</span></span><span> list</span><span class="main"><span>,</span></span><span>
      inst_params</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>string * </span><span class="main"><span>(</span></span><span>const * int</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> * </span><span class="main"><span>(</span></span><span>thm * bool</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> list</span><span class="main"><span>,</span></span><span>
      superinst_params</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>string * </span><span class="main"><span>(</span></span><span>const * int</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> * </span><span class="main"><span>(</span></span><span>thm * bool</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> list </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> list</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_scala_stmt</span></span><span> </span><span class="entity"><span>tyco_syntax</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>reserved</span></span><span>
    </span><span class="entity"><span>args_num</span></span><span> </span><span class="entity"><span>is_constr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolve</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>deresolve_full</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deresolve_const</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolve</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Constant</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deresolve_tyco</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolve</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Type_Constructor</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deresolve_class</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deresolve</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Type_Class</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>lookup_tyvar</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lookup_var</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span>o</span><span> </span><span>Name.enforce_case</span><span> </span><span>true</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>intro_tyvars</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Name.enforce_case</span><span> </span><span>true</span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_tyco_expr</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>applify</span></span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tys</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>`%%</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>tyco_syntax</span></span><span> </span><span class="entity"><span>tyco</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>print_tyco_expr</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>print</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ITyVar</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>lookup_tyvar</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_dicttyp</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_tyco_expr</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Class</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ty</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_tupled_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>ty</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_tupled_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>ty1</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>BR</span></span><span> </span><span class="entity"><span>ty1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"=&gt;"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>ty2</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_tupled_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tys</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>enum</span></span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"=&gt;"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>constraint</span></span><span> </span><span class="entity"><span>p1</span></span><span> </span><span class="entity"><span>p2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>":"</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p2</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_var</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"_"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_var</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>lookup_var</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>applify_dict</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Dict</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>d</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>applify_plain_dict</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>d</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>applify_plain_dict</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Dict_Const</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>applify_dictss</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Class_Instance</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>inst</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>snd</span><span> </span><span class="entity"><span>dss</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>applify_plain_dict</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Dict_Var</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>var</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"implicitly"</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>enclose</span></span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span> </span><span class="main"><span>[</span></span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_class</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>enclose</span></span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>lookup_tyvar</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>var</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>applify_dictss</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="entity"><span>dss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>applify</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>applify_dict</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>dss</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>is_pat</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IConst</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>print_app</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>is_pat</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>is_pat</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t1</span></span><span> </span><span class="entity"><span>`$</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>Code_Thingol.unfold_const_app</span></span><span> </span><span class="entity"><span>t</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>app</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>print_app</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>is_pat</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>app</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>applify</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>is_pat</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fxy</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>is_pat</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>BR</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>is_pat</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IVar</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>print_var</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>v</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>is_pat</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>`|=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs_tys</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Code_Thingol.unfold_abs</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_abs_head</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs_tys</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>brackets</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>@|</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>is_pat</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ICase</span></span><span> </span><span class="entity"><span>case_expr</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>Code_Thingol.unfold_const_app</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>primitive </span><span class="entity"><span>case_expr</span></span><span class="main"><span>)</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>app</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span> sym </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>is_none</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>print_case</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>case_expr</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>print_app</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>is_pat</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>app</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>print_case</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>case_expr</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_abs_head</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>some_v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="main"><span>(</span></span><span>the_list</span><span> </span><span class="entity"><span>some_v</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
             </span><span class="main"><span>(</span></span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span>
               </span><span class="entity"><span>enclose</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>constraint</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_var</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="entity"><span>some_v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
               </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"=&gt;"</span></span><span>
             </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars'</span></span><span class="main"><span>)</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_app</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>is_pat</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>app</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>typargs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dom</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dicts</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>typargs'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_pat</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>typargs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>syntax</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="entity"><span>const</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>applify_dicts</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_pat</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>is_some</span><span> </span><span class="entity"><span>syntax</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>is_constr</span></span><span> </span><span class="entity"><span>sym</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>Code_Thingol.unambiguous_dictss</span></span><span> </span><span class="entity"><span>dicts</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>K</span><span> </span><span class="entity"><span>p</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>applify_dictss</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>wanted</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>syntax</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>args_num</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>applify_dicts</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>gen_applify</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_constr</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>is_pat</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fxy</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>applify</span></span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="entity"><span>NOBR</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>typargs'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dicts</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Plain_printer</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>applify_dicts</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>applify</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>is_pat</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fxy</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>applify</span></span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="entity"><span>NOBR</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>typargs'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dicts</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Complex_printer</span></span><span> </span><span class="entity"><span>print</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>print</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>is_pat</span></span><span> </span><span class="entity"><span>some_thm</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>ts</span></span><span> </span><span>~~</span><span> </span><span>take</span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>dom</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>vs_tys</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ts1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>Code_Thingol.satisfied_application</span></span><span> </span><span class="entity"><span>wanted</span></span><span> </span><span class="entity"><span>app</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>vs_tys</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>ts2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="entity"><span>print'</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>ts</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span>Pretty.block</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print'</span></span><span> </span><span class="entity"><span>BR</span></span><span> </span><span class="entity"><span>ts1</span></span><span> </span><span>::</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Pretty.block</span><span>
              </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>".apply("</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>is_pat</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts2</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
          </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>is_pat</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs_tys</span></span><span> </span><span class="entity"><span>`|==&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IConst</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>`$$</span></span><span> </span><span class="entity"><span>ts1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_bind</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>gen_print_bind</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="entity"><span>p</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>print_case</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>{</span></span><span> clauses </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>brackify</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span>o</span><span> </span><span>Pretty.breaks</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>str</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"sys.error(\"empty case\")"</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_case</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>case_expr</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span> clauses </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bind</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>binds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Code_Thingol.unfold_let</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ICase</span></span><span> </span><span class="entity"><span>case_expr</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_match_val</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>vars</span></span><span>
              </span><span>|&gt;</span><span> </span><span class="entity"><span>print_bind</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>BR</span></span><span> </span><span class="entity"><span>pat</span></span><span>
              </span><span>|&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>false</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"val"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>constraint</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>BR</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_match_seq</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>true</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_match</span></span><span> </span><span class="entity"><span>is_first</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>IVar</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>Code_Thingol.is_IAbs</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>is_first</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>print_match_val</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>IVar</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>print_match_seq</span></span><span> </span><span class="entity"><span>t</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_match</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
                  </span><span class="entity"><span>print_match_val</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>seps_ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>vars</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>print_match</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>bind</span></span><span> </span><span>||&gt;&gt;</span><span> </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_match</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>binds</span></span><span> </span><span>|&gt;&gt;</span><span> </span><span>uncurry</span><span> </span><span>cons</span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>all_seps_ps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>seps_ps</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span>true</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>insert_seps</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>insert_seps</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>seps_ps</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sep</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>sep</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>";"</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>insert_seps</span></span><span> </span><span class="entity"><span>seps_ps</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>brackify_block</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"{"</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>insert_seps</span></span><span> </span><span class="entity"><span>all_seps_ps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"}"</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_case</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>{</span></span><span> term </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> typ </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> clauses </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>clauses</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_select</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p_pat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_bind</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>pat</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>p_body</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>body</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"case"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p_pat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"=&gt;"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p_body</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>map</span><span> </span><span class="entity"><span>print_select</span></span><span> </span><span class="entity"><span>clauses</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Pretty.block_enclose</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"match"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"{"</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"}"</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>single</span><span>
            </span><span>|&gt;</span><span> </span><span class="entity"><span>enclose</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_context</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>applify</span></span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sort</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>Pretty.block</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>str</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>lookup_tyvar</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span>::</span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>" : "</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>deresolve_class</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sort</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>NOBR</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_defhead</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>tys</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"def"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>constraint</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>applify</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>param</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="entity"><span>constraint</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>lookup_var</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>param</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>NOBR</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_context</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolve_const</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>params</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_def</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tys</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Code_Thingol.unfold_fun</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name.invent</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"a"</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_tyvars</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>print_defhead</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>tys</span></span><span> </span><span class="entity"><span>ty'</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"sys.error("</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>print_scala_string</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_def</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tycos</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>build</span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span>fold</span><span> </span><span class="entity"><span>Code_Thingol.add_tyconames</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>eqs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>reserved</span></span><span>
              </span><span>|&gt;</span><span> </span><span class="entity"><span>intro_base_names</span></span><span>
                   </span><span class="main"><span>(</span></span><span>is_none</span><span> </span><span>o</span><span> </span><span class="entity"><span>tyco_syntax</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>deresolve_tyco</span></span><span> </span><span class="entity"><span>tycos</span></span><span>
              </span><span>|&gt;</span><span> </span><span class="entity"><span>intro_tyvars</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>simple</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>eqs</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ts</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>forall</span><span> </span><span class="entity"><span>Code_Thingol.is_IVar</span></span><span> </span><span class="entity"><span>ts</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>reserved</span></span><span>
              </span><span>|&gt;</span><span> </span><span class="entity"><span>intro_base_names_for</span></span><span> </span><span class="main"><span>(</span></span><span>is_none</span><span> </span><span>o</span><span> </span><span class="entity"><span>const_syntax</span></span><span class="main"><span>)</span></span><span>
                   </span><span class="entity"><span>deresolve</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>eqs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>simple</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>IVar</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span>hd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>eqs</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>aux_params</span></span><span> </span><span class="entity"><span>vars1</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>eqs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>vars1</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tys'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Code_Thingol.unfold_fun_n</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tuplify</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>p</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tuplify</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>enum</span></span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="entity"><span>ps</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_rhs</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>some_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_clause</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>eq</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ts</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>some_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="main"><span>=</span></span><span>
                  </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="main"><span>(</span></span><span>build</span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span class="entity"><span>Code_Thingol.add_varnames</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars1</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"case"</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>tuplify</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_term</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>some_thm</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="entity"><span>NOBR</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"=&gt;"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_rhs</span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="entity"><span>eq</span></span><span class="main"><span>]</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>head</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_defhead</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>vars2</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>tys'</span></span><span> </span><span class="entity"><span>ty'</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>simple</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>head</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_rhs</span></span><span> </span><span class="entity"><span>vars2</span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>eqs</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span>Pretty.block_enclose</span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>head</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tuplify</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>lookup_var</span></span><span> </span><span class="entity"><span>vars2</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"match"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"{"</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"}"</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>print_clause</span></span><span> </span><span class="entity"><span>eqs</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>print_method</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span>Library.enclose</span><span> </span><span class="inner_quoted"><span>"`"</span></span><span> </span><span class="inner_quoted"><span>"`"</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_full</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Constant</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_inst</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>inst_params</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>superinst_params</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_tyvars</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>classtyp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>`%%</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ITyVar</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_classparam_instance</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>classparam</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>dom</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dom_length</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>aux_dom</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name.invent_names</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"a"</span></span><span> </span><span class="entity"><span>dom</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>auxs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>aux_dom</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="entity"><span>auxs</span></span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>aux_dom1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>aux_dom2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>chop</span><span> </span><span class="entity"><span>dom_length</span></span><span> </span><span class="entity"><span>aux_dom</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>abstract_using</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>abstract_using</span></span><span> </span><span class="entity"><span>aux_dom</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>enum</span></span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span>
                  </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>aux</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>constraint</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>lookup_var</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>aux</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>aux_dom</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"=&gt;"</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>aux_abstr1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>abstract_using</span></span><span> </span><span class="entity"><span>aux_dom1</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>aux_abstr2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>abstract_using</span></span><span> </span><span class="entity"><span>aux_dom2</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"val"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_method</span></span><span> </span><span class="entity"><span>classparam</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span class="main"><span>]</span></span><span>
              </span><span>@</span><span> </span><span class="entity"><span>aux_abstr1</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>aux_abstr2</span></span><span> </span><span class="entity"><span>@|</span></span><span> </span><span class="entity"><span>print_app</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span>false</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IVar</span></span><span> </span><span>o</span><span> </span><span>SOME</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>auxs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Pretty.block_enclose</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"implicit def"</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>constraint</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_context</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>vs</span></span><span>
            </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Library.enclose</span><span> </span><span class="inner_quoted"><span>"`"</span></span><span> </span><span class="inner_quoted"><span>"`"</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_full</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Class_Instance</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>print_dicttyp</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>classtyp</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"new"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_dicttyp</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>classtyp</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"{"</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"}"</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>print_classparam_instance</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst_params</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>superinst_params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Fun</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>raw_eqs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>print_def</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>filter</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>raw_eqs</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Datatype</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cos</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_tyvars</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>rpair</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_co</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>co</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vs_args</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span>Pretty.block</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>applify</span></span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>lookup_tyvar</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>NOBR</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"final case class "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>deresolve_const</span></span><span> </span><span class="entity"><span>co</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs_args</span></span><span class="main"><span>)</span></span><span>
                </span><span class="entity"><span>@@</span></span><span> </span><span class="entity"><span>enum</span></span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>arg</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>constraint</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>arg</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>(</span></span><span>Name.invent_names</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"a"</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"extends"</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>applify</span></span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>lookup_tyvar</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>NOBR</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_tyco</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span>
              </span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Pretty.chunks</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>applify</span></span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>lookup_tyvar</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>NOBR</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"abstract sealed class "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>deresolve_tyco</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span>
                </span><span>::</span><span> </span><span>map</span><span> </span><span class="entity"><span>print_co</span></span><span> </span><span class="entity"><span>cos</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Class</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Class</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>classrels</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>classparams</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>insts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_tyvars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>class</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_typarg</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Pretty.block</span><span>
              </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"["</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>lookup_tyvar</span></span><span> </span><span class="entity"><span>tyvars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_super_classes</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span>
              </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_super_classes</span></span><span> </span><span class="entity"><span>classrels</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"extends"</span></span><span>
                  </span><span>::</span><span> </span><span>separate</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"with"</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>add_typarg</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_class</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>classrels</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_classparam_val</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>classparam</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"val"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>constraint</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_method</span></span><span> </span><span class="entity"><span>classparam</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>print_tupled_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Code_Thingol.unfold_fun</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_classparam_def</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>classparam</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tys</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Code_Thingol.unfold_fun</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>implicit_name</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name.invent</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lookup_tyvar</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>proto_vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>implicit_name</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>auxs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name.invent</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>proto_vars</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"a"</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>intro_vars</span></span><span> </span><span class="entity"><span>auxs</span></span><span> </span><span class="entity"><span>proto_vars</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"def"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>constraint</span></span><span> </span><span class="main"><span>(</span></span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>applify</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>aux</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>constraint</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>lookup_var</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>aux</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>add_typarg</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolve_const</span></span><span> </span><span class="entity"><span>classparam</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>auxs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"(implicit "</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>implicit_name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>": "</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>add_typarg</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolve_class</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>tyvars</span></span><span> </span><span class="entity"><span>NOBR</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"="</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>applify</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>lookup_var</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>NOBR</span></span><span>
                  </span><span class="main"><span>(</span></span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>implicit_name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"."</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>print_method</span></span><span> </span><span class="entity"><span>classparam</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>auxs</span></span><span class="main"><span>]</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Pretty.chunks</span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="main"><span>(</span></span><span>Pretty.block_enclose</span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>concat</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"trait"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>add_typarg</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>deresolve_class</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>]</span></span><span>
                  </span><span>@</span><span> </span><span>the_list</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_super_classes</span></span><span> </span><span class="entity"><span>classrels</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"{"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"}"</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>print_classparam_val</span></span><span> </span><span class="entity"><span>classparams</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span>::</span><span> </span><span>map</span><span> </span><span class="entity"><span>print_classparam_def</span></span><span> </span><span class="entity"><span>classparams</span></span><span>
              </span><span class="entity"><span>@|</span></span><span> </span><span>Pretty.block_enclose</span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"object "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>deresolve_class</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" {"</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"}"</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_inst</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>insts</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pickup_instances_for_class</span></span><span> </span><span class="entity"><span>program</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tab</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Symtab.empty</span><span>
      </span><span>|&gt;</span><span> </span><span>Code_Symbol.Graph.fold</span><span>
        </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Classinst</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>inst_params</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>superinst_params</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span>Symtab.map_default</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span>cons</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyco</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>{</span></span><span> vs </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> inst_params </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inst_params</span></span><span class="main"><span>,</span></span><span> superinst_params </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>superinst_params</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
           </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>I</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>program</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Symtab.lookup_list</span><span> </span><span class="entity"><span>tab</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>scala_program_of_program</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>case_insensitive</span></span><span> </span><span class="entity"><span>module_name</span></span><span> </span><span class="entity"><span>reserved</span></span><span> </span><span class="entity"><span>identifiers</span></span><span> </span><span class="entity"><span>exports</span></span><span> </span><span class="entity"><span>program</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>variant</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>case_insensitive</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Code_Namespace.variant_case_insensitive</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Name.variant</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>namify_module</span></span><span> </span><span class="entity"><span>name_fragment</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>nsp_class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_object</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_common</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>declare</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name.declare</span><span> </span><span class="entity"><span>name_fragment</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name_fragment</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>declare</span></span><span> </span><span class="entity"><span>nsp_class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>declare</span></span><span> </span><span class="entity"><span>nsp_object</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>declare</span></span><span> </span><span class="entity"><span>nsp_common</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>namify_class</span></span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>nsp_class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_object</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_common</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>base'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_class'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>variant</span></span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="entity"><span>nsp_class</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>base'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>nsp_class'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_object</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Name.declare</span><span> </span><span class="entity"><span>base'</span></span><span> </span><span class="entity"><span>nsp_common</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>namify_object</span></span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>nsp_class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_object</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_common</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>base'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_object'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>variant</span></span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="entity"><span>nsp_object</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>base'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>nsp_class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_object'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Name.declare</span><span> </span><span class="entity"><span>base'</span></span><span> </span><span class="entity"><span>nsp_common</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>namify_common</span></span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>nsp_class</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_object</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_common</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>base'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_common'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>variant</span></span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="entity"><span>nsp_common</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>base'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Name.declare</span><span> </span><span class="entity"><span>base'</span></span><span> </span><span class="entity"><span>nsp_class</span></span><span class="main"><span>,</span></span><span> </span><span>Name.declare</span><span> </span><span class="entity"><span>base'</span></span><span> </span><span class="entity"><span>nsp_object</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nsp_common'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Fun</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_object</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Datatype</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_class</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Datatypecons</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_common</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Class</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_class</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Classrel</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_object</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Classparam</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_object</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.Classinst</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_common</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pickup_instances</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pickup_instances_for_class</span></span><span> </span><span class="entity"><span>program</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>modify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Fun</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>modify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Fun</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Fun</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>modify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Datatype</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Datatype</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>modify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Datatypecons</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>modify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Class</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Class</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>export</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Class</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pickup_instances</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>modify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Classrel</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>modify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Classparam</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>modify_stmt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Code_Thingol.Classinst</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>Code_Namespace.hierarchical_program</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="main"><span>{</span></span><span> module_name </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>module_name</span></span><span class="main"><span>,</span></span><span> reserved </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>,</span></span><span> identifiers </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>identifiers</span></span><span class="main"><span>,</span></span><span>
        empty_nsp </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>reserved</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>reserved</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> namify_module </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_module</span></span><span class="main"><span>,</span></span><span>
        namify_stmt </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>namify_stmt</span></span><span class="main"><span>,</span></span><span> cyclic_modules </span><span class="main"><span>=</span></span><span> </span><span>true</span><span class="main"><span>,</span></span><span>
        class_transitive </span><span class="main"><span>=</span></span><span> </span><span>true</span><span class="main"><span>,</span></span><span> class_relation_public </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> empty_data </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        memorize_data </span><span class="main"><span>=</span></span><span> </span><span>K</span><span> </span><span>I</span><span class="main"><span>,</span></span><span> modify_stmts </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>modify_stmt</span></span><span> </span><span class="main"><span>}</span></span><span>
      </span><span class="entity"><span>exports</span></span><span> </span><span class="entity"><span>program</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>serialize_scala</span></span><span> </span><span class="entity"><span>case_insensitive</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>module_name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>reserved_syms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>identifiers</span></span><span class="main"><span>,</span></span><span>
    </span><span class="entity"><span>includes</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>class_syntax</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tyco_syntax</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="main"><span>}</span></span><span> </span><span class="entity"><span>program</span></span><span> </span><span class="entity"><span>exports</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>

    </span><span class="comment1"><span>(* build program *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>deresolver</span></span><span class="main"><span>,</span></span><span> hierarchical_program </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>scala_program</span></span><span> </span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>scala_program_of_program</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>case_insensitive</span></span><span> </span><span class="entity"><span>module_name</span></span><span> </span><span class="main"><span>(</span></span><span>Name.make_context</span><span> </span><span class="entity"><span>reserved_syms</span></span><span class="main"><span>)</span></span><span>
        </span><span class="entity"><span>identifiers</span></span><span> </span><span class="entity"><span>exports</span></span><span> </span><span class="entity"><span>program</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* print statements *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>lookup_constr</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>constr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Code_Symbol.Graph.get_node</span><span> </span><span class="entity"><span>program</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="entity"><span>tyco</span></span><span class="main"><span>)</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>Code_Thingol.Datatype</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>constrs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span>the</span><span> </span><span class="main"><span>(</span></span><span>AList.lookup</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>o</span><span> </span><span>apsnd</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>constrs</span></span><span> </span><span class="entity"><span>constr</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>classparams_of_class</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Code_Symbol.Graph.get_node</span><span> </span><span class="entity"><span>program</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Class</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>)</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>Code_Thingol.Class</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>classparams</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>classparams</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>args_num</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sym</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>Constant</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Code_Symbol.Graph.get_node</span><span> </span><span class="entity"><span>program</span></span><span> </span><span class="entity"><span>sym</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>Code_Thingol.Fun</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span>length</span><span> </span><span>o</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span class="entity"><span>Code_Thingol.unfold_fun</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ty</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Code_Thingol.Fun</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ts</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>ts</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Code_Thingol.Datatypecons</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>length</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lookup_constr</span></span><span> </span><span class="entity"><span>tyco</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Code_Thingol.Classparam</span></span><span> </span><span class="entity"><span>class</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span>length</span><span> </span><span>o</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span class="entity"><span>Code_Thingol.unfold_fun</span></span><span> </span><span>o</span><span> </span><span>the</span><span> </span><span>o</span><span> </span><span>AList.lookup</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>classparams_of_class</span></span><span> </span><span class="entity"><span>class</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>const</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_stmt</span></span><span> </span><span class="entity"><span>prefix_fragments</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_scala_stmt</span></span><span>
      </span><span class="entity"><span>tyco_syntax</span></span><span> </span><span class="entity"><span>const_syntax</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>make_vars</span></span><span> </span><span class="entity"><span>reserved_syms</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args_num</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Thingol.is_constr</span></span><span> </span><span class="entity"><span>program</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolver</span></span><span> </span><span class="entity"><span>prefix_fragments</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>deresolver</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* print modules *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_module</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Pretty.chunks2</span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"object "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>base</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" {"</span></span><span class="main"><span>)</span></span><span>
        </span><span>::</span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>@|</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"} /* object "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>base</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" */"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* serialization *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Pretty.chunks2</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>snd</span><span> </span><span class="entity"><span>includes</span></span><span>
      </span><span>@</span><span> </span><span class="entity"><span>Code_Namespace.print_hierarchical</span></span><span> </span><span class="main"><span>{</span></span><span>
        print_module </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_module</span></span><span class="main"><span>,</span></span><span> print_stmt </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_stmt</span></span><span class="main"><span>,</span></span><span>
        lift_markup </span><span class="main"><span>=</span></span><span> </span><span>I</span><span> </span><span class="main"><span>}</span></span><span> </span><span class="entity"><span>scala_program</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Target.Singleton</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"scala"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>try</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deresolver</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>serializer</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Code_Target.serializer</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Code_Target.parse_args</span></span><span> </span><span class="main"><span>(</span></span><span>Scan.optional</span><span> </span><span class="main"><span>(</span></span><span>Args.$$$</span><span> </span><span class="inner_quoted"><span>"case_insensitive"</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span>false</span><span>
    </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>case_insensitive</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>serialize_scala</span></span><span> </span><span class="entity"><span>case_insensitive</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>literals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>numeral_scala</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="inner_numeral"><span>~2147483647</span></span><span> </span><span>&lt;</span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span>&lt;=</span><span> </span><span class="inner_numeral"><span>2147483647</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>signed_string_of_int</span><span> </span><span class="entity"><span>k</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>quote</span><span> </span><span class="main"><span>(</span></span><span>signed_string_of_int</span><span> </span><span class="entity"><span>k</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>Literals</span></span><span> </span><span class="main"><span>{</span></span><span>
  literal_string </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_scala_string</span></span><span class="main"><span>,</span></span><span>
  literal_numeral </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"BigInt("</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>numeral_scala</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>,</span></span><span>
  literal_list </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"Nil"</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"List"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>enum</span></span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="entity"><span>ps</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
  infix_cons </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>6</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"::"</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>}</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(** Isar setup **)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Theory.setup</span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Target.add_language</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>target</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>{</span></span><span> serializer </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>serializer</span></span><span class="main"><span>,</span></span><span> literals </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>literals</span></span><span class="main"><span>,</span></span><span>
      check </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span> env_var </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"SCALA_HOME"</span></span><span class="main"><span>,</span></span><span>
        make_destination </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span>+</span><span> </span><span>Path.explode</span><span> </span><span class="inner_quoted"><span>"ROOT.scala"</span></span><span class="main"><span>,</span></span><span>
        make_command </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="inner_quoted"><span>"isabelle_scala scalac $ISABELLE_SCALAC_OPTIONS ROOT.scala"</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span>
      evaluation_args </span><span class="main"><span>=</span></span><span> </span><span>Token.explode0</span><span> </span><span>Keyword.empty_keywords</span><span> </span><span class="inner_quoted"><span>"case_insensitive"</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>
  </span><span>#&gt;</span><span> </span><span class="entity"><span>Code_Target.set_printings</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Type_Constructor</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"fun"</span></span><span class="main"><span>,</span></span><span>
    </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>target</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>print_typ</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ty1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty2</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="entity"><span>brackify_infix</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fxy</span></span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="entity"><span>print_typ</span></span><span> </span><span class="entity"><span>BR</span></span><span> </span><span class="entity"><span>ty1</span></span><span> </span><span class="comment1"><span>(*product type vs. tupled arguments!*)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>str</span></span><span> </span><span class="inner_quoted"><span>"=&gt;"</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>print_typ</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>INFX</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ty2</span></span><span>
      </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span>#&gt;</span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Target.add_reserved</span></span><span> </span><span class="entity"><span>target</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span>
      </span><span class="inner_quoted"><span>"abstract"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"case"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"catch"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"class"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"def"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"do"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"else"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"enum"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"export"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"extends"</span></span><span class="main"><span>,</span></span><span>
      </span><span class="inner_quoted"><span>"false"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"final"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"finally"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"for"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"forSome"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"given"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"if"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"implicit"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"import"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"lazy"</span></span><span class="main"><span>,</span></span><span>
      </span><span class="inner_quoted"><span>"match"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"new"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"null"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"object"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"override"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"package"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"private"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"protected"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"requires"</span></span><span class="main"><span>,</span></span><span>
      </span><span class="inner_quoted"><span>"return"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"sealed"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"super"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"then"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"this"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"throw"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"trait"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"try"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"true"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"type"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"val"</span></span><span class="main"><span>,</span></span><span>
      </span><span class="inner_quoted"><span>"var"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"while"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"with"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"yield"</span></span><span>
    </span><span class="main"><span>]</span></span><span>
  </span><span>#&gt;</span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Code_Target.add_reserved</span></span><span> </span><span class="entity"><span>target</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span>
      </span><span class="inner_quoted"><span>"apply"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"sys"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"scala"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"BigInt"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"Nil"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"List"</span></span><span>
    </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span> </span><span class="comment1"><span>(*struct*)</span></span><span>
</span></pre>
</body>

</html>