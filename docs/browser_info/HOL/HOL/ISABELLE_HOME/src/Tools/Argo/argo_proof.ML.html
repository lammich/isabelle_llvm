<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹~~/src/Tools/Argo/argo_proof.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹~~/src/Tools/Argo/argo_proof.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      Tools/Argo/argo_proof.ML
    Author:     Sascha Boehme

The proof language of the Argo solver.

Proofs trace the inferences of the solver. They can be used to check unsatisfiability results.

The proof language is inspired by:

  Leonardo de Moura and Nikolaj Bjørner. Proofs and Refutations, and Z3. In
  Proceedings of the LPAR 2008 Workshops, Knowledge Exchange: Automated Provers and Proof
  Assistants, and the 7th International Workshop on the Implementation of Logics,
  volume 418 of CEUR Workshop Proceedings. CEUR-WS.org, 2008.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>ARGO_PROOF</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="comment1"><span>(* types *)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>proof_id</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>tautology</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Taut_And_1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Taut_And_2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * int </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Taut_Or_1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * int </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Taut_Or_2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Taut_Iff_1</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Taut_Iff_2</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Taut_Iff_3</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Taut_Iff_4</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Taut_Ite_Then</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Taut_Ite_Else</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>side</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Left</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Right</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>inequality</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Le</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Lt</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>rewrite</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Rewr_Not_True</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Not_False</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Not_Not</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Not_And</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Not_Or</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Rewr_Not_Iff</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Rewr_And_False</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_And_Dual</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * int </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_And_Sort</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * int list list </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Rewr_Or_True</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Or_Dual</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * int </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Or_Sort</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * int list list </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Rewr_Iff_True</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Iff_False</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Iff_Not_Not</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Iff_Refl</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Iff_Symm</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Rewr_Iff_Dual</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Rewr_Imp</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Ite_Prop</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Ite_True</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Ite_False</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Ite_Eq</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Rewr_Eq_Refl</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Eq_Symm</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Rewr_Neg</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Add</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span>Rat.rat * int option</span><span class="main"><span>)</span></span><span> list * </span><span class="main"><span>(</span></span><span>Rat.rat * int option</span><span class="main"><span>)</span></span><span> list </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Sub</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Rewr_Mul_Nums</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> Rat.rat * Rat.rat </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Mul_Zero</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Mul_One</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Mul_Comm</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Rewr_Mul_Assoc</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> side </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Mul_Sum</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> side </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Mul_Div</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> side </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Rewr_Div_Zero</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Div_One</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Div_Nums</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> Rat.rat * Rat.rat </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Rewr_Div_Num</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> side * Rat.rat </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Div_Mul</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> side * Rat.rat </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Div_Div</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> side </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Rewr_Div_Sum</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Min_Eq</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Min_Lt</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Min_Gt</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Max_Eq</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Max_Lt</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Rewr_Max_Gt</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Abs</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Eq_Nums</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> bool </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Eq_Sub</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Eq_Le</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Rewr_Ineq_Nums</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> inequality * bool </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Ineq_Add</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> inequality * Rat.rat </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Rewr_Ineq_Sub</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> inequality </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Ineq_Mul</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> inequality * Rat.rat </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Rewr_Not_Ineq</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> inequality
  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>conv</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Keep_Conv</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Then_Conv</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> conv * conv </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Args_Conv</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> Argo_Expr.kind * conv list </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Rewr_Conv</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rewrite
  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Axiom</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Taut</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tautology * Argo_Expr.expr </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Conjunct</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * int </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewrite</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> conv </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Hyp</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * Argo_Expr.expr </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Clause</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int list </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Lemma</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int list </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Unit_Res</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Refl</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> Argo_Expr.expr </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Symm</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Trans</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Cong</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Subst</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Linear_Comb</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>proof</span></span><span>

  </span><span class="comment1"><span>(* equalities and orders *)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> eq_proof_id</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>proof_id</span></span><span> * </span><span class="entity"><span>proof_id</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> proof_id_ord</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>proof_id</span></span><span> </span><span>ord</span><span>

  </span><span class="comment1"><span>(* conversion constructors *)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> keep_conv</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>conv</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_then_conv</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>conv</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>conv</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>conv</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_args_conv</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Argo_Expr.kind</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>conv</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>conv</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_rewr_conv</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rewrite</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>conv</span></span><span>

  </span><span class="comment1"><span>(* context *)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>context</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> cdcl_context</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>context</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> cc_context</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>context</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> simplex_context</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>context</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> solver_context</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>context</span></span><span>

  </span><span class="comment1"><span>(* proof constructors *)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_axiom</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof</span></span><span> * </span><span class="entity"><span>context</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_taut</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tautology</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Argo_Expr.expr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof</span></span><span> * </span><span class="entity"><span>context</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_conj</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof</span></span><span> * </span><span class="entity"><span>context</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_rewrite</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>conv</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof</span></span><span> * </span><span class="entity"><span>context</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_hyp</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Argo_Lit.literal</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof</span></span><span> * </span><span class="entity"><span>context</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_clause</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Argo_Lit.literal</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof</span></span><span> * </span><span class="entity"><span>context</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_lemma</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Argo_Lit.literal</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof</span></span><span> * </span><span class="entity"><span>context</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_unit_res</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Argo_Lit.literal</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof</span></span><span> * </span><span class="entity"><span>context</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_refl</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Argo_Term.term</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof</span></span><span> * </span><span class="entity"><span>context</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_symm</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>proof</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof</span></span><span> * </span><span class="entity"><span>context</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_trans</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>proof</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof</span></span><span> * </span><span class="entity"><span>context</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_cong</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>proof</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof</span></span><span> * </span><span class="entity"><span>context</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_subst</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>proof</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof</span></span><span> * </span><span class="entity"><span>context</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_linear_comb</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>proof</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof</span></span><span> * </span><span class="entity"><span>context</span></span><span>

  </span><span class="comment1"><span>(* proof destructors *)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> id_of</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>proof</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof_id</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> dest</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>proof</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof_id</span></span><span> * </span><span class="entity"><span>rule</span></span><span> * </span><span class="entity"><span>proof</span></span><span> </span><span>list</span><span>

  </span><span class="comment1"><span>(* string representations *)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> string_of_proof_id</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>proof_id</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> string_of_taut</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>tautology</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> string_of_rule</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>

  </span><span class="comment1"><span>(* unsatisfiability *)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>exception</span></span></span><span> UNSAT </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>proof</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> unsat</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>proof</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> 'a </span><span class="comment1"><span>(* raises UNSAT *)</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Argo_Proof</span></span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ARGO_PROOF</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="comment1"><span>(* types *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>tautology</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Taut_And_1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Taut_And_2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * int </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Taut_Or_1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * int </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Taut_Or_2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Taut_Iff_1</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Taut_Iff_2</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Taut_Iff_3</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Taut_Iff_4</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Taut_Ite_Then</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Taut_Ite_Else</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>side</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Left</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Right</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>inequality</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Le</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Lt</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>rewrite</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Rewr_Not_True</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Not_False</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Not_Not</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Not_And</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Not_Or</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Rewr_Not_Iff</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Rewr_And_False</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_And_Dual</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * int </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_And_Sort</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * int list list </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Rewr_Or_True</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Or_Dual</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * int </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Or_Sort</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * int list list </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Rewr_Iff_True</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Iff_False</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Iff_Not_Not</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Iff_Refl</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Iff_Symm</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Rewr_Iff_Dual</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Rewr_Imp</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Ite_Prop</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Ite_True</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Ite_False</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Ite_Eq</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Rewr_Eq_Refl</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Eq_Symm</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Rewr_Neg</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Add</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span>Rat.rat * int option</span><span class="main"><span>)</span></span><span> list * </span><span class="main"><span>(</span></span><span>Rat.rat * int option</span><span class="main"><span>)</span></span><span> list </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Sub</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Rewr_Mul_Nums</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> Rat.rat * Rat.rat </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Mul_Zero</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Mul_One</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Mul_Comm</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Rewr_Mul_Assoc</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> side </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Mul_Sum</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> side </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Mul_Div</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> side </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Rewr_Div_Zero</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Div_One</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Div_Nums</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> Rat.rat * Rat.rat </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Rewr_Div_Num</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> side * Rat.rat </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Div_Mul</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> side * Rat.rat </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Div_Div</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> side </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Rewr_Div_Sum</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Min_Eq</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Min_Lt</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Min_Gt</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Max_Eq</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Max_Lt</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Rewr_Max_Gt</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Abs</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Eq_Nums</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> bool </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Eq_Sub</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Eq_Le</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Rewr_Ineq_Nums</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> inequality * bool </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Ineq_Add</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> inequality * Rat.rat </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Rewr_Ineq_Sub</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> inequality </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewr_Ineq_Mul</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> inequality * Rat.rat </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Rewr_Not_Ineq</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> inequality

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>conv</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Keep_Conv</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Then_Conv</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> conv * conv </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Args_Conv</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> Argo_Expr.kind * conv list </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Rewr_Conv</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> rewrite

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Axiom</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Taut</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> tautology * Argo_Expr.expr </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Conjunct</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * int </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Rewrite</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> conv </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Hyp</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int * Argo_Expr.expr </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Clause</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int list </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Lemma</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int list </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Unit_Res</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Refl</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> Argo_Expr.expr </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Symm</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Trans</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Cong</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Subst</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Linear_Comb</span></span><span>

</span><span class="comment1"><span>(*
  Proof identifiers are intentially hidden to prevent that functions outside of this structure
  are able to build proofs. Proof can hence only be built by the functions provided by
  this structure.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>proof_id</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Cdcl</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Cc</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Simplex</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Solver</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>proof</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Proof</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> proof_id * rule * proof list


</span><span class="comment1"><span>(* internal functions *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>proof_id_card</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>4</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>raw_proof_id</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Cdcl</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>i</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_proof_id</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Cc</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>i</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_proof_id</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Simplex</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>i</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>raw_proof_id</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Solver</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>i</span></span><span>


</span><span class="comment1"><span>(* equalities and orders *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>int_of_proof_id</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Cdcl</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_proof_id</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Cc</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_proof_id</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Simplex</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>int_of_proof_id</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Solver</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>3</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>eq_proof_id</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Cdcl</span></span><span> </span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Cdcl</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>eq_proof_id</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Cc</span></span><span> </span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Cc</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>eq_proof_id</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Simplex</span></span><span> </span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Simplex</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>eq_proof_id</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Solver</span></span><span> </span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Solver</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>eq_proof_id</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>proof_id_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Cdcl</span></span><span> </span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Cdcl</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>int_ord</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>proof_id_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Cc</span></span><span> </span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Cc</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>int_ord</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>proof_id_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Simplex</span></span><span> </span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Simplex</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>int_ord</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>proof_id_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Solver</span></span><span> </span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Solver</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>int_ord</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>proof_id_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>id2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>int_ord</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>int_of_proof_id</span></span><span> </span><span class="entity"><span>id1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>int_of_proof_id</span></span><span> </span><span class="entity"><span>id2</span></span><span class="main"><span>)</span></span><span>


</span><span class="comment1"><span>(* conversion constructors *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>keep_conv</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Keep_Conv</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_then_conv</span></span><span> </span><span class="entity"><span>Keep_Conv</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>c</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_then_conv</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="entity"><span>Keep_Conv</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>c</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_then_conv</span></span><span> </span><span class="entity"><span>c1</span></span><span> </span><span class="entity"><span>c2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Then_Conv</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c2</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_args_conv</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>cs</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>forall</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Keep_Conv</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Keep_Conv</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>Args_Conv</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rewr_conv</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Rewr_Conv</span></span><span> </span><span class="entity"><span>r</span></span><span>


</span><span class="comment1"><span>(* context *)</span></span><span>

</span><span class="comment1"><span>(*
  The proof context stores the next unused identifier. Incidentally, the same type as
  for the proof identifier can be used as context. Every proof-producing module of the
  solver has its own proof identifier domain to ensure globally unique identifiers
  without sharing a single proof context.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>proof_id</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cdcl_context</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Cdcl</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cc_context</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Cc</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>simplex_context</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Simplex</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>solver_context</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Solver</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>next_id</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>Cdcl</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Cdcl</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>next_id</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>Cc</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Cc</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>next_id</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>Simplex</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Simplex</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>next_id</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>Solver</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Solver</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>


</span><span class="comment1"><span>(* proof destructors *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>id_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>id</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dest</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>p</span></span><span>


</span><span class="comment1"><span>(* proof constructors *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_proof</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>cx</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cx</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>next_id</span></span><span> </span><span class="entity"><span>cx</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ps</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cx</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_axiom</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_proof</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Axiom</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_taut</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>e</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_proof</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Taut</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>e</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_conj</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_proof</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Conjunct</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rewrite</span></span><span> </span><span class="entity"><span>Keep_Conv</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="entity"><span>cx</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cx</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_rewrite</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="entity"><span>cx</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_proof</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewrite</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>cx</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_hyp</span></span><span> </span><span class="entity"><span>lit</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_proof</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Hyp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Argo_Lit.signed_id_of</span></span><span> </span><span class="entity"><span>lit</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Argo_Lit.signed_expr_of</span></span><span> </span><span class="entity"><span>lit</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_clause</span></span><span> </span><span class="entity"><span>lits</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="entity"><span>cx</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_proof</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Clause</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>Argo_Lit.signed_id_of</span></span><span> </span><span class="entity"><span>lits</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>cx</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_lemma</span></span><span> </span><span class="entity"><span>lits</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_proof</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Lemma</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>Argo_Lit.signed_id_of</span></span><span> </span><span class="entity"><span>lits</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span>

</span><span class="comment1"><span>(*
  Replay of unit-resolution steps can be optimized if all premises follow a specific form.
  Therefore, each premise is checked if it is in clausal form.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>check_clause</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>Proof</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Clause</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>p</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>check_clause</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>Proof</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Lemma</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>p</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>check_clause</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>Proof</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Unit_Res</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>p</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>check_clause</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Fail</span><span> </span><span class="inner_quoted"><span>"bad clause proof"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_unit</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>p1</span></span><span> </span><span class="entity"><span>p2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_proof</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Unit_Res</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Argo_Term.id_of</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>check_clause</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_unit_res</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Argo_Lit.Pos</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>p1</span></span><span> </span><span class="entity"><span>p2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_unit</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>p1</span></span><span> </span><span class="entity"><span>p2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_unit_res</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Argo_Lit.Neg</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>p1</span></span><span> </span><span class="entity"><span>p2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_unit</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>p2</span></span><span> </span><span class="entity"><span>p1</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_refl</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_proof</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Refl</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Argo_Term.expr_of</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_symm</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_proof</span></span><span> </span><span class="entity"><span>Symm</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_trans</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Refl</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>p2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>pair</span><span> </span><span class="entity"><span>p2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_trans</span></span><span> </span><span class="entity"><span>p1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Refl</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>pair</span><span> </span><span class="entity"><span>p1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_trans</span></span><span> </span><span class="entity"><span>p1</span></span><span> </span><span class="entity"><span>p2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_proof</span></span><span> </span><span class="entity"><span>Trans</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p2</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_cong</span></span><span> </span><span class="entity"><span>p1</span></span><span> </span><span class="entity"><span>p2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_proof</span></span><span> </span><span class="entity"><span>Cong</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p2</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_subst</span></span><span> </span><span class="entity"><span>p1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Refl</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Refl</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>pair</span><span> </span><span class="entity"><span>p1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_subst</span></span><span> </span><span class="entity"><span>p1</span></span><span> </span><span class="entity"><span>p2</span></span><span> </span><span class="entity"><span>p3</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_proof</span></span><span> </span><span class="entity"><span>Subst</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p3</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_linear_comb</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_proof</span></span><span> </span><span class="entity"><span>Linear_Comb</span></span><span> </span><span class="entity"><span>ps</span></span><span>


</span><span class="comment1"><span>(* string representations *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_of_proof_id</span></span><span> </span><span class="entity"><span>id</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>string_of_int</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>proof_id_card</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>raw_proof_id</span></span><span> </span><span class="entity"><span>id</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>int_of_proof_id</span></span><span> </span><span class="entity"><span>id</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_of_list</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>enclose</span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>(</span></span><span>space_implode</span><span> </span><span class="inner_quoted"><span>", "</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parens</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>string_of_list</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>xs</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>brackets</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>string_of_list</span></span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>xs</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_of_taut</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Taut_And_1</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"and "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>n</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_taut</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Taut_And_2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"and "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>parens</span></span><span> </span><span>string_of_int</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_taut</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Taut_Or_1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"or "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>parens</span></span><span> </span><span>string_of_int</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_taut</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Taut_Or_2</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"or "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>n</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_taut</span></span><span> </span><span class="entity"><span>Taut_Iff_1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(p1 == p2) | p1 | p2"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_taut</span></span><span> </span><span class="entity"><span>Taut_Iff_2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(p1 == p2) | ~p1 | ~p2"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_taut</span></span><span> </span><span class="entity"><span>Taut_Iff_3</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"~(p1 == p2) | ~p1 | p2"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_taut</span></span><span> </span><span class="entity"><span>Taut_Iff_4</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"~(p1 == p2) | p1 | ~p2"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_taut</span></span><span> </span><span class="entity"><span>Taut_Ite_Then</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"~p | (ite p t1 t2) = t1"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_taut</span></span><span> </span><span class="entity"><span>Taut_Ite_Else</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"p | (ite p t1 t2) = t2"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Not_True</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"~T = F"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Not_False</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"~F = T"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Not_Not</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"~~p = p"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Not_And</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="inner_quoted"><span>"~(and ["</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"]) = (or ["</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"])"</span></span><span> 
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Not_Or</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="inner_quoted"><span>"~(or ["</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"]) = (and ["</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"])"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Not_Iff</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"~(p1 == p2) = (~p1 == ~p2)"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_And_False</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(and ... F("</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>i</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>") ...) = F"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_And_Dual</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="inner_quoted"><span>"(and ... p("</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>i1</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>") ... ~p("</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>i2</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>") ...) = F"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_And_Sort</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>iss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="inner_quoted"><span>"(and ["</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"]) = "</span></span><span> </span><span>^</span><span>
      </span><span class="inner_quoted"><span>"(and "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>brackets</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>brackets</span></span><span> </span><span>string_of_int</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>iss</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span> 
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Or_True</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(or ... T("</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>i</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>") ...) = T"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Or_Dual</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="inner_quoted"><span>"(or ... p("</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>i1</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>") ... ~p("</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>i2</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>") ...) = T"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Or_Sort</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>iss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="inner_quoted"><span>"(or ["</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"]) = "</span></span><span> </span><span>^</span><span>
      </span><span class="inner_quoted"><span>"(or "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>brackets</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>brackets</span></span><span> </span><span>string_of_int</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>iss</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span> 
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Iff_True</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(p == T) = p"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Iff_False</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(p == F) = ~p"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Iff_Not_Not</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(~p1 == ~p2) = (p1 == p2)"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Iff_Refl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(p == p) = T"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Iff_Symm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(p1 == p2) = (p2 == p1)"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Iff_Dual</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(p == ~p) = F"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Imp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(p1 --&gt; p2) = (~p1 | p2)"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Ite_Prop</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(if p1 p2 p2) = ((~p1 | p2) &amp; (p1 | p3) &amp; (p2 | p3))"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Ite_True</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(if T t1 t2) = t1"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Ite_False</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(if F t1 t2) = t2"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Ite_Eq</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(if p t t) = t"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Eq_Refl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(e = e) = T"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Eq_Symm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(e1 = e2) = (e2 = e1)"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Neg</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"-e = -1 * e"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Add</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_of_monom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Rat.string_of_rat</span><span> </span><span class="entity"><span>n</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_monom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@</span></span><span>1</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Rat.string_of_rat</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" * "</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"e"</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>i</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_of_polynom</span></span><span> </span><span class="entity"><span>ms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>space_implode</span><span> </span><span class="inner_quoted"><span>" + "</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>string_of_monom</span></span><span> </span><span class="entity"><span>ms</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>string_of_polynom</span></span><span> </span><span class="entity"><span>p1</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" = "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_of_polynom</span></span><span> </span><span class="entity"><span>p2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Sub</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"e1 - e2 = e1 + -1 * e2"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Mul_Nums</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Rat.string_of_rat</span><span> </span><span class="entity"><span>n1</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" * "</span></span><span> </span><span>^</span><span> </span><span>Rat.string_of_rat</span><span> </span><span class="entity"><span>n2</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" = "</span></span><span> </span><span>^</span><span> </span><span>Rat.string_of_rat</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n1</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>n2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Mul_Zero</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"0 * e = 0"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Mul_One</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"1 * e = e"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Mul_Comm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"e1 * e2 = e2 * e1"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Mul_Assoc</span></span><span> </span><span class="entity"><span>Left</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(e1 * e2) * e3 = e1 * (e2 * e3)"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Mul_Assoc</span></span><span> </span><span class="entity"><span>Right</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"e1 * (n * e2) = (e1 * n) * e2"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Mul_Sum</span></span><span> </span><span class="entity"><span>Left</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(e1 + ... + em) * e = e1 * e + ... em * e"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Mul_Sum</span></span><span> </span><span class="entity"><span>Right</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"e * (e1 + ... + em) = e * e1 + ... e * em"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Mul_Div</span></span><span> </span><span class="entity"><span>Left</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(e1 / e2) * e3 = (e1 * e3) / e2"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Mul_Div</span></span><span> </span><span class="entity"><span>Right</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"e1 * (e2 / * e3) = (e1 * e2) / e3"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Div_Zero</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"0 / e = 0"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Div_One</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"e / 1 = e"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Div_Nums</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Rat.string_of_rat</span><span> </span><span class="entity"><span>n1</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" / "</span></span><span> </span><span>^</span><span> </span><span>Rat.string_of_rat</span><span> </span><span class="entity"><span>n2</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" = "</span></span><span> </span><span>^</span><span> </span><span>Rat.string_of_rat</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n1</span></span><span> </span><span>/</span><span> </span><span class="entity"><span>n2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Div_Num</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Left</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Rat.string_of_rat</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" / e = "</span></span><span> </span><span>^</span><span> </span><span>Rat.string_of_rat</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" * (1 / e)"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Div_Num</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Right</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="inner_quoted"><span>"e / "</span></span><span> </span><span>^</span><span> </span><span>Rat.string_of_rat</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" = "</span></span><span> </span><span>^</span><span> </span><span>Rat.string_of_rat</span><span> </span><span class="main"><span>(</span></span><span>Rat.inv</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" * e"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Div_Mul</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Left</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
     </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>^</span><span> </span><span>Rat.string_of_rat</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" * e1) / e2 = "</span></span><span> </span><span>^</span><span> </span><span>Rat.string_of_rat</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" * (e1 / e2)"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Div_Mul</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Right</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="inner_quoted"><span>"e1 / ("</span></span><span> </span><span>^</span><span> </span><span>Rat.string_of_rat</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" * e2) = "</span></span><span> </span><span>^</span><span> </span><span>Rat.string_of_rat</span><span> </span><span class="main"><span>(</span></span><span>Rat.inv</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" * (e1 / e2)"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Div_Div</span></span><span> </span><span class="entity"><span>Left</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(e1 / e2) / e3 = e1 / (e2 * e3)"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Div_Div</span></span><span> </span><span class="entity"><span>Right</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"e1 / (e2 / e3) = (e1 * e3) / e2"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Div_Sum</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(e1 + ... + em) / e = e1 / e + ... + em / e"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Min_Eq</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"min e e = e"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Min_Lt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"min e1 e2 = (if e1 &lt;= e2 then e1 else e2)"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Min_Gt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"min e1 e2 = (if e2 &lt;= e1 then e2 else e1)"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Max_Eq</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"max e e = e"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Max_Lt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"max e1 e2 = (if e1 &lt; e2 then e2 else e1)"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Max_Gt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"max e1 e2 = (if e2 &lt; e1 then e1 else e2)"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Abs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"abs e = (if 0 &lt;= e then e else -e)"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Eq_Nums</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(n1 = n2) = true"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Eq_Nums</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(n1 ~= n2) = false"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Eq_Sub</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(e1 = e2) = (e1 - e2 = 0)"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>Rewr_Eq_Le</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(e1 = e2) = (and (e1 &lt;= e2) (e2 &lt;= e1))"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Ineq_Nums</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Le</span></span><span class="main"><span>,</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(n1 &lt;= n2) = true"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Ineq_Nums</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Le</span></span><span class="main"><span>,</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(n1 &lt;= n2) = false"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Ineq_Nums</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Lt</span></span><span class="main"><span>,</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(n1 &lt; n2) = true"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Ineq_Nums</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Lt</span></span><span class="main"><span>,</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(n1 &lt; n2) = false"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Ineq_Add</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Le</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(e1 &lt;= e2) = (e1 + n &lt;= e2 + n)"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Ineq_Add</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Lt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(e1 &lt; e2) = (e1 + n &lt; e2 + n)"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Ineq_Sub</span></span><span> </span><span class="entity"><span>Le</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(e1 &lt;= e2) = (e1 - e2 &lt;= 0)"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Ineq_Sub</span></span><span> </span><span class="entity"><span>Lt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(e1 &lt; e2) = (e1 - e2 &lt; 0)"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Ineq_Mul</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Le</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(e1 &lt;= e2) = (n * e1 &lt;= n * e2)"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Ineq_Mul</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Lt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"(e1 &lt; e2) = (n * e1 &lt; n * e2)"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Not_Ineq</span></span><span> </span><span class="entity"><span>Le</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"~(e1 &lt;= e2) = (e2 &lt; e1)"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Not_Ineq</span></span><span> </span><span class="entity"><span>Lt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"~(e1 &lt; e2) = (e2 &lt;= e1)"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>flatten_then_conv</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Then_Conv</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>flatten_then_conv</span></span><span> </span><span class="entity"><span>c1</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>flatten_then_conv</span></span><span> </span><span class="entity"><span>c2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>flatten_then_conv</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>c</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_of_conv</span></span><span> </span><span class="entity"><span>Keep_Conv</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"_"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_conv</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>Then_Conv</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>space_implode</span><span> </span><span class="inner_quoted"><span>" then "</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>enclose</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>string_of_conv</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>flatten_then_conv</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_conv</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Args_Conv</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="inner_quoted"><span>"args "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>Argo_Expr.string_of_kind</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>brackets</span></span><span> </span><span class="entity"><span>string_of_conv</span></span><span> </span><span class="entity"><span>cs</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_conv</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewr_Conv</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>string_of_rewr</span></span><span> </span><span class="entity"><span>r</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_of_rule</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Axiom</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"axiom "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>i</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rule</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Taut</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"tautology: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_of_taut</span></span><span> </span><span class="entity"><span>t</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rule</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Conjunct</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"conjunct "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>i</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" of "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>n</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rule</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rewrite</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"rewrite: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_of_conv</span></span><span> </span><span class="entity"><span>c</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rule</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Hyp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"hypothesis "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>i</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rule</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Clause</span></span><span> </span><span class="entity"><span>is</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"clause "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>brackets</span></span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>is</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rule</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Lemma</span></span><span> </span><span class="entity"><span>is</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"lemma "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>brackets</span></span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>is</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rule</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Unit_Res</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"unit-resolution "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>i</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rule</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Refl</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"reflexivity"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rule</span></span><span> </span><span class="entity"><span>Symm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"symmetry"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rule</span></span><span> </span><span class="entity"><span>Trans</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"transitivity"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rule</span></span><span> </span><span class="entity"><span>Cong</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"congruence"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rule</span></span><span> </span><span class="entity"><span>Subst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"substitution"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_rule</span></span><span> </span><span class="entity"><span>Linear_Comb</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"linear-combination"</span></span><span>


</span><span class="comment1"><span>(* unsatisfiability *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>exception</span></span></span><span> </span><span class="entity"><span>UNSAT</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>proof</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>unsat</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>UNSAT</span></span><span> </span><span class="entity"><span>p</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span></pre>
</body>

</html>