<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Tools/BNF/bnf_def.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Tools/BNF/bnf_def.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      HOL/Tools/BNF/bnf_def.ML
    Author:     Dmitriy Traytel, TU Muenchen
    Author:     Jasmin Blanchette, TU Muenchen
    Author:     Martin Desharnais, TU Muenchen
    Author:     Jan van Brügge, TU Muenchen
    Copyright   2012, 2013, 2014, 2022

Definition of bounded natural functors.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>BNF_DEF</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>bnf</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>nonemptiness_witness</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>I</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>list</span><span class="main"><span>,</span></span><span> wit</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span> prop</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>}</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> morph_bnf</span><span class="main"><span>:</span></span><span> </span><span>morphism</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bnf</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> morph_bnf_defs</span><span class="main"><span>:</span></span><span> </span><span>morphism</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bnf</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> permute_deads</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bnf</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> transfer_bnf</span><span class="main"><span>:</span></span><span> </span><span>theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bnf</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> bnf_of</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span>option</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> bnf_of_global</span><span class="main"><span>:</span></span><span> </span><span>theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span>option</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> bnf_interpretation</span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>theory</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> interpret_bnf</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> register_bnf_raw</span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> register_bnf</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> name_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> T_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> live_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> lives_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> dead_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> deads_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> bd_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nwits_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mapN</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> predN</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> relN</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> setN</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_setN</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_witN</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> map_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> pred_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rel_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> sets_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_T_of_bnf</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_bd_of_bnf</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_map_of_bnf</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_pred_of_bnf</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_rel_of_bnf</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_sets_of_bnf</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_wits_of_bnf</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>int</span><span> </span><span>list</span><span> * </span><span>term</span><span class="main"><span>)</span></span><span> </span><span>list</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> bd_Card_order_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> bd_Cinfinite_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> bd_Cnotzero_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> bd_card_order_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> bd_cinfinite_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> bd_regularCard_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> collect_set_map_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> in_bd_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> in_cong_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> in_mono_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> in_rel_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> inj_map_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> inj_map_strong_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> le_rel_OO_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> map_comp0_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> map_comp_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> map_cong0_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> map_cong_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> map_cong_pred_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> map_cong_simp_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> map_def_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> map_id0_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> map_id_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> map_ident0_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> map_ident_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> map_transfer_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> pred_cong0_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> pred_cong_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> pred_cong_simp_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> pred_def_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> pred_map_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> pred_mono_strong0_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> pred_mono_strong_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> pred_mono_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> pred_set_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> pred_rel_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> pred_transfer_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> pred_True_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rel_Grp_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rel_OO_Grp_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rel_OO_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rel_cong0_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rel_cong_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rel_cong_simp_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rel_conversep_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rel_def_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rel_eq_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rel_flip_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rel_map_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rel_mono_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rel_mono_strong0_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rel_mono_strong_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rel_eq_onp_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rel_refl_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rel_refl_strong_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rel_reflp_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rel_symp_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rel_transfer_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rel_transp_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> set_bd_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> set_defs_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> set_map0_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> set_map_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> set_transfer_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> wit_thms_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> wit_thmss_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_map</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_pred</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_rel</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_set</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> build_map</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>typ</span><span> * </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> * </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> build_rel</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span class="main"><span>(</span></span><span>int</span><span> * </span><span>term</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span>typ</span><span> * </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> * </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> build_set</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> flatten_type_args_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> 'a </span><span class="main"><span>-&gt;</span></span><span> 'a </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> 'a </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> map_flattened_map_args</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> 'a </span><span>list</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    'a </span><span>list</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_witness</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>list</span><span> * </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nonemptiness_witness</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_wit_goals</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span>list</span><span> * </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> minimize_wits</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>''a </span><span>list</span><span> * 'b</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>''a </span><span>list</span><span> * 'b</span><span class="main"><span>)</span></span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> wits_of_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>nonemptiness_witness</span></span><span> </span><span>list</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> zip_axioms</span><span class="main"><span>:</span></span><span> 'a </span><span class="main"><span>-&gt;</span></span><span> 'a </span><span class="main"><span>-&gt;</span></span><span> 'a </span><span class="main"><span>-&gt;</span></span><span> 'a </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> 'a </span><span class="main"><span>-&gt;</span></span><span> 'a </span><span class="main"><span>-&gt;</span></span><span> 'a </span><span class="main"><span>-&gt;</span></span><span> 'a </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> 'a </span><span class="main"><span>-&gt;</span></span><span> 'a </span><span class="main"><span>-&gt;</span></span><span> 'a </span><span class="main"><span>-&gt;</span></span><span> 'a </span><span>list</span><span>

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>inline_policy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Dont_Inline</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Hardly_Inline</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Smart_Inline</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Do_Inline</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>fact_policy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Dont_Note</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Note_Some</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Note_All</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> bnf_internals</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span>Config.T</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> bnf_timing</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span>Config.T</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> user_policy</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>fact_policy</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fact_policy</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> note_bnf_thms</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>fact_policy</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>binding</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="entity"><span>bnf</span></span><span> * </span><span>local_theory</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> note_bnf_defs</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bnf</span></span><span> * </span><span>local_theory</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> print_bnfs</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>unit</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> prepare_def</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>inline_policy</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fact_policy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span>binding</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> 'a </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> 'b </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>typ</span><span> </span><span>list</span><span> </span><span>option</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>binding</span><span> * 'a</span><span class="main"><span>)</span></span><span> * 'b</span><span class="main"><span>)</span></span><span> * 'b </span><span>list</span><span class="main"><span>)</span></span><span> * 'b</span><span class="main"><span>)</span></span><span> * 'b </span><span>list</span><span class="main"><span>)</span></span><span> * 'b </span><span>option</span><span class="main"><span>)</span></span><span> * 'b </span><span>option</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>string</span><span> * </span><span>term</span><span> </span><span>list</span><span> * </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span class="main"><span>)</span></span><span> </span><span>option</span><span> * </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> *
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bnf</span></span><span> * </span><span>local_theory</span><span class="main"><span>)</span></span><span> *
    </span><span>local_theory</span><span> * </span><span>thm</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> define_bnf_consts</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>inline_policy</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fact_policy</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span>option</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>binding</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>binding</span><span> * </span><span>typ</span><span class="main"><span>)</span></span><span> * </span><span>term</span><span class="main"><span>)</span></span><span> * </span><span>term</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> * </span><span>term</span><span class="main"><span>)</span></span><span> * </span><span>term</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> * </span><span>term</span><span> </span><span>option</span><span class="main"><span>)</span></span><span> * </span><span>term</span><span> </span><span>option</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>list</span><span> * </span><span>typ</span><span> </span><span>list</span><span> * </span><span>typ</span><span> </span><span>list</span><span> * </span><span>typ</span><span class="main"><span>)</span></span><span> *
       </span><span class="main"><span>(</span></span><span>term</span><span> * </span><span>term</span><span> </span><span>list</span><span> * </span><span>term</span><span> * </span><span class="main"><span>(</span></span><span>int</span><span> </span><span>list</span><span> * </span><span>term</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> * </span><span>term</span><span> * </span><span>term</span><span class="main"><span>)</span></span><span> *
       </span><span class="main"><span>(</span></span><span>thm</span><span> * </span><span>thm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> * </span><span>thm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> * </span><span>thm</span><span class="main"><span>)</span></span><span> *
       </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span class="main"><span>)</span></span><span> *
        </span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span class="main"><span>)</span></span><span> *
        </span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span class="main"><span>)</span></span><span> *
        </span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span class="main"><span>)</span></span><span> *
        </span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span class="main"><span>)</span></span><span> *
        </span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span class="main"><span>)</span></span><span> *
        </span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> * </span><span>local_theory</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> bnf_def</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>inline_policy</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fact_policy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>binding</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span>option</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>binding</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>binding</span><span> * </span><span>typ</span><span class="main"><span>)</span></span><span> * </span><span>term</span><span class="main"><span>)</span></span><span> * </span><span>term</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> * </span><span>term</span><span class="main"><span>)</span></span><span> * </span><span>term</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> * </span><span>term</span><span> </span><span>option</span><span class="main"><span>)</span></span><span> * </span><span>term</span><span> </span><span>option</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bnf</span></span><span> * </span><span>local_theory</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> bnf_cmd</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>binding</span><span> * </span><span>string</span><span class="main"><span>)</span></span><span> * </span><span>string</span><span class="main"><span>)</span></span><span> * </span><span>string</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> * </span><span>string</span><span class="main"><span>)</span></span><span> * </span><span>string</span><span> </span><span>list</span><span class="main"><span>)</span></span><span>
      * </span><span>string</span><span> </span><span>option</span><span class="main"><span>)</span></span><span> * </span><span>string</span><span> </span><span>option</span><span class="main"><span>)</span></span><span> * </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Plugin_Name.filter</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.state</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>BNF_Def</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>BNF_DEF</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>BNF_Util</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>BNF_Tactics</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>BNF_Def_Tactics</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fundefcong_attrs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>attributes</span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="../../../../../Fun_Def_Base.html#Fun_Def_Base.fundef_cong|attribute"><span class="operator"><span>fundef_cong</span></span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mono_attrs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>attributes</span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="../inductive.ML.html#Inductive.mono|attribute"><span class="operator"><span>mono</span></span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>axioms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  map_id0</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  map_comp0</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  map_cong0</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  set_map0</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  bd_card_order</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  bd_cinfinite</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  bd_regularCard</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  set_bd</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  le_rel_OO</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  rel_OO_Grp</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  pred_set</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span>
</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_axioms'</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>comp</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cong</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c_o</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cinf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>creg</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_bd</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>le_rel_OO</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pred</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>map_id0 </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>id</span></span><span class="main"><span>,</span></span><span> map_comp0 </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>comp</span></span><span class="main"><span>,</span></span><span> map_cong0 </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>cong</span></span><span class="main"><span>,</span></span><span> set_map0 </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map</span></span><span class="main"><span>,</span></span><span> bd_card_order </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>c_o</span></span><span class="main"><span>,</span></span><span>
   bd_cinfinite </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>cinf</span></span><span class="main"><span>,</span></span><span> bd_regularCard </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>creg</span></span><span class="main"><span>,</span></span><span> set_bd </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>set_bd</span></span><span class="main"><span>,</span></span><span> le_rel_OO </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>le_rel_OO</span></span><span class="main"><span>,</span></span><span> rel_OO_Grp </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> pred_set </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pred</span></span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dest_cons</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>List.Empty</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>dest_cons</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_axioms</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thms</span></span><span>
  </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>the_single</span><span>
  </span><span>|&gt;</span><span> </span><span class="entity"><span>dest_cons</span></span><span>
  </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>dest_cons</span></span><span>
  </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>dest_cons</span></span><span>
  </span><span>||&gt;&gt;</span><span> </span><span>chop</span><span> </span><span class="entity"><span>n</span></span><span>
  </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>dest_cons</span></span><span>
  </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>dest_cons</span></span><span>
  </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>dest_cons</span></span><span>
  </span><span>||&gt;&gt;</span><span> </span><span>chop</span><span> </span><span class="entity"><span>n</span></span><span>
  </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>dest_cons</span></span><span>
  </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>dest_cons</span></span><span>
  </span><span>||&gt;</span><span> </span><span>the_single</span><span>
  </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_axioms'</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>zip_axioms</span></span><span> </span><span class="entity"><span>mid</span></span><span> </span><span class="entity"><span>mcomp</span></span><span> </span><span class="entity"><span>mcong</span></span><span> </span><span class="entity"><span>smap</span></span><span> </span><span class="entity"><span>bdco</span></span><span> </span><span class="entity"><span>bdinf</span></span><span> </span><span class="entity"><span>bdreg</span></span><span> </span><span class="entity"><span>sbd</span></span><span> </span><span class="entity"><span>le_rel_OO</span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="entity"><span>pred</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>[</span></span><span class="entity"><span>mid</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mcomp</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mcong</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>smap</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>bdco</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bdinf</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bdreg</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>sbd</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>le_rel_OO</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pred</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_axioms</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>map_id0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_comp0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_cong0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_map0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bd_card_order</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bd_cinfinite</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>bd_regularCard</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_bd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>le_rel_OO</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_OO_Grp</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pred_set</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>map_id0 </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>map_id0</span></span><span class="main"><span>,</span></span><span>
    map_comp0 </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>map_comp0</span></span><span class="main"><span>,</span></span><span>
    map_cong0 </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>map_cong0</span></span><span class="main"><span>,</span></span><span>
    set_map0 </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>set_map0</span></span><span class="main"><span>,</span></span><span>
    bd_card_order </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>bd_card_order</span></span><span class="main"><span>,</span></span><span>
    bd_cinfinite </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>bd_cinfinite</span></span><span class="main"><span>,</span></span><span>
    bd_regularCard </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>bd_regularCard</span></span><span class="main"><span>,</span></span><span>
    set_bd </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>set_bd</span></span><span class="main"><span>,</span></span><span>
    le_rel_OO </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>le_rel_OO</span></span><span class="main"><span>,</span></span><span>
    rel_OO_Grp </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>rel_OO_Grp</span></span><span class="main"><span>,</span></span><span>
    pred_set </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>pred_set</span></span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>morph_axioms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_axioms</span></span><span> </span><span>o</span><span> </span><span>Morphism.thm</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  map_def</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  set_defs</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  rel_def</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  pred_def</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span>
</span><span class="main"><span>}</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_defs</span></span><span> </span><span class="entity"><span>map</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="entity"><span>pred</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>map_def </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map</span></span><span class="main"><span>,</span></span><span> set_defs </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>,</span></span><span> rel_def </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> pred_def </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pred</span></span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_defs</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>map_def</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_defs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_def</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pred_def</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>map_def </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>map_def</span></span><span class="main"><span>,</span></span><span> set_defs </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>set_defs</span></span><span class="main"><span>,</span></span><span> rel_def </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>rel_def</span></span><span class="main"><span>,</span></span><span> pred_def </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>pred_def</span></span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>morph_defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_defs</span></span><span> </span><span>o</span><span> </span><span>Morphism.thm</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>facts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  bd_Card_order</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  bd_Cinfinite</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  bd_Cnotzero</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  collect_set_map</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  in_bd</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  in_cong</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  in_mono</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  in_rel</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  inj_map</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  inj_map_strong</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  map_comp</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  map_cong</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  map_cong_simp</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  map_cong_pred</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  map_id</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  map_ident0</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  map_ident</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  map_ident_strong</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  map_transfer</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  rel_eq</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  rel_flip</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  set_map</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  rel_cong0</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  rel_cong</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  rel_cong_simp</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  rel_map</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  rel_mono</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  rel_mono_strong0</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  rel_mono_strong</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  set_transfer</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  rel_Grp</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  rel_conversep</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  rel_OO</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  rel_refl</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  rel_refl_strong</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  rel_reflp</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  rel_symp</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  rel_transp</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  rel_transfer</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  rel_eq_onp</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  pred_transfer</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  pred_True</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  pred_map</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  pred_rel</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  pred_mono_strong0</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  pred_mono_strong</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  pred_mono</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  pred_cong0</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  pred_cong</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span class="main"><span>,</span></span><span>
  pred_cong_simp</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>lazy</span><span>
</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_facts</span></span><span> </span><span class="entity"><span>bd_Card_order</span></span><span> </span><span class="entity"><span>bd_Cinfinite</span></span><span> </span><span class="entity"><span>bd_Cnotzero</span></span><span> </span><span class="entity"><span>collect_set_map</span></span><span> </span><span class="entity"><span>in_bd</span></span><span> </span><span class="entity"><span>in_cong</span></span><span> </span><span class="entity"><span>in_mono</span></span><span> </span><span class="entity"><span>in_rel</span></span><span>
    </span><span class="entity"><span>inj_map</span></span><span> </span><span class="entity"><span>inj_map_strong</span></span><span> </span><span class="entity"><span>map_comp</span></span><span> </span><span class="entity"><span>map_cong</span></span><span> </span><span class="entity"><span>map_cong_simp</span></span><span> </span><span class="entity"><span>map_cong_pred</span></span><span> </span><span class="entity"><span>map_id</span></span><span> </span><span class="entity"><span>map_ident0</span></span><span> </span><span class="entity"><span>map_ident</span></span><span>
    </span><span class="entity"><span>map_ident_strong</span></span><span> </span><span class="entity"><span>map_transfer</span></span><span> </span><span class="entity"><span>rel_eq</span></span><span> </span><span class="entity"><span>rel_flip</span></span><span> </span><span class="entity"><span>set_map</span></span><span> </span><span class="entity"><span>rel_cong0</span></span><span> </span><span class="entity"><span>rel_cong</span></span><span> </span><span class="entity"><span>rel_cong_simp</span></span><span> </span><span class="entity"><span>rel_map</span></span><span>
    </span><span class="entity"><span>rel_mono</span></span><span> </span><span class="entity"><span>rel_mono_strong0</span></span><span> </span><span class="entity"><span>rel_mono_strong</span></span><span> </span><span class="entity"><span>set_transfer</span></span><span> </span><span class="entity"><span>rel_Grp</span></span><span> </span><span class="entity"><span>rel_conversep</span></span><span> </span><span class="entity"><span>rel_OO</span></span><span> </span><span class="entity"><span>rel_refl</span></span><span>
    </span><span class="entity"><span>rel_refl_strong</span></span><span> </span><span class="entity"><span>rel_reflp</span></span><span> </span><span class="entity"><span>rel_symp</span></span><span> </span><span class="entity"><span>rel_transp</span></span><span> </span><span class="entity"><span>rel_transfer</span></span><span> </span><span class="entity"><span>rel_eq_onp</span></span><span> </span><span class="entity"><span>pred_transfer</span></span><span> </span><span class="entity"><span>pred_True</span></span><span>
    </span><span class="entity"><span>pred_map</span></span><span> </span><span class="entity"><span>pred_rel</span></span><span> </span><span class="entity"><span>pred_mono_strong0</span></span><span> </span><span class="entity"><span>pred_mono_strong</span></span><span> </span><span class="entity"><span>pred_mono</span></span><span> </span><span class="entity"><span>pred_cong0</span></span><span> </span><span class="entity"><span>pred_cong</span></span><span>
    </span><span class="entity"><span>pred_cong_simp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  bd_Card_order </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bd_Card_order</span></span><span class="main"><span>,</span></span><span>
  bd_Cinfinite </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bd_Cinfinite</span></span><span class="main"><span>,</span></span><span>
  bd_Cnotzero </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bd_Cnotzero</span></span><span class="main"><span>,</span></span><span>
  collect_set_map </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>collect_set_map</span></span><span class="main"><span>,</span></span><span>
  in_bd </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>in_bd</span></span><span class="main"><span>,</span></span><span>
  in_cong </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>in_cong</span></span><span class="main"><span>,</span></span><span>
  in_mono </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>in_mono</span></span><span class="main"><span>,</span></span><span>
  in_rel </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>in_rel</span></span><span class="main"><span>,</span></span><span>
  inj_map </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inj_map</span></span><span class="main"><span>,</span></span><span>
  inj_map_strong </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inj_map_strong</span></span><span class="main"><span>,</span></span><span>
  map_comp </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_comp</span></span><span class="main"><span>,</span></span><span>
  map_cong </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_cong</span></span><span class="main"><span>,</span></span><span>
  map_cong_simp </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_cong_simp</span></span><span class="main"><span>,</span></span><span>
  map_cong_pred </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_cong_pred</span></span><span class="main"><span>,</span></span><span>
  map_id </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_id</span></span><span class="main"><span>,</span></span><span>
  map_ident0 </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_ident0</span></span><span class="main"><span>,</span></span><span>
  map_ident </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_ident</span></span><span class="main"><span>,</span></span><span>
  map_ident_strong </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_ident_strong</span></span><span class="main"><span>,</span></span><span>
  map_transfer </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_transfer</span></span><span class="main"><span>,</span></span><span>
  rel_eq </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_eq</span></span><span class="main"><span>,</span></span><span>
  rel_flip </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_flip</span></span><span class="main"><span>,</span></span><span>
  set_map </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>set_map</span></span><span class="main"><span>,</span></span><span>
  rel_cong0 </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_cong0</span></span><span class="main"><span>,</span></span><span>
  rel_cong </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_cong</span></span><span class="main"><span>,</span></span><span>
  rel_cong_simp </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_cong_simp</span></span><span class="main"><span>,</span></span><span>
  rel_map </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_map</span></span><span class="main"><span>,</span></span><span>
  rel_mono </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_mono</span></span><span class="main"><span>,</span></span><span>
  rel_mono_strong0 </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_mono_strong0</span></span><span class="main"><span>,</span></span><span>
  rel_mono_strong </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_mono_strong</span></span><span class="main"><span>,</span></span><span>
  rel_transfer </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_transfer</span></span><span class="main"><span>,</span></span><span>
  rel_Grp </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_Grp</span></span><span class="main"><span>,</span></span><span>
  rel_conversep </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_conversep</span></span><span class="main"><span>,</span></span><span>
  rel_OO </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_OO</span></span><span class="main"><span>,</span></span><span>
  rel_refl </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_refl</span></span><span class="main"><span>,</span></span><span>
  rel_refl_strong </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_refl_strong</span></span><span class="main"><span>,</span></span><span>
  rel_reflp </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_reflp</span></span><span class="main"><span>,</span></span><span>
  rel_symp </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_symp</span></span><span class="main"><span>,</span></span><span>
  rel_transp </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_transp</span></span><span class="main"><span>,</span></span><span>
  set_transfer </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>set_transfer</span></span><span class="main"><span>,</span></span><span>
  rel_eq_onp </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_eq_onp</span></span><span class="main"><span>,</span></span><span>
  pred_transfer </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pred_transfer</span></span><span class="main"><span>,</span></span><span>
  pred_True </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pred_True</span></span><span class="main"><span>,</span></span><span>
  pred_map </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pred_map</span></span><span class="main"><span>,</span></span><span>
  pred_rel </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pred_rel</span></span><span class="main"><span>,</span></span><span>
  pred_mono_strong0 </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pred_mono_strong0</span></span><span class="main"><span>,</span></span><span>
  pred_mono_strong </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pred_mono_strong</span></span><span class="main"><span>,</span></span><span>
  pred_mono </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pred_mono</span></span><span class="main"><span>,</span></span><span>
  pred_cong0 </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pred_cong0</span></span><span class="main"><span>,</span></span><span>
  pred_cong </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pred_cong</span></span><span class="main"><span>,</span></span><span>
  pred_cong_simp </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pred_cong_simp</span></span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_facts</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>{</span></span><span>
  </span><span class="entity"><span>bd_Card_order</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>bd_Cinfinite</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>bd_Cnotzero</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>collect_set_map</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>in_bd</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>in_cong</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>in_mono</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>in_rel</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>inj_map</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>inj_map_strong</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>map_comp</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>map_cong</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>map_cong_simp</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>map_cong_pred</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>map_id</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>map_ident0</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>map_ident</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>map_ident_strong</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>map_transfer</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>rel_eq</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>rel_flip</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>set_map</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>rel_cong0</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>rel_cong</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>rel_cong_simp</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>rel_map</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>rel_mono</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>rel_mono_strong0</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>rel_mono_strong</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>rel_transfer</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>rel_Grp</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>rel_conversep</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>rel_OO</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>rel_refl</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>rel_refl_strong</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>rel_reflp</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>rel_symp</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>rel_transp</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>set_transfer</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>rel_eq_onp</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>pred_transfer</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>pred_True</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>pred_map</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>pred_rel</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>pred_mono_strong0</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>pred_mono_strong</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>pred_mono</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>pred_cong0</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>pred_cong</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>pred_cong_simp</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>bd_Card_order </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>bd_Card_order</span></span><span class="main"><span>,</span></span><span>
    bd_Cinfinite </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>bd_Cinfinite</span></span><span class="main"><span>,</span></span><span>
    bd_Cnotzero </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>bd_Cnotzero</span></span><span class="main"><span>,</span></span><span>
    collect_set_map </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>collect_set_map</span></span><span class="main"><span>,</span></span><span>
    in_bd </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>in_bd</span></span><span class="main"><span>,</span></span><span>
    in_cong </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>in_cong</span></span><span class="main"><span>,</span></span><span>
    in_mono </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>in_mono</span></span><span class="main"><span>,</span></span><span>
    in_rel </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>in_rel</span></span><span class="main"><span>,</span></span><span>
    inj_map </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>inj_map</span></span><span class="main"><span>,</span></span><span>
    inj_map_strong </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>inj_map_strong</span></span><span class="main"><span>,</span></span><span>
    map_comp </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>map_comp</span></span><span class="main"><span>,</span></span><span>
    map_cong </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>map_cong</span></span><span class="main"><span>,</span></span><span>
    map_cong_simp </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>map_cong_simp</span></span><span class="main"><span>,</span></span><span>
    map_cong_pred </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>map_cong_pred</span></span><span class="main"><span>,</span></span><span>
    map_id </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>map_id</span></span><span class="main"><span>,</span></span><span>
    map_ident0 </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>map_ident0</span></span><span class="main"><span>,</span></span><span>
    map_ident </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>map_ident</span></span><span class="main"><span>,</span></span><span>
    map_ident_strong </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>map_ident_strong</span></span><span class="main"><span>,</span></span><span>
    map_transfer </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>map_transfer</span></span><span class="main"><span>,</span></span><span>
    rel_eq </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>rel_eq</span></span><span class="main"><span>,</span></span><span>
    rel_flip </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>rel_flip</span></span><span class="main"><span>,</span></span><span>
    set_map </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_map</span></span><span class="main"><span>,</span></span><span>
    rel_cong0 </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>rel_cong0</span></span><span class="main"><span>,</span></span><span>
    rel_cong </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>rel_cong</span></span><span class="main"><span>,</span></span><span>
    rel_cong_simp </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>rel_cong_simp</span></span><span class="main"><span>,</span></span><span>
    rel_map </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel_map</span></span><span class="main"><span>,</span></span><span>
    rel_mono </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>rel_mono</span></span><span class="main"><span>,</span></span><span>
    rel_mono_strong0 </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>rel_mono_strong0</span></span><span class="main"><span>,</span></span><span>
    rel_mono_strong </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>rel_mono_strong</span></span><span class="main"><span>,</span></span><span>
    rel_transfer </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>rel_transfer</span></span><span class="main"><span>,</span></span><span>
    rel_Grp </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>rel_Grp</span></span><span class="main"><span>,</span></span><span>
    rel_conversep </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>rel_conversep</span></span><span class="main"><span>,</span></span><span>
    rel_OO </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>rel_OO</span></span><span class="main"><span>,</span></span><span>
    rel_refl </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>rel_refl</span></span><span class="main"><span>,</span></span><span>
    rel_refl_strong </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>rel_refl_strong</span></span><span class="main"><span>,</span></span><span>
    rel_reflp </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>rel_reflp</span></span><span class="main"><span>,</span></span><span>
    rel_symp </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>rel_symp</span></span><span class="main"><span>,</span></span><span>
    rel_transp </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>rel_transp</span></span><span class="main"><span>,</span></span><span>
    set_transfer </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_transfer</span></span><span class="main"><span>,</span></span><span>
    rel_eq_onp </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>rel_eq_onp</span></span><span class="main"><span>,</span></span><span>
    pred_transfer </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>pred_transfer</span></span><span class="main"><span>,</span></span><span>
    pred_True </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>pred_True</span></span><span class="main"><span>,</span></span><span>
    pred_map </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>pred_map</span></span><span class="main"><span>,</span></span><span>
    pred_rel </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>pred_rel</span></span><span class="main"><span>,</span></span><span>
    pred_mono_strong0 </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>pred_mono_strong0</span></span><span class="main"><span>,</span></span><span>
    pred_mono_strong </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>pred_mono_strong</span></span><span class="main"><span>,</span></span><span>
    pred_mono </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>pred_mono</span></span><span class="main"><span>,</span></span><span>
    pred_cong0 </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>pred_cong0</span></span><span class="main"><span>,</span></span><span>
    pred_cong </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>pred_cong</span></span><span class="main"><span>,</span></span><span>
    pred_cong_simp </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>pred_cong_simp</span></span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>morph_facts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_facts</span></span><span> </span><span>o</span><span> </span><span>Morphism.thm</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>nonemptiness_witness</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  I</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  wit</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
  prop</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span>
</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_witness</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prop</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>I </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> wit </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>wit</span></span><span class="main"><span>,</span></span><span> prop </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prop</span></span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_witness</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>g</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prop</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>I </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> wit </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>wit</span></span><span class="main"><span>,</span></span><span> prop </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>g</span></span><span> </span><span class="entity"><span>prop</span></span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>morph_witness</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_witness</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>BNF</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>{</span></span><span>
  name</span><span class="main"><span>:</span></span><span> binding</span><span class="main"><span>,</span></span><span>
  T</span><span class="main"><span>:</span></span><span> typ</span><span class="main"><span>,</span></span><span>
  live</span><span class="main"><span>:</span></span><span> int</span><span class="main"><span>,</span></span><span>
  lives</span><span class="main"><span>:</span></span><span> typ list</span><span class="main"><span>,</span></span><span> </span><span class="comment1"><span>(*source type variables of map*)</span></span><span>
  lives'</span><span class="main"><span>:</span></span><span> typ list</span><span class="main"><span>,</span></span><span> </span><span class="comment1"><span>(*target type variables of map*)</span></span><span>
  dead</span><span class="main"><span>:</span></span><span> int</span><span class="main"><span>,</span></span><span>
  deads</span><span class="main"><span>:</span></span><span> typ list</span><span class="main"><span>,</span></span><span>
  map</span><span class="main"><span>:</span></span><span> term</span><span class="main"><span>,</span></span><span>
  sets</span><span class="main"><span>:</span></span><span> term list</span><span class="main"><span>,</span></span><span>
  bd</span><span class="main"><span>:</span></span><span> term</span><span class="main"><span>,</span></span><span>
  axioms</span><span class="main"><span>:</span></span><span> axioms</span><span class="main"><span>,</span></span><span>
  defs</span><span class="main"><span>:</span></span><span> defs</span><span class="main"><span>,</span></span><span>
  facts</span><span class="main"><span>:</span></span><span> facts</span><span class="main"><span>,</span></span><span>
  nwits</span><span class="main"><span>:</span></span><span> int</span><span class="main"><span>,</span></span><span>
  wits</span><span class="main"><span>:</span></span><span> nonemptiness_witness list</span><span class="main"><span>,</span></span><span>
  rel</span><span class="main"><span>:</span></span><span> term</span><span class="main"><span>,</span></span><span>
  pred</span><span class="main"><span>:</span></span><span> term
</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* getters *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rep_bnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BNF</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>name_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>name </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>T </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_T_of_bnf</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_rep</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rep_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Term.typ_subst_atomic</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>deads </span><span class="entity"><span>bnf_rep</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ds</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>lives </span><span class="entity"><span>bnf_rep</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>bnf_rep</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>live </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lives_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>lives </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dead_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>dead </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deads_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>deads </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>axioms_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>axioms </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>facts_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nwits_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>nwits </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wits_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>wits </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>flatten_type_args_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="entity"><span>dead_x</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lives</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lives_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deads_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>permute_like_unique</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deads</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>lives</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>deads</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dead_x</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(*terms*)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>map </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sets_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>sets </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>Us</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_rep</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rep_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>Term.subst_atomic_types</span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>deads </span><span class="entity"><span>bnf_rep</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ds</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>lives </span><span class="entity"><span>bnf_rep</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>lives' </span><span class="entity"><span>bnf_rep</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Us</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map </span><span class="entity"><span>bnf_rep</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_sets_of_bnf</span></span><span> </span><span class="entity"><span>Dss</span></span><span> </span><span class="entity"><span>Tss</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_rep</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rep_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.subst_atomic_types</span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>deads </span><span class="entity"><span>bnf_rep</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ds</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>lives </span><span class="entity"><span>bnf_rep</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Dss</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>sets </span><span class="entity"><span>bnf_rep</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>bd </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bd_of_bnf</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_rep</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rep_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Term.subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>deads </span><span class="entity"><span>bnf_rep</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ds</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>lives </span><span class="entity"><span>bnf_rep</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>bd </span><span class="entity"><span>bnf_rep</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_wits_of_bnf</span></span><span> </span><span class="entity"><span>Dss</span></span><span> </span><span class="entity"><span>Tss</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_rep</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rep_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wits</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>I </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>wit </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>wits </span><span class="entity"><span>bnf_rep</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span>Term.subst_atomic_types</span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>deads </span><span class="entity"><span>bnf_rep</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ds</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>lives </span><span class="entity"><span>bnf_rep</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Dss</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>wits</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>rel </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel_of_bnf</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>Us</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_rep</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rep_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>Term.subst_atomic_types</span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>deads </span><span class="entity"><span>bnf_rep</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ds</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>lives </span><span class="entity"><span>bnf_rep</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>lives' </span><span class="entity"><span>bnf_rep</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Us</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel </span><span class="entity"><span>bnf_rep</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>pred </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_pred_of_bnf</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_rep</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rep_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>Term.subst_atomic_types</span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>deads </span><span class="entity"><span>bnf_rep</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ds</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>lives </span><span class="entity"><span>bnf_rep</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>bnf_rep</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(*thms*)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_Card_order_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>bd_Card_order </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_Cinfinite_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>bd_Cinfinite </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_Cnotzero_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>bd_Cnotzero </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_card_order_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>bd_card_order </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>axioms </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_cinfinite_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>bd_cinfinite </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>axioms </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_regularCard_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>bd_regularCard </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>axioms </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>collect_set_map_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>collect_set_map </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>in_bd_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>in_bd </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>in_cong_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>in_cong </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>in_mono_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>in_mono </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>in_rel_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>in_rel </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inj_map_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inj_map </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inj_map_strong_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inj_map_strong </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>le_rel_OO_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>le_rel_OO </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>axioms </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_comp0_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>map_comp0 </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>axioms </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_comp_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>map_comp </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_cong0_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>map_cong0 </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>axioms </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_cong_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>map_cong </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_cong_pred_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>map_cong_pred </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_cong_simp_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>map_cong_simp </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_def_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>map_def </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>defs </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_id0_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>map_id0 </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>axioms </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_id_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>map_id </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_ident0_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>map_ident0 </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_ident_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>map_ident </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_ident_strong_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>map_ident_strong </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_transfer_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>map_transfer </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_eq_onp_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>rel_eq_onp </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_def_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>pred_def </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>defs </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_map_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>pred_map </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_mono_strong0_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>pred_mono_strong0 </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_mono_strong_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>pred_mono_strong </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_mono_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>pred_mono </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_cong0_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>pred_cong0 </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_cong_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>pred_cong </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_cong_simp_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>pred_cong_simp </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_rel_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>pred_rel </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_set_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>pred_set </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>axioms </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_transfer_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>pred_transfer </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_True_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>pred_True </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_Grp_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>rel_Grp </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_OO_Grp_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>rel_OO_Grp </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>axioms </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_OO_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>rel_OO </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_cong0_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>rel_cong0 </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_cong_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>rel_cong </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_cong_simp_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>rel_cong_simp </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_conversep_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>rel_conversep </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_def_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>rel_def </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>defs </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_eq_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>rel_eq </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_flip_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>rel_flip </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_map_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>rel_map </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_mono_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>rel_mono </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_mono_strong0_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>rel_mono_strong0 </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_mono_strong_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>rel_mono_strong </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_refl_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>rel_refl </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_refl_strong_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>rel_refl_strong </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_reflp_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>rel_reflp </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_symp_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>rel_symp </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_transfer_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>rel_transfer </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_transp_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>rel_transp </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_bd_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>set_bd </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>axioms </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_defs_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>set_defs </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>defs </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_map0_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>set_map0 </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>axioms </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_map_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>set_map </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_transfer_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.force</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>set_transfer </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>facts </span><span>o</span><span> </span><span class="entity"><span>rep_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wit_thms_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>maps</span><span> </span><span class="main"><span>#</span></span><span>prop </span><span>o</span><span> </span><span class="entity"><span>wits_of_bnf</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wit_thmss_of_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>prop </span><span>o</span><span> </span><span class="entity"><span>wits_of_bnf</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bnf</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>lives</span></span><span> </span><span class="entity"><span>lives'</span></span><span> </span><span class="entity"><span>dead</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>map</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>bd</span></span><span> </span><span class="entity"><span>axioms</span></span><span> </span><span class="entity"><span>defs</span></span><span> </span><span class="entity"><span>facts</span></span><span> </span><span class="entity"><span>wits</span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="entity"><span>pred</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>BNF</span></span><span> </span><span class="main"><span>{</span></span><span>name </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> T </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span>
       live </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>live</span></span><span class="main"><span>,</span></span><span> lives </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lives</span></span><span class="main"><span>,</span></span><span> lives' </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lives'</span></span><span class="main"><span>,</span></span><span> dead </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dead</span></span><span class="main"><span>,</span></span><span> deads </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deads</span></span><span class="main"><span>,</span></span><span>
       map </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map</span></span><span class="main"><span>,</span></span><span> sets </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>,</span></span><span> bd </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bd</span></span><span class="main"><span>,</span></span><span>
       axioms </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>axioms</span></span><span class="main"><span>,</span></span><span> defs </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>defs</span></span><span class="main"><span>,</span></span><span> facts </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>facts</span></span><span class="main"><span>,</span></span><span>
       nwits </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>wits</span></span><span class="main"><span>,</span></span><span> wits </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>wits</span></span><span class="main"><span>,</span></span><span> rel </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> pred </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pred</span></span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_bnf</span></span><span> </span><span class="entity"><span>f1</span></span><span> </span><span class="entity"><span>f2</span></span><span> </span><span class="entity"><span>f3</span></span><span> </span><span class="entity"><span>f4</span></span><span> </span><span class="entity"><span>f5</span></span><span> </span><span class="entity"><span>f6</span></span><span> </span><span class="entity"><span>f7</span></span><span> </span><span class="entity"><span>f8</span></span><span> </span><span class="entity"><span>f9</span></span><span> </span><span class="entity"><span>f10</span></span><span> </span><span class="entity"><span>f11</span></span><span> </span><span class="entity"><span>f12</span></span><span> </span><span class="entity"><span>f13</span></span><span> </span><span class="entity"><span>f14</span></span><span> </span><span class="entity"><span>f15</span></span><span> </span><span class="entity"><span>f16</span></span><span> </span><span class="entity"><span>f17</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>BNF</span></span><span> </span><span class="main"><span>{</span></span><span>name </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> T </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> live </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>live</span></span><span class="main"><span>,</span></span><span> lives </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lives</span></span><span class="main"><span>,</span></span><span> lives' </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lives'</span></span><span class="main"><span>,</span></span><span>
  dead </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dead</span></span><span class="main"><span>,</span></span><span> deads </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deads</span></span><span class="main"><span>,</span></span><span> map </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map</span></span><span class="main"><span>,</span></span><span> sets </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>,</span></span><span> bd </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bd</span></span><span class="main"><span>,</span></span><span>
  axioms </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>axioms</span></span><span class="main"><span>,</span></span><span> defs </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>defs</span></span><span class="main"><span>,</span></span><span> facts </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>facts</span></span><span class="main"><span>,</span></span><span>
  nwits </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nwits</span></span><span class="main"><span>,</span></span><span> wits </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>wits</span></span><span class="main"><span>,</span></span><span> rel </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> pred </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pred</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>BNF</span></span><span> </span><span class="main"><span>{</span></span><span>name </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f1</span></span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> T </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f2</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span>
       live </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f3</span></span><span> </span><span class="entity"><span>live</span></span><span class="main"><span>,</span></span><span> lives </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f4</span></span><span> </span><span class="entity"><span>lives</span></span><span class="main"><span>,</span></span><span> lives' </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f5</span></span><span> </span><span class="entity"><span>lives'</span></span><span class="main"><span>,</span></span><span> dead </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f6</span></span><span> </span><span class="entity"><span>dead</span></span><span class="main"><span>,</span></span><span> deads </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f7</span></span><span> </span><span class="entity"><span>deads</span></span><span class="main"><span>,</span></span><span>
       map </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f8</span></span><span> </span><span class="entity"><span>map</span></span><span class="main"><span>,</span></span><span> sets </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f9</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>,</span></span><span> bd </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f10</span></span><span> </span><span class="entity"><span>bd</span></span><span class="main"><span>,</span></span><span>
       axioms </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f11</span></span><span> </span><span class="entity"><span>axioms</span></span><span class="main"><span>,</span></span><span> defs </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f12</span></span><span> </span><span class="entity"><span>defs</span></span><span class="main"><span>,</span></span><span> facts </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f13</span></span><span> </span><span class="entity"><span>facts</span></span><span class="main"><span>,</span></span><span>
       nwits </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f14</span></span><span> </span><span class="entity"><span>nwits</span></span><span class="main"><span>,</span></span><span> wits </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f15</span></span><span> </span><span class="entity"><span>wits</span></span><span class="main"><span>,</span></span><span> rel </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f16</span></span><span> </span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> pred </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f17</span></span><span> </span><span class="entity"><span>pred</span></span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>morph_bnf</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Tphi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Morphism.typ</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tphi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>map_bnf</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.binding</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Tphi</span></span><span> </span><span>I</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>Tphi</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>Tphi</span></span><span class="main"><span>)</span></span><span> </span><span>I</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>Tphi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tphi</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>tphi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tphi</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>morph_axioms</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>morph_defs</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>morph_facts</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span>I</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>morph_witness</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tphi</span></span><span> </span><span class="entity"><span>tphi</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>morph_bnf_defs</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_bnf</span></span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>morph_defs</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>permute_deads</span></span><span> </span><span class="entity"><span>perm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_bnf</span></span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span class="entity"><span>perm</span></span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span> </span><span>I</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>transfer_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>morph_bnf</span></span><span> </span><span>o</span><span> </span><span>Morphism.transfer_morphism</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Data</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Generic_Data</span><span>
</span><span class="main"><span>(</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span>Symtab.table</span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>empty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symtab.empty</span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>merge</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symtab.merge</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>data</span></span><span class="main"><span>;</span></span><span>
</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>bnf_of_generic</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transfer_bnf</span></span><span> </span><span class="main"><span>(</span></span><span>Context.theory_of</span><span> </span><span class="entity"><span>context</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>Symtab.lookup</span><span> </span><span class="main"><span>(</span></span><span>Data.get</span><span> </span><span class="entity"><span>context</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_of</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bnf_of_generic</span></span><span> </span><span>o</span><span> </span><span>Context.Proof</span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_of_global</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bnf_of_generic</span></span><span> </span><span>o</span><span> </span><span>Context.Theory</span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(* Utilities *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>normalize_set</span></span><span> </span><span class="entity"><span>insts</span></span><span> </span><span class="entity"><span>instA</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>dest_funT</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>set</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>Term.dest_TVar</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.dest_setT</span></span><span> </span><span class="entity"><span>T'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.add_tvar_namesT</span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Term.subst_TVars</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>A</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span>~~</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>instA</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>insts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>normalize_rel</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>instTs</span></span><span> </span><span class="entity"><span>instA</span></span><span> </span><span class="entity"><span>instB</span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyenv</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Sign.typ_match</span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> </span><span>Library.foldr</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>instTs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>instA</span></span><span> </span><span class="entity"><span>instB</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span>Vartab.empty</span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Envir.subst_term</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyenv</span></span><span class="main"><span>,</span></span><span> </span><span>Vartab.empty</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>Type.TYPE_MATCH</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"Bad relator"</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>normalize_pred</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>instTs</span></span><span> </span><span class="entity"><span>instA</span></span><span> </span><span class="entity"><span>pred</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyenv</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Sign.typ_match</span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>pred</span></span><span class="main"><span>,</span></span><span> </span><span>Library.foldr</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>instTs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_pred1T</span></span><span> </span><span class="entity"><span>instA</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span>Vartab.empty</span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Envir.subst_term</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyenv</span></span><span class="main"><span>,</span></span><span> </span><span>Vartab.empty</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pred</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>Type.TYPE_MATCH</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"Bad predicator"</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>normalize_wit</span></span><span> </span><span class="entity"><span>insts</span></span><span> </span><span class="entity"><span>CA</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>wit</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>strip_param</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Type.raw_instance</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>CA</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>strip_param</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T1</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>strip_param</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>strip_param</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>wit</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.add_tvar_namesT</span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>insts</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>find</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>find_index</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>find</span></span><span> </span><span>o</span><span> </span><span>Term.typ_subst_TVars</span><span> </span><span class="entity"><span>subst</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>rev</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Term.subst_TVars</span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>wit</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>minimize_wits</span></span><span> </span><span class="entity"><span>wits</span></span><span> </span><span class="main"><span>=</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
   </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>minimize</span></span><span> </span><span class="entity"><span>done</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>done</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>minimize</span></span><span> </span><span class="entity"><span>done</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>todo</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>J</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>subset</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>J</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>I</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>done</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>todo</span></span><span class="main"><span>)</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>minimize</span></span><span> </span><span class="entity"><span>done</span></span><span> </span><span class="entity"><span>todo</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>minimize</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>done</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>todo</span></span><span class="main"><span>;</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>minimize</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>wits</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_map</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>Us</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Us0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>strip_typeN</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>live</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;&gt;</span><span> </span><span>List.last</span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>Term.subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ts0</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Us0</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Us</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_pred</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>domain_type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>body_fun_type</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>Term.subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ts0</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_set</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_pred</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>Us</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Us0</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>binder_types</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>strip_typeN</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>Term.subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ts0</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Us0</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Us</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>build_map_or_rel</span></span><span> </span><span class="entity"><span>mk</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>of_bnf</span></span><span> </span><span class="entity"><span>dest</span></span><span> </span><span class="entity"><span>pre_cst_table</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>simple_Ts</span></span><span> </span><span class="entity"><span>simple_Us</span></span><span> </span><span class="entity"><span>build_simple</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>build</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TU</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>simple_Ts</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>simple_Us</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="entity"><span>build_simple</span></span><span> </span><span class="entity"><span>TU</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>exists_subtype_in</span></span><span> </span><span class="entity"><span>simple_Ts</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
          </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>exists_subtype_in</span></span><span> </span><span class="entity"><span>simple_Us</span></span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="entity"><span>const</span></span><span> </span><span class="entity"><span>T</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>TU</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Us</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>s'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>recurse</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>live</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cst0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>Us</span></span><span> </span><span class="entity"><span>cst0</span></span><span class="main"><span>;</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>TUs'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>dest</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>strip_typeN</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>cst</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cst</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>build</span></span><span> </span><span class="entity"><span>TUs'</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>AList.lookup</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pre_cst_table</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>bnf_of</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                  </span><span>SOME</span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>recurse</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>live_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>build_simple</span></span><span> </span><span class="entity"><span>TU</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>entry</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>recurse</span></span><span> </span><span class="entity"><span>entry</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span class="entity"><span>build_simple</span></span><span> </span><span class="entity"><span>TU</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>build_simple</span></span><span> </span><span class="entity"><span>TU</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>build</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>build_map</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>build_map_or_rel</span></span><span> </span><span class="entity"><span>mk_map</span></span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>map_of_bnf</span></span><span> </span><span>dest_funT</span><span>
  </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Set.html#Set.set|type"><span>set</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Set.html#Set.image|const"><span>image</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>build_rel</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>build_map_or_rel</span></span><span> </span><span class="entity"><span>mk_rel</span></span><span> </span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span class="entity"><span>rel_of_bnf</span></span><span> </span><span class="entity"><span>dest_pred2T</span></span><span> </span><span>o</span><span> </span><span>append</span><span>
  </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Set.html#Set.set|type"><span>set</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.rel_set|const"><span>rel_set</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.rel_fun|const"><span>rel_fun</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>build_set</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>build</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span>Name.uu</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="entity"><span>HOLogic.mk_set</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="main"><span>[</span></span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_set</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sets_of_bnf</span></span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_of</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>exists_subtype_in</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>A</span></span><span class="main"><span>]</span></span><span> </span><span>o</span><span> </span><span>range_type</span><span> </span><span>o</span><span> </span><span>fastype_of</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_apps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.betapply</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set</span></span><span class="main"><span>,</span></span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>recurse</span></span><span> </span><span class="entity"><span>set_app</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Set.html#Set.set|type"><span>set</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>elemT</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>set_app</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>elemT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>set_app</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>mk_UNION</span></span><span> </span><span class="entity"><span>set_app</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>build</span></span><span> </span><span class="entity"><span>elemT</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>set_apps</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>HOLogic.mk_set</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Library.foldl1</span><span> </span><span class="entity"><span>mk_union</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>recurse</span></span><span> </span><span class="entity"><span>set_apps</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_set</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>build</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_flattened_map_args</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>map_args</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>flat_fs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>flatten_type_args_of_bnf</span></span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_of</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>Term.dummy</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>flat_fs'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_args</span></span><span> </span><span class="entity"><span>flat_fs</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>permute_like_unique</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconv</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>flat_fs</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>flat_fs'</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(* Names *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mapN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"map"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>setN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"set"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_setN</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>setN</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nonzero_string_of_int</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bdN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"bd"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>witN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"wit"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_witN</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>witN</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nonzero_string_of_int</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>relN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"rel"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>predN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"pred"</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_Card_orderN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"bd_Card_order"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_CinfiniteN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"bd_Cinfinite"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_CnotzeroN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"bd_Cnotzero"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_card_orderN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"bd_card_order"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_cinfiniteN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"bd_cinfinite"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_regularCardN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"bd_regularCard"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>collect_set_mapN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"collect_set_map"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>in_bdN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"in_bd"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>in_monoN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"in_mono"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>in_relN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"in_rel"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inj_mapN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"inj_map"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inj_map_strongN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"inj_map_strong"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_comp0N</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"map_comp0"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_compN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"map_comp"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_cong0N</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"map_cong0"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_congN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"map_cong"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_cong_simpN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"map_cong_simp"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_cong_predN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"map_cong_pred"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_id0N</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"map_id0"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_idN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"map_id"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_identN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"map_ident"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_ident_strongN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"map_ident_strong"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_transferN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"map_transfer"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_mono_strong0N</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"pred_mono_strong0"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_mono_strongN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"pred_mono_strong"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_monoN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"pred_mono"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_transferN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"pred_transfer"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_TrueN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"pred_True"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_mapN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"pred_map"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_relN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"pred_rel"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_setN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"pred_set"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_congN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"pred_cong"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_cong_simpN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"pred_cong_simp"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_GrpN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"rel_Grp"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_comppN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"rel_compp"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_compp_GrpN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"rel_compp_Grp"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_congN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"rel_cong"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_cong_simpN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"rel_cong_simp"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_conversepN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"rel_conversep"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_eqN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"rel_eq"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_eq_onpN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"rel_eq_onp"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_flipN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"rel_flip"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_mapN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"rel_map"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_monoN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"rel_mono"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_mono_strong0N</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"rel_mono_strong0"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_mono_strongN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"rel_mono_strong"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_reflN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"rel_refl"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_refl_strongN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"rel_refl_strong"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_reflpN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"rel_reflp"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_sympN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"rel_symp"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_transferN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"rel_transfer"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_transpN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"rel_transp"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_bdN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"set_bd"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_map0N</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"set_map0"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_mapN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"set_map"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_transferN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"set_transfer"</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>inline_policy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Dont_Inline</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Hardly_Inline</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Smart_Inline</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Do_Inline</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>fact_policy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Dont_Note</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Note_Some</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Note_All</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_internals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Attrib.setup_config_bool</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="entity_def" id="BNF_Def.bnf_internals|attribute"><span>bnf_internals</span></span><span>›</span></span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>false</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_timing</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Attrib.setup_config_bool</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="entity_def" id="BNF_Def.bnf_timing|attribute"><span>bnf_timing</span></span><span>›</span></span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>false</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>user_policy</span></span><span> </span><span class="entity"><span>policy</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Config.get</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>bnf_internals</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Note_All</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>policy</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>smart_max_inline_term_size</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>25</span></span><span class="main"><span>;</span></span><span> </span><span class="comment1"><span>(*FUDGE*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>note_bnf_thms</span></span><span> </span><span class="entity"><span>fact_policy</span></span><span> </span><span class="entity"><span>qualify0</span></span><span> </span><span class="entity"><span>bnf_b</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>axioms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>axioms_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>facts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>facts_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wits</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>wits_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>qualify</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>qs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Binding.path_of</span><span> </span><span class="entity"><span>bnf_b</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mand</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Binding.qualify</span><span> </span><span class="entity"><span>mand</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>qs</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>qualify0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>note_if_note_all</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>noted0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>witNs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>wits</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>witN</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_witN</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span>length</span><span> </span><span class="entity"><span>wits</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>notes</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>bd_card_orderN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>bd_card_order </span><span class="entity"><span>axioms</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>bd_cinfiniteN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>bd_cinfinite </span><span class="entity"><span>axioms</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>bd_regularCardN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>bd_regularCard </span><span class="entity"><span>axioms</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>bd_Card_orderN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>bd_Card_order </span><span class="entity"><span>facts</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>bd_CinfiniteN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>bd_Cinfinite </span><span class="entity"><span>facts</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>bd_CnotzeroN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>bd_Cnotzero </span><span class="entity"><span>facts</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>collect_set_mapN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>collect_set_map </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>in_bdN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>in_bd </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>in_monoN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>in_mono </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>map_comp0N</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>map_comp0 </span><span class="entity"><span>axioms</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rel_mono_strong0N</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel_mono_strong0 </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>pred_mono_strong0N</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred_mono_strong0 </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>set_map0N</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>set_map0 </span><span class="entity"><span>axioms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>set_bdN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>set_bd </span><span class="entity"><span>axioms</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>witNs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>wit_thmss_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thmN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>qualify</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.qualify</span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span>Binding.name_of</span><span> </span><span class="entity"><span>bnf_b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.name</span><span> </span><span class="entity"><span>thmN</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
             </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>thms</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Local_Theory.notes</span><span> </span><span class="entity"><span>notes</span></span><span> </span><span class="entity"><span>lthy0</span></span><span> </span><span>|&gt;&gt;</span><span> </span><span>append</span><span> </span><span class="entity"><span>noted0</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>note_unless_dont_note</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>noted0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>notes</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>in_relN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>in_rel </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>inj_mapN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inj_map </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>inj_map_strongN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inj_map_strong </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>map_compN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_comp </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>map_cong0N</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>map_cong0 </span><span class="entity"><span>axioms</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>map_congN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_cong </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fundefcong_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>map_cong_simpN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_cong_simp </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>map_cong_predN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_cong_pred </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>map_idN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_id </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>map_id0N</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>map_id0 </span><span class="entity"><span>axioms</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>map_transferN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_transfer </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>map_identN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_ident </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>map_ident_strongN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_ident_strong </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>pred_monoN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred_mono </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mono_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>pred_mono_strongN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred_mono_strong </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>pred_congN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred_cong </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fundefcong_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>pred_cong_simpN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred_cong_simp </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>pred_mapN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred_map </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>pred_relN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred_rel </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>pred_transferN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred_transfer </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>pred_TrueN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred_True </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>pred_setN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>pred_set </span><span class="entity"><span>axioms</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rel_comppN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel_OO </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rel_compp_GrpN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>no_refl</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>rel_OO_Grp </span><span class="entity"><span>axioms</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rel_conversepN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel_conversep </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rel_eqN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel_eq </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rel_eq_onpN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel_eq_onp </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rel_flipN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel_flip </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rel_GrpN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel_Grp </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rel_mapN</span></span><span class="main"><span>,</span></span><span> </span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel_map </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rel_monoN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel_mono </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mono_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rel_mono_strongN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel_mono_strong </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rel_congN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel_cong </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fundefcong_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rel_cong_simpN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel_cong_simp </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rel_reflN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel_refl </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rel_refl_strongN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel_refl_strong </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rel_reflpN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel_reflp </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rel_sympN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel_symp </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rel_transpN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel_transp </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rel_transferN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel_transfer </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>set_mapN</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_map </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>set_transferN</span></span><span class="main"><span>,</span></span><span> </span><span>Lazy.force</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_transfer </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
          </span><span>|&gt;</span><span> </span><span>filter_out</span><span> </span><span class="main"><span>(</span></span><span>null</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thmN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>attrs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>qualify</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.qualify</span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span>Binding.name_of</span><span> </span><span class="entity"><span>bnf_b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.name</span><span> </span><span class="entity"><span>thmN</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
             </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>thms</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Local_Theory.notes</span><span> </span><span class="entity"><span>notes</span></span><span> </span><span class="entity"><span>lthy0</span></span><span> </span><span>|&gt;&gt;</span><span> </span><span>append</span><span> </span><span class="entity"><span>noted0</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
    </span><span>|&gt;</span><span> </span><span class="entity"><span>fact_policy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Note_All</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>note_if_note_all</span></span><span>
    </span><span>|&gt;</span><span> </span><span class="entity"><span>fact_policy</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="entity"><span>Dont_Note</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>note_unless_dont_note</span></span><span>
    </span><span>|&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>noted</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>morph_bnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>substitute_noted_thm</span></span><span> </span><span class="entity"><span>noted</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>note_bnf_defs</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_def_binding</span></span><span> </span><span class="entity"><span>cst_of</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Thm.def_binding</span><span> </span><span class="main"><span>(</span></span><span>Binding.qualified_name</span><span> </span><span class="main"><span>(</span></span><span>dest_Const</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cst_of</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>notes</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>mk_def_binding</span></span><span> </span><span class="entity"><span>map_of_bnf</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_def_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="entity"><span>mk_def_binding</span></span><span> </span><span class="entity"><span>rel_of_bnf</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_def_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="entity"><span>mk_def_binding</span></span><span> </span><span class="entity"><span>pred_of_bnf</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pred_def_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
      </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 2</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span>pair</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_def_binding</span></span><span> </span><span>o</span><span> </span><span>K</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sets_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_defs_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>lthy</span></span><span>
    </span><span>|&gt;</span><span> </span><span>Local_Theory.notes</span><span> </span><span class="entity"><span>notes</span></span><span>
    </span><span>|&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>noted</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>morph_bnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>substitute_noted_thm</span></span><span> </span><span class="entity"><span>noted</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_wit_goals</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>bs</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>bs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>I</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>wit_goal</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_wit</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>$</span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>wit</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>I</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>bs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.False|const"><span>False</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_wit</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>map</span><span> </span><span class="entity"><span>wit_goal</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span>length</span><span> </span><span class="entity"><span>sets</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(* Define new BNFs *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>define_bnf_consts</span></span><span> </span><span class="entity"><span>const_policy</span></span><span> </span><span class="entity"><span>fact_policy</span></span><span> </span><span class="entity"><span>internal</span></span><span> </span><span class="entity"><span>Ds_opt</span></span><span> </span><span class="entity"><span>map_b</span></span><span> </span><span class="entity"><span>rel_b</span></span><span> </span><span class="entity"><span>pred_b</span></span><span> </span><span class="entity"><span>set_bs</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>bnf_b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T_rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_rhss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bd_rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit_rhss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_rhs_opt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pred_rhs_opt</span></span><span class="main"><span>)</span></span><span>
    </span><span class="entity"><span>no_defs_lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>set_rhss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>def_qualify</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Binding.qualify</span><span> </span><span>false</span><span> </span><span class="main"><span>(</span></span><span>Binding.name_of</span><span> </span><span class="entity"><span>bnf_b</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prefix_binding</span></span><span> </span><span class="entity"><span>pre</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Binding.prefix_name</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pre</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"_"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_b</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>maybe_define</span></span><span> </span><span class="entity"><span>user_specified</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rhs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inline</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>user_specified</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>fact_policy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Dont_Note</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>const_policy</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span class="entity"><span>Dont_Inline</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Hardly_Inline</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.is_Free</span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>Term.is_Const</span><span> </span><span class="entity"><span>rhs</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Smart_Inline</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.size_of_term</span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span>&lt;=</span><span> </span><span class="entity"><span>smart_max_inline_term_size</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Do_Inline</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>inline</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>rhs</span></span><span class="main"><span>,</span></span><span> </span><span>Drule.reflexive_thm</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>internal</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Local_Theory.define_internal</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Local_Theory.define</span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span>NoSyn</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Binding.concealed</span><span> </span><span class="main"><span>(</span></span><span>Thm.def_binding</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_bind_def</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>def_qualify</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Binding.is_empty</span><span> </span><span class="entity"><span>map_b</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>mk_prefix_binding</span></span><span> </span><span class="entity"><span>mapN</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>map_b</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
         </span><span class="entity"><span>map_rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_binds_defs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>set_name</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>get_b</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>try</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>set_bs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span>SOME</span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Binding.is_empty</span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>get_b</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>K</span><span> </span><span class="entity"><span>b</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>get_b</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>def_qualify</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>set_name</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_prefix_binding</span></span><span> </span><span class="entity"><span>setN</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>set_name</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_prefix_binding</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_setN</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>live</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>bs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>set_rhss</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_bind_def</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>def_qualify</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_prefix_binding</span></span><span> </span><span class="entity"><span>bdN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bd_rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>bnf_map_term</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>raw_map_def</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_set_terms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>raw_set_defs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy_old</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>no_defs_lthy</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>Local_Theory.begin_nested</span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="entity"><span>maybe_define</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>map_bind_def</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span>apfst</span><span> </span><span>split_list</span><span> </span><span>o</span><span> </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>maybe_define</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_binds_defs</span></span><span>
        </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>lthy_old</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>bnf_bd_term</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>raw_bd_def</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy_old</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>Local_Theory.begin_nested</span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>maybe_define</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>bd_bind_def</span></span><span>
      </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>lthy_old</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_map_def</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>raw_map_def</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_set_defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>raw_set_defs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_bd_def</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi'</span></span><span> </span><span class="entity"><span>raw_bd_def</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_map</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>bnf_map_term</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(*TODO: handle errors*)</span></span><span>
    </span><span class="comment1"><span>(*simple shape analysis of a map function*)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>alphas</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Calpha</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>fastype_of</span><span> </span><span class="entity"><span>bnf_map</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>strip_typeN</span></span><span> </span><span class="entity"><span>live</span></span><span>
      </span><span>|&gt;&gt;</span><span> </span><span>map_split</span><span> </span><span>dest_funT</span><span>
      </span><span>||&gt;</span><span> </span><span>dest_funT</span><span>
      </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>TYPE</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"Bad map function"</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Calpha_params</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>TVar</span><span> </span><span class="main"><span>(</span></span><span>Term.add_tvarsT</span><span> </span><span class="entity"><span>Calpha</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Morphism.typ</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>T_rhs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bad_args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.add_tfreesT</span><span> </span><span class="entity"><span>bnf_T</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>null</span><span> </span><span class="entity"><span>bad_args</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Locally fixed type arguments "</span></span><span> </span><span>^</span><span>
      </span><span>commas_quote</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Syntax.string_of_typ</span><span> </span><span class="entity"><span>no_defs_lthy</span></span><span> </span><span>o</span><span> </span><span>TFree</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bad_args</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_sets</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>normalize_set</span></span><span> </span><span class="entity"><span>Calpha_params</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_set_terms</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_bd</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Term.subst_TVars</span><span> </span><span class="main"><span>(</span></span><span>Term.add_tvar_namesT</span><span> </span><span class="entity"><span>bnf_T</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Calpha_params</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span>Morphism.term</span><span> </span><span class="entity"><span>phi'</span></span><span> </span><span class="entity"><span>bnf_bd_term</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(*TODO: assert Ds = (TVars of bnf_map) \ (alphas @ betas) as sets*)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>Ds_opt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>subtract</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alphas</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>TVar</span><span> </span><span class="main"><span>(</span></span><span>Term.add_tvars</span><span> </span><span class="entity"><span>bnf_map</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.typ</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ds</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(*TODO: further checks of type of bnf_map*)</span></span><span>
    </span><span class="comment1"><span>(*TODO: check types of bnf_sets*)</span></span><span>
    </span><span class="comment1"><span>(*TODO: check type of bnf_bd*)</span></span><span>
    </span><span class="comment1"><span>(*TODO: check type of bnf_rel*)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bnf_map</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="entity"><span>Bs'</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Term.subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>deads</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ds</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alphas</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>As'</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>betas</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Bs'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_map</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bnf_t</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>deads</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ds</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alphas</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>As'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bnf_T</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.typ_subst_atomic</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>deads</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ds</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alphas</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>As'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>As</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>unsorted_Ds</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_TFrees</span></span><span> </span><span class="entity"><span>live</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_TFrees</span></span><span> </span><span class="entity"><span>live</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_TFrees</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>deads</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>resort_tfree_or_tvar</span></span><span> </span><span>o</span><span> </span><span>Type.sort_of_atyp</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>unsorted_Ds</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>RTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>HOLogic.mk_prodT</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred2RTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rs'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"R"</span></span><span> </span><span class="entity"><span>pred2RTs</span></span><span> </span><span>|&gt;</span><span> </span><span>fst</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>CA</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_T</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>Calpha</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>CR</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_T</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>RTs</span></span><span> </span><span class="entity"><span>Calpha</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>setRs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>HOLogic.Collect_const</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_prodT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>HOLogic.mk_case_prod</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(*Grp (in (Collect (split R1) .. Collect (split Rn))) (map fst .. fst)^--1 OO
      Grp (in (Collect (split R1) .. Collect (split Rn))) (map snd .. snd)*)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_spec</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bnf_map</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>RTs</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>fst_const</span></span><span> </span><span class="entity"><span>RTs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bnf_map</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>RTs</span></span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>snd_const</span></span><span> </span><span class="entity"><span>RTs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_in</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_in</span></span><span> </span><span class="entity"><span>setRs</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bnf_t</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>RTs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_sets</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>CR</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_rel_compp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_conversep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Grp</span></span><span> </span><span class="entity"><span>bnf_in</span></span><span> </span><span class="entity"><span>map1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_Grp</span></span><span> </span><span class="entity"><span>bnf_in</span></span><span> </span><span class="entity"><span>map2</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>fold_rev</span><span> </span><span>Term.absfree</span><span> </span><span class="entity"><span>Rs'</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>the_default</span><span> </span><span class="entity"><span>rel_spec</span></span><span> </span><span class="entity"><span>rel_rhs_opt</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_bind_def</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>def_qualify</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Binding.is_empty</span><span> </span><span class="entity"><span>rel_b</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>mk_prefix_binding</span></span><span> </span><span class="entity"><span>relN</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>rel_b</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
         </span><span class="entity"><span>rel_rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_spec</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Term.absdummy</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bnf_T</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>Calpha</span></span><span class="main"><span>)</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.True|const"><span>True</span></a><span>›</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bnf_t</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_sets</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>argTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_pred1T</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_T</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>Calpha</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>Ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ps'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"P"</span></span><span> </span><span class="entity"><span>argTs</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"x"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T</span></span><span>
          </span><span>|&gt;</span><span> </span><span>fst</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>conjs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_Ball</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>P</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>Ps</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>fold_rev</span><span> </span><span>Term.absfree</span><span> </span><span class="entity"><span>Ps'</span></span><span>
          </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="entity"><span>conjs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>the_default</span><span> </span><span class="entity"><span>pred_spec</span></span><span> </span><span class="entity"><span>pred_rhs_opt</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_bind_def</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>def_qualify</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Binding.is_empty</span><span> </span><span class="entity"><span>pred_b</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>mk_prefix_binding</span></span><span> </span><span class="entity"><span>predN</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>pred_b</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
         </span><span class="entity"><span>pred_rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wit_rhss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>wit_rhss</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="main"><span>[</span></span><span>fold_rev</span><span> </span><span>Term.absdummy</span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bnf_map</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>,</span></span><span>
          </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.absdummy</span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>(</span></span><span>Bound</span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>live</span></span><span> </span><span>downto</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span>
          </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.undefined|const"><span>undefined</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>CA</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>wit_rhss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nwits</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>wit_rhss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wit_binds_defs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>nwits</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>def_qualify</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_prefix_binding</span></span><span> </span><span class="entity"><span>witN</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>def_qualify</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_prefix_binding</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_witN</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>nwits</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>bs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>wit_rhss</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>bnf_rel_term</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>raw_rel_def</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_pred_term</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>raw_pred_def</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_wit_terms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>raw_wit_defs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy_old</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>Local_Theory.begin_nested</span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>maybe_define</span></span><span> </span><span class="main"><span>(</span></span><span>is_some</span><span> </span><span class="entity"><span>rel_rhs_opt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel_bind_def</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>maybe_define</span></span><span> </span><span class="main"><span>(</span></span><span>is_some</span><span> </span><span class="entity"><span>pred_rhs_opt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pred_bind_def</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>apfst</span><span> </span><span>split_list</span><span> </span><span>o</span><span> </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>maybe_define</span></span><span> </span><span class="main"><span>(</span></span><span>not</span><span> </span><span class="main"><span>(</span></span><span>null</span><span> </span><span class="entity"><span>wit_rhss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>wit_binds_defs</span></span><span>
      </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>lthy_old</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_rel_def</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>raw_rel_def</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_rel</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>bnf_rel_term</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bnf_rel</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="entity"><span>Bs'</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>normalize_rel</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="entity"><span>Bs'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bnf_T</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="entity"><span>Calpha</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bnf_T</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>Bs'</span></span><span> </span><span class="entity"><span>Calpha</span></span><span class="main"><span>)</span></span><span>
        </span><span class="entity"><span>bnf_rel</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_pred_def</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>raw_pred_def</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_pred</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>bnf_pred_term</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bnf_pred</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>normalize_pred</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>mk_pred1T</span></span><span> </span><span class="entity"><span>As'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bnf_T</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="entity"><span>Calpha</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_pred</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_wit_defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>raw_wit_defs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_wits</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>normalize_wit</span></span><span> </span><span class="entity"><span>Calpha_params</span></span><span> </span><span class="entity"><span>Calpha</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span>o</span><span> </span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_wit_terms</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel_spec</span></span><span> </span><span class="entity"><span>Ds'</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="entity"><span>Bs'</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Term.subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>Ds</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ds'</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>As</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>As'</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Bs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Bs'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel_spec</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_pred_spec</span></span><span> </span><span class="entity"><span>Ds'</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Term.subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>Ds</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ds'</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>As</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>As'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pred_spec</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>alphas</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>deads</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Calpha</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_map</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bnf_sets</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bnf_bd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bnf_wits</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bnf_rel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bnf_pred</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_map_def</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bnf_set_defs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bnf_bd_def</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bnf_wit_defs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bnf_rel_def</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bnf_pred_def</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bnf_map</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_bnf_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_bnf_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_bnf_rel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_bnf_pred</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_rel_spec</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_pred_spec</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prepare_def</span></span><span> </span><span class="entity"><span>const_policy</span></span><span> </span><span class="entity"><span>mk_fact_policy</span></span><span> </span><span class="entity"><span>internal</span></span><span> </span><span class="entity"><span>qualify</span></span><span> </span><span class="entity"><span>prep_typ</span></span><span> </span><span class="entity"><span>prep_term</span></span><span> </span><span class="entity"><span>Ds_opt</span></span><span> </span><span class="entity"><span>map_b</span></span><span> </span><span class="entity"><span>rel_b</span></span><span>
  </span><span class="entity"><span>pred_b</span></span><span> </span><span class="entity"><span>set_bs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>raw_bnf_b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>raw_bnf_T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>raw_map</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>raw_sets</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>raw_bd</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>raw_wits</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>raw_rel_opt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
    </span><span class="entity"><span>raw_pred_opt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>no_defs_lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fact_policy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_fact_policy</span></span><span> </span><span class="entity"><span>no_defs_lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_b</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>qualify</span></span><span> </span><span class="entity"><span>raw_bnf_b</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>raw_sets</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T_rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prep_typ</span></span><span> </span><span class="entity"><span>no_defs_lthy</span></span><span> </span><span class="entity"><span>raw_bnf_T</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prep_term</span></span><span> </span><span class="entity"><span>no_defs_lthy</span></span><span> </span><span class="entity"><span>raw_map</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_rhss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prep_term</span></span><span> </span><span class="entity"><span>no_defs_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>raw_sets</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prep_term</span></span><span> </span><span class="entity"><span>no_defs_lthy</span></span><span> </span><span class="entity"><span>raw_bd</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wit_rhss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prep_term</span></span><span> </span><span class="entity"><span>no_defs_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>raw_wits</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_rhs_opt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prep_term</span></span><span> </span><span class="entity"><span>no_defs_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>raw_rel_opt</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_rhs_opt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prep_term</span></span><span> </span><span class="entity"><span>no_defs_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>raw_pred_opt</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>err</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Trying to register the type "</span></span><span> </span><span>^</span><span> </span><span>quote</span><span> </span><span class="main"><span>(</span></span><span>Syntax.string_of_typ</span><span> </span><span class="entity"><span>no_defs_lthy</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
        </span><span class="inner_quoted"><span>" as unnamed BNF"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>key</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Binding.is_empty</span><span> </span><span class="entity"><span>bnf_b</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>T_rhs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>C</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>forall</span><span> </span><span class="main"><span>(</span></span><span>can</span><span> </span><span>dest_TFree</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>has_duplicates</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="main"><span>(</span></span><span>Binding.qualified_name</span><span> </span><span class="entity"><span>C</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>C</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span class="entity"><span>err</span></span><span> </span><span class="entity"><span>T_rhs</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>err</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_b</span></span><span class="main"><span>,</span></span><span> </span><span>Local_Theory.full_name</span><span> </span><span class="entity"><span>no_defs_lthy</span></span><span> </span><span class="entity"><span>bnf_b</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>alphas</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>deads</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Calpha</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_map</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bnf_sets</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bnf_bd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bnf_wits</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bnf_rel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bnf_pred</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_map_def</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bnf_set_defs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bnf_bd_def</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bnf_wit_defs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bnf_rel_def</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bnf_pred_def</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bnf_map_Ds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_bnf_t_Ds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_bnf_T_Ds</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_rel_spec</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_pred_spec</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
       </span><span class="entity"><span>define_bnf_consts</span></span><span> </span><span class="entity"><span>const_policy</span></span><span> </span><span class="entity"><span>fact_policy</span></span><span> </span><span class="entity"><span>internal</span></span><span> </span><span class="entity"><span>Ds_opt</span></span><span> </span><span class="entity"><span>map_b</span></span><span> </span><span class="entity"><span>rel_b</span></span><span> </span><span class="entity"><span>pred_b</span></span><span> </span><span class="entity"><span>set_bs</span></span><span>
         </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>bnf_b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T_rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_rhss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bd_rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit_rhss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_rhs_opt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pred_rhs_opt</span></span><span class="main"><span>)</span></span><span>
         </span><span class="entity"><span>no_defs_lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dead</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>deads</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>As'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Bs'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Cs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>unsorted_Ds</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Es</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>B1Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>B2Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_TFrees</span></span><span> </span><span class="entity"><span>live</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_TFrees</span></span><span> </span><span class="entity"><span>live</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_TFrees</span></span><span> </span><span class="entity"><span>live</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_TFrees</span></span><span> </span><span class="entity"><span>dead</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_TFrees</span></span><span> </span><span class="entity"><span>live</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_TFrees</span></span><span> </span><span class="entity"><span>live</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_TFrees</span></span><span> </span><span class="entity"><span>live</span></span><span>
      </span><span>||&gt;</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_TFrees</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
      </span><span>||&gt;</span><span> </span><span>the_single</span><span>
      </span><span>||&gt;</span><span> </span><span>`</span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>resort_tfree_or_tvar</span></span><span> </span><span>o</span><span> </span><span>Type.sort_of_atyp</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>unsorted_Ds</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_bnf_map</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_map_Ds</span></span><span> </span><span class="entity"><span>Ds</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_bnf_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_t_Ds</span></span><span> </span><span class="entity"><span>Ds</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_bnf_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_T_Ds</span></span><span> </span><span class="entity"><span>Ds</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred1PTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_pred1T</span></span><span> </span><span class="entity"><span>As'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred1QTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_pred1T</span></span><span> </span><span class="entity"><span>Bs'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred2RTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="entity"><span>Bs'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred2RTsAsCs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="entity"><span>Cs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred2RTsBsCs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>Bs'</span></span><span> </span><span class="entity"><span>Cs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred2RTsBsEs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>Bs'</span></span><span> </span><span class="entity"><span>Es</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred2RTsCsBs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>Bs'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred2RTsCsEs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>Es</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred2RT's</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>Bs'</span></span><span> </span><span class="entity"><span>As'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>self_pred2RTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="entity"><span>As'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>transfer_domRTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="entity"><span>B1Ts</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>transfer_ranRTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>Bs'</span></span><span> </span><span class="entity"><span>B2Ts</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>CA'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_T</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="entity"><span>Calpha</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>CB'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_T</span></span><span> </span><span class="entity"><span>Bs'</span></span><span> </span><span class="entity"><span>Calpha</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>CC'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_T</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>Calpha</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>CE'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_T</span></span><span> </span><span class="entity"><span>Es</span></span><span> </span><span class="entity"><span>Calpha</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>CB1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_T</span></span><span> </span><span class="entity"><span>B1Ts</span></span><span> </span><span class="entity"><span>Calpha</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>CB2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_T</span></span><span> </span><span class="entity"><span>B2Ts</span></span><span> </span><span class="entity"><span>Calpha</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_map_AsAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_map</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="entity"><span>As'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_map_AsBs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_map</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="entity"><span>Bs'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_map_AsCs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_map</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="entity"><span>Cs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_map_BsCs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_map</span></span><span> </span><span class="entity"><span>Bs'</span></span><span> </span><span class="entity"><span>Cs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_sets_As</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bnf_t</span></span><span> </span><span class="entity"><span>As'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_sets</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_sets_Bs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bnf_t</span></span><span> </span><span class="entity"><span>Bs'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_sets</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_bd_As</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_t</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="entity"><span>bnf_bd</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bnf_rel</span></span><span> </span><span class="entity"><span>RTs</span></span><span> </span><span class="entity"><span>CA</span></span><span> </span><span class="entity"><span>CB</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>normalize_rel</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>RTs</span></span><span> </span><span class="entity"><span>CA</span></span><span> </span><span class="entity"><span>CB</span></span><span> </span><span class="entity"><span>bnf_rel</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bnf_pred</span></span><span> </span><span class="entity"><span>PTs</span></span><span> </span><span class="entity"><span>CA</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>normalize_pred</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>PTs</span></span><span> </span><span class="entity"><span>CA</span></span><span> </span><span class="entity"><span>bnf_pred</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>hs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>is</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>zs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>zs'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="entity"><span>As_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ps'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ps_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Qs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rs_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>S_AsCs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>S_CsBs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>S_BsEs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="entity"><span>transfer_domRs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>transfer_ranRs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"f"</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="entity"><span>Bs'</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"f"</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="entity"><span>Bs'</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"g"</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Bs'</span></span><span> </span><span class="entity"><span>Cs</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"h"</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"i"</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="entity"><span>Cs</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"x"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>CA'</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"x"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>CA'</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"y"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>CB'</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"y"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>CB'</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"z"</span></span><span> </span><span class="entity"><span>As'</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"z"</span></span><span> </span><span class="entity"><span>As'</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"y"</span></span><span> </span><span class="entity"><span>Bs'</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"A"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>As'</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"A"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>As'</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"b"</span></span><span> </span><span class="entity"><span>As'</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees'</span></span><span> </span><span class="inner_quoted"><span>"P"</span></span><span> </span><span class="entity"><span>pred1PTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"P"</span></span><span> </span><span class="entity"><span>pred1PTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"Q"</span></span><span> </span><span class="entity"><span>pred1QTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"R"</span></span><span> </span><span class="entity"><span>pred2RTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"R"</span></span><span> </span><span class="entity"><span>pred2RTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"S"</span></span><span> </span><span class="entity"><span>pred2RTsBsCs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"S"</span></span><span> </span><span class="entity"><span>pred2RTsAsCs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"S"</span></span><span> </span><span class="entity"><span>pred2RTsCsBs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"S"</span></span><span> </span><span class="entity"><span>pred2RTsBsEs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"R"</span></span><span> </span><span class="entity"><span>transfer_domRTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"S"</span></span><span> </span><span class="entity"><span>transfer_ranRTs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fs_copy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>retype_const_or_free</span></span><span> </span><span>o</span><span> </span><span>fastype_of</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>x_copy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>retype_const_or_free</span></span><span> </span><span class="entity"><span>CA'</span></span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>y_copy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>retype_const_or_free</span></span><span> </span><span class="entity"><span>CB'</span></span><span> </span><span class="entity"><span>x'</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_rel</span></span><span> </span><span class="entity"><span>pred2RTs</span></span><span> </span><span class="entity"><span>CA'</span></span><span> </span><span class="entity"><span>CB'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_pred</span></span><span> </span><span class="entity"><span>pred1PTs</span></span><span> </span><span class="entity"><span>CA'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_pred</span></span><span> </span><span class="entity"><span>pred1QTs</span></span><span> </span><span class="entity"><span>CB'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>relCsEs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_rel</span></span><span> </span><span class="entity"><span>pred2RTsCsEs</span></span><span> </span><span class="entity"><span>CC'</span></span><span> </span><span class="entity"><span>CE'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>relAsAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_rel</span></span><span> </span><span class="entity"><span>self_pred2RTs</span></span><span> </span><span class="entity"><span>CA'</span></span><span> </span><span class="entity"><span>CA'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_wit_As</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bnf_t</span></span><span> </span><span class="entity"><span>As'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_wits</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_id0_goal</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_map_app_id</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_map_AsAs</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>As'</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_map_app_id</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>CA'</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_comp0_goal</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_map_app_comp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_map_AsCs</span></span><span class="main"><span>,</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>gs</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>comp_bnf_map_app</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span>
          </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_map_BsCs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_map_AsBs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_map_app_comp</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>comp_bnf_map_app</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_map_cong_prem</span></span><span> </span><span class="entity"><span>mk_implies</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>f_copy</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Logic.all</span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_implies</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f_copy</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_cong0_goal</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_map_cong_prem</span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>bnf_sets_As</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>fs_copy</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eq</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_map_AsBs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span>
          </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_map_AsBs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs_copy</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs_copy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>eq</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_map0s_goal</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>setA</span></span><span> </span><span class="entity"><span>setB</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_comp_map</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>setB</span></span><span class="main"><span>,</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_map_AsBs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>image_comp_set</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_image</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>setA</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_comp_map</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>image_comp_set</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>bnf_sets_As</span></span><span> </span><span class="entity"><span>bnf_sets_Bs</span></span><span> </span><span class="entity"><span>fs</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>card_order_bd_goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_card_order</span></span><span> </span><span class="entity"><span>bnf_bd_As</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cinfinite_bd_goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_cinfinite</span></span><span> </span><span class="entity"><span>bnf_bd_As</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>regularCard_bd_goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_regularCard</span></span><span> </span><span class="entity"><span>bnf_bd_As</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_bds_goal</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Logic.all</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_ordLess</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_card_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_bd_As</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>map</span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>bnf_sets_As</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>relAsCs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_rel</span></span><span> </span><span class="entity"><span>pred2RTsAsCs</span></span><span> </span><span class="entity"><span>CA'</span></span><span> </span><span class="entity"><span>CC'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>relBsCs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_rel</span></span><span> </span><span class="entity"><span>pred2RTsBsCs</span></span><span> </span><span class="entity"><span>CB'</span></span><span> </span><span class="entity"><span>CC'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>relCsBs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_rel</span></span><span> </span><span class="entity"><span>pred2RTsCsBs</span></span><span> </span><span class="entity"><span>CC'</span></span><span> </span><span class="entity"><span>CB'</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_OO_lhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>relAsCs</span></span><span class="main"><span>,</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>mk_rel_compp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="entity"><span>Ss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_OO_rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rel_compp</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>relBsCs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>le_rel_OO_goal</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Ss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_leq</span></span><span> </span><span class="entity"><span>rel_OO_rhs</span></span><span> </span><span class="entity"><span>rel_OO_lhs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_OO_Grp_goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rel_spec</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="entity"><span>Bs'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_set_goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pred</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ps</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_pred_spec</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>As'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ps</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>zip_axioms</span></span><span> </span><span class="entity"><span>map_id0_goal</span></span><span> </span><span class="entity"><span>map_comp0_goal</span></span><span> </span><span class="entity"><span>map_cong0_goal</span></span><span> </span><span class="entity"><span>set_map0s_goal</span></span><span>
      </span><span class="entity"><span>card_order_bd_goal</span></span><span> </span><span class="entity"><span>cinfinite_bd_goal</span></span><span> </span><span class="entity"><span>regularCard_bd_goal</span></span><span> </span><span class="entity"><span>set_bds_goal</span></span><span> </span><span class="entity"><span>le_rel_OO_goal</span></span><span> </span><span class="entity"><span>rel_OO_Grp_goal</span></span><span> </span><span class="entity"><span>pred_set_goal</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_wit_goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_wit_goals</span></span><span> </span><span class="entity"><span>bs</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>bnf_sets_As</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>triv_wit_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_trivial_wit_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>bnf_wit_defs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wit_goalss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>raw_wits</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>triv_wit_tac</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_wit_goals</span></span><span> </span><span class="entity"><span>bnf_wit_As</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>after_qed</span></span><span> </span><span class="entity"><span>mk_wit_thms</span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>axioms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_wit_thms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_axioms</span></span><span> </span><span class="entity"><span>live</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>chop</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_Card_order</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>bd_card_order </span><span class="entity"><span>axioms</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.conjunct2|fact"><span>conjunct2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Cardinal_Order_Relation.html#BNF_Cardinal_Order_Relation.card_order_on_Card_order|fact"><span>card_order_on_Card_order</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_Cinfinite</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>bd_cinfinite </span><span class="entity"><span>axioms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bd_Card_order</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_Cnotzero</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bd_Cinfinite</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Cardinal_Arithmetic.html#BNF_Cardinal_Arithmetic.Cinfinite_Cnotzero|fact"><span>Cinfinite_Cnotzero</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_collect_set_map</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>defT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_T</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>Calpha</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>collect_map</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_collect</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bnf_t</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_sets</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>defT</span></span><span class="main"><span>,</span></span><span>
              </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bnf_map</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>hs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>image_collect</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_collect</span></span><span>
              </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_image</span></span><span> </span><span class="entity"><span>h</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>hs</span></span><span> </span><span class="entity"><span>bnf_sets_As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>defT</span></span><span class="main"><span>;</span></span><span>
            </span><span class="comment1"><span>(*collect {set1 ... setm} o map f1 ... fm = collect {f1` o set1 ... fm` o setm}*)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>hs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>collect_map</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>image_collect</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="entity"><span>mk_collect_set_map_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_map0 </span><span class="entity"><span>axioms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>collect_set_map</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_collect_set_map</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_in_mono</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems_mono</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>mk_leq</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>As_copy</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>in_mono_goal</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>As</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>As_copy</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prems_mono</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>mk_leq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_in</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>bnf_sets_As</span></span><span> </span><span class="entity"><span>CA'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_in</span></span><span> </span><span class="entity"><span>As_copy</span></span><span> </span><span class="entity"><span>bnf_sets_As</span></span><span> </span><span class="entity"><span>CA'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>in_mono_goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="entity"><span>mk_in_mono_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>live</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>in_mono</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_in_mono</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_in_cong</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems_cong</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>As_copy</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>in_cong_goal</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>As</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>As_copy</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prems_cong</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_in</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>bnf_sets_As</span></span><span> </span><span class="entity"><span>CA'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_in</span></span><span> </span><span class="entity"><span>As_copy</span></span><span> </span><span class="entity"><span>bnf_sets_As</span></span><span> </span><span class="entity"><span>CA'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>in_cong_goal</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>TRY</span><span> </span><span>o</span><span> </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>in_cong</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_in_cong</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_id</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_map_id</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_id0 </span><span class="entity"><span>axioms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_ident0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_map_ident</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_id0 </span><span class="entity"><span>axioms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_ident</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_map_ident</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>map_id</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_ident_strong</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>mk_map_ident_strong</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_cong0 </span><span class="entity"><span>axioms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>map_id</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_comp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_map_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_comp0 </span><span class="entity"><span>axioms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_map_cong</span></span><span> </span><span class="entity"><span>mk_implies</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_map_cong_prem</span></span><span> </span><span class="entity"><span>mk_implies</span></span><span> </span><span class="entity"><span>x_copy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>bnf_sets_As</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>fs_copy</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eq</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_map_AsBs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span>
              </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_map_AsBs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs_copy</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>x_copy</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs_copy</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prem0</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>eq</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.simp_implies_def|fact"><span>simp_implies_def</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>THEN</span><span>
              </span><span class="entity"><span>mk_map_cong_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_cong0 </span><span class="entity"><span>axioms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_cong</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_map_cong</span></span><span> </span><span>Logic.mk_implies</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_cong_simp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_map_cong</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.simp_implies|const"><span>simp_implies</span></a><span>›</span></span></span><span> </span><span>$</span><span> </span><span class="entity"><span>a</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_inj_map</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_inj</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_inj</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_map_AsBs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="entity"><span>mk_inj_map_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>map_id</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>map_comp</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_cong0 </span><span class="entity"><span>axioms</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>map_cong</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inj_map</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_inj_map</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_map</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_set_map</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_map0 </span><span class="entity"><span>axioms</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wit_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>nontriv_wit_thms</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>mk_wit_thms</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>Lazy.force</span><span> </span><span class="entity"><span>set_map</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>nontriv_wit_thms</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_in_bd</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bdT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dest_relT</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>bnf_bd_As</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bdTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>bdT</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_bnfT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_T</span></span><span> </span><span class="entity"><span>bdTs</span></span><span> </span><span class="entity"><span>Calpha</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>surj_imp_ordLeq_inst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>TrueI</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ranTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>AT</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_sumT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.unitT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>As'</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>funTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>bdT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ranTs</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ran_bnfT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_T</span></span><span> </span><span class="entity"><span>ranTs</span></span><span> </span><span class="entity"><span>Calpha</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>revTs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>`</span><span>rev</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bd_bnfT</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>funTs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span>Thm.ctyp_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ran_bnfT</span></span><span class="main"><span>,</span></span><span>
                  </span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_prodT</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tinst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="entity"><span>HOLogic.mk_case_prod</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absdummy</span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>tl</span><span> </span><span class="entity"><span>revTs</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>(</span></span><span>Term.absdummy</span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>revTs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bnf_map</span></span><span> </span><span class="entity"><span>bdTs</span></span><span> </span><span class="entity"><span>ranTs</span></span><span class="main"><span>,</span></span><span>
                      </span><span>map</span><span> </span><span>Bound</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>live</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>downto</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="entity"><span>live</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>tinst</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span>Thm.instantiate'</span><span> </span><span class="entity"><span>cTs</span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Cardinal_Order_Relation.html#BNF_Cardinal_Order_Relation.surj_imp_ordLeq|fact"><span>surj_imp_ordLeq</span></a><span class="antiquote"><span>}</span></span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_cexp</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>ctwo</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>mk_csum</span></span><span> </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="main"><span>(</span></span><span>uncurry</span><span> </span><span class="entity"><span>mk_csum</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>mk_card_of</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctwo</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>mk_csum</span></span><span> </span><span class="entity"><span>bnf_bd_As</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_card_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span> </span><span class="entity"><span>bd_bnfT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>in_bd_goal</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>As</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_ordLeq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_card_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_in</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>bnf_sets_As</span></span><span> </span><span class="entity"><span>CA'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bd</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>weak_set_bds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Wellorder_Constructions.html#BNF_Wellorder_Constructions.ordLess_imp_ordLeq|fact"><span>ordLess_imp_ordLeq</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_bd </span><span class="entity"><span>axioms</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>in_bd_goal</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_in_bd_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>surj_imp_ordLeq_inst</span></span><span>
                </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>map_comp</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>map_id</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_cong0 </span><span class="entity"><span>axioms</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>Lazy.force</span><span> </span><span class="entity"><span>set_map</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>weak_set_bds</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>bd_card_order </span><span class="entity"><span>axioms</span></span><span class="main"><span>)</span></span><span>
                </span><span class="entity"><span>bd_Card_order</span></span><span> </span><span class="entity"><span>bd_Cinfinite</span></span><span> </span><span class="entity"><span>bd_Cnotzero</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>in_bd</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_in_bd</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_OO_Grp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>rel_OO_Grp </span><span class="entity"><span>axioms</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_OO_Grps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>no_refl</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rel_OO_Grp</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel_Grp</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_Grp</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Grp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_in</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>bnf_sets_As</span></span><span> </span><span class="entity"><span>CA'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_map_AsBs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>As</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lhs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_rel_Grp_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>rel_OO_Grps</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_id0 </span><span class="entity"><span>axioms</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_cong0 </span><span class="entity"><span>axioms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>map_id</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>map_comp</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>Lazy.force</span><span> </span><span class="entity"><span>set_map</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_Grp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_rel_Grp</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel_prems</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="entity"><span>Rs_copy</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel_concl</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rs_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel_mono</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mono_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rel_prems</span></span><span> </span><span class="entity"><span>mk_leq</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mono_concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rel_concl</span></span><span> </span><span class="main"><span>(</span></span><span>uncurry</span><span> </span><span class="entity"><span>mk_leq</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
              </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Rs_copy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mono_prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mono_concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="entity"><span>mk_rel_mono_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>rel_OO_Grps</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>in_mono</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel_cong0</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cong_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rel_prems</span></span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cong_concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rel_concl</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
              </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Rs_copy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cong_prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cong_concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>TRY</span><span> </span><span>o</span><span> </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_mono</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_rel_mono</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_cong0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_rel_cong0</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>relAsAs</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span class="entity"><span>As'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span class="entity"><span>CA'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="entity"><span>mk_rel_eq_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_Grp</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_cong0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_id0 </span><span class="entity"><span>axioms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_eq</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_rel_eq</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel_conversep</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>relBsAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf_rel</span></span><span> </span><span class="entity"><span>pred2RT's</span></span><span> </span><span class="entity"><span>CB'</span></span><span> </span><span class="entity"><span>CA'</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>relBsAs</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_conversep</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_conversep</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>le_goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_leq</span></span><span> </span><span class="entity"><span>lhs</span></span><span> </span><span class="entity"><span>rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>le_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>le_goal</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_rel_conversep_le_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>rel_OO_Grps</span></span><span>
                </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_eq</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_cong0 </span><span class="entity"><span>axioms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>map_comp</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>Lazy.force</span><span> </span><span class="entity"><span>set_map</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lhs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="entity"><span>mk_rel_conversep_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>le_thm</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_mono</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_conversep</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_rel_conversep</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel_OO</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
            </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Ss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_leq</span></span><span> </span><span class="entity"><span>rel_OO_lhs</span></span><span> </span><span class="entity"><span>rel_OO_rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_rel_OO_le_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>rel_OO_Grps</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_eq</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_cong0 </span><span class="entity"><span>axioms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>map_comp</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>Lazy.force</span><span> </span><span class="entity"><span>set_map</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.antisym|fact"><span>antisym</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>le_rel_OO </span><span class="entity"><span>axioms</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_OO</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_rel_OO</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_in_rel</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>trans</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rel_OO_Grp</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.OO_Grp_alt|fact"><span>OO_Grp_alt</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.predicate2_eqD|fact"><span>predicate2_eqD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>in_rel</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_in_rel</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel_flip</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.conversep_iff|fact"><span>conversep_iff</span></a><span class="antiquote"><span>}</span></span></span></span><span>
            </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_conversep</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.predicate2_eqD|fact"><span>predicate2_eqD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_flip</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_rel_flip</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel_mono_strong0</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prem</span></span><span> </span><span class="entity"><span>setA</span></span><span> </span><span class="entity"><span>setB</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="entity"><span>S</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Ball</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>setA</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>a</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Ball</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>setB</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>a</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>S</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>a</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span>
              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_prem</span></span><span> </span><span class="entity"><span>bnf_sets_As</span></span><span> </span><span class="entity"><span>bnf_sets_Bs</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="entity"><span>Rs_copy</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rs_copy</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
              </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Rs_copy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_rel_mono_strong0_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>in_rel</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>Lazy.force</span><span> </span><span class="entity"><span>set_map</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_mono_strong0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_rel_mono_strong0</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_mono_strong</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="main"><span>(</span></span><span>Object_Logic.rulify</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel_mono_strong0</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel_cong_prem</span></span><span> </span><span class="entity"><span>mk_implies</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>x'</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>z'</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="entity"><span>set'</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="entity"><span>R_copy</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Logic.all</span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.all</span><span> </span><span class="entity"><span>z'</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>mk_implies</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_implies</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R_copy</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel_cong</span></span><span> </span><span class="entity"><span>mk_implies</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rel_cong_prem</span></span><span> </span><span class="entity"><span>mk_implies</span></span><span> </span><span class="entity"><span>x_copy</span></span><span> </span><span class="entity"><span>y_copy</span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>bnf_sets_As</span></span><span> </span><span class="entity"><span>bnf_sets_Bs</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="entity"><span>Rs_copy</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eq</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span>
              </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rs_copy</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x_copy</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>eq</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>prem0</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>prem1</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prem0</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>prem1</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>eq</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="entity"><span>mk_rel_cong_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>chop</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_mono_strong</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_cong</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rel_cong</span></span><span> </span><span>Logic.mk_implies</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_cong_simp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rel_cong</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.simp_implies|const"><span>simp_implies</span></a><span>›</span></span></span><span> </span><span>$</span><span> </span><span class="entity"><span>a</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_pred_prems</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span class="entity"><span>Ps_copy</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_pred_concl</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pred</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ps</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pred</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ps_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_pred_cong0</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cong_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_pred_prems</span></span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cong_concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_pred_concl</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
              </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ps</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Ps_copy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cong_prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cong_concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>TRY</span><span> </span><span>o</span><span> </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_cong0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_pred_cong0</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel_eq_onp</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>relAsAs</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_eq_onp</span></span><span> </span><span class="entity"><span>Ps</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_eq_onp</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pred</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ps</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>Ps'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lhs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="entity"><span>mk_rel_eq_onp_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred_set </span><span class="entity"><span>axioms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_id0 </span><span class="entity"><span>axioms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_Grp</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_eq_onp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_rel_eq_onp</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_rel</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.eq_onp_eqD|fact"><span>eq_onp_eqD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel_eq_onp</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_pred_mono_strong0</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prem</span></span><span> </span><span class="entity"><span>setA</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="entity"><span>Q</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Ball</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>setA</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>P</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Q</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pred</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ps</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span>
              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_prem</span></span><span> </span><span class="entity"><span>bnf_sets_As</span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span class="entity"><span>Ps_copy</span></span><span> </span><span class="entity"><span>zs</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pred</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ps_copy</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
              </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Ps_copy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="entity"><span>mk_pred_mono_strong0_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>pred_rel</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_mono_strong0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_mono_strong0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_pred_mono_strong0</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_mono_strong</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.map</span><span> </span><span class="main"><span>(</span></span><span>Object_Logic.rulify</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pred_mono_strong0</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_pred_mono</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mono_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_pred_prems</span></span><span> </span><span class="entity"><span>mk_leq</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mono_concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_pred_concl</span></span><span> </span><span class="main"><span>(</span></span><span>uncurry</span><span> </span><span class="entity"><span>mk_leq</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
              </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ps</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Ps_copy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mono_prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mono_concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="entity"><span>mk_pred_mono_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_eq_onp</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_mono</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_mono</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_pred_mono</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_pred_cong_prem</span></span><span> </span><span class="entity"><span>mk_implies</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="entity"><span>P_copy</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Logic.all</span><span> </span><span class="entity"><span>z</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>mk_implies</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>P</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>P_copy</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_pred_cong</span></span><span> </span><span class="entity"><span>mk_implies</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_pred_cong_prem</span></span><span> </span><span class="entity"><span>mk_implies</span></span><span> </span><span class="entity"><span>x_copy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>bnf_sets_As</span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span class="entity"><span>Ps_copy</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eq</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pred</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ps</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span>
              </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pred</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ps_copy</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>eq</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>prem0</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prem0</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>eq</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="entity"><span>mk_rel_cong_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>chop</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>pred_mono_strong</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_cong</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_pred_cong</span></span><span> </span><span>Logic.mk_implies</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_cong_simp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_pred_cong</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.simp_implies|const"><span>simp_implies</span></a><span>›</span></span></span><span> </span><span>$</span><span> </span><span class="entity"><span>a</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_map_cong_pred</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>g</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>g</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span>
              </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pred</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>fs_copy</span></span><span> </span><span class="entity"><span>zs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eq</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_map_AsBs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span>
              </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_map_AsBs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs_copy</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x_copy</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>x_copy</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs_copy</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>prem0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prem</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>eq</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>pred_set </span><span class="entity"><span>axioms</span></span><span class="main"><span>]</span></span><span> </span><span>THEN</span><span>
              </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>map_cong</span></span><span class="main"><span>)</span></span><span> </span><span>THEN_ALL_NEW</span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.bspec|fact"><span>bspec</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>THEN'</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_cong_pred</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_map_cong_pred</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel_map</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>lhs</span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>S_CsBs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>S_AsCs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>is</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lhs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lhss</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="main"><span>[</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>relCsBs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>S_CsBs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_map_AsCs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>is</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span>
               </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>relAsCs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>S_AsCs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_map_BsCs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rhss</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="main"><span>[</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                 </span><span class="entity"><span>mk_vimage2p</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>P</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>is</span></span><span> </span><span class="entity"><span>S_CsBs</span></span><span> </span><span class="entity"><span>Bs'</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span>
               </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                 </span><span class="entity"><span>mk_vimage2p</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>P</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>gs</span></span><span> </span><span class="entity"><span>S_AsCs</span></span><span> </span><span class="entity"><span>As'</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>lhss</span></span><span> </span><span class="entity"><span>rhss</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>goals</span></span><span>
            </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                 </span><span class="entity"><span>mk_rel_map0_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_OO</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_conversep</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_Grp</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>map_id</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.vimage2p_def|fact"><span>vimage2p_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../Fun.html#Fun.id|const"><span>id</span></a></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>simplified</span></span><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.id_apply|fact"><span>id_apply</span></a><span class="main"><span>]</span></span><span>
                 </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.vimage2p_def|fact"><span>vimage2p_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../Fun.html#Fun.id|const"><span>id</span></a></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>simplified</span></span><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.id_apply|fact"><span>id_apply</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_map</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_rel_map</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel_refl</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.ge_eq_refl|fact"><span>ge_eq_refl</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.ord_eq_le_trans|fact"><span>ord_eq_le_trans</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span>
          </span><span class="main"><span>[</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_eq</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_mono</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.refl_ge_eq|fact"><span>refl_ge_eq</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_refl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_rel_refl</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel_refl_strong</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span>rule_by_tactic</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>ALLGOALS</span><span> </span><span class="main"><span>(</span></span><span>Object_Logic.full_atomize_tac</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_eq</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.predicate2_eqD|fact"><span>predicate2_eqD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> _ </span><a class="entity_ref" href="../../../../../HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>RS</span><span>
              </span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_mono_strong</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>OF</span><span>
            </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.diag_imp_eq_le|fact"><span>diag_imp_eq_le</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_refl_strong</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_rel_refl_strong</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel_preserves</span></span><span> </span><span class="entity"><span>mk_prop</span></span><span> </span><span class="entity"><span>prop_conv_thm</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>retype_const_or_free</span></span><span> </span><span class="entity"><span>self_pred2RTs</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_prop</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_prop</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>relAsAs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>goal</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>goal</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>prop_conv_thm</span></span><span class="main"><span>]</span></span><span> </span><span>THEN</span><span>
                </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.ord_eq_le_trans|fact"><span>ord_eq_le_trans</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
                  </span><span>THEN'</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_mono</span></span><span class="main"><span>)</span></span><span> </span><span>THEN_ALL_NEW</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_reflp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rel_preserves</span></span><span> </span><span class="entity"><span>mk_reflp</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.reflp_eq|fact"><span>reflp_eq</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>rel_eq</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_symp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rel_preserves</span></span><span> </span><span class="entity"><span>mk_symp</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.symp_conversep|fact"><span>symp_conversep</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>rel_conversep</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_transp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rel_preserves</span></span><span> </span><span class="entity"><span>mk_transp</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.transp_relcompp|fact"><span>transp_relcompp</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>rel_OO</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_pred_True</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pred</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>absdummy</span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.True|const"><span>True</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>As'</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>absdummy</span><span> </span><span class="entity"><span>CA'</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.True|const"><span>True</span></a><span>›</span></span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lhs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ext</span></span><span class="main"><span>,</span></span><span> </span><span>Lazy.force</span><span> </span><span class="entity"><span>pred_rel</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                  </span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_cong0</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>fun_cong</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>fun_cong</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>trans</span></span><span> </span><span>OF</span><span>
                    </span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.eq_onp_True|fact"><span>eq_onp_True</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_eq</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>fun_cong</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>fun_cong</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.eqTrueI|fact"><span>eqTrueI</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_True</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_pred_True</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_pred_map</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pred'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Qs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_map_AsBs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pred</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 2</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Qs</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lhs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_set</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>pred_set </span><span class="entity"><span>axioms</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>fun_cong</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pred_set</span></span><span> </span><span>RSN</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pred_set</span></span><span> </span><span>RSN</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>box_equals</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
                </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.Ball_image_comp|fact"><span>Ball_image_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.ball_empty|fact"><span>ball_empty</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span>Lazy.force</span><span> </span><span class="entity"><span>set_map</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
                </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_map</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_pred_map</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_map_transfer</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rels</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_rel_fun</span></span><span> </span><span class="entity"><span>transfer_domRs</span></span><span> </span><span class="entity"><span>transfer_ranRs</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rel_fun</span></span><span>
              </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bnf_rel</span></span><span> </span><span class="entity"><span>transfer_domRTs</span></span><span> </span><span class="entity"><span>CA'</span></span><span> </span><span class="entity"><span>CB1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>transfer_domRs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bnf_rel</span></span><span> </span><span class="entity"><span>transfer_ranRTs</span></span><span> </span><span class="entity"><span>CB'</span></span><span> </span><span class="entity"><span>CB2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>transfer_ranRs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span>
              </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span class="entity"><span>mk_rel_fun</span></span><span> </span><span class="entity"><span>rels</span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>bnf_map_AsBs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>mk_bnf_map</span></span><span> </span><span class="entity"><span>B1Ts</span></span><span> </span><span class="entity"><span>B2Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
              </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transfer_domRs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>transfer_ranRs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_map_transfer_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_mono</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>in_rel</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>Lazy.force</span><span> </span><span class="entity"><span>set_map</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_cong0 </span><span class="entity"><span>axioms</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>map_comp</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_transfer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_map_transfer</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_pred_transfer</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>iff</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem_rels</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_rel_fun</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>iff</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem_elems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rel_fun</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>iff</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span>
              </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span class="entity"><span>mk_rel_fun</span></span><span> </span><span class="entity"><span>prem_rels</span></span><span> </span><span class="entity"><span>prem_elems</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>pred</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>pred'</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="entity"><span>mk_pred_transfer_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>in_rel</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>pred_map</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>pred_cong</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_transfer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_pred_transfer</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel_transfer</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>iff</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem_rels</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T1</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T2</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_rel_fun</span></span><span> </span><span class="entity"><span>T1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rel_fun</span></span><span> </span><span class="entity"><span>T2</span></span><span> </span><span class="entity"><span>iff</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>S_AsCs</span></span><span> </span><span class="entity"><span>S_BsEs</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem_elems</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>mk_rel_fun</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bnf_rel</span></span><span> </span><span class="entity"><span>pred2RTsAsCs</span></span><span> </span><span class="entity"><span>CA'</span></span><span> </span><span class="entity"><span>CC'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>S_AsCs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rel_fun</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bnf_rel</span></span><span> </span><span class="entity"><span>pred2RTsBsEs</span></span><span> </span><span class="entity"><span>CB'</span></span><span> </span><span class="entity"><span>CE'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>S_BsEs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>iff</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span class="entity"><span>mk_rel_fun</span></span><span> </span><span class="entity"><span>prem_rels</span></span><span> </span><span class="entity"><span>prem_elems</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>rel</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>relCsEs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="entity"><span>mk_rel_transfer_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>in_rel</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_map</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_mono_strong</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_transfer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_rel_transfer</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_set_transfer</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_sets</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>B</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_rel</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>A</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>B</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.rel_set|const"><span>rel_set</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="entity"><span>Bs'</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_Rs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rel_set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>setA</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>setB</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rel_fun</span></span><span> </span><span class="entity"><span>rel_Rs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>setA</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>setB</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="entity"><span>rel_sets</span></span><span> </span><span class="entity"><span>bnf_sets_As</span></span><span> </span><span class="entity"><span>bnf_sets_Bs</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_conjunction_balanced</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                     </span><span class="entity"><span>mk_set_transfer_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>in_rel</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>Lazy.force</span><span> </span><span class="entity"><span>set_map</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
                </span><span>|&gt;</span><span> </span><span>Conjunction.elim_balanced</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_transfer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_set_transfer</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_inj_map_strong</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>assms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>setA</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>z'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>z'</span></span><span class="main"><span>]</span></span><span>
                </span><span class="main"><span>(</span></span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>setA</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                   </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>setA</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                     </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                       </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>z'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_sets_As</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>zs'</span></span><span> </span><span class="entity"><span>fs'</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_implies</span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_eq</span></span><span>
                 </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_map_AsBs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span>
                  </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_map_AsBs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs'</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
               </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>x'</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs'</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span>Logic.mk_implies</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>assms</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="entity"><span>mk_inj_map_strong_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_eq</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_map</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span>Lazy.force</span><span> </span><span class="entity"><span>rel_mono_strong</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inj_map_strong</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Lazy.lazy</span><span> </span><span class="entity"><span>mk_inj_map_strong</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_defs</span></span><span> </span><span class="entity"><span>bnf_map_def</span></span><span> </span><span class="entity"><span>bnf_set_defs</span></span><span> </span><span class="entity"><span>bnf_rel_def</span></span><span> </span><span class="entity"><span>bnf_pred_def</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>facts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_facts</span></span><span> </span><span class="entity"><span>bd_Card_order</span></span><span> </span><span class="entity"><span>bd_Cinfinite</span></span><span> </span><span class="entity"><span>bd_Cnotzero</span></span><span> </span><span class="entity"><span>collect_set_map</span></span><span> </span><span class="entity"><span>in_bd</span></span><span> </span><span class="entity"><span>in_cong</span></span><span>
          </span><span class="entity"><span>in_mono</span></span><span> </span><span class="entity"><span>in_rel</span></span><span> </span><span class="entity"><span>inj_map</span></span><span> </span><span class="entity"><span>inj_map_strong</span></span><span> </span><span class="entity"><span>map_comp</span></span><span> </span><span class="entity"><span>map_cong</span></span><span> </span><span class="entity"><span>map_cong_simp</span></span><span> </span><span class="entity"><span>map_cong_pred</span></span><span> </span><span class="entity"><span>map_id</span></span><span>
          </span><span class="entity"><span>map_ident0</span></span><span> </span><span class="entity"><span>map_ident</span></span><span> </span><span class="entity"><span>map_ident_strong</span></span><span> </span><span class="entity"><span>map_transfer</span></span><span> </span><span class="entity"><span>rel_eq</span></span><span> </span><span class="entity"><span>rel_flip</span></span><span> </span><span class="entity"><span>set_map</span></span><span> </span><span class="entity"><span>rel_cong0</span></span><span> </span><span class="entity"><span>rel_cong</span></span><span>
          </span><span class="entity"><span>rel_cong_simp</span></span><span> </span><span class="entity"><span>rel_map</span></span><span> </span><span class="entity"><span>rel_mono</span></span><span> </span><span class="entity"><span>rel_mono_strong0</span></span><span> </span><span class="entity"><span>rel_mono_strong</span></span><span> </span><span class="entity"><span>set_transfer</span></span><span> </span><span class="entity"><span>rel_Grp</span></span><span> </span><span class="entity"><span>rel_conversep</span></span><span>
          </span><span class="entity"><span>rel_OO</span></span><span> </span><span class="entity"><span>rel_refl</span></span><span> </span><span class="entity"><span>rel_refl_strong</span></span><span> </span><span class="entity"><span>rel_reflp</span></span><span> </span><span class="entity"><span>rel_symp</span></span><span> </span><span class="entity"><span>rel_transp</span></span><span> </span><span class="entity"><span>rel_transfer</span></span><span> </span><span class="entity"><span>rel_eq_onp</span></span><span>
          </span><span class="entity"><span>pred_transfer</span></span><span> </span><span class="entity"><span>pred_True</span></span><span> </span><span class="entity"><span>pred_map</span></span><span> </span><span class="entity"><span>pred_rel</span></span><span> </span><span class="entity"><span>pred_mono_strong0</span></span><span> </span><span class="entity"><span>pred_mono_strong</span></span><span> </span><span class="entity"><span>pred_mono</span></span><span>
          </span><span class="entity"><span>pred_cong0</span></span><span> </span><span class="entity"><span>pred_cong</span></span><span> </span><span class="entity"><span>pred_cong_simp</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wits</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_witness</span></span><span> </span><span class="entity"><span>bnf_wits</span></span><span> </span><span class="entity"><span>wit_thms</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_rel</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Term.subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>Ds</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>deads</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>As'</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>alphas</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Bs'</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf_pred</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>Ds</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>deads</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>As'</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>alphas</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pred</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bnf</span></span><span> </span><span class="entity"><span>bnf_b</span></span><span> </span><span class="entity"><span>Calpha</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>betas</span></span><span> </span><span class="entity"><span>dead</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>bnf_map</span></span><span> </span><span class="entity"><span>bnf_sets</span></span><span> </span><span class="entity"><span>bnf_bd</span></span><span> </span><span class="entity"><span>axioms</span></span><span>
          </span><span class="entity"><span>defs</span></span><span> </span><span class="entity"><span>facts</span></span><span> </span><span class="entity"><span>wits</span></span><span> </span><span class="entity"><span>bnf_rel</span></span><span> </span><span class="entity"><span>bnf_pred</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>note_bnf_thms</span></span><span> </span><span class="entity"><span>fact_policy</span></span><span> </span><span class="entity"><span>qualify</span></span><span> </span><span class="entity"><span>bnf_b</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>one_step_defs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>no_reflexive</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_map_def</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>bnf_bd_def</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>bnf_set_defs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>bnf_wit_defs</span></span><span> </span><span>@</span><span>
        </span><span class="main"><span>[</span></span><span class="entity"><span>bnf_rel_def</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bnf_pred_def</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>key</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit_goalss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>after_qed</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>one_step_defs</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>BNF_Plugin</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Plugin</span></span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>bnf_interpretation</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>BNF_Plugin.interpretation</span></span><span> </span><span class="entity"><span>name</span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transfer_bnf</span></span><span> </span><span class="main"><span>(</span></span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>interpret_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>BNF_Plugin.data</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>register_bnf_raw</span></span><span> </span><span class="entity"><span>key</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Local_Theory.declaration</span><span> </span><span class="main"><span>{</span></span><span>syntax </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> pervasive </span><span class="main"><span>=</span></span><span> </span><span>true</span><span class="main"><span>,</span></span><span> pos </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>}</span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Data.map</span><span> </span><span class="main"><span>(</span></span><span>Symtab.update</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>key</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>morph_bnf</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>register_bnf</span></span><span> </span><span class="entity"><span>plugins</span></span><span> </span><span class="entity"><span>key</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>register_bnf_raw</span></span><span> </span><span class="entity"><span>key</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>interpret_bnf</span></span><span> </span><span class="entity"><span>plugins</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>bnf_def</span></span><span> </span><span class="entity"><span>const_policy</span></span><span> </span><span class="entity"><span>fact_policy</span></span><span> </span><span class="entity"><span>internal</span></span><span> </span><span class="entity"><span>qualify</span></span><span> </span><span class="entity"><span>tacs</span></span><span> </span><span class="entity"><span>wit_tac</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>map_b</span></span><span> </span><span class="entity"><span>rel_b</span></span><span> </span><span class="entity"><span>pred_b</span></span><span> </span><span class="entity"><span>set_bs</span></span><span>
    </span><span class="entity"><span>raw_csts</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>triv_tac_opt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit_goalss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>after_qed</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>one_step_defs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_wits_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>set_maps</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>TRYALL</span><span> </span><span>Goal.conjunction_tac</span><span> </span><span>THEN</span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>triv_tac_opt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span>SOME</span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>set_maps</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>one_step_defs</span></span><span> </span><span>THEN</span><span> </span><span class="entity"><span>wit_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wit_goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>Logic.mk_conjunction_balanced</span><span> </span><span class="entity"><span>wit_goalss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_wit_thms</span></span><span> </span><span class="entity"><span>set_maps</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.mk_conjunction_balanced</span><span> </span><span class="entity"><span>wit_goals</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_wits_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>set_maps</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
        </span><span>|&gt;</span><span> </span><span>Conjunction.elim_balanced</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>wit_goals</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>Conjunction.elim_balanced</span><span> </span><span>o</span><span> </span><span>length</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>wit_goalss</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>o</span><span> </span><span>map</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.forall_elim_vars</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span> </span><span>oo</span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>one_step_defs</span></span><span> </span><span>THEN</span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tacs</span></span><span class="main"><span>)</span></span><span>
    </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>after_qed</span></span><span> </span><span class="entity"><span>mk_wit_thms</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>single</span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>prepare_def</span></span><span> </span><span class="entity"><span>const_policy</span></span><span> </span><span class="entity"><span>fact_policy</span></span><span> </span><span class="entity"><span>internal</span></span><span> </span><span class="entity"><span>qualify</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>I</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>I</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span class="entity"><span>map_b</span></span><span> </span><span class="entity"><span>rel_b</span></span><span> </span><span class="entity"><span>pred_b</span></span><span>
    </span><span class="entity"><span>set_bs</span></span><span> </span><span class="entity"><span>raw_csts</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>bnf_cmd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>raw_csts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>raw_plugins</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>key</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>triv_tac_opt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit_goalss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>after_qed</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>defs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>plugins</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>raw_plugins</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wit_goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>Logic.mk_conjunction_balanced</span><span> </span><span class="entity"><span>wit_goalss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_triv_wit_thms</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>set_maps</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.mk_conjunction_balanced</span><span> </span><span class="entity"><span>wit_goals</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>TRYALL</span><span> </span><span>Goal.conjunction_tac</span><span> </span><span>THEN</span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>set_maps</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
        </span><span>|&gt;</span><span> </span><span>Conjunction.elim_balanced</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>wit_goals</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>Conjunction.elim_balanced</span><span> </span><span>o</span><span> </span><span>length</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>wit_goalss</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>o</span><span> </span><span>map</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.forall_elim_vars</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_wit_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_wit_goals</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>triv_tac_opt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>rpair</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>wit_goalss</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_triv_wit_thms</span></span><span> </span><span class="entity"><span>tac</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>lthy</span></span><span>
    </span><span>|&gt;</span><span> </span><span class="entity"><span>Proof.theorem</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>(</span></span><span>uncurry</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>register_bnf</span></span><span> </span><span class="entity"><span>plugins</span></span><span> </span><span class="entity"><span>key</span></span><span class="main"><span>)</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>after_qed</span></span><span> </span><span class="entity"><span>mk_wit_thms</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>single</span><span> </span><span>o</span><span> </span><span>rpair</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>nontriv_wit_goals</span></span><span class="main"><span>)</span></span><span>
    </span><span>|&gt;</span><span> </span><span class="entity"><span>Proof.unfolding</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.OO_Grp_alt|fact"><span>OO_Grp_alt</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>::</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.mem_Collect_eq|fact"><span>mem_Collect_eq</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>::</span><span> </span><span class="entity"><span>defs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
    </span><span>|&gt;</span><span> </span><span class="entity"><span>Proof.refine_singleton</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Method.Basic</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="entity"><span>Method.SIMPLE_METHOD</span></span><span> </span><span class="main"><span>(</span></span><span>TRYALL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>prepare_def</span></span><span> </span><span class="entity"><span>Do_Inline</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>user_policy</span></span><span> </span><span class="entity"><span>Note_Some</span></span><span class="main"><span>)</span></span><span> </span><span>false</span><span> </span><span>I</span><span> </span><span>Syntax.read_typ</span><span> </span><span>Syntax.read_term</span><span>
    </span><span>NONE</span><span> </span><span>Binding.empty</span><span> </span><span>Binding.empty</span><span> </span><span>Binding.empty</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>raw_csts</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_bnfs</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pretty_set</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Pretty.block</span><span>
      </span><span class="main"><span>[</span></span><span>Pretty.str</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_setN</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>":"</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span>
        </span><span>Pretty.quote</span><span> </span><span class="main"><span>(</span></span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pretty_bnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>key</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>BNF</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>live</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lives</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dead</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>deads</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Pretty.big_list</span><span>
        </span><span class="main"><span>(</span></span><span>Pretty.string_of</span><span> </span><span class="main"><span>(</span></span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span>Pretty.str</span><span> </span><span class="entity"><span>key</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>":"</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span>
          </span><span>Pretty.quote</span><span> </span><span class="main"><span>(</span></span><span>Syntax.pretty_typ</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"live:"</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.str</span><span> </span><span class="main"><span>(</span></span><span>string_of_int</span><span> </span><span class="entity"><span>live</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>3</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.list</span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span> </span><span class="main"><span>(</span></span><span>List.map</span><span> </span><span class="main"><span>(</span></span><span>Syntax.pretty_typ</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lives</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
          </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"dead:"</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.str</span><span> </span><span class="main"><span>(</span></span><span>string_of_int</span><span> </span><span class="entity"><span>dead</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>3</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.list</span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span> </span><span class="main"><span>(</span></span><span>List.map</span><span> </span><span class="main"><span>(</span></span><span>Syntax.pretty_typ</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>deads</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
          </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span>Pretty.str</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapN</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>":"</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span>
            </span><span>Pretty.quote</span><span> </span><span class="main"><span>(</span></span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>map</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
          </span><span>List.map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pretty_set</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span>length</span><span> </span><span class="entity"><span>sets</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span>
          </span><span class="main"><span>[</span></span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span>Pretty.str</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bdN</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>":"</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span>
            </span><span>Pretty.quote</span><span> </span><span class="main"><span>(</span></span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>bd</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>Pretty.big_list</span><span> </span><span class="inner_quoted"><span>"Registered bounded natural functors:"</span></span><span>
      </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>pretty_bnf</span></span><span> </span><span class="main"><span>(</span></span><span>sort_by</span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>Symtab.dest</span><span> </span><span class="main"><span>(</span></span><span>Data.get</span><span> </span><span class="main"><span>(</span></span><span>Context.Proof</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span>|&gt;</span><span> </span><span>Pretty.writeln</span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Outer_Syntax.command</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">command_keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword1"><span>print_bnfs</span></span><span>›</span></span></span><span>
    </span><span class="inner_quoted"><span>"print all bounded natural functors"</span></span><span>
    </span><span class="main"><span>(</span></span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Toplevel.keep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_bnfs</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Toplevel.context_of</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Outer_Syntax.local_theory_to_proof</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">command_keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword1"><span>bnf</span></span><span>›</span></span></span><span>
    </span><span class="inner_quoted"><span>"register a type as a bounded natural functor"</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>parse_opt_binding_colon</span></span><span> </span><span>--</span><span> </span><span>Parse.typ</span><span> </span><span>--|</span><span>
       </span><span class="main"><span>(</span></span><span>Parse.reserved</span><span> </span><span class="inner_quoted"><span>"map"</span></span><span> </span><span>--</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword2"><span>:</span></span><span>›</span></span></span><span class="main"><span>)</span></span><span> </span><span>--</span><span> </span><span>Parse.term</span><span> </span><span>--</span><span>
       </span><span>Scan.optional</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Parse.reserved</span><span> </span><span class="inner_quoted"><span>"sets"</span></span><span> </span><span>--</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword2"><span>:</span></span><span>›</span></span></span><span class="main"><span>)</span></span><span> </span><span>|--</span><span>
         </span><span>Scan.repeat1</span><span> </span><span class="main"><span>(</span></span><span>Scan.unless</span><span> </span><span class="main"><span>(</span></span><span>Parse.reserved</span><span> </span><span class="inner_quoted"><span>"bd"</span></span><span class="main"><span>)</span></span><span> </span><span>Parse.term</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span>--|</span><span>
       </span><span class="main"><span>(</span></span><span>Parse.reserved</span><span> </span><span class="inner_quoted"><span>"bd"</span></span><span> </span><span>--</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword2"><span>:</span></span><span>›</span></span></span><span class="main"><span>)</span></span><span> </span><span>--</span><span> </span><span>Parse.term</span><span> </span><span>--</span><span>
       </span><span>Scan.optional</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Parse.reserved</span><span> </span><span class="inner_quoted"><span>"wits"</span></span><span> </span><span>--</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword2"><span>:</span></span><span>›</span></span></span><span class="main"><span>)</span></span><span> </span><span>|--</span><span>
         </span><span>Scan.repeat1</span><span> </span><span class="main"><span>(</span></span><span>Scan.unless</span><span> </span><span class="main"><span>(</span></span><span>Parse.reserved</span><span> </span><span class="inner_quoted"><span>"rel"</span></span><span> </span><span>||</span><span>
           </span><span>Parse.reserved</span><span> </span><span class="inner_quoted"><span>"plugins"</span></span><span class="main"><span>)</span></span><span> </span><span>Parse.term</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span>--</span><span>
       </span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Parse.reserved</span><span> </span><span class="inner_quoted"><span>"rel"</span></span><span> </span><span>--</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword2"><span>:</span></span><span>›</span></span></span><span class="main"><span>)</span></span><span> </span><span>|--</span><span> </span><span>Parse.term</span><span class="main"><span>)</span></span><span> </span><span>--</span><span>
       </span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Parse.reserved</span><span> </span><span class="inner_quoted"><span>"pred"</span></span><span> </span><span>--</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword2"><span>:</span></span><span>›</span></span></span><span class="main"><span>)</span></span><span> </span><span>|--</span><span> </span><span>Parse.term</span><span class="main"><span>)</span></span><span> </span><span>--</span><span>
       </span><span>Scan.optional</span><span> </span><span class="entity"><span>Plugin_Name.parse_filter</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>Plugin_Name.default_filter</span></span><span class="main"><span>)</span></span><span>
       </span><span>&gt;&gt;</span><span> </span><span class="entity"><span>bnf_cmd</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span></pre>
</body>

</html>