<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Tools/Nunchaku/nunchaku.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Tools/Nunchaku/nunchaku.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      HOL/Tools/Nunchaku/nunchaku.ML
    Author:     Jasmin Blanchette, VU Amsterdam
    Copyright   2015, 2016, 2017

The core of the Nunchaku integration in Isabelle.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>NUNCHAKU</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>isa_model</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Nunchaku_Reconstruct.isa_model</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Auto_Try</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Try</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Normal</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>mode_of_operation_params</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>{</span></span><span>solvers</span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     falsify</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     assms</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     spy</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     overlord</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     expect</span><span class="main"><span>:</span></span><span> </span><span>string</span><span class="main"><span>}</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>scope_of_search_params</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>{</span></span><span>wfs</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>typ</span><span class="main"><span>)</span></span><span> </span><span>option</span><span> * </span><span>bool</span><span> </span><span>option</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     whacks</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>term</span><span> </span><span>option</span><span> * </span><span>bool</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     min_bound</span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
     max_bound</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
     bound_increment</span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
     cards</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>option</span><span> * </span><span class="main"><span>(</span></span><span>int</span><span> </span><span>option</span><span> * </span><span>int</span><span> </span><span>option</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     monos</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>option</span><span> * </span><span>bool</span><span> </span><span>option</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>}</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>output_format_params</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>{</span></span><span>verbose</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     debug</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     max_potential</span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
     max_genuine</span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
     evals</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     atomss</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>option</span><span> * </span><span>string</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>}</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>optimization_params</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>{</span></span><span>specialize</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     multithread</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>}</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>timeout_params</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>{</span></span><span>timeout</span><span class="main"><span>:</span></span><span> </span><span>Time.time</span><span class="main"><span>,</span></span><span>
     wf_timeout</span><span class="main"><span>:</span></span><span> </span><span>Time.time</span><span class="main"><span>}</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>{</span></span><span>mode_of_operation_params</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>mode_of_operation_params</span></span><span class="main"><span>,</span></span><span>
     scope_of_search_params</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>scope_of_search_params</span></span><span class="main"><span>,</span></span><span>
     output_format_params</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>output_format_params</span></span><span class="main"><span>,</span></span><span>
     optimization_params</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>optimization_params</span></span><span class="main"><span>,</span></span><span>
     timeout_params</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>timeout_params</span></span><span class="main"><span>}</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> genuineN</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> quasi_genuineN</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> potentialN</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> noneN</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> unknownN</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> no_nunchakuN</span><span class="main"><span>:</span></span><span> </span><span>string</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> run_chaku_on_prop</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.state</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>string</span><span> * </span><span class="entity"><span>isa_model</span></span><span> </span><span>option</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> run_chaku_on_subgoal</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.state</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> * </span><span class="entity"><span>isa_model</span></span><span> </span><span>option</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Nunchaku</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>NUNCHAKU</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nunchaku_Util</span><span class="main"><span>;</span></span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nunchaku_Collect</span><span class="main"><span>;</span></span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nunchaku_Problem</span><span class="main"><span>;</span></span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nunchaku_Translate</span><span class="main"><span>;</span></span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nunchaku_Model</span><span class="main"><span>;</span></span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nunchaku_Reconstruct</span><span class="main"><span>;</span></span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nunchaku_Display</span><span class="main"><span>;</span></span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Nunchaku_Tool</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Auto_Try</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Try</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Normal</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>mode_of_operation_params</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>solvers</span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   falsify</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   assms</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   spy</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   overlord</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   expect</span><span class="main"><span>:</span></span><span> </span><span>string</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>scope_of_search_params</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>wfs</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>typ</span><span class="main"><span>)</span></span><span> </span><span>option</span><span> * </span><span>bool</span><span> </span><span>option</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   whacks</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>term</span><span> </span><span>option</span><span> * </span><span>bool</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   min_bound</span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
   max_bound</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
   bound_increment</span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
   cards</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>option</span><span> * </span><span class="main"><span>(</span></span><span>int</span><span> </span><span>option</span><span> * </span><span>int</span><span> </span><span>option</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   monos</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>option</span><span> * </span><span>bool</span><span> </span><span>option</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>output_format_params</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>verbose</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   debug</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   max_potential</span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
   max_genuine</span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
   evals</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   atomss</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>option</span><span> * </span><span>string</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>optimization_params</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>specialize</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   multithread</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>timeout_params</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>timeout</span><span class="main"><span>:</span></span><span> </span><span>Time.time</span><span class="main"><span>,</span></span><span>
   wf_timeout</span><span class="main"><span>:</span></span><span> </span><span>Time.time</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>mode_of_operation_params</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>mode_of_operation_params</span></span><span class="main"><span>,</span></span><span>
   scope_of_search_params</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>scope_of_search_params</span></span><span class="main"><span>,</span></span><span>
   output_format_params</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>output_format_params</span></span><span class="main"><span>,</span></span><span>
   optimization_params</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>optimization_params</span></span><span class="main"><span>,</span></span><span>
   timeout_params</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>timeout_params</span></span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>genuineN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"genuine"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>quasi_genuineN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"quasi_genuine"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>potentialN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"potential"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>noneN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"none"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unknownN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"unknown"</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>no_nunchakuN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"no_nunchaku"</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>str_of_mode</span></span><span> </span><span class="entity"><span>Auto_Try</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Auto_Try"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_mode</span></span><span> </span><span class="entity"><span>Try</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Try"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_mode</span></span><span> </span><span class="entity"><span>Normal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Normal"</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>none_true</span></span><span> </span><span class="entity"><span>assigns</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>forall</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>&lt;&gt;</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>assigns</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>has_lonely_bool_var</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const_</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>Pure.conjunction</span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> </span><span class="quoted"><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const_</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> </span><span class="quoted"><span>‹</span><span>Free</span><span> </span><span class="main"><span>_</span></span><span>›</span></span><span>›</span></span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>has_lonely_bool_var</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>syntactic_sorts</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><span>{</span></span><a class="entity_ref" href="../../../../../HOL.html#HOL.default|class"><span>default</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="../../../../../Groups.html#Groups.zero|class"><span>zero</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="../../../../../Groups.html#Groups.one|class"><span>one</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="../../../../../Groups.html#Groups.plus|class"><span>plus</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="../../../../../Groups.html#Groups.minus|class"><span>minus</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="../../../../../Groups.html#Groups.uminus|class"><span>uminus</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="../../../../../Groups.html#Groups.times|class"><span>times</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="../../../../../Fields.html#Fields.inverse|class"><span>inverse</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="../../../../../Groups.html#Groups.abs|class"><span>abs</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="../../../../../Groups.html#Groups.sgn|class"><span>sgn</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord|class"><span>ord</span></a><span class="main"><span>,</span></span><a class="entity_ref" href="../../../../../HOL.html#HOL.equal|class"><span>equal</span></a><span class="main"><span>}</span></span><span>›</span></span></span><span> </span><span>@</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Num.html#Num.numeral|class"><span>numeral</span></a><span>›</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>has_tfree_syntactic_sort</span></span><span> </span><span class="main"><span>(</span></span><span>TFree</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>S</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>subset</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>S</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>syntactic_sorts</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>has_tfree_syntactic_sort</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>has_syntactic_sorts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>exists_type</span><span> </span><span class="main"><span>(</span></span><span>exists_subtype</span><span> </span><span class="entity"><span>has_tfree_syntactic_sort</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unprefix_error</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>perhaps</span><span> </span><span class="main"><span>(</span></span><span>try</span><span> </span><span class="main"><span>(</span></span><span>unprefix</span><span> </span><span class="inner_quoted"><span>"failure: "</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span>#&gt;</span><span> </span><span>perhaps</span><span> </span><span class="main"><span>(</span></span><span>try</span><span> </span><span class="main"><span>(</span></span><span>unprefix</span><span> </span><span class="inner_quoted"><span>"Error: "</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* Give the soft timeout a chance. *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timeout_slack</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>seconds</span><span> </span><span class="inner_numeral"><span>1.0</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>run_chaku_on_prop</span></span><span> </span><span class="entity"><span>state</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span>mode_of_operation_params </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>solvers</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>falsify</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>assms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>spy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>overlord</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>expect</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span>
      scope_of_search_params </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>wfs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>whacks</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>min_bound</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_bound</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bound_increment</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cards</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>monos</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span>
      output_format_params </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>verbose</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>debug</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>evals</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>atomss</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span>
      optimization_params </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>specialize</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span>
      timeout_params </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>timeout</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wf_timeout</span></span><span class="main"><span>}</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>
    </span><span class="entity"><span>mode</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>all_assms</span></span><span> </span><span class="entity"><span>subgoal</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Proof.context_of</span></span><span> </span><span class="entity"><span>state</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>time_start</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Time.now</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>print</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>writeln</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>print_n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Normal</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>writeln</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_v</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>verbose</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>writeln</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_d</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>debug</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>writeln</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>das_wort_Model</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>falsify</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"Countermodel"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"Model"</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>das_wort_model</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>falsify</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"countermodel"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"model"</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tool_params</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>{</span></span><span>solvers </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>solvers</span></span><span class="main"><span>,</span></span><span> overlord </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>overlord</span></span><span class="main"><span>,</span></span><span> min_bound </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>min_bound</span></span><span class="main"><span>,</span></span><span> max_bound </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>max_bound</span></span><span class="main"><span>,</span></span><span>
       bound_increment </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bound_increment</span></span><span class="main"><span>,</span></span><span> debug </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>debug</span></span><span class="main"><span>,</span></span><span> specialize </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>specialize</span></span><span class="main"><span>,</span></span><span>
       timeout </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>timeout</span></span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>run</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>outcome</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>outcome_code</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>poly_axioms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>isa_problem</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>sound</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>complete</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>isa_problem_of_subgoal</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>falsify</span></span><span> </span><span class="entity"><span>wfs</span></span><span> </span><span class="entity"><span>whacks</span></span><span> </span><span class="entity"><span>cards</span></span><span> </span><span class="entity"><span>debug</span></span><span> </span><span class="entity"><span>wf_timeout</span></span><span> </span><span class="entity"><span>evals</span></span><span>
                </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>assms</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>all_assms</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>subgoal</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_d</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"*** Isabelle problem ***\n"</span></span><span> </span><span>^</span><span>
              </span><span class="entity"><span>str_of_isa_problem</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>isa_problem</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ugly_nun_problem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nun_problem_of_isa</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>isa_problem</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_d</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"*** Ugly Nunchaku problem ***\n"</span></span><span> </span><span>^</span><span>
              </span><span class="entity"><span>str_of_nun_problem</span></span><span> </span><span class="entity"><span>ugly_nun_problem</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nice_nun_problem</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nice_nun_problem</span></span><span> </span><span class="entity"><span>ugly_nun_problem</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_d</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"*** Nice Nunchaku problem ***\n"</span></span><span> </span><span>^</span><span>
              </span><span class="entity"><span>str_of_nun_problem</span></span><span> </span><span class="entity"><span>nice_nun_problem</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_any_hints</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>has_lonely_bool_var</span></span><span> </span><span class="entity"><span>subgoal</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                </span><span class="entity"><span>print</span></span><span> </span><span class="inner_quoted"><span>"Hint: Maybe you forgot a colon after the lemma's name?"</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>has_syntactic_sorts</span></span><span> </span><span class="entity"><span>subgoal</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                </span><span class="entity"><span>print</span></span><span> </span><span class="inner_quoted"><span>"Hint: Maybe you forgot a type constraint?"</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>get_isa_model_opt</span></span><span> </span><span class="entity"><span>output</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nice_nun_model</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nun_model_of_str</span></span><span> </span><span class="entity"><span>output</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_d</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"*** Nice Nunchaku model ***\n"</span></span><span> </span><span>^</span><span>
                  </span><span class="entity"><span>str_of_nun_model</span></span><span> </span><span class="entity"><span>nice_nun_model</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ugly_nun_model</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ugly_nun_model</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="entity"><span>nice_nun_model</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_d</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"*** Ugly Nunchaku model ***\n"</span></span><span> </span><span>^</span><span>
                  </span><span class="entity"><span>str_of_nun_model</span></span><span> </span><span class="entity"><span>ugly_nun_model</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pat_completes</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pat_completes_of_isa_problem</span></span><span> </span><span class="entity"><span>isa_problem</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>raw_isa_model</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>isa_model_of_nun</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>pat_completes</span></span><span> </span><span class="entity"><span>atomss</span></span><span> </span><span class="entity"><span>ugly_nun_model</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_d</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"*** Raw Isabelle model ***\n"</span></span><span> </span><span>^</span><span>
                  </span><span class="entity"><span>str_of_isa_model</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>raw_isa_model</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cleaned_isa_model</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>clean_up_isa_model</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>raw_isa_model</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_d</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"*** Cleaned-up Isabelle model ***\n"</span></span><span> </span><span>^</span><span>
                  </span><span class="entity"><span>str_of_isa_model</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>cleaned_isa_model</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span class="entity"><span>cleaned_isa_model</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>isa_model_opt</span></span><span> </span><span class="entity"><span>output</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>debug</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>get_isa_model_opt</span></span><span> </span><span class="entity"><span>output</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>try</span><span> </span><span class="entity"><span>get_isa_model_opt</span></span><span> </span><span class="entity"><span>output</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>model_str</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>isa_model_opt</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>pretty_of_isa_model_opt</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>#&gt;</span><span> </span><span>Pretty.string_of</span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>unsat_means_theorem</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>null</span><span> </span><span class="entity"><span>whacks</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>cards</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>monos</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>unknown</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>print_n</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"No "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>das_wort_model</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" found"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unknownN</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>unsat_or_unknown</span></span><span> </span><span class="entity"><span>solver</span></span><span> </span><span class="entity"><span>complete</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>complete</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>print_n</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"No "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>das_wort_model</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" exists (according to "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>solver</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span>^</span><span>
                   </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>falsify</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>unsat_means_theorem</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"\nThe goal is a theorem"</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                 </span><span class="main"><span>(</span></span><span class="entity"><span>noneN</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                </span><span class="entity"><span>unknown</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>sat_or_maybe_sat</span></span><span> </span><span class="entity"><span>solver</span></span><span> </span><span class="entity"><span>sound</span></span><span> </span><span class="entity"><span>output</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>header</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>sound</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>das_wort_Model</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"Potential "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>das_wort_model</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span>null</span><span> </span><span class="entity"><span>poly_axioms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>none_true</span></span><span> </span><span class="entity"><span>wfs</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                  </span><span class="main"><span>(</span></span><span>true</span><span class="main"><span>,</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>print</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>header</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" (according to "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>solver</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"):\n"</span></span><span> </span><span>^</span><span>
                     </span><span class="entity"><span>model_str</span></span><span> </span><span class="entity"><span>output</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>print_any_hints</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                   </span><span class="main"><span>(</span></span><span class="entity"><span>genuineN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>isa_model_opt</span></span><span> </span><span class="entity"><span>output</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>no_poly</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>no_wf</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ignorings</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
                      </span><span>|&gt;</span><span> </span><span>not</span><span> </span><span class="entity"><span>no_poly</span></span><span> </span><span>?</span><span> </span><span>cons</span><span> </span><span class="inner_quoted"><span>"polymorphic axioms"</span></span><span>
                      </span><span>|&gt;</span><span> </span><span>not</span><span> </span><span class="entity"><span>no_wf</span></span><span> </span><span>?</span><span> </span><span>cons</span><span> </span><span class="inner_quoted"><span>"unchecked well-foundedness"</span></span><span class="main"><span>;</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                    </span><span class="main"><span>(</span></span><span class="entity"><span>print</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>header</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" (according to "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>solver</span></span><span> </span><span>^</span><span>
                       </span><span class="inner_quoted"><span>", ignoring "</span></span><span> </span><span>^</span><span> </span><span>space_implode</span><span> </span><span class="inner_quoted"><span>" and "</span></span><span> </span><span class="entity"><span>ignorings</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"):\n"</span></span><span> </span><span>^</span><span>
                       </span><span class="entity"><span>model_str</span></span><span> </span><span class="entity"><span>output</span></span><span> </span><span>^</span><span>
                       </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>no_poly</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                          </span><span class="inner_quoted"><span>""</span></span><span>
                        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                          </span><span class="inner_quoted"><span>"\nIgnored axioms:\n"</span></span><span> </span><span>^</span><span>
                          </span><span>cat_lines</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>prefix</span><span> </span><span class="inner_quoted"><span>"  "</span></span><span> </span><span>o</span><span> </span><span>Syntax.string_of_term</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>poly_axioms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                     </span><span class="entity"><span>print_any_hints</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                     </span><span class="main"><span>(</span></span><span class="entity"><span>quasi_genuineN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>isa_model_opt</span></span><span> </span><span class="entity"><span>output</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>solve_nun_problem</span></span><span> </span><span class="entity"><span>tool_params</span></span><span> </span><span class="entity"><span>nice_nun_problem</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
              </span><span class="entity"><span>Unsat</span></span><span> </span><span class="entity"><span>solver</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>unsat_or_unknown</span></span><span> </span><span class="entity"><span>solver</span></span><span> </span><span class="entity"><span>complete</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Sat</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>solver</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>output</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>sat_or_maybe_sat</span></span><span> </span><span class="entity"><span>solver</span></span><span> </span><span class="entity"><span>sound</span></span><span> </span><span class="entity"><span>output</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Unknown</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>unknown</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Unknown</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>solver</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>output</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>sat_or_maybe_sat</span></span><span> </span><span class="entity"><span>solver</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>output</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Timeout</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_n</span></span><span> </span><span class="inner_quoted"><span>"Time out"</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unknownN</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Nunchaku_Var_Not_Set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>print_n</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Variable $"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nunchaku_home_env_var</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" not set"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unknownN</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Nunchaku_Cannot_Execute</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>print_n</span></span><span> </span><span class="inner_quoted"><span>"External tool \"nunchaku\" cannot execute"</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unknownN</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Nunchaku_Not_Found</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>print_n</span></span><span> </span><span class="inner_quoted"><span>"External tool \"nunchaku\" not found"</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unknownN</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>CVC4_Cannot_Execute</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>print_n</span></span><span> </span><span class="inner_quoted"><span>"External tool \"cvc4\" cannot execute"</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unknownN</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>CVC4_Not_Found</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_n</span></span><span> </span><span class="inner_quoted"><span>"External tool \"cvc4\" not found"</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unknownN</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Unknown_Error</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>code</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>msg</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>print_n</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Error: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>unprefix_error</span></span><span> </span><span class="entity"><span>msg</span></span><span> </span><span>^</span><span>
                 </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>code</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>" (code "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>code</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
               </span><span class="main"><span>(</span></span><span class="entity"><span>unknownN</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span>
            </span><span class="entity"><span>CYCLIC_DEPS</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>print_n</span></span><span> </span><span class="inner_quoted"><span>"Cyclic dependencies (or bug in Nunchaku)"</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unknownN</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TOO_DEEP_DEPS</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>print_n</span></span><span> </span><span class="inner_quoted"><span>"Too deep dependencies (or bug in Nunchaku)"</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unknownN</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TOO_META</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>print_n</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Formula too meta for Nunchaku:\n"</span></span><span> </span><span>^</span><span> </span><span>Syntax.string_of_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
             </span><span class="main"><span>(</span></span><span class="entity"><span>unknownN</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>UNEXPECTED_POLYMORPHISM</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>print_n</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Unexpected polymorphism in term\n"</span></span><span> </span><span>^</span><span> </span><span>Syntax.string_of_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
             </span><span class="main"><span>(</span></span><span class="entity"><span>unknownN</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>UNEXPECTED_VAR</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>print_n</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Unexpected schematic variables in term\n"</span></span><span> </span><span>^</span><span> </span><span>Syntax.string_of_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
             </span><span class="main"><span>(</span></span><span class="entity"><span>unknownN</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>UNSUPPORTED_FUNC</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>print_n</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Unsupported low-level constant in problem: "</span></span><span> </span><span>^</span><span> </span><span>Syntax.string_of_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
             </span><span class="main"><span>(</span></span><span class="entity"><span>unknownN</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>expect</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>outcome_code</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>expect</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>outcome</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Unexpected outcome: "</span></span><span> </span><span>^</span><span> </span><span>quote</span><span> </span><span class="entity"><span>outcome_code</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>spying</span></span><span> </span><span class="entity"><span>spy</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>state</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"starting "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str_of_mode</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" mode"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>outcome</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>outcome_code</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Timeout.apply</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timeout</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>timeout_slack</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>run</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>Timeout.TIMEOUT</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_n</span></span><span> </span><span class="inner_quoted"><span>"Time out"</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unknownN</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print_v</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"Total time: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_of_time</span></span><span> </span><span class="main"><span>(</span></span><span>Time.now</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>time_start</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>spying</span></span><span> </span><span class="entity"><span>spy</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>state</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"outcome: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>outcome_code</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>expect</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>outcome_code</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>expect</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>outcome</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Unexpected outcome: "</span></span><span> </span><span>^</span><span> </span><span>quote</span><span> </span><span class="entity"><span>outcome_code</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>run_chaku_on_subgoal</span></span><span> </span><span class="entity"><span>state</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Proof.context_of</span></span><span> </span><span class="entity"><span>state</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.prop_of</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>goal </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.raw_goal</span></span><span> </span><span class="entity"><span>state</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Logic.no_prems</span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="main"><span>(</span></span><span>writeln</span><span> </span><span class="inner_quoted"><span>"No subgoal!"</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>noneN</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subgoal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>Logic.goal_params</span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>all_assms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>Thm.term_of</span><span> </span><span class="main"><span>(</span></span><span>Assumption.all_assms_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>run_chaku_on_prop</span></span><span> </span><span class="entity"><span>state</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>all_assms</span></span><span> </span><span class="entity"><span>subgoal</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span></pre>
</body>

</html>