<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Tools/string_syntax.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Tools/string_syntax.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      HOL/Tools/string_syntax.ML
    Author:     Makarius

Concrete syntax for characters and strings.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>STRING_SYNTAX</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> hex</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_bits_syntax</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> dest_bits_syntax</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> ascii_ord_of</span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> plain_strings_of</span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>character</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Char</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Ord</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> classify_character</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>character</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>String_Syntax</span></span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>STRING_SYNTAX</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="comment1"><span>(* numeral *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>hex_digit</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>10</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"A"</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>11</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"B"</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>12</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"C"</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>13</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"D"</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>14</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"E"</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>15</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"F"</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>hex_prefix</span></span><span> </span><span class="entity"><span>ms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"0x"</span></span><span> </span><span>^</span><span> </span><span>implode</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span>-</span><span> </span><span>length</span><span> </span><span class="entity"><span>ms</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"0"</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ms</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>hex</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>hex_prefix</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>hex_digit</span></span><span> </span><span class="main"><span>(</span></span><span>radixpand</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>16</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(* booleans as bits *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bit_syntax</span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Syntax.const</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_syntax</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../HOL.html#HOL.True|const"><span>True</span></a><span>›</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_syntax</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../HOL.html#HOL.False|const"><span>False</span></a><span>›</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bits_syntax</span></span><span> </span><span class="entity"><span>len</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_bit_syntax</span></span><span> </span><span>o</span><span> </span><span>Integer.radicify</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="entity"><span>len</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dest_bit_syntax</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_syntax</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../HOL.html#HOL.True|const"><span>True</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> 
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>dest_bit_syntax</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_syntax</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../HOL.html#HOL.False|const"><span>False</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>dest_bit_syntax</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Match</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dest_bits_syntax</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Integer.eval_radix</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>dest_bit_syntax</span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(* char *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>ascii_ord_of</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Symbol.is_ascii</span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>ord</span><span> </span><span class="entity"><span>c</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"⏎"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_numeral"><span>10</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Bad character: "</span></span><span> </span><span>^</span><span> </span><span>quote</span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_char_syntax</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span>Syntax.const</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_syntax</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../String.html#String.char.Char|const"><span>Char</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_bits_syntax</span></span><span> </span><span class="inner_numeral"><span>8</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>plain_strings_of</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>map</span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>Lexicon.explode_str</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span class="main"><span>,</span></span><span> </span><span>Position.none</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>character</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Char</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Ord</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>specials</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>raw_explode</span><span> </span><span class="inner_quoted"><span>"\\\"`'"</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>classify_character</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>chr</span><span> </span><span class="entity"><span>i</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>specials</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>Symbol.is_ascii</span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>Symbol.is_printable</span><span> </span><span class="entity"><span>c</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Char</span></span><span> </span><span class="entity"><span>c</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"\n"</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Char</span></span><span> </span><span class="inner_quoted"><span>"⏎"</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>Ord</span></span><span> </span><span class="entity"><span>i</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dest_char_syntax</span></span><span> </span><span class="entity"><span>b0</span></span><span> </span><span class="entity"><span>b1</span></span><span> </span><span class="entity"><span>b2</span></span><span> </span><span class="entity"><span>b3</span></span><span> </span><span class="entity"><span>b4</span></span><span> </span><span class="entity"><span>b5</span></span><span> </span><span class="entity"><span>b6</span></span><span> </span><span class="entity"><span>b7</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>classify_character</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dest_bits_syntax</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>b0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b3</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b4</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b5</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b6</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b7</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dest_char_ast</span></span><span> </span><span class="main"><span>(</span></span><span>Ast.Appl</span><span> </span><span class="main"><span>[</span></span><span>Ast.Constant</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">syntax_const</span><span class="hidden">&gt;</span></span></span><span>‹_Char›</span></span><span class="main"><span>,</span></span><span> </span><span>Ast.Constant</span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>plain_strings_of</span></span><span> </span><span class="entity"><span>s</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>dest_char_ast</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Match</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>char_tr</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">syntax_const</span><span class="hidden">&gt;</span></span></span><span>‹_constrain›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>c</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>char_tr</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>u</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>char_tr</span></span><span> </span><span class="main"><span>[</span></span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>plain_strings_of</span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span class="main"><span>[</span></span><span class="entity"><span>c</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_char_syntax</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ascii_ord_of</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Single character expected: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>char_tr</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>TERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"char_tr"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>char_ord_tr</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">syntax_const</span><span class="hidden">&gt;</span></span></span><span>‹_constrain›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>c</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>char_ord_tr</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>u</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>char_ord_tr</span></span><span> </span><span class="main"><span>[</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>num</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>mk_char_syntax</span></span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>value </span><span>o</span><span> </span><span>Lexicon.read_num</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>num</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>char_ord_tr</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>TERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"char_ord_tr"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>char_tr'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>b1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b3</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b4</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b5</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b6</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b7</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b8</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>dest_char_syntax</span></span><span> </span><span class="entity"><span>b1</span></span><span> </span><span class="entity"><span>b2</span></span><span> </span><span class="entity"><span>b3</span></span><span> </span><span class="entity"><span>b4</span></span><span> </span><span class="entity"><span>b5</span></span><span> </span><span class="entity"><span>b6</span></span><span> </span><span class="entity"><span>b7</span></span><span> </span><span class="entity"><span>b8</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span class="entity"><span>Char</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Syntax.const</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">syntax_const</span><span class="hidden">&gt;</span></span></span><span>‹_Char›</span></span><span> </span><span>$</span><span>
          </span><span>Syntax.const</span><span> </span><span class="main"><span>(</span></span><span>Lexicon.implode_str</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>s</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Ord</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Syntax.const</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">syntax_const</span><span class="hidden">&gt;</span></span></span><span>‹_Char_ord›</span></span><span> </span><span>$</span><span>
          </span><span>Syntax.free</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>hex</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>char_tr'</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Match</span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(* string *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_string_syntax</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Syntax.const</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_syntax</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../List.html#List.list.Nil|const"><span>Nil</span></a><span>›</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_string_syntax</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Syntax.const</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_syntax</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../List.html#List.list.Cons|const"><span>Cons</span></a><span>›</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>mk_char_syntax</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ascii_ord_of</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span>
        </span><span>$</span><span> </span><span class="entity"><span>mk_string_syntax</span></span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_string_ast</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Ast.Appl</span><span> </span><span class="main"><span>[</span></span><span>Ast.Constant</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">syntax_const</span><span class="hidden">&gt;</span></span></span><span>‹_inner_string›</span></span><span class="main"><span>,</span></span><span>
    </span><span>Ast.Variable</span><span> </span><span class="main"><span>(</span></span><span>Lexicon.implode_str</span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_tr</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">syntax_const</span><span class="hidden">&gt;</span></span></span><span>‹_constrain›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>c</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>string_tr</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>u</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_tr</span></span><span> </span><span class="main"><span>[</span></span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>mk_string_syntax</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>plain_strings_of</span></span><span> </span><span class="entity"><span>str</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_tr</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>TERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"string_tr"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>list_ast_tr'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>args</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Ast.Appl</span><span> </span><span class="main"><span>[</span></span><span>Ast.Constant</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">syntax_const</span><span class="hidden">&gt;</span></span></span><span>‹_String›</span></span><span class="main"><span>,</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>mk_string_ast</span></span><span> </span><span>o</span><span> </span><span>maps</span><span> </span><span class="entity"><span>dest_char_ast</span></span><span> </span><span>o</span><span> </span><span>Ast.unfold_ast</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">syntax_const</span><span class="hidden">&gt;</span></span></span><span>‹_args›</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>list_ast_tr'</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Match</span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(* theory setup *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Theory.setup</span><span>
   </span><span class="main"><span>(</span></span><span>Sign.parse_translation</span><span>
     </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">syntax_const</span><span class="hidden">&gt;</span></span></span><span>‹_Char›</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="entity"><span>char_tr</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">syntax_const</span><span class="hidden">&gt;</span></span></span><span>‹_Char_ord›</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="entity"><span>char_ord_tr</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">syntax_const</span><span class="hidden">&gt;</span></span></span><span>‹_String›</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="entity"><span>string_tr</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span>#&gt;</span><span>
    </span><span>Sign.print_translation</span><span>
     </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_syntax</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../String.html#String.char.Char|const"><span>Char</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="entity"><span>char_tr'</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span>#&gt;</span><span>
    </span><span>Sign.print_ast_translation</span><span>
     </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">syntax_const</span><span class="hidden">&gt;</span></span></span><span>‹_list›</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="entity"><span>list_ast_tr'</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span></pre>
</body>

</html>