<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Tools/Qelim/cooper.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Tools/Qelim/cooper.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      HOL/Tools/Qelim/cooper.ML
    Author:     Amine Chaieb, TU Muenchen

Presburger arithmetic by Cooper's algorithm.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>COOPER</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>entry</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> get</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>entry</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> del</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>attribute</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> add</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>attribute</span><span>
  </span><span class="keyword1"><span class="keyword"><span>exception</span></span></span><span> COOPER </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> conv</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> tac</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Cooper</span></span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>COOPER</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>entry</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>simpset</span><span> * </span><span>term</span><span> </span><span>list</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>allowed_consts</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.plus_class.plus|const"><span>(+)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.plus_class.plus|const"><span>(+)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span>
   </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.minus_class.minus|const"><span>(-)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.minus_class.minus|const"><span>(-)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span>
   </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.times_class.times|const"><span>(*)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.times_class.times|const"><span>(*)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span>
   </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="keyword1"><a class="entity_ref" href="../../../../../Rings.html#Rings.divide_class.divide|const"><span>(div)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="keyword1"><a class="entity_ref" href="../../../../../Rings.html#Rings.divide_class.divide|const"><span>(div)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span>
   </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="keyword1"><a class="entity_ref" href="../../../../../Rings.html#Rings.modulo_class.modulo|const"><span>(mod)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="keyword1"><a class="entity_ref" href="../../../../../Rings.html#Rings.modulo_class.modulo|const"><span>(mod)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span>
   </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.disj|const"><span>HOL.disj</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.implies|const"><span>HOL.implies</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span>
   </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../HOL.html#HOL.eq|const"><span>(=)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../HOL.html#HOL.eq|const"><span>(=)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../HOL.html#HOL.eq|const"><span>(=)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.bool|type"><span>bool</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span>
   </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less|const"><span>(&lt;)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less|const"><span>(&lt;)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span>
   </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less_eq|const"><span>(&lt;=)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less_eq|const"><span>(&lt;=)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span>
   </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="keyword1"><a class="entity_ref" href="../../../../../Rings.html#Rings.dvd_class.dvd|const"><span>(dvd)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="keyword1"><a class="entity_ref" href="../../../../../Rings.html#Rings.dvd_class.dvd|const"><span>(dvd)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span>
   </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.abs_class.abs|const"><span>abs</span></a><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span>
   </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.max|const"><span>max</span></a><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.max|const"><span>max</span></a><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span>
   </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.min|const"><span>min</span></a><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.min|const"><span>min</span></a><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span>
   </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.uminus_class.uminus|const"><span>uminus</span></a><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="comment1"><span>(*@ {term "uminus :: nat =&gt; _"},*)</span></span><span>
   </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Not|const"><span>Not</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Nat.html#Nat.Suc|const"><span>Suc</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span>
   </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Ex|const"><span>Ex</span></a><span> </span><span class="main"><span>::</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Ex|const"><span>Ex</span></a><span> </span><span class="main"><span>::</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../../../../Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span>
   </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.All|const"><span>All</span></a><span> </span><span class="main"><span>::</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.All|const"><span>All</span></a><span> </span><span class="main"><span>::</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../../../../Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span>
   </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Int.html#Int.nat|const"><span>nat</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Int.html#Int.int|const"><span>int</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span>
   </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Num.html#Num.num.One|const"><span>Num.One</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Num.html#Num.num.Bit0|const"><span>Num.Bit0</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Num.html#Num.num.Bit1|const"><span>Num.Bit1</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span>
   </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Num.html#Num.numeral_class.numeral|const"><span>Num.numeral</span></a><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Num.html#Num.num|type"><span>num</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Num.html#Num.numeral_class.numeral|const"><span>Num.numeral</span></a><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Num.html#Num.num|type"><span>num</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><a class="entity_ref" href="../../../../../Nat.html#Nat.nat|type"><span>nat</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span>
   </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../../../../Nat.html#Nat.nat|type"><span>nat</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../../../../Nat.html#Nat.nat|type"><span>nat</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span>
   </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.True|const"><span>True</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.False|const"><span>False</span></a><span>›</span></span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Data</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Generic_Data</span><span>
</span><span class="main"><span>(</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>simpset</span><span> * </span><span>term</span><span> </span><span>list</span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>empty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOL_ss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>allowed_consts</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>merge</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ss1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ss2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>(</span></span><span>merge_ss</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ss1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Library.merge</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconv</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ts1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>get</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Data.get</span><span> </span><span>o</span><span> </span><span>Context.Proof</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.declaration_attribute</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
  </span><span class="entity"><span>context</span></span><span> </span><span>|&gt;</span><span> </span><span>Data.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
     </span><span class="main"><span>(</span></span><span>simpset_map</span><span> </span><span class="main"><span>(</span></span><span>Context.proof_of</span><span> </span><span class="entity"><span>context</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>addsimps</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>th</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>,</span></span><span>
      </span><span>merge</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconv</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ts'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>del</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.declaration_attribute</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
  </span><span class="entity"><span>context</span></span><span> </span><span>|&gt;</span><span> </span><span>Data.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
     </span><span class="main"><span>(</span></span><span>simpset_map</span><span> </span><span class="main"><span>(</span></span><span>Context.proof_of</span><span> </span><span class="entity"><span>context</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>delsimps</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>th</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>,</span></span><span>
      </span><span>subtract</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconv</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts'</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>simp_thms_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Simplifier.rewrite</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>addsimps</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.simp_thms|fact"><span>simp_thms</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>FWD</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Drule.implies_elim_list</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>true_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.True|const"><span>True</span></a><span>›</span></span></span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>false_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.False|const"><span>False</span></a><span>›</span></span></span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>presburger_ss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>simpset_of</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span class="entity"><span><span class="hidden">\&lt;^</span><span class="control">context</span><span class="hidden">&gt;</span></span></span></span></span><span> </span><span>addsimps</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.zdvd1_eq|fact"><span>zdvd1_eq</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lin_ss</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>simpset_of</span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>presburger_ss</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span><span class="hidden">\&lt;^</span><span class="control">context</span><span class="hidden">&gt;</span></span></span></span></span><span>
    </span><span>addsimps</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Rings.html#Rings.semidom_modulo_class.dvd_eq_mod_eq_0|fact"><span>dvd_eq_mod_eq_0</span></a><span> </span><a class="entity_ref" href="../../../../../Groups.html#Groups.semigroup_add_class.add.assoc|fact"><span>add.assoc</span></a><span> </span><span class="main"><span>[</span></span><span class="operator"><span>where</span></span><span> 'a </span><span class="main"><span class="main"><span>=</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../../../../Groups.html#Groups.ab_semigroup_add_class.add.commute|fact"><span>add.commute</span></a><span> </span><span class="main"><span>[</span></span><span class="operator"><span>where</span></span><span> 'a </span><span class="main"><span class="main"><span>=</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../../../../Groups.html#Groups.ab_semigroup_add_class.add.left_commute|fact"><span>add.left_commute</span></a><span> </span><span class="main"><span>[</span></span><span class="operator"><span>where</span></span><span> 'a </span><span class="main"><span class="main"><span>=</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a></span><span class="main"><span>]</span></span><span>
  </span><a class="entity_ref" href="../../../../../Groups.html#Groups.semigroup_mult_class.mult.assoc|fact"><span>mult.assoc</span></a><span> </span><span class="main"><span>[</span></span><span class="operator"><span>where</span></span><span> 'a </span><span class="main"><span class="main"><span>=</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../../../../Groups.html#Groups.ab_semigroup_mult_class.mult.commute|fact"><span>mult.commute</span></a><span> </span><span class="main"><span>[</span></span><span class="operator"><span>where</span></span><span> 'a </span><span class="main"><span class="main"><span>=</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../../../../Groups.html#Groups.ab_semigroup_mult_class.mult.left_commute|fact"><span>mult.left_commute</span></a><span> </span><span class="main"><span>[</span></span><span class="operator"><span>where</span></span><span> 'a </span><span class="main"><span class="main"><span>=</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a></span><span class="main"><span>]</span></span><span>
</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>iT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.intT</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dest_number</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.dest_number</span></span><span> </span><span>#&gt;</span><span> </span><span>snd</span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>perhaps_number</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>try</span><span> </span><span class="entity"><span>dest_number</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>is_number</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>can</span><span> </span><span class="entity"><span>dest_number</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>miconj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>midisj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mieq</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mineq</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>milt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mile</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>migt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mige</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>midvd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mindvd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>miP</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.instantiate'</span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">ctyp</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> "</span><a class="entity_ref" href="../../../../../Presburger.html#Presburger.minf|fact"><span>minf</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infDconj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDdisj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDdvd</span></span><span class="main"><span>,</span></span><span class="entity"><span>infDndvd</span></span><span class="main"><span>,</span></span><span class="entity"><span>infDP</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.instantiate'</span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">ctyp</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> "</span><a class="entity_ref" href="../../../../../Presburger.html#Presburger.inf_period|fact"><span>inf_period</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>piconj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pidisj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pieq</span></span><span class="main"><span>,</span></span><span class="entity"><span>pineq</span></span><span class="main"><span>,</span></span><span class="entity"><span>pilt</span></span><span class="main"><span>,</span></span><span class="entity"><span>pile</span></span><span class="main"><span>,</span></span><span class="entity"><span>pigt</span></span><span class="main"><span>,</span></span><span class="entity"><span>pige</span></span><span class="main"><span>,</span></span><span class="entity"><span>pidvd</span></span><span class="main"><span>,</span></span><span class="entity"><span>pindvd</span></span><span class="main"><span>,</span></span><span class="entity"><span>piP</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.instantiate'</span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">ctyp</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> "</span><a class="entity_ref" href="../../../../../Presburger.html#Presburger.pinf|fact"><span>pinf</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>miP</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>piP</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.instantiate'</span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">ctyp</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.bool|type"><span>bool</span></a><span>›</span></span></span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>miP</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>piP</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>infDP</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.instantiate'</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>SOME</span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">ctyp</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">ctyp</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.bool|type"><span>bool</span></a><span>›</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>infDP</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="entity"><span>asetconj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>asetdisj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>aseteq</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>asetneq</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>asetlt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>asetle</span></span><span class="main"><span>,</span></span><span>
      </span><span class="entity"><span>asetgt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>asetge</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>asetdvd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>asetndvd</span></span><span class="main"><span>,</span></span><span class="entity"><span>asetP</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>[</span></span><span class="entity"><span>bsetconj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bsetdisj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bseteq</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bsetneq</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bsetlt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bsetle</span></span><span class="main"><span>,</span></span><span>
      </span><span class="entity"><span>bsetgt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bsetge</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bsetdvd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bsetndvd</span></span><span class="main"><span>,</span></span><span class="entity"><span>bsetP</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>  </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> "</span><a class="entity_ref" href="../../../../../Presburger.html#Presburger.aset|fact"><span>aset</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> "</span><a class="entity_ref" href="../../../../../Presburger.html#Presburger.bset|fact"><span>bset</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>cpmi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cppi</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Presburger.html#Presburger.cpmi|fact"><span>cpmi</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Presburger.html#Presburger.cppi|fact"><span>cppi</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unity_coeff_ex</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.instantiate'</span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">ctyp</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Presburger.html#Presburger.unity_coeff_ex|fact"><span>unity_coeff_ex</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>zdvd_mono</span></span><span class="main"><span>,</span></span><span class="entity"><span>simp_from_to</span></span><span class="main"><span>,</span></span><span class="entity"><span>all_not_ex</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span>
     </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Presburger.html#Presburger.zdvd_mono|fact"><span>zdvd_mono</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Presburger.html#Presburger.simp_from_to|fact"><span>simp_from_to</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../HOL.html#HOL.all_not_ex|fact"><span>all_not_ex</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>dvd_uminus</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dvd_uminus'</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> "</span><a class="entity_ref" href="../../../../../Presburger.html#Presburger.uminus_dvd_conv|fact"><span>uminus_dvd_conv</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eval_ss</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>simpset_of</span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>presburger_ss</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span><span class="hidden">\&lt;^</span><span class="control">context</span><span class="hidden">&gt;</span></span></span></span></span><span>
    </span><span>addsimps</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>simp_from_to</span></span><span class="main"><span>]</span></span><span> </span><span>delsimps</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>insert_iff</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bex_triv</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>eval_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Simplifier.rewrite</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>eval_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* recognising cterm without moving to terms *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>fm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>And</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> cterm*cterm</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Or</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> cterm*cterm</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Eq</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> cterm </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NEq</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> cterm
            </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Lt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> cterm </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Le</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> cterm </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Gt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> cterm </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Ge</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> cterm
            </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Dvd</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> cterm*cterm </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NDvd</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> cterm*cterm </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Nox</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>whatis</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="main"><span>(</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
  </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>_</span></span><span>$</span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_binop</span><span> </span><span class="entity"><span>ct</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.disj|const"><span>HOL.disj</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>_</span></span><span>$</span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_binop</span><span> </span><span class="entity"><span>ct</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.eq|const"><span>HOL.eq</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>y</span></span><span>$</span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>aconv</span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Eq</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_arg</span><span> </span><span class="entity"><span>ct</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>Nox</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Not|const"><span>Not</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.eq|const"><span>HOL.eq</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>y</span></span><span>$</span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>aconv</span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>NEq</span></span><span> </span><span class="main"><span>(</span></span><span>funpow</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span>Thm.dest_arg</span><span> </span><span class="entity"><span>ct</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>Nox</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less|const"><span>Orderings.less</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span>$</span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>aconv</span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Lt</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_arg</span><span> </span><span class="entity"><span>ct</span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>aconv</span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Gt</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_arg1</span><span> </span><span class="entity"><span>ct</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>Nox</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less_eq|const"><span>Orderings.less_eq</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>aconv</span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Le</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_arg</span><span> </span><span class="entity"><span>ct</span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>aconv</span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Ge</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_arg1</span><span> </span><span class="entity"><span>ct</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>Nox</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Rings.html#Rings.dvd_class.dvd|const"><span>Rings.dvd</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>_</span></span><span>$</span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.plus_class.plus|const"><span>Groups.plus</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>y</span></span><span>$</span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>aconv</span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Dvd</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_binop</span><span> </span><span class="entity"><span>ct</span></span><span> </span><span>||&gt;</span><span> </span><span>Thm.dest_arg</span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>Nox</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Not|const"><span>Not</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Rings.html#Rings.dvd_class.dvd|const"><span>Rings.dvd</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>_</span></span><span>$</span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.plus_class.plus|const"><span>Groups.plus</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>y</span></span><span>$</span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>aconv</span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
   </span><span class="entity"><span>NDvd</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_binop</span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_arg</span><span> </span><span class="entity"><span>ct</span></span><span class="main"><span>)</span></span><span> </span><span>||&gt;</span><span> </span><span>Thm.dest_arg</span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>Nox</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Nox</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Nox</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>get_pmi_term</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span class="entity"><span>eq</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
     </span><span class="main"><span>(</span></span><span>Thm.dest_abs_global</span><span> </span><span>o</span><span> </span><span>Thm.dest_arg</span><span> </span><span>o</span><span> </span><span>snd</span><span> </span><span>o</span><span> </span><span>Thm.dest_abs_global</span><span> </span><span>o</span><span> </span><span>Thm.dest_arg</span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span>Thm.dest_arg</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span>Thm.lambda</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>o</span><span> </span><span>Thm.dest_arg</span><span> </span><span>o</span><span> </span><span>Thm.dest_arg</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>eq</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>get_pmi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>get_pmi_term</span></span><span> </span><span>o</span><span> </span><span>Thm.cprop_of</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>p_v'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"P'"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.bool|type"><span>bool</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>q_v'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Q'"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.bool|type"><span>bool</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>p_v</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"P"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.bool|type"><span>bool</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>q_v</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Q"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.bool|type"><span>bool</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>myfwd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>th1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>th2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>th3</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="entity"><span>q</span></span><span>
      </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>th_1</span></span><span class="main"><span>,</span></span><span class="entity"><span>th_2</span></span><span class="main"><span>,</span></span><span class="entity"><span>th_3</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>th_1'</span></span><span class="main"><span>,</span></span><span class="entity"><span>th_2'</span></span><span class="main"><span>,</span></span><span class="entity"><span>th_3'</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
   </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mp'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mq'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>get_pmi</span></span><span> </span><span class="entity"><span>th_1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>get_pmi</span></span><span> </span><span class="entity"><span>th_1'</span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mi_th</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>FWD</span></span><span> </span><span class="main"><span>(</span></span><span>Drule.instantiate_normalize</span><span>
          </span><span class="main"><span>(</span></span><span>TVars.empty</span><span class="main"><span>,</span></span><span> </span><span>Vars.make</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>p_v</span></span><span class="main"><span>,</span></span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>q_v</span></span><span class="main"><span>,</span></span><span class="entity"><span>q</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p_v'</span></span><span class="main"><span>,</span></span><span class="entity"><span>mp'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>q_v'</span></span><span class="main"><span>,</span></span><span class="entity"><span>mq'</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>th_1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>th_1'</span></span><span class="main"><span>]</span></span><span>
   </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>infD_th</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>FWD</span></span><span> </span><span class="main"><span>(</span></span><span>Drule.instantiate_normalize</span><span> </span><span class="main"><span>(</span></span><span>TVars.empty</span><span class="main"><span>,</span></span><span> </span><span>Vars.make</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>p_v</span></span><span class="main"><span>,</span></span><span class="entity"><span>mp'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>q_v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mq'</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>th3</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>th_3</span></span><span class="main"><span>,</span></span><span class="entity"><span>th_3'</span></span><span class="main"><span>]</span></span><span>
   </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_th</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>FWD</span></span><span> </span><span class="main"><span>(</span></span><span>Drule.instantiate_normalize</span><span> </span><span class="main"><span>(</span></span><span>TVars.empty</span><span class="main"><span>,</span></span><span> </span><span>Vars.make</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>p_v</span></span><span class="main"><span>,</span></span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>q_v</span></span><span class="main"><span>,</span></span><span class="entity"><span>q</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>th2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>th_2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>th_2'</span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mi_th</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_th</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infD_th</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Thm.instantiate'</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>SOME</span><span> </span><span class="entity"><span>cts</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>infDTrue</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.instantiate'</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="entity"><span>true_tm</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>infDP</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>infDFalse</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.instantiate'</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="entity"><span>false_tm</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>infDP</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cadd</span></span><span> </span><span class="main"><span>=</span></span><span>  </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.plus_class.plus|const"><span>(+)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cmulC</span></span><span> </span><span class="main"><span>=</span></span><span>  </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.times_class.times|const"><span>(*)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cminus</span></span><span> </span><span class="main"><span>=</span></span><span>  </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.minus_class.minus|const"><span>(-)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cone</span></span><span> </span><span class="main"><span>=</span></span><span>  </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>addC</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mulC</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>subC</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>Thm.term_of</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>cadd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cmulC</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cminus</span></span><span class="main"><span>]</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>zero</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>one</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>numeral1</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_number</span></span><span> </span><span class="entity"><span>iT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dest_number</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>numeral2</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_number</span></span><span> </span><span class="entity"><span>iT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dest_number</span></span><span> </span><span class="entity"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dest_number</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>minus1</span></span><span class="main"><span>,</span></span><span class="entity"><span>plus1</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Thm.apply</span><span> </span><span class="main"><span>(</span></span><span>Thm.apply</span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cone</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>cminus</span></span><span class="main"><span>,</span></span><span class="entity"><span>cadd</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>decomp_pinf</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>dvd</span></span><span> </span><span class="entity"><span>inS</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>aseteq</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>asetneq</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>asetlt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>asetle</span></span><span class="main"><span>,</span></span><span>
                           </span><span class="entity"><span>asetgt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>asetge</span></span><span class="main"><span>,</span></span><span class="entity"><span>asetdvd</span></span><span class="main"><span>,</span></span><span class="entity"><span>asetndvd</span></span><span class="main"><span>,</span></span><span class="entity"><span>asetP</span></span><span class="main"><span>,</span></span><span>
                           </span><span class="entity"><span>infDdvd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDndvd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>asetconj</span></span><span class="main"><span>,</span></span><span>
                           </span><span class="entity"><span>asetdisj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDconj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDdisj</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>cp</span></span><span> </span><span class="main"><span>=</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>whatis</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>cp</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
  </span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span class="entity"><span>q</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span class="entity"><span>q</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>myfwd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>piconj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>asetconj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDconj</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.lambda</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.lambda</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>q</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span class="entity"><span>q</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span class="entity"><span>q</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>myfwd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pidisj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>asetdisj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDdisj</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.lambda</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.lambda</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>q</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Eq</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pieq</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FWD</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>aseteq</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>inS</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>plus1</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDFalse</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NEq</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pineq</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FWD</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>asetneq</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>inS</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDTrue</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Lt</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pilt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FWD</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>asetlt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>inS</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDFalse</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Le</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pile</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FWD</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>asetle</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>inS</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>plus1</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDFalse</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Gt</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pigt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>asetgt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDTrue</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Ge</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pige</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>asetge</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDTrue</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Dvd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>d</span></span><span class="main"><span>,</span></span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
   </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dd</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dvd</span></span><span> </span><span class="entity"><span>d</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>d</span></span><span class="main"><span>,</span></span><span class="entity"><span>s</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pidvd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FWD</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>d</span></span><span class="main"><span>,</span></span><span class="entity"><span>s</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>asetdvd</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>dd</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="entity"><span>FWD</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>d</span></span><span class="main"><span>,</span></span><span class="entity"><span>s</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>infDdvd</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>dd</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NDvd</span></span><span class="main"><span>(</span></span><span class="entity"><span>d</span></span><span class="main"><span>,</span></span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dd</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dvd</span></span><span> </span><span class="entity"><span>d</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>d</span></span><span class="main"><span>,</span></span><span class="entity"><span>s</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pindvd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FWD</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>d</span></span><span class="main"><span>,</span></span><span class="entity"><span>s</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>asetndvd</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>dd</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FWD</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>d</span></span><span class="main"><span>,</span></span><span class="entity"><span>s</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>infDndvd</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>dd</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>cp</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>piP</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>cp</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>asetP</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>cp</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>infDP</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>decomp_minf</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>dvd</span></span><span> </span><span class="entity"><span>inS</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>bseteq</span></span><span class="main"><span>,</span></span><span class="entity"><span>bsetneq</span></span><span class="main"><span>,</span></span><span class="entity"><span>bsetlt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bsetle</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bsetgt</span></span><span class="main"><span>,</span></span><span>
                           </span><span class="entity"><span>bsetge</span></span><span class="main"><span>,</span></span><span class="entity"><span>bsetdvd</span></span><span class="main"><span>,</span></span><span class="entity"><span>bsetndvd</span></span><span class="main"><span>,</span></span><span class="entity"><span>bsetP</span></span><span class="main"><span>,</span></span><span>
                           </span><span class="entity"><span>infDdvd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDndvd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bsetconj</span></span><span class="main"><span>,</span></span><span>
                           </span><span class="entity"><span>bsetdisj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDconj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDdisj</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>cp</span></span><span> </span><span class="main"><span>=</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>whatis</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>cp</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
  </span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span class="entity"><span>q</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span class="entity"><span>q</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>myfwd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>miconj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bsetconj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDconj</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.lambda</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.lambda</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>q</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span class="entity"><span>q</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span class="entity"><span>q</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>myfwd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>midisj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bsetdisj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDdisj</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.lambda</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.lambda</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>q</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Eq</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>mieq</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FWD</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>bseteq</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>inS</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>minus1</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDFalse</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NEq</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>mineq</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FWD</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>bsetneq</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>inS</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDTrue</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Lt</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>milt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>bsetlt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDTrue</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Le</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>mile</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>bsetle</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDTrue</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Gt</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>migt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FWD</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>bsetgt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>inS</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDFalse</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Ge</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>mige</span></span><span class="main"><span>,</span></span><span class="entity"><span>FWD</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>bsetge</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>inS</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>minus1</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDFalse</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Dvd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>d</span></span><span class="main"><span>,</span></span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dd</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dvd</span></span><span> </span><span class="entity"><span>d</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>d</span></span><span class="main"><span>,</span></span><span class="entity"><span>s</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>midvd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FWD</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>d</span></span><span class="main"><span>,</span></span><span class="entity"><span>s</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>bsetdvd</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>dd</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FWD</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>d</span></span><span class="main"><span>,</span></span><span class="entity"><span>s</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>infDdvd</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>dd</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NDvd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>d</span></span><span class="main"><span>,</span></span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dd</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dvd</span></span><span> </span><span class="entity"><span>d</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>d</span></span><span class="main"><span>,</span></span><span class="entity"><span>s</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>mindvd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FWD</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>d</span></span><span class="main"><span>,</span></span><span class="entity"><span>s</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>bsetndvd</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>dd</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FWD</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>d</span></span><span class="main"><span>,</span></span><span class="entity"><span>s</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>infDndvd</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>dd</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>cp</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>miP</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>cp</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>bsetP</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>cp</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>infDP</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

    </span><span class="comment1"><span>(* Canonical linear form for terms, formulae etc.. *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>provelin</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Goal.prove</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>t</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>simp_tac</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>lin_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span>TRY</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Lin_Arith.tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>linear_cmul</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>zero</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>linear_cmul</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.plus_class.plus|const"><span>Groups.plus</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>a</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>addC</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>linear_cmul</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>linear_cmul</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>b</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.times_class.times|const"><span>Groups.times</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>c</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mulC</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>numeral1</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.minus_class.minus|const"><span>Groups.minus</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>a</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>subC</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>linear_cmul</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>linear_cmul</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>b</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>m</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.uminus_class.uminus|const"><span>Groups.uminus</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>linear_cmul</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>a</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>numeral1</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>earlier</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>earlier</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>h</span></span><span>::</span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span>aconv</span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>false</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span>aconv</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>true</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>earlier</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>linear_add</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>tm1</span></span><span> </span><span class="entity"><span>tm2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.plus_class.plus|const"><span>Groups.plus</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.times_class.times|const"><span>Groups.times</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>c1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x1</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span>
    </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.plus_class.plus|const"><span>Groups.plus</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.times_class.times|const"><span>Groups.times</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>c2</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x2</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>x1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>x2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>numeral2</span></span><span> </span><span>Integer.add</span><span> </span><span class="entity"><span>c1</span></span><span> </span><span class="entity"><span>c2</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>zero</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>linear_add</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span class="entity"><span>r2</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>addC</span></span><span>$</span><span class="main"><span>(</span></span><span class="entity"><span>mulC</span></span><span>$</span><span class="entity"><span>c</span></span><span>$</span><span class="entity"><span>x1</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>(</span></span><span class="entity"><span>linear_add</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>earlier</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>x1</span></span><span> </span><span class="entity"><span>x2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>addC</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mulC</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>c1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x1</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>linear_add</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span class="entity"><span>tm2</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>addC</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mulC</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>c2</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x2</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>linear_add</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>tm1</span></span><span> </span><span class="entity"><span>r2</span></span><span>
 </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.plus_class.plus|const"><span>Groups.plus</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.times_class.times|const"><span>Groups.times</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>c1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x1</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>r1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="entity"><span>addC</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mulC</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>c1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x1</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>linear_add</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>r1</span></span><span> </span><span class="entity"><span>tm2</span></span><span>
 </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.plus_class.plus|const"><span>Groups.plus</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.times_class.times|const"><span>Groups.times</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>c2</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x2</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>r2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="entity"><span>addC</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mulC</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>c2</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x2</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>linear_add</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>tm1</span></span><span> </span><span class="entity"><span>r2</span></span><span>
 </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>numeral2</span></span><span> </span><span>Integer.add</span><span> </span><span class="entity"><span>tm1</span></span><span> </span><span class="entity"><span>tm2</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>linear_neg</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>linear_cmul</span></span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>linear_sub</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>tm1</span></span><span> </span><span class="entity"><span>tm2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>linear_add</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>tm1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>linear_neg</span></span><span> </span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>exception</span></span></span><span> </span><span class="entity"><span>COOPER</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>string</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>lint</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span>  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_number</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>tm</span></span><span>  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
  </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.uminus_class.uminus|const"><span>Groups.uminus</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>linear_neg</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lint</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.plus_class.plus|const"><span>Groups.plus</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>s</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>linear_add</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lint</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lint</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.minus_class.minus|const"><span>Groups.minus</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>s</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>linear_sub</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lint</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lint</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.times_class.times|const"><span>Groups.times</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>s</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>s'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lint</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>s</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lint</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>t</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>perhaps_number</span></span><span> </span><span class="entity"><span>s'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>linear_cmul</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>t'</span></span><span>
   </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>perhaps_number</span></span><span> </span><span class="entity"><span>t'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>linear_cmul</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>s'</span></span><span>
   </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>COOPER</span></span><span> </span><span class="inner_quoted"><span>"lint: not linear"</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
 </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>addC</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mulC</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>one</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>zero</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>lin</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>_</span></span><span>::</span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Not|const"><span>Not</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less|const"><span>Orderings.less</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>s</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>lin</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less_eq|const"><span>Orderings.less_eq</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>lin</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>_</span></span><span>::</span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Not|const"><span>Not</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less_eq|const"><span>Orderings.less_eq</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>s</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>lin</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less|const"><span>Orderings.less</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>lin</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Not|const"><span>Not</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Not|const"><span>Not</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lin</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>lin</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>_</span></span><span>::</span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Rings.html#Rings.dvd_class.dvd|const"><span>Rings.dvd</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>d</span></span><span>$</span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>HOLogic.mk_binrel</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Rings.html#Rings.dvd_class.dvd|const"><span>Rings.dvd</span></a><span>›</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>numeral1</span></span><span> </span><span>abs</span><span> </span><span class="entity"><span>d</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lint</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>lin</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>x</span></span><span>::</span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>b</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.eq|const"><span>HOL.eq</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>s</span></span><span>$</span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
     </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>lint</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subC</span></span><span>$</span><span class="entity"><span>t</span></span><span>$</span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>_</span></span><span>$</span><span class="main"><span>(</span></span><span class="entity"><span>m</span></span><span>$</span><span class="entity"><span>c</span></span><span>$</span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>b</span></span><span>$</span><span class="entity"><span>zero</span></span><span>$</span><span class="entity"><span>t</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>dest_number</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span>&lt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>b</span></span><span>$</span><span class="main"><span>(</span></span><span class="entity"><span>m</span></span><span>$</span><span class="main"><span>(</span></span><span class="entity"><span>numeral1</span></span><span> </span><span>~</span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>r</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>b</span></span><span>$</span><span class="main"><span>(</span></span><span class="entity"><span>m</span></span><span>$</span><span class="entity"><span>c</span></span><span>$</span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>(</span></span><span class="entity"><span>linear_neg</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>b</span></span><span>$</span><span class="entity"><span>zero</span></span><span>$</span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>lin</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>x</span></span><span>::</span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>b</span></span><span>$</span><span class="entity"><span>s</span></span><span>$</span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
     </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>lint</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subC</span></span><span>$</span><span class="entity"><span>t</span></span><span>$</span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>_</span></span><span>$</span><span class="main"><span>(</span></span><span class="entity"><span>m</span></span><span>$</span><span class="entity"><span>c</span></span><span>$</span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>b</span></span><span>$</span><span class="entity"><span>zero</span></span><span>$</span><span class="entity"><span>t</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>dest_number</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span>&lt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>b</span></span><span>$</span><span class="main"><span>(</span></span><span class="entity"><span>m</span></span><span>$</span><span class="main"><span>(</span></span><span class="entity"><span>numeral1</span></span><span> </span><span>~</span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>r</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>b</span></span><span>$</span><span class="main"><span>(</span></span><span class="entity"><span>linear_neg</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>(</span></span><span class="entity"><span>m</span></span><span>$</span><span class="entity"><span>c</span></span><span>$</span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>b</span></span><span>$</span><span class="entity"><span>zero</span></span><span>$</span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>lin</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>fm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fm</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>lint_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>provelin</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span class="entity"><span>iT</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>t</span></span><span>$</span><span class="main"><span>(</span></span><span class="entity"><span>lint</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
             </span><span>RS</span><span> </span><span class="entity"><span>eq_reflection</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_intrel_type</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.bool|type"><span>bool</span></a><span>›</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_intrel</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>b</span></span><span>$</span><span class="main"><span>_</span></span><span>$</span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_intrel_type</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_intrel</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Not|const"><span>Not</span></a><span>›</span></span></span><span>$</span><span class="main"><span>(</span></span><span class="entity"><span>b</span></span><span>$</span><span class="main"><span>_</span></span><span>$</span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_intrel_type</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_intrel</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>linearize_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
  </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Rings.html#Rings.dvd_class.dvd|const"><span>Rings.dvd</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>_</span></span><span>$</span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Conv.binop_conv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lint_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ct</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>d'</span></span><span class="main"><span>,</span></span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_binop</span><span> </span><span class="main"><span>(</span></span><span>Thm.rhs_of</span><span> </span><span class="entity"><span>th</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dt'</span></span><span class="main"><span>,</span></span><span class="entity"><span>tt'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>d'</span></span><span class="main"><span>,</span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_number</span></span><span> </span><span class="entity"><span>dt'</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>is_number</span></span><span> </span><span class="entity"><span>tt'</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Conv.fconv_rule</span><span> </span><span class="main"><span>(</span></span><span>Conv.arg_conv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Simplifier.rewrite</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>presburger_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>th</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
       </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dth</span></span><span> </span><span class="main"><span>=</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>perhaps_number</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>d'</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
           </span><span>SOME</span><span> </span><span class="entity"><span>d</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>d</span></span><span> </span><span>&lt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
             </span><span class="main"><span>(</span></span><span>Conv.fconv_rule</span><span> </span><span class="main"><span>(</span></span><span>Conv.arg_conv</span><span> </span><span class="main"><span>(</span></span><span>Conv.arg1_conv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lint_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                              </span><span class="main"><span>(</span></span><span>Thm.transitive</span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>d'</span></span><span class="main"><span>,</span></span><span class="entity"><span>t'</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>dvd_uminus</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>TERM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>th</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>th</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>COOPER</span></span><span> </span><span class="inner_quoted"><span>"linearize_conv: not linear"</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>d''</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.rhs_of</span><span> </span><span class="entity"><span>dth</span></span><span> </span><span>|&gt;</span><span> </span><span>Thm.dest_arg1</span><span>
     </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>tt'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.plus_class.plus|const"><span>Groups.plus</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.times_class.times|const"><span>Groups.times</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>c</span></span><span>$</span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_number</span></span><span> </span><span class="entity"><span>c</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span>&lt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Conv.fconv_rule</span><span> </span><span class="main"><span>(</span></span><span>Conv.arg_conv</span><span> </span><span class="main"><span>(</span></span><span>Conv.arg_conv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lint_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                                       </span><span class="main"><span>(</span></span><span>Thm.transitive</span><span> </span><span class="entity"><span>dth</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>d''</span></span><span class="main"><span>,</span></span><span class="entity"><span>t'</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>dvd_uminus'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>dth</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>dth</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Not|const"><span>Not</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Rings.html#Rings.dvd_class.dvd|const"><span>Rings.dvd</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>_</span></span><span>$</span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Conv.arg_conv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>linearize_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ct</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_intrel</span></span><span> </span><span class="entity"><span>t</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>provelin</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span class="entity"><span>bT</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>t</span></span><span>$</span><span class="main"><span>(</span></span><span class="entity"><span>lin</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
       </span><span>RS</span><span> </span><span class="entity"><span>eq_reflection</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Thm.reflexive</span><span> </span><span class="entity"><span>ct</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dvdc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="keyword1"><a class="entity_ref" href="../../../../../Rings.html#Rings.dvd_class.dvd|const"><span>(dvd)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>unify</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>q</span></span><span> </span><span class="main"><span>=</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>e</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cx</span></span><span class="main"><span>,</span></span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>q</span></span><span> </span><span>|&gt;</span><span> </span><span>Thm.dest_comb</span><span> </span><span>||&gt;</span><span> </span><span>Thm.dest_abs_global</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>cx</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ins</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>insert</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span>int</span><span> * </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>acc</span></span><span class="main"><span>,</span></span><span class="entity"><span>dacc</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span>Const</span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.times_class.times|const"><span>Groups.times</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>c</span></span><span>$</span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span>aconv</span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.eq|const"><span>HOL.eq</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less|const"><span>Orderings.less</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less_eq|const"><span>Orderings.less_eq</span></a><span>›</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>s</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ins</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dest_number</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>acc</span></span><span class="main"><span>,</span></span><span class="entity"><span>dacc</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>acc</span></span><span class="main"><span>,</span></span><span class="entity"><span>dacc</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>_</span></span><span>$</span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.times_class.times|const"><span>Groups.times</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>c</span></span><span>$</span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span>aconv</span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span>
       </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less|const"><span>Orderings.less</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less_eq|const"><span>Orderings.less_eq</span></a><span>›</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>s</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ins</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dest_number</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>acc</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dacc</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>acc</span></span><span class="main"><span>,</span></span><span class="entity"><span>dacc</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Rings.html#Rings.dvd_class.dvd|const"><span>Rings.dvd</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>_</span></span><span>$</span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.plus_class.plus|const"><span>Groups.plus</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.times_class.times|const"><span>Groups.times</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>c</span></span><span>$</span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span>aconv</span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>acc</span></span><span class="main"><span>,</span></span><span class="entity"><span>ins</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dest_number</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dacc</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>acc</span></span><span class="main"><span>,</span></span><span class="entity"><span>dacc</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>_</span></span><span>$</span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>h</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>acc</span></span><span class="main"><span>,</span></span><span class="entity"><span>dacc</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_arg1</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_arg</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.disj|const"><span>HOL.disj</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>_</span></span><span>$</span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>h</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>acc</span></span><span class="main"><span>,</span></span><span class="entity"><span>dacc</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_arg1</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_arg</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Not|const"><span>Not</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>acc</span></span><span class="main"><span>,</span></span><span class="entity"><span>dacc</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_arg</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>acc</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dacc</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cs</span></span><span class="main"><span>,</span></span><span class="entity"><span>ds</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>p</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Integer.lcms</span><span> </span><span class="main"><span>(</span></span><span>union</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cs</span></span><span> </span><span class="entity"><span>ds</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>cv</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>b</span></span><span>$</span><span class="entity"><span>s</span></span><span>$</span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span class="entity"><span>bT</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>tm</span></span><span>$</span><span class="main"><span>(</span></span><span class="entity"><span>b</span></span><span>$</span><span class="main"><span>(</span></span><span class="entity"><span>linear_cmul</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>(</span></span><span class="entity"><span>linear_cmul</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
         </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>provelin</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>eq_reflection</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>nzprop</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>=</span></span><span>
     </span><span class="entity"><span>Simplifier.rewrite</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>lin_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span>Thm.apply</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span>›</span></span></span></span><span> </span><span class="main"><span>(</span></span><span>Thm.apply</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Not|const"><span>Not</span></a><span>›</span></span></span></span><span>
           </span><span class="main"><span>(</span></span><span>Thm.apply</span><span> </span><span class="main"><span>(</span></span><span>Thm.apply</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../HOL.html#HOL.eq|const"><span>(=)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Numeral.mk_cnumber</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">ctyp</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
           </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.equal_elim</span><span> </span><span class="main"><span>(</span></span><span>Thm.symmetric</span><span> </span><span class="entity"><span>th</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>TrueI</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>notz</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tab</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span>Inttab.update</span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>ds</span></span><span> </span><span>~~</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>nzprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span> </span><span>div</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ds</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>Inttab.empty</span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>the</span><span> </span><span class="main"><span>(</span></span><span>Inttab.lookup</span><span> </span><span class="entity"><span>tab</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ct</span></span><span> </span><span>|&gt;</span><span> </span><span>Thm.term_of</span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>dest_number</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>Option.Option</span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span>writeln</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"noz: Theorems-Table contains no entry for "</span></span><span> </span><span>^</span><span>
              </span><span>Syntax.string_of_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Option.Option</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>unit_conv</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
   </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>_</span></span><span>$</span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Conv.binop_conv</span><span> </span><span class="entity"><span>unit_conv</span></span><span> </span><span class="entity"><span>t</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.disj|const"><span>HOL.disj</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>_</span></span><span>$</span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Conv.binop_conv</span><span> </span><span class="entity"><span>unit_conv</span></span><span> </span><span class="entity"><span>t</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Not|const"><span>Not</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Conv.arg_conv</span><span> </span><span class="entity"><span>unit_conv</span></span><span> </span><span class="entity"><span>t</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.times_class.times|const"><span>Groups.times</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>c</span></span><span>$</span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>=</span></span><span class="entity"><span>y</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.eq|const"><span>HOL.eq</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less|const"><span>Orderings.less</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less_eq|const"><span>Orderings.less_eq</span></a><span>›</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>s</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>cv</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span> </span><span>div</span><span> </span><span class="entity"><span>dest_number</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Thm.reflexive</span><span> </span><span class="entity"><span>t</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>_</span></span><span>$</span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.times_class.times|const"><span>Groups.times</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>c</span></span><span>$</span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>=</span></span><span class="entity"><span>y</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less|const"><span>Orderings.less</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less_eq|const"><span>Orderings.less_eq</span></a><span>›</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>s</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>cv</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span> </span><span>div</span><span> </span><span class="entity"><span>dest_number</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Thm.reflexive</span><span> </span><span class="entity"><span>t</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Rings.html#Rings.dvd_class.dvd|const"><span>Rings.dvd</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>d</span></span><span>$</span><span class="main"><span>(</span></span><span class="entity"><span>r</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.plus_class.plus|const"><span>Groups.plus</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.times_class.times|const"><span>Groups.times</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>c</span></span><span>$</span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span>$</span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>=</span></span><span class="entity"><span>y</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
       </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span>div</span><span> </span><span class="entity"><span>dest_number</span></span><span> </span><span class="entity"><span>c</span></span><span>
       </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>kt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_number</span></span><span> </span><span class="entity"><span>iT</span></span><span> </span><span class="entity"><span>k</span></span><span>
       </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span>Thm.dest_arg1</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span>Thm.dest_arg</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span>
             </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Thm.dest_arg</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>|&gt;</span><span> </span><span>funpow</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span>Thm.dest_arg1</span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>notz</span></span><span class="main"><span>)</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>zdvd_mono</span></span><span class="main"><span>)</span></span><span>
       </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>d'</span></span><span class="main"><span>,</span></span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mulC</span></span><span>$</span><span class="entity"><span>kt</span></span><span>$</span><span class="entity"><span>d</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mulC</span></span><span>$</span><span class="entity"><span>kt</span></span><span>$</span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span>
       </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>provelin</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span class="entity"><span>iT</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>d'</span></span><span>$</span><span class="main"><span>(</span></span><span class="entity"><span>lint</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>d'</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                   </span><span>RS</span><span> </span><span class="entity"><span>eq_reflection</span></span><span>
       </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tht</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>provelin</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span class="entity"><span>iT</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>t'</span></span><span>$</span><span class="main"><span>(</span></span><span class="entity"><span>linear_cmul</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                 </span><span>RS</span><span> </span><span class="entity"><span>eq_reflection</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.combination</span><span> </span><span class="main"><span>(</span></span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>dvdc</span></span><span> </span><span class="entity"><span>thc</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tht</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Thm.reflexive</span><span> </span><span class="entity"><span>t</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Thm.reflexive</span><span> </span><span class="entity"><span>t</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>uth</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>unit_conv</span></span><span> </span><span class="entity"><span>p</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>clt</span></span><span> </span><span class="main"><span>=</span></span><span>  </span><span class="entity"><span>Numeral.mk_cnumber</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">ctyp</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span></span><span> </span><span class="entity"><span>l</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ltx</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.apply</span><span> </span><span class="main"><span>(</span></span><span>Thm.apply</span><span> </span><span class="entity"><span>cmulC</span></span><span> </span><span class="entity"><span>clt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cx</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>e</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.abstract_rule</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cx</span></span><span> </span><span class="entity"><span>uth</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>[</span></span><span>Thm.lambda</span><span> </span><span class="entity"><span>ltx</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.rhs_of</span><span> </span><span class="entity"><span>uth</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>clt</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>unity_coeff_ex</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th</span></span><span>
      </span><span class="main"><span>(</span></span><span>Thm.transitive</span><span> </span><span class="main"><span>(</span></span><span>Thm.symmetric</span><span> </span><span class="main"><span>(</span></span><span>Thm.beta_conversion</span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span>Thm.cprop_of</span><span> </span><span class="entity"><span>th'</span></span><span> </span><span>|&gt;</span><span> </span><span>Thm.dest_arg1</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>th'</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lth</span></span><span class="main"><span>,</span></span><span class="entity"><span>rth</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="main"><span>(</span></span><span>Thm.cprop_of</span><span> </span><span class="entity"><span>thf</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;&gt;</span><span> </span><span>Thm.dest_arg</span><span> </span><span>|&gt;&gt;</span><span> </span><span>Thm.beta_conversion</span><span> </span><span>true</span><span>
                  </span><span>||&gt;</span><span> </span><span>Thm.beta_conversion</span><span> </span><span>true</span><span> </span><span>|&gt;&gt;</span><span> </span><span>Thm.symmetric</span><span>
 </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.transitive</span><span> </span><span class="main"><span>(</span></span><span>Thm.transitive</span><span> </span><span class="entity"><span>lth</span></span><span> </span><span class="entity"><span>thf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rth</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>


</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>emptyIS</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Set.html#Set.empty|const"><span>{}</span></a></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.set|type"><span>set</span></a><span>›</span></span></span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>insert_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Set.html#Set.insert|const"><span>insert</span></a><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mkISet</span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>Thm.apply</span><span> </span><span class="entity"><span>insert_tm</span></span><span> </span><span>#&gt;</span><span> </span><span>Thm.apply</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="entity"><span>emptyIS</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eqelem_imp_imp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.eqelem_imp_iff|fact"><span>eqelem_imp_iff</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>iffD1</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>A_v</span></span><span class="main"><span>,</span></span><span class="entity"><span>B_v</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Thm.cprop_of</span><span> </span><span class="entity"><span>th</span></span><span> </span><span>|&gt;</span><span> </span><span>funpow</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span>Thm.dest_arg</span><span>
    </span><span>|&gt;</span><span> </span><span>Thm.dest_abs_global</span><span> </span><span>|&gt;</span><span> </span><span>snd</span><span> </span><span>|&gt;</span><span> </span><span>Thm.dest_arg1</span><span> </span><span>|&gt;</span><span> </span><span>Thm.dest_arg</span><span>
    </span><span>|&gt;</span><span> </span><span>Thm.dest_abs_global</span><span> </span><span>|&gt;</span><span> </span><span>snd</span><span> </span><span>|&gt;</span><span> </span><span>Thm.dest_fun</span><span> </span><span>|&gt;</span><span> </span><span>Thm.dest_arg</span><span>
    </span><span>|&gt;</span><span> </span><span>Thm.term_of</span><span> </span><span>|&gt;</span><span> </span><span>dest_Var</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>asetP</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bsetP</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>D_v</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"D"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>cooperex_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>q</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>

 </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>uth</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>unify</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>q</span></span><span>
 </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_abs_global</span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_arg</span><span> </span><span class="main"><span>(</span></span><span>Thm.rhs_of</span><span> </span><span class="entity"><span>uth</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
 </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ins</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>insert</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconvc</span><span class="main"><span>)</span></span><span>
 </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bacc</span></span><span class="main"><span>,</span></span><span class="entity"><span>aacc</span></span><span class="main"><span>,</span></span><span class="entity"><span>dacc</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>whatis</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="entity"><span>And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span class="entity"><span>q</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="entity"><span>q</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>h</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bacc</span></span><span class="main"><span>,</span></span><span class="entity"><span>aacc</span></span><span class="main"><span>,</span></span><span class="entity"><span>dacc</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span class="entity"><span>q</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="entity"><span>q</span></span><span>  </span><span class="main"><span>(</span></span><span class="entity"><span>h</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bacc</span></span><span class="main"><span>,</span></span><span class="entity"><span>aacc</span></span><span class="main"><span>,</span></span><span class="entity"><span>dacc</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Eq</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ins</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>minus1</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bacc</span></span><span class="main"><span>,</span></span><span>
             </span><span class="entity"><span>ins</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>plus1</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>aacc</span></span><span class="main"><span>,</span></span><span class="entity"><span>dacc</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NEq</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ins</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>bacc</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>ins</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>aacc</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dacc</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Lt</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bacc</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ins</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>aacc</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dacc</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Le</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bacc</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ins</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>plus1</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>aacc</span></span><span class="main"><span>,</span></span><span class="entity"><span>dacc</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Gt</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ins</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>bacc</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>aacc</span></span><span class="main"><span>,</span></span><span class="entity"><span>dacc</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Ge</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ins</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>minus1</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bacc</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>aacc</span></span><span class="main"><span>,</span></span><span class="entity"><span>dacc</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Dvd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>d</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bacc</span></span><span class="main"><span>,</span></span><span class="entity"><span>aacc</span></span><span class="main"><span>,</span></span><span>insert</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>d</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>dest_number</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dacc</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NDvd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>d</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bacc</span></span><span class="main"><span>,</span></span><span class="entity"><span>aacc</span></span><span class="main"><span>,</span></span><span>insert</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>d</span></span><span>|&gt;</span><span> </span><span class="entity"><span>dest_number</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dacc</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bacc</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>aacc</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dacc</span></span><span class="main"><span>)</span></span><span>
 </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>b0</span></span><span class="main"><span>,</span></span><span class="entity"><span>a0</span></span><span class="main"><span>,</span></span><span class="entity"><span>ds</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
 </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>d</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Integer.lcms</span><span> </span><span class="entity"><span>ds</span></span><span>
 </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cd</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Numeral.mk_cnumber</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">ctyp</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span></span><span> </span><span class="entity"><span>d</span></span><span>
 </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>divprop</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>=</span></span><span>
     </span><span class="entity"><span>Simplifier.rewrite</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>lin_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span>Thm.apply</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span>›</span></span></span></span><span>
           </span><span class="main"><span>(</span></span><span>Thm.apply</span><span> </span><span class="main"><span>(</span></span><span>Thm.apply</span><span> </span><span class="entity"><span>dvdc</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Numeral.mk_cnumber</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">ctyp</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cd</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.equal_elim</span><span> </span><span class="main"><span>(</span></span><span>Thm.symmetric</span><span> </span><span class="entity"><span>th</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>TrueI</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
 </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dvd</span></span><span> </span><span class="main"><span>=</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tab</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span>Inttab.update</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ds</span></span><span> </span><span>~~</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>divprop</span></span><span> </span><span class="entity"><span>ds</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>Inttab.empty</span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
     </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>the</span><span> </span><span class="main"><span>(</span></span><span>Inttab.lookup</span><span> </span><span class="entity"><span>tab</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>dest_number</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
       </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>Option.Option</span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="main"><span>(</span></span><span>writeln</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"dvd: Theorems-Table contains no entry for"</span></span><span> </span><span>^</span><span>
            </span><span>Syntax.string_of_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Option.Option</span><span class="main"><span>)</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
 </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dp</span></span><span> </span><span class="main"><span>=</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Simplifier.rewrite</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>lin_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span>Thm.apply</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span>›</span></span></span></span><span>
           </span><span class="main"><span>(</span></span><span>Thm.apply</span><span> </span><span class="main"><span>(</span></span><span>Thm.apply</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less|const"><span>(&lt;)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cd</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.equal_elim</span><span> </span><span class="main"><span>(</span></span><span>Thm.symmetric</span><span> </span><span class="entity"><span>th</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>TrueI</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="comment1"><span>(* A and B set *)</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>
     </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>insI1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.instantiate'</span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">ctyp</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Set.html#Set.insertI1|fact"><span>insertI1</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span>
     </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>insI2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.instantiate'</span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">ctyp</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Set.html#Set.insertI2|fact"><span>insertI2</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>provein</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>S</span></span><span> </span><span class="main"><span>=</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>S</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.bot_class.bot|const"><span>Orderings.bot</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"Unexpected error in Cooper, please email Amine Chaieb"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Set.html#Set.insert|const"><span>insert</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cy</span></span><span class="main"><span>,</span></span><span class="entity"><span>S'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_binop</span><span> </span><span class="entity"><span>S</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>aconv</span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Thm.instantiate'</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>S'</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>insI1</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Thm.implies_elim</span><span> </span><span class="main"><span>(</span></span><span>Thm.instantiate'</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>S'</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>cy</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>insI2</span></span><span class="main"><span>)</span></span><span>
                           </span><span class="main"><span>(</span></span><span class="entity"><span>provein</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>S'</span></span><span class="main"><span>)</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

 </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>al</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lint</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span>o</span><span> </span><span>Thm.term_of</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>a0</span></span><span>
 </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lint</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span>o</span><span> </span><span>Thm.term_of</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>b0</span></span><span>
 </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sl</span></span><span class="main"><span>,</span></span><span class="entity"><span>s0</span></span><span class="main"><span>,</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span class="entity"><span>abths</span></span><span class="main"><span>,</span></span><span class="entity"><span>cpth</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>length</span><span> </span><span class="main"><span>(</span></span><span>distinct</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconv</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bl</span></span><span class="main"><span>)</span></span><span> </span><span>&lt;=</span><span> </span><span>length</span><span> </span><span class="main"><span>(</span></span><span>distinct</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconv</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>al</span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>bl</span></span><span class="main"><span>,</span></span><span class="entity"><span>b0</span></span><span class="main"><span>,</span></span><span class="entity"><span>decomp_minf</span></span><span class="main"><span>,</span></span><span>
     </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>B</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
       </span><span>Thm.implies_elim</span><span> </span><span class="main"><span>(</span></span><span>Thm.instantiate</span><span> </span><span class="main"><span>(</span></span><span>TVars.empty</span><span class="main"><span>,</span></span><span> </span><span>Vars.make2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>B_v</span></span><span class="main"><span>,</span></span><span class="entity"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>D_v</span></span><span class="main"><span>,</span></span><span class="entity"><span>cd</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>th</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dp</span></span><span class="main"><span>)</span></span><span>
                     </span><span class="main"><span>[</span></span><span class="entity"><span>bseteq</span></span><span class="main"><span>,</span></span><span class="entity"><span>bsetneq</span></span><span class="main"><span>,</span></span><span class="entity"><span>bsetlt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bsetle</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bsetgt</span></span><span class="main"><span>,</span></span><span class="entity"><span>bsetge</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>@</span><span>
                   </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.instantiate</span><span> </span><span class="main"><span>(</span></span><span>TVars.empty</span><span class="main"><span>,</span></span><span> </span><span>Vars.make2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>B_v</span></span><span class="main"><span>,</span></span><span class="entity"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>D_v</span></span><span class="main"><span>,</span></span><span class="entity"><span>cd</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                        </span><span class="main"><span>[</span></span><span class="entity"><span>bsetdvd</span></span><span class="main"><span>,</span></span><span class="entity"><span>bsetndvd</span></span><span class="main"><span>,</span></span><span class="entity"><span>bsetP</span></span><span class="main"><span>,</span></span><span class="entity"><span>infDdvd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDndvd</span></span><span class="main"><span>,</span></span><span class="entity"><span>bsetconj</span></span><span class="main"><span>,</span></span><span>
                         </span><span class="entity"><span>bsetdisj</span></span><span class="main"><span>,</span></span><span class="entity"><span>infDconj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDdisj</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                       </span><span class="entity"><span>cpmi</span></span><span class="main"><span>)</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>al</span></span><span class="main"><span>,</span></span><span class="entity"><span>a0</span></span><span class="main"><span>,</span></span><span class="entity"><span>decomp_pinf</span></span><span class="main"><span>,</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span>Thm.implies_elim</span><span> </span><span class="main"><span>(</span></span><span>Thm.instantiate</span><span> </span><span class="main"><span>(</span></span><span>TVars.empty</span><span class="main"><span>,</span></span><span> </span><span>Vars.make2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>A_v</span></span><span class="main"><span>,</span></span><span class="entity"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>D_v</span></span><span class="main"><span>,</span></span><span class="entity"><span>cd</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>th</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dp</span></span><span class="main"><span>)</span></span><span>
                   </span><span class="main"><span>[</span></span><span class="entity"><span>aseteq</span></span><span class="main"><span>,</span></span><span class="entity"><span>asetneq</span></span><span class="main"><span>,</span></span><span class="entity"><span>asetlt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>asetle</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>asetgt</span></span><span class="main"><span>,</span></span><span class="entity"><span>asetge</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>@</span><span>
                   </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.instantiate</span><span> </span><span class="main"><span>(</span></span><span>TVars.empty</span><span class="main"><span>,</span></span><span> </span><span>Vars.make2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>A_v</span></span><span class="main"><span>,</span></span><span class="entity"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>D_v</span></span><span class="main"><span>,</span></span><span class="entity"><span>cd</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                   </span><span class="main"><span>[</span></span><span class="entity"><span>asetdvd</span></span><span class="main"><span>,</span></span><span class="entity"><span>asetndvd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>asetP</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDdvd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDndvd</span></span><span class="main"><span>,</span></span><span class="entity"><span>asetconj</span></span><span class="main"><span>,</span></span><span>
                         </span><span class="entity"><span>asetdisj</span></span><span class="main"><span>,</span></span><span class="entity"><span>infDconj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>infDdisj</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>cppi</span></span><span class="main"><span>)</span></span><span>
 </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cpth</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
   </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sths</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tl</span></span><span class="main"><span>,</span></span><span class="entity"><span>t0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>tl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>t0</span></span><span>
                      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Thm.instantiate'</span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">ctyp</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="entity"><span>t0</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>refl</span></span><span>
                      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>provelin</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span class="entity"><span>iT</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>tl</span></span><span>$</span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>t0</span></span><span class="main"><span>)</span></span><span>
                                 </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                   </span><span class="main"><span>(</span></span><span class="entity"><span>sl</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>s0</span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>csl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>distinct</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconvc</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.cprop_of</span><span> </span><span>#&gt;</span><span> </span><span>Thm.dest_arg</span><span> </span><span>#&gt;</span><span> </span><span>Thm.dest_arg1</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sths</span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>S</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mkISet</span></span><span> </span><span class="entity"><span>csl</span></span><span>
   </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inStab</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>tab</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Termtab.update</span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>provein</span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="entity"><span>S</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tab</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="entity"><span>csl</span></span><span> </span><span>Termtab.empty</span><span>
   </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eqelem_th</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.instantiate'</span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">ctyp</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span>NONE</span><span class="main"><span>,</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>S</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>eqelem_imp_imp</span></span><span>
   </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inS</span></span><span> </span><span class="main"><span>=</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tab</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span>Termtab.update</span><span>
        </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>eq</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.cprop_of</span><span> </span><span class="entity"><span>eq</span></span><span> </span><span>|&gt;</span><span> </span><span>Thm.dest_arg</span><span> </span><span>|&gt;</span><span> </span><span>Thm.dest_binop</span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>=</span></span><span>
                      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>t</span></span><span>
                      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>the</span><span> </span><span class="main"><span>(</span></span><span>Termtab.lookup</span><span> </span><span class="entity"><span>inStab</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>FWD</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.instantiate'</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>eqelem_th</span></span><span class="main"><span>)</span></span><span>
                        </span><span class="main"><span>[</span></span><span class="entity"><span>eq</span></span><span class="main"><span>,</span></span><span> </span><span>the</span><span> </span><span class="main"><span>(</span></span><span>Termtab.lookup</span><span> </span><span class="entity"><span>inStab</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>th</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sths</span></span><span class="main"><span>)</span></span><span> </span><span>Termtab.empty</span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>the</span><span> </span><span class="main"><span>(</span></span><span>Termtab.lookup</span><span> </span><span class="entity"><span>tab</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>Option.Option</span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="main"><span>(</span></span><span>writeln</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"inS: No theorem for "</span></span><span> </span><span>^</span><span> </span><span>Syntax.string_of_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Option.Option</span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
       </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inf</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nb</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pd</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>divide_and_conquer</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>dvd</span></span><span> </span><span class="entity"><span>inS</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>abths</span></span><span> </span><span class="entity"><span>S</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>p</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>dp</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>inf</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nb</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pd</span></span><span class="main"><span>]</span></span><span> </span><span>MRS</span><span> </span><span class="entity"><span>cpth</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
 </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cpth'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>uth</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cpth</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>eq_reflection</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>cpth'</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>simp_thms_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>then_conv</span><span> </span><span class="entity"><span>eval_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.rhs_of</span><span> </span><span class="entity"><span>cpth'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>literals_conv</span></span><span> </span><span class="entity"><span>bops</span></span><span> </span><span class="entity"><span>uops</span></span><span> </span><span class="entity"><span>env</span></span><span> </span><span class="entity"><span>cv</span></span><span> </span><span class="main"><span>=</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
   </span><span class="entity"><span>b</span></span><span>$</span><span class="main"><span>_</span></span><span>$</span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconv</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bops</span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Conv.binop_conv</span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>cv</span></span><span> </span><span class="entity"><span>env</span></span><span> </span><span class="entity"><span>t</span></span><span>
 </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>u</span></span><span>$</span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconv</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>uops</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Conv.arg_conv</span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>cv</span></span><span> </span><span class="entity"><span>env</span></span><span> </span><span class="entity"><span>t</span></span><span>
 </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>cv</span></span><span> </span><span class="entity"><span>env</span></span><span> </span><span class="entity"><span>t</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>integer_nnf_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>env</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>nnf_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>then_conv</span><span> </span><span class="entity"><span>literals_conv</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.conj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.disj</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>env</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>linearize_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>conv_ss</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>simpset_of</span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span><span class="hidden">\&lt;^</span><span class="control">context</span><span class="hidden">&gt;</span></span></span></span></span><span>
    </span><span>addsimps</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.simp_thms|fact"><span>simp_thms</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span>take</span><span> </span><span class="inner_numeral"><span>4</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.ex_simps|fact"><span>ex_simps</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span>
      </span><span class="main"><span>[</span></span><span class="entity"><span>not_all</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>all_not_ex</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.ex_disj_distrib|fact"><span>ex_disj_distrib</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Qelim.gen_qelim_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>Simplifier.rewrite</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>conv_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>Simplifier.rewrite</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>presburger_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>Simplifier.rewrite</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>conv_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>(</span></span><span>cons</span><span> </span><span>o</span><span> </span><span>Thm.term_of</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Misc_Legacy.term_frees</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>linearize_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>integer_nnf_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>cooperex_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>p</span></span><span>
  </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>COOPER</span></span><span> </span><span class="inner_quoted"><span>"bad cterm"</span></span><span>
       </span><span class="main"><span>|</span></span><span> </span><span>THM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>COOPER</span></span><span> </span><span class="inner_quoted"><span>"bad thm"</span></span><span>
       </span><span class="main"><span>|</span></span><span> </span><span>TYPE</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>COOPER</span></span><span> </span><span class="inner_quoted"><span>"bad type"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_bools</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ops</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../HOL.html#HOL.eq|const"><span>(=)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less|const"><span>(&lt;)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less_eq|const"><span>(&lt;=)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span>
      </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.disj|const"><span>HOL.disj</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.implies|const"><span>HOL.implies</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../HOL.html#HOL.eq|const"><span>(=)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.bool|type"><span>bool</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span>
      </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Not|const"><span>Not</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.All|const"><span>All</span></a><span> </span><span class="main"><span>::</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span>
      </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Ex|const"><span>Ex</span></a><span> </span><span class="main"><span>::</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.True|const"><span>True</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.False|const"><span>False</span></a><span>›</span></span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>is_op</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ops</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>skip</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>skip</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>is_op</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>add_bools</span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>add_bools</span></span><span> </span><span class="entity"><span>l</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>insert</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconv</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>skip</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>is_op</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>add_bools</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>add_bools</span></span><span> </span><span class="entity"><span>f</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>insert</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconv</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span>Abs</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>add_bools</span></span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="main"><span>(</span></span><span>Term.dest_abs_global</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>skip</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>is_op</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>I</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>insert</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconv</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>descend</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>abs</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xT</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>xn'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.dest_abs_global</span><span> </span><span class="main"><span>(</span></span><span>Abs</span><span> </span><span class="entity"><span>abs</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>xn'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xT</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p'</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Proc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Cooper_Procedure</span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>num_of_term</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span>Free</span><span> </span><span class="entity"><span>vT</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Proc.Bound</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.nat_of_integer</span></span><span> </span><span class="main"><span>(</span></span><span>find_index</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>vT'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>vT'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>vT</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>num_of_term</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span>Term.Bound</span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Proc.Bound</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.nat_of_integer</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>num_of_term</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Proc.C</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Int_of_integer</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>num_of_term</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Proc.C</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Int_of_integer</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>num_of_term</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Num.html#Num.numeral_class.numeral|const"><span>numeral</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>Proc.C</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Int_of_integer</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dest_number</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>num_of_term</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.uminus_class.uminus|const"><span>Groups.uminus</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>Proc.Neg</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>num_of_term</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>num_of_term</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.plus_class.plus|const"><span>Groups.plus</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>Proc.Add</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>num_of_term</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>num_of_term</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>num_of_term</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.minus_class.minus|const"><span>Groups.minus</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>Proc.Sub</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>num_of_term</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>num_of_term</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>num_of_term</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.times_class.times|const"><span>Groups.times</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
     </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>perhaps_number</span></span><span> </span><span class="entity"><span>t1</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Proc.Mul</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Int_of_integer</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>num_of_term</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>perhaps_number</span></span><span> </span><span class="entity"><span>t2</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Proc.Mul</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Int_of_integer</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>num_of_term</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>COOPER</span></span><span> </span><span class="inner_quoted"><span>"reification: unsupported kind of multiplication"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>num_of_term</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>COOPER</span></span><span> </span><span class="inner_quoted"><span>"reification: bad term"</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fm_of_term</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.True|const"><span>True</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Proc.T</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fm_of_term</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.False|const"><span>False</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Proc.F</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fm_of_term</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>Proc.And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm_of_term</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm_of_term</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fm_of_term</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.disj|const"><span>HOL.disj</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>Proc.Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm_of_term</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm_of_term</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fm_of_term</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.implies|const"><span>HOL.implies</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>Proc.Imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm_of_term</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm_of_term</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fm_of_term</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../HOL.html#HOL.eq|const"><span>(=)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.bool|type"><span>bool</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span> ›</span></span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>Proc.Iff</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm_of_term</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fm_of_term</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fm_of_term</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Not|const"><span>Not</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>Proc.Not</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm_of_term</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fm_of_term</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Ex|const"><span>Ex</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Abs</span><span> </span><span class="entity"><span>abs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>Proc.E</span></span><span> </span><span class="main"><span>(</span></span><span>uncurry</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm_of_term</span></span><span> </span><span class="entity"><span>ps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>descend</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>abs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fm_of_term</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.All|const"><span>All</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Abs</span><span> </span><span class="entity"><span>abs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>Proc.A</span></span><span> </span><span class="main"><span>(</span></span><span>uncurry</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fm_of_term</span></span><span> </span><span class="entity"><span>ps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>descend</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>abs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fm_of_term</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../HOL.html#HOL.eq|const"><span>(=)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>Proc.Eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Sub</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>num_of_term</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>num_of_term</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fm_of_term</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less_eq|const"><span>Orderings.less_eq</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>Proc.Le</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Sub</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>num_of_term</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>num_of_term</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fm_of_term</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less|const"><span>Orderings.less</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>Proc.Lt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Sub</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>num_of_term</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>num_of_term</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fm_of_term</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Rings.html#Rings.dvd_class.dvd|const"><span>Rings.dvd</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
     </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>perhaps_number</span></span><span> </span><span class="entity"><span>t1</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Proc.Dvd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Int_of_integer</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>num_of_term</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>COOPER</span></span><span> </span><span class="inner_quoted"><span>"reification: unsupported dvd"</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fm_of_term</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>find_index</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span>aconv</span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ps</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Proc.Closed</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.nat_of_integer</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>COOPER</span></span><span> </span><span class="inner_quoted"><span>"reification: unknown term"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>term_of_num</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.C</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_number</span></span><span> </span><span class="entity"><span>HOLogic.intT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.integer_of_int</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_num</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Bound</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.integer_of_nat</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_num</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Neg</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.uminus_class.uminus|const"><span>uminus</span></a><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span> </span><span>$</span><span> </span><span class="entity"><span>term_of_num</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t'</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_num</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Add</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.plus_class.plus|const"><span>(+)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span> </span><span>$</span><span> </span><span class="entity"><span>term_of_num</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>term_of_num</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_num</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Sub</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.minus_class.minus|const"><span>(-)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span> </span><span>$</span><span> </span><span class="entity"><span>term_of_num</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>term_of_num</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_num</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Mul</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.times_class.times|const"><span>(*)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span> </span><span>$</span><span> </span><span class="entity"><span>HOLogic.mk_number</span></span><span> </span><span class="entity"><span>HOLogic.intT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.integer_of_int</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>term_of_num</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_num</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.CN</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>term_of_num</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Add</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Mul</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Proc.Bound</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>Proc.T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.True|const"><span>True</span></a><span>›</span></span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>Proc.F</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.False|const"><span>False</span></a><span>›</span></span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.And</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.conj</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Or</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.disj</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.imp</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Iff</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../HOL.html#HOL.eq|const"><span>(=)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.bool|type"><span>bool</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span> </span><span>$</span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Not</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.Not</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t'</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Eq</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../HOL.html#HOL.eq|const"><span>(=)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span> ›</span></span></span><span> </span><span>$</span><span> </span><span class="entity"><span>term_of_num</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t'</span></span><span>$</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.NEq</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Not</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Eq</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Lt</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less|const"><span>(&lt;)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span> ›</span></span></span><span> </span><span>$</span><span> </span><span class="entity"><span>term_of_num</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t'</span></span><span> </span><span>$</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Le</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less_eq|const"><span>(&lt;=)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span> ›</span></span></span><span> </span><span>$</span><span> </span><span class="entity"><span>term_of_num</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t'</span></span><span> </span><span>$</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Gt</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less|const"><span>(&lt;)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span> ›</span></span></span><span> </span><span>$</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span><span> </span><span>$</span><span> </span><span class="entity"><span>term_of_num</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t'</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Ge</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.less_eq|const"><span>(&lt;=)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span> ›</span></span></span><span> </span><span>$</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span><span> </span><span>$</span><span> </span><span class="entity"><span>term_of_num</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t'</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Dvd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="keyword1"><a class="entity_ref" href="../../../../../Rings.html#Rings.dvd_class.dvd|const"><span>(dvd)</span></a></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span> ›</span></span></span><span> </span><span>$</span><span>
      </span><span class="entity"><span>HOLogic.mk_number</span></span><span> </span><span class="entity"><span>HOLogic.intT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.integer_of_int</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>term_of_num</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t'</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.NDvd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Not</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Dvd</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Closed</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.integer_of_nat</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.NClosed</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Not</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proc.Closed</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>procedure</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.add_frees</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>add_bools</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>term_of_fm</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Proc.pa</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>fm_of_term</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>oracle</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Context.&gt;&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span>Context.map_theory_result</span><span>
  </span><span class="main"><span>(</span></span><span>Thm.add_oracle</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="entity_def" id="Presburger.cooper|oracle"><span>cooper</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>o</span><span> </span><span>Logic.mk_equals</span><span> </span><span>o</span><span> </span><span>apply2</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>procedure</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>comp_ss</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>simpset_of</span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_ss</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span><span class="hidden">\&lt;^</span><span class="control">context</span><span class="hidden">&gt;</span></span></span></span></span><span> </span><span>addsimps</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Numeral_Simprocs.html#Numeral_Simprocs.semiring_norm|fact"><span>semiring_norm</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>strip_objimp</span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.implies|const"><span>HOL.implies</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>A</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_binop</span><span> </span><span class="entity"><span>ct</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>strip_objimp</span></span><span> </span><span class="entity"><span>B</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ct</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>strip_objall</span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="main"><span>=</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
  </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.All|const"><span>All</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Abs</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span>Thm.dest_abs_global</span><span> </span><span>o</span><span> </span><span>Thm.dest_comb</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ct</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>cons</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>strip_objall</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="entity"><span>ct</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>all_maxscope_ss</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span>simpset_of</span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span><span class="hidden">\&lt;^</span><span class="control">context</span><span class="hidden">&gt;</span></span></span></span></span><span>
      </span><span>addsimps</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> "</span><a class="entity_ref" href="../../../../../HOL.html#HOL.all_simps|fact"><span>all_simps</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>thin_prems_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>simp_tac</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>all_maxscope_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span>THEN'</span><span>
  </span><span>CSUBGOAL</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
     </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>qvs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>strip_objall</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_arg</span><span> </span><span class="entity"><span>p'</span></span><span class="main"><span>)</span></span><span>
     </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>split_last</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>strip_objimp</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span>
     </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>qs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>filter</span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="entity"><span>ps</span></span><span>
     </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>q</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.False|const"><span>False</span></a><span>›</span></span></span></span><span>
     </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ng</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Thm.apply</span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.lambda</span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>qvs</span></span><span>
         </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>q</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Thm.apply</span><span> </span><span class="main"><span>(</span></span><span>Thm.apply</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.implies|const"><span>HOL.implies</span></a><span>›</span></span></span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>q</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>qs</span></span><span> </span><span class="entity"><span>q</span></span><span class="main"><span>)</span></span><span>
     </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>g</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.apply</span><span> </span><span class="main"><span>(</span></span><span>Thm.apply</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><span>(==&gt;)</span></span><span>›</span></span></span></span><span> </span><span class="main"><span>(</span></span><span>Thm.apply</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span>›</span></span></span></span><span> </span><span class="entity"><span>ng</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>p'</span></span><span>
     </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ntac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>qs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>q</span></span><span> </span><span>aconvc</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.False|const"><span>False</span></a><span>›</span></span></span></span><span>
                         </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>ntac</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>no_tac</span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">try</span><span class="hidden">&gt;</span></span></span><span class="entity"><span>‹</span><span>Goal.prove_internal</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>g</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>blast_tac</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>put_claset</span></span><span> </span><span class="entity"><span>HOL_cs</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>no_tac</span><span>
        </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>r</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>
 </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>isnum</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
   </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.zero_class.zero|const"><span>Groups.zero</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span>
 </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.one_class.one|const"><span>Groups.one</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span>
 </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Nat.html#Nat.Suc|const"><span>Suc</span></a><span>›</span></span></span><span>$</span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>isnum</span></span><span> </span><span class="entity"><span>s</span></span><span>
 </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Int.html#Int.nat|const"><span>nat</span></a><span>›</span></span></span><span>$</span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>isnum</span></span><span> </span><span class="entity"><span>s</span></span><span>
 </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Int.html#Int.int|const"><span>int</span></a><span>›</span></span></span><span>$</span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>isnum</span></span><span> </span><span class="entity"><span>s</span></span><span>
 </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.uminus_class.uminus|const"><span>Groups.uminus</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>isnum</span></span><span> </span><span class="entity"><span>s</span></span><span>
 </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.plus_class.plus|const"><span>Groups.plus</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>l</span></span><span>$</span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>isnum</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>isnum</span></span><span> </span><span class="entity"><span>r</span></span><span>
 </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.times_class.times|const"><span>Groups.times</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>l</span></span><span>$</span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>isnum</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>isnum</span></span><span> </span><span class="entity"><span>r</span></span><span>
 </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Groups.html#Groups.minus_class.minus|const"><span>Groups.minus</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>l</span></span><span>$</span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>isnum</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>isnum</span></span><span> </span><span class="entity"><span>r</span></span><span>
 </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Power.html#Power.power_class.power|const"><span>Power.power</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>l</span></span><span>$</span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>isnum</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>isnum</span></span><span> </span><span class="entity"><span>r</span></span><span>
 </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Rings.html#Rings.modulo_class.modulo|const"><span>Rings.modulo</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>l</span></span><span>$</span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>isnum</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>isnum</span></span><span> </span><span class="entity"><span>r</span></span><span>
 </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Rings.html#Rings.divide_class.divide|const"><span>Rings.divide</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>l</span></span><span>$</span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>isnum</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>isnum</span></span><span> </span><span class="entity"><span>r</span></span><span>
 </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>is_number</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>can</span><span> </span><span class="entity"><span>HOLogic.dest_nat</span></span><span> </span><span class="entity"><span>t</span></span><span>

 </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.intT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.natT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.typ_of_cterm</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>false</span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="entity"><span>c</span></span><span>$</span><span class="entity"><span>l</span></span><span>$</span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.times_class.times|const"><span>(*)</span></a></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../../Groups.html#Groups.times_class.times|const"><span>(*)</span></a></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../../../../Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>c</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>isnum</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>isnum</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconv</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>c</span></span><span>$</span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconv</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconv</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span>

 </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>term_constants</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="entity"><span>acc</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span>Const</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>insert</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconv</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>acc</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>a</span></span><span>$</span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>h</span></span><span> </span><span class="entity"><span>acc</span></span><span> </span><span class="entity"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>b</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="entity"><span>acc</span></span><span> </span><span class="entity"><span>t</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>acc</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_relevant</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="main"><span>=</span></span><span>
 </span><span>subset</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconv</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>term_constants</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>snd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
 </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
  </span><span>forall</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Nat.html#Nat.nat|type"><span>nat</span></a><span>›</span></span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>Misc_Legacy.term_frees</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
 </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
  </span><span>forall</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span>Var</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../Nat.html#Nat.nat|type"><span>nat</span></a><span>›</span></span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>Misc_Legacy.term_vars</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>int_nat_terms</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="main"><span>=</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>snd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="entity"><span>acc</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>insert</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconvc</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>acc</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="main"><span>_</span></span><span>$</span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>h</span></span><span> </span><span class="entity"><span>acc</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_arg</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_fun</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span>Abs</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Thm.dest_abs_global</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>||&gt;</span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="entity"><span>acc</span></span><span> </span><span>|&gt;</span><span> </span><span>uncurry</span><span> </span><span class="main"><span>(</span></span><span>remove</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconvc</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>acc</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>generalize_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>CSUBGOAL</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>PRIMITIVE</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
   </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>all</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span>Thm.apply</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.all_const</span><span> </span><span class="main"><span>(</span></span><span>Thm.typ_of_cterm</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.lambda</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>sort</span><span> </span><span>Thm.fast_term_ord</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>p'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span class="entity"><span>all</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="entity"><span>p</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.implies_intr</span><span> </span><span class="entity"><span>p'</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.implies_elim</span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span>Thm.forall_elim</span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.assume</span><span> </span><span class="entity"><span>p'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ss1</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>simpset_of</span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>comp_ss</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span><span class="hidden">\&lt;^</span><span class="control">context</span><span class="hidden">&gt;</span></span></span></span></span><span>
    </span><span>addsimps</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.simp_thms|fact"><span>simp_thms</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span>
            </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Int.html#Int.nat_numeral|fact"><span>nat_numeral</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Int.html#Int.int_dvd_int_iff|fact"><span>int_dvd_int_iff</span></a><span> </span><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Nat.html#Nat.semiring_1_class.of_nat_add|fact"><span>of_nat_add</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Nat.html#Nat.semiring_1_class.of_nat_mult|fact"><span>of_nat_mult</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span>
        </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Int.html#Int.int_int_eq|fact"><span>int_int_eq</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Int.html#Int.zle_int|fact"><span>zle_int</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Nat.html#Nat.linordered_nonzero_semiring_class.of_nat_less_iff|fact"><span>of_nat_less_iff</span></a><span>" </span><span class="main"><span>[</span></span><span class="operator"><span>where</span></span><span> ?'a </span><span class="main"><span class="main"><span>=</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../Int.html#Int.int|type"><span>int</span></a></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span>
    </span><span>|&gt;</span><span> </span><span class="entity"><span>Splitter.add_split</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Presburger.html#Presburger.zdiff_int_split|fact"><span>zdiff_int_split</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ss2</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>simpset_of</span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span><span class="hidden">\&lt;^</span><span class="control">context</span><span class="hidden">&gt;</span></span></span></span></span><span>
    </span><span>addsimps</span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Int.html#Int.nat_0_le|fact"><span>nat_0_le</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Num.html#Num.semiring_1_class.of_nat_numeral|fact"><span>of_nat_numeral</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Int.html#Int.all_nat|fact"><span>all_nat</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Int.html#Int.ex_nat|fact"><span>ex_nat</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Num.html#Num.linordered_nonzero_semiring_class.zero_le_numeral|fact"><span>zero_le_numeral</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Num.html#Num.linordered_nonzero_semiring_class.le_numeral_extra|fact"><span>le_numeral_extra</span></a><span>"</span><span class="main"><span>(</span></span><span>3</span><span class="main"><span>)</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Nat.html#Nat.semiring_1_class.of_nat_0|fact"><span>of_nat_0</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Nat.html#Nat.semiring_1_class.of_nat_1|fact"><span>of_nat_1</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Nat.html#Nat.Suc_eq_plus1|fact"><span>Suc_eq_plus1</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span>
    </span><span>|&gt;</span><span> </span><span>fold</span><span> </span><span class="entity"><span>Simplifier.add_cong</span></span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Presburger.html#Presburger.conj_le_cong|fact"><span>conj_le_cong</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Presburger.html#Presburger.imp_le_cong|fact"><span>imp_le_cong</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>div_mod_ss</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>simpset_of</span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span><span class="hidden">\&lt;^</span><span class="control">context</span><span class="hidden">&gt;</span></span></span></span></span><span>
    </span><span>addsimps</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.simp_thms|fact"><span>simp_thms</span></a><span>
      </span><a class="entity_ref" href="../../../../../Rings.html#Rings.semidom_modulo_class.mod_eq_0_iff_dvd|fact"><span>mod_eq_0_iff_dvd</span></a><span> </span><a class="entity_ref" href="../../../../../Euclidean_Rings.html#Euclidean_Rings.euclidean_semiring_cancel_class.mod_add_left_eq|fact"><span>mod_add_left_eq</span></a><span> </span><a class="entity_ref" href="../../../../../Euclidean_Rings.html#Euclidean_Rings.euclidean_semiring_cancel_class.mod_add_right_eq|fact"><span>mod_add_right_eq</span></a><span>
      </span><a class="entity_ref" href="../../../../../Euclidean_Rings.html#Euclidean_Rings.euclidean_semiring_cancel_class.mod_add_eq|fact"><span>mod_add_eq</span></a><span> </span><a class="entity_ref" href="../../../../../Euclidean_Rings.html#Euclidean_Rings.unique_euclidean_semiring_class.div_add1_eq|fact"><span>div_add1_eq</span></a><span> </span><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../../../../Euclidean_Rings.html#Euclidean_Rings.unique_euclidean_semiring_class.div_add1_eq|fact"><span>div_add1_eq</span></a><span> </span><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span>
      </span><a class="entity_ref" href="../../../../../Rings.html#Rings.semidom_modulo_class.mod_self|fact"><span>mod_self</span></a><span> </span><a class="entity_ref" href="../../../../../Rings.html#Rings.semidom_modulo_class.mod_by_0|fact"><span>mod_by_0</span></a><span> </span><a class="entity_ref" href="../../../../../Rings.html#Rings.semidom_divide_class.div_by_0|fact"><span>div_by_0</span></a><span>
      </span><a class="entity_ref" href="../../../../../Rings.html#Rings.semidom_divide_class.div_0|fact"><span>div_0</span></a><span> </span><a class="entity_ref" href="../../../../../Rings.html#Rings.semidom_modulo_class.mod_0|fact"><span>mod_0</span></a><span> </span><a class="entity_ref" href="../../../../../Rings.html#Rings.semidom_divide_class.div_by_1|fact"><span>div_by_1</span></a><span> </span><a class="entity_ref" href="../../../../../Rings.html#Rings.semidom_modulo_class.mod_by_1|fact"><span>mod_by_1</span></a><span>
      </span><a class="entity_ref" href="../../../../../Euclidean_Rings.html#Euclidean_Rings.div_by_Suc_0|fact"><span>div_by_Suc_0</span></a><span> </span><a class="entity_ref" href="../../../../../Euclidean_Rings.html#Euclidean_Rings.mod_by_Suc_0|fact"><span>mod_by_Suc_0</span></a><span> </span><a class="entity_ref" href="../../../../../Nat.html#Nat.Suc_eq_plus1|fact"><span>Suc_eq_plus1</span></a><span>
      </span><a class="entity_ref" href="../../../../../Groups.html#Groups.ac_simps|fact"><span class="dynamic"><span class="dynamic"><span>ac_simps</span></span></span></a><span class="antiquote"><span>}</span></span></span></span><span>
   </span><span>addsimprocs</span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">simproc</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>cancel_div_mod_nat</span><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">simproc</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>cancel_div_mod_int</span><span>›</span></span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>splits_ss</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>simpset_of</span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>comp_ss</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span><span class="hidden">\&lt;^</span><span class="control">context</span><span class="hidden">&gt;</span></span></span></span></span><span>
    </span><span>addsimps</span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Rings.html#Rings.semiring_modulo_class.minus_div_mult_eq_mod|fact"><span>minus_div_mult_eq_mod</span></a><span> </span><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span>
    </span><span>|&gt;</span><span> </span><span>fold</span><span> </span><span class="entity"><span>Splitter.add_split</span></span><span>
      </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Euclidean_Rings.html#Euclidean_Rings.split_zdiv|fact"><span>split_zdiv</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Euclidean_Rings.html#Euclidean_Rings.split_zmod|fact"><span>split_zmod</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Euclidean_Rings.html#Euclidean_Rings.split_div&apos;|fact"><span>split_div'</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
       </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Lattices.html#Lattices.linorder_class.split_min|fact"><span>split_min</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Lattices.html#Lattices.linorder_class.split_max|fact"><span>split_max</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> "</span><a class="entity_ref" href="../../../../../Rings.html#Rings.linordered_idom_class.abs_split|fact"><span>abs_split</span></a><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>nat_to_int_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>simp_tac</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>ss1</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span>THEN_ALL_NEW</span><span>
  </span><span class="entity"><span>simp_tac</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>ss2</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span>THEN_ALL_NEW</span><span>
  </span><span class="entity"><span>simp_tac</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>comp_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>div_mod_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>simp_tac</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>div_mod_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>splits_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>simp_tac</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>splits_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>core_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>CSUBGOAL</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
     </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cpth</span></span><span> </span><span class="main"><span>=</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Config.get</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>quick_and_dirty</span><span>
       </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>oracle</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>Envir.beta_norm</span><span> </span><span class="main"><span>(</span></span><span>Envir.eta_long</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_arg</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Conv.arg_conv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>p</span></span><span>
     </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>p'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.rhs_of</span><span> </span><span class="entity"><span>cpth</span></span><span>
     </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.implies_intr</span><span> </span><span class="entity"><span>p'</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.equal_elim</span><span> </span><span class="main"><span>(</span></span><span>Thm.symmetric</span><span> </span><span class="entity"><span>cpth</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.assume</span><span> </span><span class="entity"><span>p'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>th</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
   </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span class="entity"><span>COOPER</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>no_tac</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>finish_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>q</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SUBGOAL</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>q</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>I</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>TRY</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>TrueI</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>elim</span></span><span> </span><span class="entity"><span>add_ths</span></span><span> </span><span class="entity"><span>del_ths</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Subgoal.FOCUS_PARAMS</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>simpset_ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>put_simpset</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>delsimps</span><span> </span><span class="entity"><span>del_ths</span></span><span> </span><span>addsimps</span><span> </span><span class="entity"><span>add_ths</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>Method.insert_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>rev</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">named_theorems</span><span class="hidden">&gt;</span></span></span><span>‹arith›</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span>THEN_ALL_NEW</span><span> </span><span>Object_Logic.full_atomize_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
    </span><span>THEN_ALL_NEW</span><span> </span><span>CONVERSION</span><span> </span><span>Thm.eta_long_conversion</span><span>
    </span><span>THEN_ALL_NEW</span><span> </span><span class="entity"><span>simp_tac</span></span><span> </span><span class="entity"><span>simpset_ctxt</span></span><span>
    </span><span>THEN_ALL_NEW</span><span> </span><span class="main"><span>(</span></span><span>TRY</span><span> </span><span>o</span><span> </span><span class="entity"><span>generalize_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>int_nat_terms</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span>THEN_ALL_NEW</span><span> </span><span>Object_Logic.full_atomize_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
    </span><span>THEN_ALL_NEW</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thin_prems_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_relevant</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span>THEN_ALL_NEW</span><span> </span><span>Object_Logic.full_atomize_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
    </span><span>THEN_ALL_NEW</span><span> </span><span class="entity"><span>div_mod_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
    </span><span>THEN_ALL_NEW</span><span> </span><span class="entity"><span>splits_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
    </span><span>THEN_ALL_NEW</span><span> </span><span class="entity"><span>simp_tac</span></span><span> </span><span class="entity"><span>simpset_ctxt</span></span><span>
    </span><span>THEN_ALL_NEW</span><span> </span><span>CONVERSION</span><span> </span><span>Thm.eta_long_conversion</span><span>
    </span><span>THEN_ALL_NEW</span><span> </span><span class="entity"><span>nat_to_int_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
    </span><span>THEN_ALL_NEW</span><span> </span><span class="entity"><span>core_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
    </span><span>THEN_ALL_NEW</span><span> </span><span class="entity"><span>finish_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>elim</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(* attribute syntax *)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>keyword</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Scan.lift</span><span> </span><span class="main"><span>(</span></span><span>Args.$$$</span><span> </span><span class="entity"><span>k</span></span><span> </span><span>--</span><span> </span><span>Args.colon</span><span class="main"><span>)</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>constsN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"consts"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>any_keyword</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>keyword</span></span><span> </span><span class="entity"><span>constsN</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Scan.repeats</span><span> </span><span class="main"><span>(</span></span><span>Scan.unless</span><span> </span><span class="entity"><span>any_keyword</span></span><span> </span><span class="entity"><span>Attrib.multi_thm</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>terms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span>o</span><span> </span><span>Drule.dest_term</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>optional</span></span><span> </span><span class="entity"><span>scan</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Scan.optional</span><span> </span><span class="entity"><span>scan</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Theory.setup</span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>Attrib.setup</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="entity_def" id="Presburger.presburger|attribute"><span>presburger</span></span><span>›</span></span></span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Scan.lift</span><span> </span><span class="main"><span>(</span></span><span>Args.$$$</span><span> </span><span class="inner_quoted"><span>"del"</span></span><span class="main"><span>)</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>optional</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>keyword</span></span><span> </span><span class="entity"><span>constsN</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>terms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>&gt;&gt;</span><span> </span><span class="entity"><span>del</span></span><span> </span><span>||</span><span>
        </span><span class="entity"><span>optional</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>keyword</span></span><span> </span><span class="entity"><span>constsN</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>terms</span></span><span class="main"><span>)</span></span><span> </span><span>&gt;&gt;</span><span> </span><span class="entity"><span>add</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"data for Cooper's algorithm"</span></span><span>
    </span><span>#&gt;</span><span> </span><span class="entity"><span>Arith_Data.add_tactic</span></span><span> </span><span class="inner_quoted"><span>"Presburger arithmetic"</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tac</span></span><span> </span><span>true</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span></pre>
</body>

</html>