<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Tools/ATP/atp_proof.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Tools/ATP/atp_proof.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      HOL/Tools/ATP/atp_proof.ML
    Author:     Lawrence C. Paulson, Cambridge University Computer Laboratory
    Author:     Claire Quigley, Cambridge University Computer Laboratory
    Author:     Jasmin Blanchette, TU Muenchen
    Author:     Mathias Fleury, ENS Rennes

Abstract representation of ATP proofs and TSTP/SPASS syntax.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>ATP_PROOF</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> 'a </span><span class="entity"><span>atp_type</span></span><span> </span><span class="main"><span>=</span></span><span> 'a </span><span class="entity"><span>ATP_Problem.atp_type</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> 'b</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_term</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> 'b</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ATP_Problem.atp_term</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>atp_formula_role</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ATP_Problem.atp_formula_role</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> 'b</span><span class="main"><span>,</span></span><span> 'c</span><span class="main"><span>,</span></span><span> 'd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_formula</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> 'b</span><span class="main"><span>,</span></span><span> 'c</span><span class="main"><span>,</span></span><span> 'd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ATP_Problem.atp_formula</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> 'a </span><span class="entity"><span>atp_problem</span></span><span> </span><span class="main"><span>=</span></span><span> 'a </span><span class="entity"><span>ATP_Problem.atp_problem</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>exception</span></span></span><span> UNRECOGNIZED_ATP_PROOF </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>unit</span><span>

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>atp_failure</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>MaybeUnprovable</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Unprovable</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>GaveUp</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>ProofMissing</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>ProofIncomplete</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>ProofUnparsable</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>UnsoundProof</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> bool * string list </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>TimedOut</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Inappropriate</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>OutOfResources</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>MalformedInput</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>MalformedOutput</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Interrupted</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>Crashed</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>InternalError</span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="entity"><span>UnknownError</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>atp_step_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>string</span><span> * </span><span>string</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> 'b</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_step</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>atp_step_name</span></span><span> * </span><span class="entity"><span>atp_formula_role</span></span><span> * 'a * 'b * </span><span class="entity"><span>atp_step_name</span></span><span> </span><span>list</span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> 'a </span><span class="entity"><span>atp_proof</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> 'a</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> 'a </span><span class="entity"><span>atp_type</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_term</span></span><span class="main"><span>,</span></span><span> 'a</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_formula</span></span><span class="main"><span>,</span></span><span> </span><span>string</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_step</span></span><span> </span><span>list</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> agsyholN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> alt_ergoN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> cvc4N </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> eN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> iproverN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> leo2N </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> leo3N </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> satallaxN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> spassN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> vampireN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> veritN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> waldmeisterN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> z3N </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> zipperpositionN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> remote_prefix </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> dummy_fofN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> dummy_tfxN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> dummy_thfN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> agsyhol_core_rule </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> spass_input_rule </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> spass_pre_skolemize_rule </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> spass_skolemize_rule </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> zipperposition_define_rule </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> short_output </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> string_of_atp_failure </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>atp_failure</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> extract_known_atp_failure </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>atp_failure</span></span><span> * </span><span>string</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>atp_failure</span></span><span> </span><span>option</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> extract_tstplike_proof_and_outcome </span><span class="main"><span>:</span></span><span>
    </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>string</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>atp_failure</span></span><span> * </span><span>string</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
    </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> * </span><span class="entity"><span>atp_failure</span></span><span> </span><span>option</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_same_atp_step </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>atp_step_name</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>atp_step_name</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> scan_general_id </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> * </span><span>string</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> parse_fol_formula </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span>string</span><span class="main"><span>,</span></span><span> </span><span>string</span><span> </span><span class="entity"><span>atp_type</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span class="main"><span>,</span></span><span> </span><span>string</span><span> </span><span class="entity"><span>atp_type</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_term</span></span><span class="main"><span>,</span></span><span> </span><span>string</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_formula</span></span><span> * </span><span>string</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> clean_up_atp_proof_dependencies </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="entity"><span>atp_proof</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="entity"><span>atp_proof</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> map_term_names_in_atp_proof </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="entity"><span>atp_proof</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="entity"><span>atp_proof</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nasty_atp_proof </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>Symtab.table</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="entity"><span>atp_proof</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="entity"><span>atp_proof</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> skip_term </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> * </span><span>string</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> parse_hol_formula </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> 'b</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span class="main"><span>,</span></span><span> </span><span>string</span><span> </span><span class="entity"><span>ATP_Problem.atp_type</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ATP_Problem.atp_term</span></span><span class="main"><span>,</span></span><span> 'c</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ATP_Problem.atp_formula</span></span><span> *
    </span><span>string</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> dummy_atype </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="entity"><span>ATP_Problem.atp_type</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> role_of_tptp_string </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>ATP_Problem.atp_formula_role</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> parse_line </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'a * </span><span>string</span><span> </span><span class="entity"><span>ATP_Problem.atp_problem_line</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>string</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>string</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> * </span><span class="entity"><span>ATP_Problem.atp_formula_role</span></span><span> *
    </span><span class="main"><span>(</span></span><span>string</span><span class="main"><span>,</span></span><span> 'b</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span class="main"><span>,</span></span><span> </span><span>string</span><span> </span><span class="entity"><span>ATP_Problem.atp_type</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ATP_Problem.atp_term</span></span><span class="main"><span>,</span></span><span>
      'c</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ATP_Problem.atp_formula</span></span><span>
    * </span><span>string</span><span> * </span><span class="main"><span>(</span></span><span>string</span><span> * 'd </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> * </span><span>string</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> core_inference </span><span class="main"><span>:</span></span><span> 'a </span><span class="main"><span>-&gt;</span></span><span> 'b </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'b * 'b </span><span>list</span><span class="main"><span>)</span></span><span> * </span><span class="entity"><span>ATP_Problem.atp_formula_role</span></span><span> *
    </span><span class="main"><span>(</span></span><span>'c</span><span class="main"><span>,</span></span><span> 'd</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span class="main"><span>,</span></span><span> 'e</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ATP_Problem.atp_term</span></span><span class="main"><span>,</span></span><span> 'f</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ATP_Problem.atp_formula</span></span><span> * 'a * 'g </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> vampire_step_name_ord </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * 'a</span><span class="main"><span>)</span></span><span> </span><span>ord</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> core_of_agsyhol_proof </span><span class="main"><span>:</span></span><span>  </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span>list</span><span> </span><span>option</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> string_of_atp_step </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>'a </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'b </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> 'b</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_step</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> atp_proof_of_tstplike_proof </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="entity"><span>atp_problem</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>string</span><span> </span><span class="entity"><span>atp_proof</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> atp_abduce_candidates_of_output </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="entity"><span>atp_problem</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span>string</span><span class="main"><span>,</span></span><span> </span><span>string</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span class="main"><span>,</span></span><span> </span><span>string</span><span> </span><span class="entity"><span>atp_type</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_term</span></span><span class="main"><span>,</span></span><span> </span><span>string</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_formula</span></span><span> </span><span>list</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>ATP_Proof</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ATP_PROOF</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>ATP_Util</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>ATP_Problem</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>agsyholN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"agsyhol"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alt_ergoN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"alt_ergo"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cvc4N</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"cvc4"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"e"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>iproverN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"iprover"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>leo2N</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"leo2"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>leo3N</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"leo3"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>satallaxN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"satallax"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>spassN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"spass"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vampireN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"vampire"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>veritN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"verit"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>waldmeisterN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"waldmeister"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>z3N</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"z3"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>zipperpositionN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"zipperposition"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>remote_prefix</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"remote_"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dummy_fofN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"dummy_fof"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dummy_tfxN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"dummy_tfx"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dummy_thfN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"dummy_thf"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>agsyhol_core_rule</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"__agsyhol_core"</span></span><span> </span><span class="comment1"><span>(* arbitrary *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>spass_input_rule</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Inp"</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>spass_pre_skolemize_rule</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"__Sko0"</span></span><span> </span><span class="comment1"><span>(* arbitrary *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>spass_skolemize_rule</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"__Sko"</span></span><span> </span><span class="comment1"><span>(* arbitrary *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>zipperposition_define_rule</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"define"</span></span><span> </span><span class="comment1"><span>(* arbitrary *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>exception</span></span></span><span> </span><span class="entity"><span>UNRECOGNIZED_ATP_PROOF</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>unit</span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>atp_failure</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>MaybeUnprovable</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Unprovable</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>GaveUp</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>ProofMissing</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>ProofIncomplete</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>ProofUnparsable</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>UnsoundProof</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> bool * string list </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>TimedOut</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Inappropriate</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>OutOfResources</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>MalformedInput</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>MalformedOutput</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Interrupted</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>Crashed</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>InternalError</span></span><span> </span><span class="main"><span>|</span></span><span>
  </span><span class="entity"><span>UnknownError</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>short_output</span></span><span> </span><span class="entity"><span>verbose</span></span><span> </span><span class="entity"><span>output</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>verbose</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>output</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"No details available"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>elide_string</span></span><span> </span><span class="inner_numeral"><span>1000</span></span><span> </span><span class="entity"><span>output</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
    </span><span class="inner_quoted"><span>""</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>from_lemmas</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>from_lemmas</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>" from "</span></span><span> </span><span>^</span><span> </span><span>space_implode</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Try.serial_commas</span></span><span> </span><span class="inner_quoted"><span>"and"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>quote</span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_of_atp_failure</span></span><span> </span><span class="entity"><span>MaybeUnprovable</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Problem maybe unprovable"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_atp_failure</span></span><span> </span><span class="entity"><span>Unprovable</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Problem unprovable"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_atp_failure</span></span><span> </span><span class="entity"><span>GaveUp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Gave up"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_atp_failure</span></span><span> </span><span class="entity"><span>ProofMissing</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Proof missing"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_atp_failure</span></span><span> </span><span class="entity"><span>ProofIncomplete</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Proof incomplete"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_atp_failure</span></span><span> </span><span class="entity"><span>ProofUnparsable</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Proof unparsable"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_atp_failure</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>UnsoundProof</span></span><span> </span><span class="main"><span>(</span></span><span>false</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="inner_quoted"><span>"Derived the lemma \"False\""</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>from_lemmas</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span>^</span><span>
    </span><span class="inner_quoted"><span>", likely due to the use of an unsound type encoding"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_atp_failure</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>UnsoundProof</span></span><span> </span><span class="main"><span>(</span></span><span>true</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="inner_quoted"><span>"Derived the lemma \"False\""</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>from_lemmas</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span>^</span><span>
    </span><span class="inner_quoted"><span>", likely due to inconsistent axioms or \"sorry\"d lemmas"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_atp_failure</span></span><span> </span><span class="entity"><span>TimedOut</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Timed out"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_atp_failure</span></span><span> </span><span class="entity"><span>Inappropriate</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Problem outside the prover's scope"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_atp_failure</span></span><span> </span><span class="entity"><span>OutOfResources</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Out of resources"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_atp_failure</span></span><span> </span><span class="entity"><span>MalformedInput</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Malformed problem"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_atp_failure</span></span><span> </span><span class="entity"><span>MalformedOutput</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Malformed output"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_atp_failure</span></span><span> </span><span class="entity"><span>Interrupted</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Interrupted"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_atp_failure</span></span><span> </span><span class="entity"><span>Crashed</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Crashed"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_atp_failure</span></span><span> </span><span class="entity"><span>InternalError</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Internal prover error"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>string_of_atp_failure</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>UnknownError</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="inner_quoted"><span>"Prover error"</span></span><span> </span><span>^</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>" (pass the \"verbose\" option for details)"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>":\n"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>extract_delimited</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>begin_delim</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>end_delim</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>output</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>first_field</span><span> </span><span class="entity"><span>begin_delim</span></span><span> </span><span class="entity"><span>output</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tail</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>first_field</span><span> </span><span class="inner_quoted"><span>"\n"</span></span><span> </span><span class="entity"><span>tail</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tail'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>end_delim</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="entity"><span>tail'</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>first_field</span><span> </span><span class="entity"><span>end_delim</span></span><span> </span><span class="entity"><span>tail'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>body</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>body</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span>

</span><span class="comment1"><span>(* Splits by the first possible of a list of delimiters. *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>extract_tstplike_proof</span></span><span> </span><span class="entity"><span>delims</span></span><span> </span><span class="entity"><span>output</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span>find_first</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>String.isSubstring</span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>output</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>ListPair.unzip</span><span> </span><span class="entity"><span>delims</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>begin_delim</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>end_delim</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>extract_delimited</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>begin_delim</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>end_delim</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>output</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>extract_known_atp_failure</span></span><span> </span><span class="entity"><span>known_failures</span></span><span> </span><span class="entity"><span>output</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>known_failures</span></span><span>
  </span><span>|&gt;</span><span> </span><span>find_first</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pattern</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>String.isSubstring</span><span> </span><span class="entity"><span>pattern</span></span><span> </span><span class="entity"><span>output</span></span><span class="main"><span>)</span></span><span>
  </span><span>|&gt;</span><span> </span><span>Option.map</span><span> </span><span>fst</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>extract_tstplike_proof_and_outcome</span></span><span> </span><span class="entity"><span>verbose</span></span><span> </span><span class="entity"><span>proof_delims</span></span><span> </span><span class="entity"><span>known_failures</span></span><span> </span><span class="entity"><span>output</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>known_atp_failure</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>extract_known_atp_failure</span></span><span> </span><span class="entity"><span>known_failures</span></span><span> </span><span class="entity"><span>output</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tstplike_proof</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>extract_tstplike_proof</span></span><span> </span><span class="entity"><span>proof_delims</span></span><span> </span><span class="entity"><span>output</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tstplike_proof</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>known_atp_failure</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>ProofIncomplete</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>ProofUnparsable</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>ProofMissing</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>UnknownError</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>short_output</span></span><span> </span><span class="entity"><span>verbose</span></span><span> </span><span class="entity"><span>output</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>res</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>res</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tstplike_proof</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tstplike_proof</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>atp_step_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>string</span><span> * </span><span>string</span><span> </span><span>list</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_same_atp_step</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s2</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>s1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>s2</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vampire_fact_prefix</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"f"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>vampire_step_name_ord</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>q</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apply2</span><span> </span><span>fst</span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="comment1"><span>(* The "unprefix" part is to cope with Vampire's output, which puts facts with names of the
       form "fN" where N is an integer in reverse order. *)</span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span>Int.fromString</span><span> </span><span>o</span><span> </span><span>perhaps</span><span> </span><span class="main"><span>(</span></span><span>try</span><span> </span><span class="main"><span>(</span></span><span>unprefix</span><span> </span><span class="entity"><span>vampire_fact_prefix</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>q</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>int_ord</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>LESS</span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>GREATER</span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>string_ord</span><span> </span><span class="entity"><span>q</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> 'b</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_step</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>atp_step_name</span></span><span> * </span><span class="entity"><span>atp_formula_role</span></span><span> * 'a * 'b * </span><span class="entity"><span>atp_step_name</span></span><span> </span><span>list</span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> 'a </span><span class="entity"><span>atp_proof</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> 'a</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span>'a</span><span class="main"><span>,</span></span><span> 'a </span><span class="entity"><span>atp_type</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_term</span></span><span class="main"><span>,</span></span><span> 'a</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_formula</span></span><span class="main"><span>,</span></span><span> </span><span>string</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>atp_step</span></span><span> </span><span>list</span><span>

</span><span class="comment1"><span>(**** PARSING OF TSTP FORMAT ****)</span></span><span>

</span><span class="comment1"><span>(* Strings enclosed in single quotes (e.g., file names), identifiers possibly starting
   with "$" and possibly with "!" in them. *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>scan_general_id</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>$$</span><span> </span><span class="inner_quoted"><span>"'"</span></span><span> </span><span>|--</span><span> </span><span>Scan.repeat</span><span> </span><span class="main"><span>(</span></span><span>~$$</span><span> </span><span class="inner_quoted"><span>"'"</span></span><span class="main"><span>)</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"'"</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>implode</span><span>
  </span><span>||</span><span> </span><span class="main"><span>(</span></span><span>Scan.repeat</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>"$"</span></span><span class="main"><span>)</span></span><span> </span><span>--</span><span> </span><span>Scan.many1</span><span> </span><span>Symbol.is_letdig</span><span> </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>^</span><span> </span><span>o</span><span> </span><span>apply2</span><span> </span><span>implode</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span>--</span><span> </span><span>Scan.optional</span><span> </span><span class="main"><span>(</span></span><span>Scan.repeat</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>"!"</span></span><span class="main"><span>)</span></span><span> </span><span>--</span><span> </span><span>Scan.many1</span><span> </span><span>Symbol.is_letdig</span><span> </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>^</span><span> </span><span>o</span><span> </span><span>apply2</span><span> </span><span>implode</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span>
    </span><span>&gt;&gt;</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>^</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>skip_term</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>skip</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>accum</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>accum</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>skip</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>accum</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ss</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ss'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"."</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>accum</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>accum</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>skip</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>accum</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ss'</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"("</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"["</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="entity"><span>skip</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>accum</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ss'</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
          </span><span class="entity"><span>skip</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>accum</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ss'</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>skip</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span>#&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span>rev</span><span> </span><span>#&gt;</span><span> </span><span>implode</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>skip_terms</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>skip_term</span></span><span> </span><span>:::</span><span> </span><span>Scan.repeat</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>skip_term</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>source</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>File_Source</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string * string option
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Inference_Source</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string * string list
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Introduced_Source</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Define_Source</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dummy_phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>AAtom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dummy_atype</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>AType</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

</span><span class="comment1"><span>(* "skip_term" is there to cope with Waldmeister nonsense such as "theory(equality)". *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_dependency</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>parse_inference_source</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>snd</span><span>
   </span><span>||</span><span> </span><span class="entity"><span>scan_general_id</span></span><span> </span><span>--|</span><span> </span><span class="entity"><span>skip_term</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>single</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>parse_dependencies</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span>Scan.repeats</span><span> </span><span class="main"><span>(</span></span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>","</span></span><span class="main"><span>)</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_dependency</span></span><span class="main"><span>)</span></span><span>
   </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span>filter_out</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"theory"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>parse_file_source</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span>Scan.this_string</span><span> </span><span class="inner_quoted"><span>"file"</span></span><span> </span><span>|--</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>scan_general_id</span></span><span>
   </span><span>--</span><span> </span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>scan_general_id</span></span><span>
     </span><span>--|</span><span> </span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span>|--</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span>--</span><span> </span><span>Scan.option</span><span> </span><span class="entity"><span>scan_general_id</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"]"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>parse_inference_source</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span>Scan.this_string</span><span> </span><span class="inner_quoted"><span>"inference"</span></span><span> </span><span>|--</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>scan_general_id</span></span><span>
   </span><span>--|</span><span> </span><span class="entity"><span>skip_term</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span>--|</span><span> </span><span class="entity"><span>skip_term</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"["</span></span><span>
   </span><span>--</span><span> </span><span class="entity"><span>parse_dependencies</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"]"</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>parse_introduced_source</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span>Scan.this_string</span><span> </span><span class="inner_quoted"><span>"introduced"</span></span><span> </span><span>|--</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>scan_general_id</span></span><span>
   </span><span>--|</span><span> </span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>skip_term</span></span><span class="main"><span>)</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>parse_define_source</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span>Scan.this_string</span><span> </span><span class="inner_quoted"><span>"define"</span></span><span> </span><span>|--</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>skip_term</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>parse_source</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>parse_file_source</span></span><span> </span><span>&gt;&gt;</span><span> </span><span class="entity"><span>File_Source</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>SOME</span><span>
   </span><span>||</span><span> </span><span class="entity"><span>parse_inference_source</span></span><span> </span><span>&gt;&gt;</span><span> </span><span class="entity"><span>Inference_Source</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>SOME</span><span>
   </span><span>||</span><span> </span><span class="entity"><span>parse_introduced_source</span></span><span> </span><span>&gt;&gt;</span><span> </span><span class="entity"><span>Introduced_Source</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>SOME</span><span>
   </span><span>||</span><span> </span><span class="entity"><span>parse_define_source</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span class="entity"><span>Define_Source</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>SOME</span><span>
   </span><span>||</span><span> </span><span class="entity"><span>scan_general_id</span></span><span> </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Inference_Source</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>s</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="comment1"><span>(* for E *)</span></span><span>
   </span><span>||</span><span> </span><span class="entity"><span>skip_term</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>list_app</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>arg</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>tptp_app</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>arg</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="entity"><span>f</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_class</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>scan_general_id</span></span><span> </span><span class="entity"><span>x</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>parse_classes</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>parse_class</span></span><span> </span><span>:::</span><span> </span><span>Scan.repeat</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>"&amp;"</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_class</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_type</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_type</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>")"</span></span><span>
    </span><span>||</span><span> </span><span>Scan.this_string</span><span> </span><span class="entity"><span>tptp_pi_binder</span></span><span> </span><span>|--</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>skip_terms</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"]"</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>":"</span></span><span> </span><span>--</span><span> </span><span class="entity"><span>parse_type</span></span><span>
       </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="comment1"><span>(* currently ignoring type constructor declarations anyway *)</span></span><span class="main"><span>)</span></span><span>
    </span><span>||</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>scan_general_id</span></span><span> </span><span>--</span><span> </span><span>Scan.optional</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>"{"</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_classes</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"}"</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
        </span><span>--</span><span> </span><span>Scan.optional</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_types</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
       </span><span>&gt;&gt;</span><span> </span><span class="entity"><span>AType</span></span><span class="main"><span>)</span></span><span>
   </span><span>--</span><span> </span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="entity"><span>tptp_app</span></span><span> </span><span>||</span><span> </span><span>$$</span><span> </span><span class="entity"><span>tptp_fun_type</span></span><span> </span><span>||</span><span> </span><span>$$</span><span> </span><span class="entity"><span>tptp_product_type</span></span><span class="main"><span>)</span></span><span> </span><span>--</span><span> </span><span class="entity"><span>parse_type</span></span><span class="main"><span>)</span></span><span>
  </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>a</span></span><span>
       </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bin_op</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>bin_op</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_app</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
           </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
             </span><span class="entity"><span>AType</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s_clss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>AType</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s_clss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>b</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
           </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>UNRECOGNIZED_ATP_PROOF</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>bin_op</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_fun_type</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
           </span><span class="entity"><span>AFun</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>bin_op</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_product_type</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
           </span><span class="entity"><span>AType</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>tptp_product_type</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
           </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Fail</span><span> </span><span class="inner_quoted"><span>"impossible case"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>parse_types</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>parse_type</span></span><span> </span><span>:::</span><span> </span><span>Scan.repeat</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_type</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>

</span><span class="comment1"><span>(* We currently half ignore types. *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_fol_optional_type_signature</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="entity"><span>tptp_has_type</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_type</span></span><span class="main"><span>)</span></span><span>
   </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>some</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AType</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dfg_individual_type</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>NONE</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>some</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>res</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>parse_fol_arg</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_fol_term</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span>--|</span><span> </span><span class="entity"><span>parse_fol_optional_type_signature</span></span><span>
   </span><span>||</span><span> </span><span class="entity"><span>scan_general_id</span></span><span> </span><span>--</span><span> </span><span class="entity"><span>parse_fol_optional_type_signature</span></span><span>
       </span><span>--</span><span> </span><span>Scan.optional</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>"&lt;"</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_types</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"&gt;"</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
       </span><span>--</span><span> </span><span>Scan.optional</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_fol_terms</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
     </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty_opt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tyargs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_tptp_variable</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>tyargs</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>is_some</span><span> </span><span class="entity"><span>ty_opt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
         </span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span>the_list</span><span> </span><span class="entity"><span>ty_opt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
         </span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tyargs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>parse_fol_term</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>parse_fol_arg</span></span><span> </span><span>--</span><span> </span><span>Scan.repeat</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="entity"><span>tptp_app</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_fol_arg</span></span><span class="main"><span>)</span></span><span>
   </span><span>--|</span><span> </span><span class="entity"><span>parse_fol_optional_type_signature</span></span><span> </span><span>&gt;&gt;</span><span> </span><span class="entity"><span>list_app</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>parse_fol_terms</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>parse_fol_term</span></span><span> </span><span>:::</span><span> </span><span>Scan.repeat</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_fol_term</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_fol_atom</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>parse_fol_term</span></span><span> </span><span>--</span><span>
    </span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="entity"><span>tptp_not_infix</span></span><span class="main"><span>)</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="entity"><span>tptp_equal</span></span><span> </span><span>--</span><span> </span><span class="entity"><span>parse_fol_term</span></span><span class="main"><span>)</span></span><span>
   </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>AAtom</span></span><span> </span><span class="entity"><span>u1</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>neg</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>AAtom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"equal"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>u1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>is_some</span><span> </span><span class="entity"><span>neg</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>mk_anot</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>

</span><span class="comment1"><span>(* TPTP formulas are fully parenthesized, so we don't need to worry about operator precedence. *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_fol_literal</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Scan.repeat</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="entity"><span>tptp_not</span></span><span class="main"><span>)</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>length</span><span class="main"><span>)</span></span><span>
      </span><span>--</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_fol_formula</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>")"</span></span><span>
          </span><span>||</span><span> </span><span class="entity"><span>parse_fol_quantified_formula</span></span><span>
          </span><span>||</span><span> </span><span class="entity"><span>parse_fol_atom</span></span><span class="main"><span>)</span></span><span>
      </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>mod</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>mk_anot</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>parse_fol_formula</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>parse_fol_literal</span></span><span>
   </span><span>--</span><span> </span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Scan.this_string</span><span> </span><span class="entity"><span>tptp_implies</span></span><span>
                    </span><span>||</span><span> </span><span>Scan.this_string</span><span> </span><span class="entity"><span>tptp_iff</span></span><span>
                    </span><span>||</span><span> </span><span>Scan.this_string</span><span> </span><span class="entity"><span>tptp_not_iff</span></span><span>
                    </span><span>||</span><span> </span><span>Scan.this_string</span><span> </span><span class="entity"><span>tptp_if</span></span><span>
                    </span><span>||</span><span> </span><span>$$</span><span> </span><span class="entity"><span>tptp_or</span></span><span>
                    </span><span>||</span><span> </span><span>$$</span><span> </span><span class="entity"><span>tptp_and</span></span><span class="main"><span>)</span></span><span> </span><span>--</span><span> </span><span class="entity"><span>parse_fol_formula</span></span><span class="main"><span>)</span></span><span>
   </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>phi1</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>phi1</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>phi1</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_implies</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>mk_aconn</span></span><span> </span><span class="entity"><span>AImplies</span></span><span> </span><span class="entity"><span>phi1</span></span><span> </span><span class="entity"><span>phi2</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_iff</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>mk_aconn</span></span><span> </span><span class="entity"><span>AIff</span></span><span> </span><span class="entity"><span>phi1</span></span><span> </span><span class="entity"><span>phi2</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_not_iff</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>mk_anot</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_aconn</span></span><span> </span><span class="entity"><span>AIff</span></span><span> </span><span class="entity"><span>phi1</span></span><span> </span><span class="entity"><span>phi2</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_if</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>mk_aconn</span></span><span> </span><span class="entity"><span>AImplies</span></span><span> </span><span class="entity"><span>phi2</span></span><span> </span><span class="entity"><span>phi1</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_or</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>mk_aconn</span></span><span> </span><span class="entity"><span>AOr</span></span><span> </span><span class="entity"><span>phi1</span></span><span> </span><span class="entity"><span>phi2</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_and</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>mk_aconn</span></span><span> </span><span class="entity"><span>AAnd</span></span><span> </span><span class="entity"><span>phi1</span></span><span> </span><span class="entity"><span>phi2</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Fail</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"impossible connective "</span></span><span> </span><span>^</span><span> </span><span>quote</span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>parse_fol_quantified_formula</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="entity"><span>tptp_forall</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span class="entity"><span>AForall</span></span><span> </span><span>||</span><span> </span><span>$$</span><span> </span><span class="entity"><span>tptp_exists</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span class="entity"><span>AExists</span></span><span class="main"><span>)</span></span><span>
   </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span>--</span><span> </span><span class="entity"><span>parse_fol_terms</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"]"</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>":"</span></span><span> </span><span>--</span><span> </span><span class="entity"><span>parse_fol_literal</span></span><span>
   </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>q</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>AQuant</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>q</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parse_tstp_extra_arguments</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Scan.optional</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_source</span></span><span> </span><span>--|</span><span> </span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>skip_term</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>NONE</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>waldmeister_conjecture_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"conjecture_1"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_same_term</span></span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>tm1</span></span><span> </span><span class="entity"><span>tm2</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>do_term_pair</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AAbs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>var1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>typ1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AAbs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>var2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>typ2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>subst</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>typ1</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="entity"><span>typ2</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>args1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>args2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>NONE</span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ls</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>var1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var2</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>subst</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="entity"><span>do_term_pair</span></span><span> </span><span class="entity"><span>body1</span></span><span> </span><span class="entity"><span>body2</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>nth_drop</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>subst</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>ls</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>subst</span></span><span class="main"><span>)</span></span><span>
                 </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>args1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>args2</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>fold2</span><span> </span><span class="entity"><span>do_term_pair</span></span><span> </span><span class="entity"><span>args1</span></span><span> </span><span class="entity"><span>args2</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>K</span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>do_term_pair</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s2</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>subst</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>apply2</span><span> </span><span class="entity"><span>is_tptp_variable</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s2</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span class="main"><span>(</span></span><span>true</span><span class="main"><span>,</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>AList.lookup</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>s1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span>SOME</span><span> </span><span class="entity"><span>s2'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>s2'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>s2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="main"><span>(</span></span><span>AList.find</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>s2</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s2</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>subst</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>false</span><span class="main"><span>,</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>s1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>s2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span>SOME</span><span> </span><span class="entity"><span>subst</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span>NONE</span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>args1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>args2</span></span><span>
                       </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>fold2</span><span> </span><span class="entity"><span>do_term_pair</span></span><span> </span><span class="entity"><span>args1</span></span><span> </span><span class="entity"><span>args2</span></span><span>
                       </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>K</span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>do_term_pair</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>SOME</span><span> </span><span class="entity"><span>subst</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>do_term_pair</span></span><span> </span><span class="entity"><span>tm1</span></span><span> </span><span class="entity"><span>tm2</span></span><span> </span><span>|&gt;</span><span> </span><span>is_some</span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_same_formula</span></span><span> </span><span class="entity"><span>comm</span></span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AQuant</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>q1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AQuant</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>q2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>q1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>q2</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>xs1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>xs2</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
    </span><span class="entity"><span>is_same_formula</span></span><span> </span><span class="entity"><span>comm</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x2</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs1</span></span><span> </span><span class="entity"><span>xs2</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>subst</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>phi1</span></span><span> </span><span class="entity"><span>phi2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_same_formula</span></span><span> </span><span class="entity"><span>comm</span></span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phis1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phis2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>c1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>c2</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>forall2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_same_formula</span></span><span> </span><span class="entity"><span>comm</span></span><span> </span><span class="entity"><span>subst</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>phis1</span></span><span> </span><span class="entity"><span>phis2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_same_formula</span></span><span> </span><span class="entity"><span>comm</span></span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AAtom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm1</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"equal"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>tm11</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tm12</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AAtom</span></span><span> </span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>is_same_term</span></span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>tm1</span></span><span> </span><span class="entity"><span>tm2</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>comm</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>is_same_term</span></span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"equal"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>tm12</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tm11</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_same_formula</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AAtom</span></span><span> </span><span class="entity"><span>tm1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AAtom</span></span><span> </span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_same_term</span></span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>tm1</span></span><span> </span><span class="entity"><span>tm2</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_same_formula</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>matching_formula_line_identifier</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Formula</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ident</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_same_formula</span></span><span> </span><span>true</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>phi'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ident</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi'</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>matching_formula_line_identifier</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>find_formula_in_problem</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>maps</span><span> </span><span>snd</span><span>
  </span><span>#&gt;</span><span> </span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>matching_formula_line_identifier</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span>
  </span><span>#&gt;</span><span> </span><span>try</span><span> </span><span class="main"><span>(</span></span><span>single</span><span> </span><span>o</span><span> </span><span>hd</span><span class="main"><span>)</span></span><span>
  </span><span>#&gt;</span><span> </span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>commute_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AAtom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>AAtom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>rev</span><span> </span><span class="entity"><span>tms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>commute_eq</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Fail</span><span> </span><span class="inner_quoted"><span>"expected equation"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>role_of_tptp_string</span></span><span> </span><span class="inner_quoted"><span>"axiom"</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Axiom</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>role_of_tptp_string</span></span><span> </span><span class="inner_quoted"><span>"definition"</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Definition</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>role_of_tptp_string</span></span><span> </span><span class="inner_quoted"><span>"lemma"</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Lemma</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>role_of_tptp_string</span></span><span> </span><span class="inner_quoted"><span>"hypothesis"</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Hypothesis</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>role_of_tptp_string</span></span><span> </span><span class="inner_quoted"><span>"conjecture"</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Conjecture</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>role_of_tptp_string</span></span><span> </span><span class="inner_quoted"><span>"negated_conjecture"</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Negated_Conjecture</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>role_of_tptp_string</span></span><span> </span><span class="inner_quoted"><span>"plain"</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Plain</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>role_of_tptp_string</span></span><span> </span><span class="inner_quoted"><span>"type"</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Type_Role</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>role_of_tptp_string</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Unknown</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_one_in_list</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>foldl1</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>||</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>Scan.this_string</span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_literal_binary_ops</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>tptp_equal</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tptp_not_equal</span></span><span class="main"><span>]</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tptp_nonliteral_binary_ops</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>[</span></span><span class="entity"><span>tptp_and</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tptp_or</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tptp_implies</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tptp_iff</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tptp_if</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tptp_not_and</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tptp_not_or</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tptp_not_iff</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_literal_binary_op</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>parse_one_in_list</span></span><span> </span><span class="entity"><span>tptp_literal_binary_ops</span></span><span>
   </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_equal</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"equal"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_nonliteral_binary_op</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>parse_one_in_list</span></span><span> </span><span class="entity"><span>tptp_nonliteral_binary_ops</span></span><span>
   </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_equal</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"equal"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parse_fol_quantifier</span></span><span> </span><span class="main"><span>=</span></span><span>
   </span><span class="entity"><span>parse_one_in_list</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>tptp_forall</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tptp_exists</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tptp_lambda</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tptp_hilbert_choice</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tptp_hilbert_the</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parse_hol_quantifier</span></span><span> </span><span class="main"><span>=</span></span><span>
   </span><span class="entity"><span>parse_one_in_list</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>tptp_ho_forall</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tptp_ho_exists</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tptp_hilbert_choice</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tptp_hilbert_the</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_ho_of_fo_quant</span></span><span> </span><span class="entity"><span>q</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>q</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_forall</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>tptp_ho_forall</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>q</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_exists</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>tptp_ho_exists</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>q</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_hilbert_choice</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>tptp_hilbert_choice</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>q</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_hilbert_the</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>tptp_hilbert_the</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Fail</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"unrecognized quantification: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>q</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>remove_hol_app</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tptp_app</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>remove_hol_app</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>AAbs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>var</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>remove_hol_app</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AAbs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>var</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>remove_hol_app</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>remove_hol_app</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AAbs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>var</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>AAbs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>var</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>remove_hol_app</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>remove_hol_app</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_hol_typed_var</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span>Scan.repeat</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>scan_general_id</span></span><span> </span><span>--</span><span> </span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="entity"><span>tptp_has_type</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_type</span></span><span class="main"><span>)</span></span><span>
     </span><span>--|</span><span> </span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span>Scan.this_string</span><span> </span><span class="inner_quoted"><span>","</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
   </span><span>||</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_hol_typed_var</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_simple_hol_term</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>parse_fol_quantifier</span></span><span> </span><span>--</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_hol_typed_var</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"]"</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>":"</span></span><span class="main"><span>)</span></span><span> </span><span>--</span><span> </span><span class="entity"><span>parse_hol_term</span></span><span>
      </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>q</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span>fold_rev</span><span>
            </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="entity"><span>AAbs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>var</span></span><span class="main"><span>,</span></span><span> </span><span>the_default</span><span> </span><span class="entity"><span>dummy_atype</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>tptp_lambda</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="entity"><span>q</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                      </span><span class="entity"><span>mk_app</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>q</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_ho_of_fo_quant</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_simple_aterm</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                      </span><span>I</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
  </span><span>||</span><span> </span><span>Scan.this_string</span><span> </span><span class="entity"><span>tptp_not</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_hol_term</span></span><span> </span><span>&gt;&gt;</span><span> </span><span class="entity"><span>mk_app</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_simple_aterm</span></span><span> </span><span class="entity"><span>tptp_not</span></span><span class="main"><span>)</span></span><span>
  </span><span>||</span><span> </span><span class="entity"><span>scan_general_id</span></span><span> </span><span>--</span><span> </span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="entity"><span>tptp_has_type</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_type</span></span><span class="main"><span>)</span></span><span>
    </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>typ_opt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>var</span></span><span class="main"><span>,</span></span><span> </span><span>the_list</span><span> </span><span class="entity"><span>typ_opt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span>||</span><span> </span><span class="entity"><span>parse_hol_quantifier</span></span><span> </span><span>&gt;&gt;</span><span> </span><span class="entity"><span>mk_simple_aterm</span></span><span>
  </span><span>||</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_hol_term</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>")"</span></span><span>
  </span><span>||</span><span> </span><span class="entity"><span>parse_literal_binary_op</span></span><span> </span><span>&gt;&gt;</span><span> </span><span class="entity"><span>mk_simple_aterm</span></span><span>
  </span><span>||</span><span> </span><span class="entity"><span>parse_nonliteral_binary_op</span></span><span> </span><span>&gt;&gt;</span><span> </span><span class="entity"><span>mk_simple_aterm</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>parse_applied_hol_term</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>parse_simple_hol_term</span></span><span> </span><span>--</span><span> </span><span>Scan.repeat</span><span> </span><span class="main"><span>(</span></span><span>Scan.this_string</span><span> </span><span class="entity"><span>tptp_app</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_simple_hol_term</span></span><span class="main"><span>)</span></span><span>
    </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tis</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ti</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>left</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_app</span></span><span> </span><span class="entity"><span>left</span></span><span> </span><span class="entity"><span>ti</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tis</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>parse_literal_hol_term</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>parse_applied_hol_term</span></span><span> </span><span>--</span><span> </span><span>Scan.repeat</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>parse_literal_binary_op</span></span><span> </span><span>--</span><span> </span><span class="entity"><span>parse_applied_hol_term</span></span><span class="main"><span>)</span></span><span>
    </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c_ti_s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ti</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>left</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_apps</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_simple_aterm</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>left</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ti</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>c_ti_s</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>parse_hol_term</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>parse_literal_hol_term</span></span><span> </span><span>--</span><span> </span><span>Scan.repeat</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>parse_nonliteral_binary_op</span></span><span> </span><span>--</span><span> </span><span class="entity"><span>parse_literal_hol_term</span></span><span class="main"><span>)</span></span><span>
    </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c_ti_s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ti</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>left</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_apps</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_simple_aterm</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>left</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ti</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>c_ti_s</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_hol_formula</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>parse_hol_term</span></span><span> </span><span>#&gt;&gt;</span><span> </span><span class="entity"><span>remove_hol_app</span></span><span> </span><span>#&gt;&gt;</span><span> </span><span class="entity"><span>AAtom</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_tstp_hol_line</span></span><span> </span><span class="entity"><span>full</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span>Scan.this_string</span><span> </span><span class="entity"><span>tptp_thf</span></span><span> </span><span>--</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"("</span></span><span class="main"><span>)</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>scan_general_id</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>","</span></span><span>
  </span><span>--</span><span> </span><span>Symbol.scan_ascii_id</span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span>--</span><span>
     </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>full</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>parse_hol_formula</span></span><span> </span><span>||</span><span> </span><span class="entity"><span>skip_term</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span class="entity"><span>dummy_phi</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>skip_term</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span class="entity"><span>dummy_phi</span></span><span class="main"><span>)</span></span><span>
     </span><span>--</span><span> </span><span class="entity"><span>parse_tstp_extra_arguments</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>")"</span></span><span>
  </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"."</span></span><span>
  </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>num</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>role0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>src</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>role</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>role_of_tptp_string</span></span><span> </span><span class="entity"><span>role0</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>role'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rule</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>deps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>src</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>File_Source</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>role</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Definition</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
              </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>num</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>find_formula_in_problem</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>problem</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>role</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
              </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>num</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>s</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>role</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Inference_Source</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rule</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>deps</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>num</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>role</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rule</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>deps</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Introduced_Source</span></span><span> </span><span class="entity"><span>rule</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>num</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Definition</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rule</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>Define_Source</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>num</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Definition</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>zipperposition_define_rule</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>num</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>num</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>role</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>role'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rule</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>rpair</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>deps</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_tstp_fol_line</span></span><span> </span><span class="entity"><span>full</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Scan.this_string</span><span> </span><span class="entity"><span>tptp_cnf</span></span><span> </span><span>||</span><span> </span><span>Scan.this_string</span><span> </span><span class="entity"><span>tptp_fof</span></span><span> </span><span>||</span><span> </span><span>Scan.this_string</span><span> </span><span class="entity"><span>tptp_tcf</span></span><span>
      </span><span>||</span><span> </span><span>Scan.this_string</span><span> </span><span class="entity"><span>tptp_tff</span></span><span class="main"><span>)</span></span><span> </span><span>--</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"("</span></span><span class="main"><span>)</span></span><span>
    </span><span>|--</span><span> </span><span class="entity"><span>scan_general_id</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span>--</span><span> </span><span>Symbol.scan_ascii_id</span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>","</span></span><span>
    </span><span>--</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>full</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>parse_fol_formula</span></span><span> </span><span>||</span><span> </span><span class="entity"><span>skip_term</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span class="entity"><span>dummy_phi</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>skip_term</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span class="entity"><span>dummy_phi</span></span><span class="main"><span>)</span></span><span>
    </span><span>--</span><span> </span><span class="entity"><span>parse_tstp_extra_arguments</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"."</span></span><span>
   </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>num</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>role0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>src</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>role</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>role_of_tptp_string</span></span><span> </span><span class="entity"><span>role0</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>role'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rule</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>deps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="comment1"><span>(* Waldmeister isn't exactly helping. *)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>src</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>File_Source</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>waldmeister_conjecture_name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                   </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>find_formula_in_problem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_anot</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                     </span><span class="comment1"><span>(* Waldmeister hack: Get the original orientation of the equation to avoid
                        confusing Isar. *)</span></span><span>
                     </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi'</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                     </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>num</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>s</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span class="entity"><span>phi</span></span><span> </span><span>|&gt;</span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_same_formula</span></span><span> </span><span>false</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_anot</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>phi'</span></span><span class="main"><span>)</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>commute_eq</span></span><span class="main"><span>)</span></span><span>
                   </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>num</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                   </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>num</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>s</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                 </span><span class="entity"><span>role</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>File_Source</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>num</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>find_formula_in_problem</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>problem</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>role</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Inference_Source</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rule</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>deps</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>num</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>role</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rule</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>deps</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Introduced_Source</span></span><span> </span><span class="entity"><span>rule</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>num</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Definition</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rule</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>Define_Source</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>num</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Definition</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>zipperposition_define_rule</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>num</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>num</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>role</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_step</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>role'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rule</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>rpair</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>deps</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>role'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
               </span><span class="entity"><span>Definition</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
               </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                 </span><span class="entity"><span>AAtom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"equal"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="comment1"><span>(* Vampire's equality proxy axiom *)</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Definition</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rule</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>rpair</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>deps</span></span><span class="main"><span>)</span></span><span>
               </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_step</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
             </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_step</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_tstp_line</span></span><span> </span><span class="entity"><span>full</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>parse_tstp_fol_line</span></span><span> </span><span class="entity"><span>full</span></span><span> </span><span class="entity"><span>problem</span></span><span>
  </span><span>||</span><span> </span><span class="entity"><span>parse_tstp_hol_line</span></span><span> </span><span class="entity"><span>full</span></span><span> </span><span class="entity"><span>problem</span></span><span>

</span><span class="comment1"><span>(**** PARSING OF SPASS OUTPUT ****)</span></span><span>

</span><span class="comment1"><span>(* SPASS returns clause references of the form "x.y". We ignore "y". *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parse_dot_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>scan_general_id</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"."</span></span><span> </span><span>--|</span><span> </span><span class="entity"><span>scan_general_id</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parse_spass_annotations</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Scan.optional</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>":"</span></span><span> </span><span>|--</span><span> </span><span>Scan.repeat</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>parse_dot_name</span></span><span> </span><span>--|</span><span> </span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>","</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>

</span><span class="comment1"><span>(* We ignore the stars and the pluses that follow literals. *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_decorated_atom</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>parse_fol_atom</span></span><span> </span><span>--|</span><span> </span><span>Scan.repeat</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>"*"</span></span><span> </span><span>||</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"+"</span></span><span> </span><span>||</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>" "</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_horn</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>AAtom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"c_False"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_horn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>neg_lits</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pos_lits</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>foldr1</span><span> </span><span class="main"><span>(</span></span><span>uncurry</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_aconn</span></span><span> </span><span class="entity"><span>AOr</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>mk_anot</span></span><span> </span><span class="entity"><span>neg_lits</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pos_lits</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_horn_clause</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span>Scan.repeat</span><span> </span><span class="entity"><span>parse_decorated_atom</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"|"</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"|"</span></span><span>
     </span><span>--</span><span> </span><span>Scan.repeat</span><span> </span><span class="entity"><span>parse_decorated_atom</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"-"</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"&gt;"</span></span><span>
     </span><span>--</span><span> </span><span>Scan.repeat</span><span> </span><span class="entity"><span>parse_decorated_atom</span></span><span>
   </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_horn</span></span><span> </span><span>o</span><span> </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>@</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parse_spass_debug</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>|--</span><span> </span><span>Scan.repeat</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>scan_general_id</span></span><span> </span><span>--|</span><span> </span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>","</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span>

</span><span class="comment1"><span>(* Syntax: &lt;num&gt;[0:&lt;inference&gt;&lt;annotations&gt;] &lt;atoms&gt; || &lt;atoms&gt; -&gt; &lt;atoms&gt; .
           derived from formulae &lt;ident&gt;* *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_spass_line</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>parse_spass_debug</span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>scan_general_id</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span>--|</span><span> </span><span>Scan.many1</span><span> </span><span>Symbol.is_digit</span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>":"</span></span><span>
     </span><span>--</span><span> </span><span>Symbol.scan_ascii_id</span><span> </span><span>--</span><span> </span><span class="entity"><span>parse_spass_annotations</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"]"</span></span><span> </span><span>--</span><span> </span><span class="entity"><span>parse_horn_clause</span></span><span> </span><span>--|</span><span> </span><span>$$</span><span> </span><span class="inner_quoted"><span>"."</span></span><span>
     </span><span>--</span><span> </span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span>Scan.this_string</span><span> </span><span class="inner_quoted"><span>"derived from formulae "</span></span><span>
                     </span><span>|--</span><span> </span><span>Scan.repeat</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>scan_general_id</span></span><span> </span><span>--|</span><span> </span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span>$$</span><span> </span><span class="inner_quoted"><span>" "</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
   </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>num</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rule</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>deps</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>num</span></span><span class="main"><span>,</span></span><span> </span><span>these</span><span> </span><span class="entity"><span>names</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Unknown</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rule</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>rpair</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>deps</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>core_inference</span></span><span> </span><span class="entity"><span>inf</span></span><span> </span><span class="entity"><span>fact</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>fact</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>fact</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Unknown</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dummy_phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>inf</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_line</span></span><span> </span><span class="entity"><span>full</span></span><span> </span><span class="entity"><span>local_name</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="comment1"><span>(* Satallax is handled separately, in "atp_satallax.ML". *)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>local_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>spassN</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>parse_spass_line</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>parse_tstp_line</span></span><span> </span><span class="entity"><span>full</span></span><span> </span><span class="entity"><span>problem</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>core_of_agsyhol_proof</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>split_lines</span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="inner_quoted"><span>"The transformed problem consists of the following conjectures:"</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>conj</span></span><span> </span><span>::</span><span>
    </span><span class="main"><span>_</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>proof_term</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>unprefix</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span class="entity"><span>conj</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>find_enclosed</span></span><span> </span><span class="inner_quoted"><span>"&lt;&lt;"</span></span><span> </span><span class="inner_quoted"><span>"&gt;&gt;"</span></span><span> </span><span class="entity"><span>proof_term</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>clean_up_dependencies</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>clean_up_dependencies</span></span><span> </span><span class="entity"><span>seen</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>role</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rule</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>deps</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>steps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>role</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rule</span></span><span class="main"><span>,</span></span><span> </span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>dep</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>find_first</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_same_atp_step</span></span><span> </span><span class="entity"><span>dep</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>seen</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>deps</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span>
    </span><span class="entity"><span>clean_up_dependencies</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>seen</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>steps</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>clean_up_atp_proof_dependencies</span></span><span> </span><span class="entity"><span>proof</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>clean_up_dependencies</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>proof</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_term_names_in_atp_proof</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AType</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>clss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>AType</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>clss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>map_type</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>map_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AFun</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>AFun</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_type</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_type</span></span><span> </span><span class="entity"><span>ty'</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>map_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>APi</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>APi</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_type</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_term</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>map_type</span></span><span> </span><span class="entity"><span>tys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>map_term</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>map_term</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AAbs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>AAbs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_type</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_term</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>map_term</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_formula</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AQuant</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>q</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>AQuant</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>q</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_formula</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>map_formula</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phis</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>AConn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>map_formula</span></span><span> </span><span class="entity"><span>phis</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>map_formula</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AAtom</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>AAtom</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_term</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_step</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>role</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rule</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>deps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>role</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_formula</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rule</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>deps</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>map</span><span> </span><span class="entity"><span>map_step</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>nasty_name</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symtab.lookup</span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span>|&gt;</span><span> </span><span>the_default</span><span> </span><span class="entity"><span>s</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>nasty_atp_proof</span></span><span> </span><span class="entity"><span>pool</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>Symtab.is_empty</span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>)</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>map_term_names_in_atp_proof</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nasty_name</span></span><span> </span><span class="entity"><span>pool</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_of_list</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>enclose</span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span class="inner_quoted"><span>"]"</span></span><span> </span><span class="main"><span>(</span></span><span>commas</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_of_atp_step_name</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>s</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>", "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_of_list</span></span><span> </span><span>I</span><span> </span><span class="entity"><span>ss</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_of_atp_step</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>g</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>role</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>name'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>string_of_atp_step_name</span></span><span> </span><span class="entity"><span>name</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>role'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ATP_Problem.tptp_string_of_role</span></span><span> </span><span class="entity"><span>role</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>x'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>x</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>g</span></span><span> </span><span class="entity"><span>y</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>names'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>string_of_list</span></span><span> </span><span class="entity"><span>string_of_atp_step_name</span></span><span> </span><span class="entity"><span>names</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="inner_quoted"><span>"("</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>name'</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>", "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>role'</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>", "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>x'</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>", "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>y'</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>", "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>names'</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_proof</span></span><span> </span><span class="entity"><span>full</span></span><span> </span><span class="entity"><span>local_name</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>strip_spaces_except_between_idents</span></span><span>
  </span><span>#&gt;</span><span> </span><span>raw_explode</span><span>
  </span><span>#&gt;</span><span> </span><span>Scan.error</span><span> </span><span class="main"><span>(</span></span><span>!!</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>UNRECOGNIZED_ATP_PROOF</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
       </span><span class="main"><span>(</span></span><span>Scan.finite</span><span> </span><span>Symbol.stopper</span><span> </span><span class="main"><span>(</span></span><span>Scan.repeats1</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>parse_line</span></span><span> </span><span class="entity"><span>full</span></span><span> </span><span class="entity"><span>local_name</span></span><span> </span><span class="entity"><span>problem</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span>#&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>proof</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>proof</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>UNRECOGNIZED_ATP_PROOF</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>atp_proof_of_tstplike_proof</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>atp_proof_of_tstplike_proof</span></span><span> </span><span class="entity"><span>full</span></span><span> </span><span class="entity"><span>local_prover</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="entity"><span>tstp</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>core_of_agsyhol_proof</span></span><span> </span><span class="entity"><span>tstp</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span>SOME</span><span> </span><span class="entity"><span>facts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>facts</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>core_inference</span></span><span> </span><span class="entity"><span>agsyhol_core_rule</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="entity"><span>tstp</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>parse_proof</span></span><span> </span><span class="entity"><span>full</span></span><span> </span><span class="entity"><span>local_prover</span></span><span> </span><span class="entity"><span>problem</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>local_prover</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>vampireN</span></span><span> </span><span>?</span><span> </span><span>perhaps</span><span> </span><span class="main"><span>(</span></span><span>try</span><span> </span><span class="main"><span>(</span></span><span>sort</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vampire_step_name_ord</span></span><span> </span><span>o</span><span> </span><span>apply2</span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>e_symbol_prefixes</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"esk"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"epred"</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>exists_name_in_term</span></span><span> </span><span class="entity"><span>pred</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>ex_name</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATerm</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pred</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>exists</span><span> </span><span class="entity"><span>ex_name</span></span><span> </span><span class="entity"><span>tms</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ex_name</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>AAbs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>exists</span><span> </span><span class="entity"><span>ex_name</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>tms</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>ex_name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>exists_name_in_formula</span></span><span> </span><span class="entity"><span>pred</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>formula_fold</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ex</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>ex</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>exists_name_in_term</span></span><span> </span><span class="entity"><span>pred</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>exists_symbol_in_formula</span></span><span> </span><span class="entity"><span>prefixes</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>exists_name_in_formula</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>prefix</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>String.isPrefix</span><span> </span><span class="entity"><span>prefix</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prefixes</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>atp_abduce_candidates_of_output</span></span><span> </span><span class="entity"><span>local_prover</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="entity"><span>output</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="comment1"><span>(* Truncate too large output to avoid memory issues. *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>max_size</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1000000</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>output</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>String.size</span><span> </span><span class="entity"><span>output</span></span><span> </span><span>&gt;</span><span> </span><span class="entity"><span>max_size</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span>String.substring</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>output</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_size</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="entity"><span>output</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fold_extract</span></span><span> </span><span class="entity"><span>accum</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>accum</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fold_extract</span></span><span> </span><span class="entity"><span>accum</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>line</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>lines</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>String.isSubstring</span><span> </span><span class="inner_quoted"><span>"# info"</span></span><span> </span><span class="entity"><span>line</span></span><span>
           </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>String.isSubstring</span><span> </span><span class="inner_quoted"><span>"negated_conjecture"</span></span><span> </span><span class="entity"><span>line</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>String.isSubstring</span><span> </span><span class="inner_quoted"><span>", 0, 0,"</span></span><span> </span><span class="entity"><span>line</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="comment1"><span>(* This pattern occurs in the "info()" comment of an E clause that directly emerges from
               the conjecture. We don't want to tell the user that they can prove "P" by assuming
               "P". *)</span></span><span>
            </span><span class="entity"><span>fold_extract</span></span><span> </span><span class="entity"><span>accum</span></span><span> </span><span class="entity"><span>lines</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>clean_line</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>space_explode</span><span> </span><span class="inner_quoted"><span>"#"</span></span><span> </span><span class="entity"><span>line</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                  </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span>
                </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>before_hash</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>before_hash</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>try</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>parse_proof</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>local_prover</span></span><span> </span><span class="entity"><span>problem</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>clean_line</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                </span><span>SOME</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>local_prover</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>eN</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>exists_symbol_in_formula</span></span><span> </span><span class="entity"><span>e_symbol_prefixes</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                  </span><span class="entity"><span>fold_extract</span></span><span> </span><span class="entity"><span>accum</span></span><span> </span><span class="entity"><span>lines</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                  </span><span class="entity"><span>fold_extract</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>phi</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>accum</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lines</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fold_extract</span></span><span> </span><span class="entity"><span>accum</span></span><span> </span><span class="entity"><span>lines</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
          </span><span class="entity"><span>fold_extract</span></span><span> </span><span class="entity"><span>accum</span></span><span> </span><span class="entity"><span>lines</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>fold_extract</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>split_lines</span><span> </span><span class="entity"><span>output</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span></pre>
</body>

</html>