<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Tools/semiring_normalizer.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Tools/semiring_normalizer.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      HOL/Tools/semiring_normalizer.ML
    Author:     Amine Chaieb, TU Muenchen

Normalization of expressions in semirings.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>SEMIRING_NORMALIZER</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>entry</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> match</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>cterm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>entry</span></span><span> </span><span>option</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> the_semiring</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>cterm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> the_ring</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>cterm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> the_field</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>cterm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> the_idom</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> the_ideal</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> declare</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>{</span></span><span>semiring</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span> ring</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
    field</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span> idom</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span> ideal</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>}</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> semiring_normalize_conv</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> semiring_normalize_ord_conv</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>cterm</span><span> </span><span>ord</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> semiring_normalize_wrapper</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>entry</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> semiring_normalize_ord_wrapper</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>entry</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>cterm</span><span> </span><span>ord</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> semiring_normalizers_conv</span><span class="main"><span>:</span></span><span> </span><span>cterm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>cterm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span>
    </span><span class="main"><span>-&gt;</span></span><span> </span><span>cterm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>cterm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
      </span><span class="main"><span>(</span></span><span>cterm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span class="main"><span>)</span></span><span> * </span><span>conv</span><span> * </span><span>conv</span><span> * </span><span>conv</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>cterm</span><span> </span><span>ord</span><span> </span><span class="main"><span>-&gt;</span></span><span>
        </span><span class="main"><span>{</span></span><span>add</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span class="main"><span>,</span></span><span>
         mul</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span class="main"><span>,</span></span><span>
         neg</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span class="main"><span>,</span></span><span>
         main</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span class="main"><span>,</span></span><span>
         pow</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span class="main"><span>,</span></span><span>
         sub</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span class="main"><span>}</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> semiring_normalizers_ord_wrapper</span><span class="main"><span>:</span></span><span>  </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>entry</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>cterm</span><span> </span><span>ord</span><span> </span><span class="main"><span>-&gt;</span></span><span>
      </span><span class="main"><span>{</span></span><span>add</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span class="main"><span>,</span></span><span>
       mul</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span class="main"><span>,</span></span><span>
       neg</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span class="main"><span>,</span></span><span>
       main</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span class="main"><span>,</span></span><span>
       pow</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span class="main"><span>,</span></span><span>
       sub</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span class="main"><span>}</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Semiring_Normalizer</span></span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>SEMIRING_NORMALIZER</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="comment1"><span>(** data **)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>entry</span></span><span> </span><span class="main"><span>=</span></span><span>
 </span><span class="main"><span>{</span></span><span>vars</span><span class="main"><span>:</span></span><span> </span><span>cterm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  semiring</span><span class="main"><span>:</span></span><span> </span><span>cterm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  ring</span><span class="main"><span>:</span></span><span> </span><span>cterm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  field</span><span class="main"><span>:</span></span><span> </span><span>cterm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  idom</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  ideal</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>}</span></span><span> *
 </span><span class="main"><span>{</span></span><span>is_const</span><span class="main"><span>:</span></span><span> </span><span>cterm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
  dest_const</span><span class="main"><span>:</span></span><span> </span><span>cterm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>Rat.rat</span><span class="main"><span>,</span></span><span>
  mk_const</span><span class="main"><span>:</span></span><span> </span><span>ctyp</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>Rat.rat</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>cterm</span><span class="main"><span>,</span></span><span>
  conv</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>cterm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Data</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Generic_Data</span><span>
</span><span class="main"><span>(</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>thm</span><span> * </span><span class="entity"><span>entry</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>empty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>merge</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>AList.merge</span><span> </span><span>Thm.eq_thm</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>data</span></span><span class="main"><span>;</span></span><span>
</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>the_rules</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span>the</span><span> </span><span>o</span><span> </span><span>AList.lookup</span><span> </span><span>Thm.eq_thm</span><span> </span><span class="main"><span>(</span></span><span>Data.get</span><span> </span><span class="main"><span>(</span></span><span>Context.Proof</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>the_semiring</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>semiring </span><span>oo</span><span> </span><span class="entity"><span>the_rules</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>the_ring</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>ring </span><span>oo</span><span> </span><span class="entity"><span>the_rules</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>the_field</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>field </span><span>oo</span><span> </span><span class="entity"><span>the_rules</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>the_idom</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>idom </span><span>oo</span><span> </span><span class="entity"><span>the_rules</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>the_ideal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>ideal </span><span>oo</span><span> </span><span class="entity"><span>the_rules</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>match</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>match_inst</span></span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="entity"><span>vars</span></span><span class="main"><span>,</span></span><span> semiring </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sr_ops</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sr_rules</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          ring </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r_ops</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r_rules</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> field </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f_ops</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f_rules</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idom</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ideal</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span>
         </span><span class="entity"><span>fns</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pat</span></span><span> </span><span class="main"><span>=</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="entity"><span>instT</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>substT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.instantiate</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>instT</span></span><span class="main"><span>,</span></span><span> </span><span>Vars.empty</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>substT_cterm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Drule.cterm_rule</span><span> </span><span class="entity"><span>substT</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>substT_cterm</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>semiring'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>substT_cterm</span></span><span> </span><span class="entity"><span>sr_ops</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>substT</span></span><span> </span><span class="entity"><span>sr_rules</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ring'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>substT_cterm</span></span><span> </span><span class="entity"><span>r_ops</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>substT</span></span><span> </span><span class="entity"><span>r_rules</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>field'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>substT_cterm</span></span><span> </span><span class="entity"><span>f_ops</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>substT</span></span><span> </span><span class="entity"><span>f_rules</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>idom'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>substT</span></span><span> </span><span class="entity"><span>idom</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ideal'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>substT</span></span><span> </span><span class="entity"><span>ideal</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>result</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span>vars </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>vars'</span></span><span class="main"><span>,</span></span><span> semiring </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>semiring'</span></span><span class="main"><span>,</span></span><span>
                           ring </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ring'</span></span><span class="main"><span>,</span></span><span> field </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>field'</span></span><span class="main"><span>,</span></span><span> idom </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>idom'</span></span><span class="main"><span>,</span></span><span> ideal </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ideal'</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fns</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>result</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>try</span><span> </span><span>Thm.match</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
           </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span>
         </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>instT</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="entity"><span>instT</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>match_struct</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>entry</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span>semiring </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sr_ops</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> ring </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r_ops</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> field </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f_ops</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>entry</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>get_first</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>match_inst</span></span><span> </span><span class="entity"><span>entry</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sr_ops</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>r_ops</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_ops</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>get_first</span><span> </span><span class="entity"><span>match_struct</span></span><span> </span><span class="main"><span>(</span></span><span>Data.get</span><span> </span><span class="main"><span>(</span></span><span>Context.Proof</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(* extra-logical functions *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>semiring_norm_ss</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>simpset_of</span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span><span class="hidden">\&lt;^</span><span class="control">context</span><span class="hidden">&gt;</span></span></span></span></span><span> </span><span>addsimps</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../Numeral_Simprocs.html#Numeral_Simprocs.semiring_norm|fact"><span>semiring_norm</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>semiring_funs</span></span><span> </span><span class="main"><span>=</span></span><span>
   </span><span class="main"><span>{</span></span><span>is_const </span><span class="main"><span>=</span></span><span> </span><span>can</span><span> </span><span class="entity"><span>HOLogic.dest_number</span></span><span> </span><span>o</span><span> </span><span>Thm.term_of</span><span class="main"><span>,</span></span><span>
    dest_const </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span>Rat.of_int</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.dest_number</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>TERM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"ring_dest_const"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
    mk_const </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>cT</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Numeral.mk_cnumber</span></span><span> </span><span class="entity"><span>cT</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Rat.dest</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"int_of_rat: bad int"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
    conv </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="entity"><span>Simplifier.rewrite</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>semiring_norm_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
      </span><span>then_conv</span><span> </span><span class="entity"><span>Simplifier.rewrite</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>addsimps</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../Num.html#Num.numeral_class.numeral.numeral_One|fact"><span>numeral_One</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>divide_const</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.cterm_of</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span><span class="hidden">\&lt;^</span><span class="control">context</span><span class="hidden">&gt;</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span>Logic.varify_global</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../Fields.html#Fields.inverse_class.inverse_divide|const"><span>(/)</span></a></span><span>›</span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>divide_tvar</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.add_tvars</span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>divide_const</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>field_funs</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>numeral_is_const</span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
       </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../Rings.html#Rings.divide_class.divide|const"><span>Rings.divide</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>a</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
         </span><span>can</span><span> </span><span class="entity"><span>HOLogic.dest_number</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>can</span><span> </span><span class="entity"><span>HOLogic.dest_number</span></span><span> </span><span class="entity"><span>b</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../Fields.html#Fields.inverse_class.inverse|const"><span>Fields.inverse</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>can</span><span> </span><span class="entity"><span>HOLogic.dest_number</span></span><span> </span><span class="entity"><span>t</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>can</span><span> </span><span class="entity"><span>HOLogic.dest_number</span></span><span> </span><span class="entity"><span>t</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dest_const</span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
       </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../Rings.html#Rings.divide_class.divide|const"><span>Rings.divide</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>a</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>=&gt;</span></span><span>
        </span><span>Rat.make</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.dest_number</span></span><span> </span><span class="entity"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>snd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.dest_number</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../Fields.html#Fields.inverse_class.inverse|const"><span>Fields.inverse</span></a><span>›</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>$</span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                   </span><span>Rat.inv</span><span> </span><span class="main"><span>(</span></span><span>Rat.of_int</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.dest_number</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Rat.of_int</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.dest_number</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
       </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>TERM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"ring_dest_const"</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_const</span></span><span> </span><span class="entity"><span>cT</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Rat.dest</span><span> </span><span class="entity"><span>x</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Numeral.mk_cnumber</span></span><span> </span><span class="entity"><span>cT</span></span><span> </span><span class="entity"><span>a</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Thm.apply</span><span>
             </span><span class="main"><span>(</span></span><span>Thm.apply</span><span>
               </span><span class="main"><span>(</span></span><span>Thm.instantiate_cterm</span><span> </span><span class="main"><span>(</span></span><span>TVars.make1</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>divide_tvar</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cT</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Vars.empty</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>divide_const</span></span><span class="main"><span>)</span></span><span>
               </span><span class="main"><span>(</span></span><span class="entity"><span>Numeral.mk_cnumber</span></span><span> </span><span class="entity"><span>cT</span></span><span> </span><span class="entity"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
             </span><span class="main"><span>(</span></span><span class="entity"><span>Numeral.mk_cnumber</span></span><span> </span><span class="entity"><span>cT</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
     </span><span class="main"><span>{</span></span><span>is_const </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>numeral_is_const</span></span><span class="main"><span>,</span></span><span>
      dest_const </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_const</span></span><span class="main"><span>,</span></span><span>
      mk_const </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_const</span></span><span class="main"><span>,</span></span><span>
      conv </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Numeral_Simprocs.field_comp_conv</span></span><span class="main"><span>}</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(* logical content *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>semiringN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"semiring"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ringN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"ring"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fieldN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"field"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>idomN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"idom"</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>declare</span></span><span> </span><span class="entity"><span>raw_key</span></span><span>
    </span><span class="main"><span>{</span></span><span>semiring </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>raw_semiring0</span></span><span class="main"><span>,</span></span><span> ring </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>raw_ring0</span></span><span class="main"><span>,</span></span><span> field </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>raw_field0</span></span><span class="main"><span>,</span></span><span> idom </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>raw_idom</span></span><span class="main"><span>,</span></span><span> ideal </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>raw_ideal</span></span><span class="main"><span>}</span></span><span>
    </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span>Proof_Context.augment</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>raw_semiring0</span></span><span> </span><span>@</span><span> </span><span>fst</span><span> </span><span class="entity"><span>raw_ring0</span></span><span> </span><span>@</span><span> </span><span>fst</span><span> </span><span class="entity"><span>raw_field0</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prepare_ops</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>Variable.export_terms</span><span> </span><span class="entity"><span>ctxt'</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span>#&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>raw_semiring</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prepare_ops</span></span><span> </span><span class="entity"><span>raw_semiring0</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>raw_ring</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prepare_ops</span></span><span> </span><span class="entity"><span>raw_ring0</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>raw_field</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prepare_ops</span></span><span> </span><span class="entity"><span>raw_field0</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>lthy</span></span><span> </span><span>|&gt;</span><span> </span><span>Local_Theory.declaration</span><span> </span><span class="main"><span>{</span></span><span>syntax </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> pervasive </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> pos </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Context.proof_of</span><span> </span><span class="entity"><span>context</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>key</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>raw_key</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>transform_ops_rules</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ops</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rules</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.cterm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ops</span></span><span class="main"><span>,</span></span><span> </span><span>Morphism.fact</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>rules</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sr_ops</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sr_rules</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>transform_ops_rules</span></span><span> </span><span class="entity"><span>raw_semiring</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r_ops</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r_rules</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>transform_ops_rules</span></span><span> </span><span class="entity"><span>raw_ring</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f_ops</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f_rules</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>transform_ops_rules</span></span><span> </span><span class="entity"><span>raw_field</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>idom</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Morphism.fact</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>raw_idom</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ideal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Morphism.fact</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>raw_ideal</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>check</span></span><span> </span><span class="entity"><span>kind</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>null</span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
          </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Expected "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>kind</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" for "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>check_ops</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>check</span></span><span> </span><span class="inner_quoted"><span>"operations"</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>check_rules</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>check</span></span><span> </span><span class="inner_quoted"><span>"rules"</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>check_ops</span></span><span> </span><span class="entity"><span>semiringN</span></span><span> </span><span class="entity"><span>sr_ops</span></span><span> </span><span class="inner_numeral"><span>5</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
          </span><span class="entity"><span>check_rules</span></span><span> </span><span class="entity"><span>semiringN</span></span><span> </span><span class="entity"><span>sr_rules</span></span><span> </span><span class="inner_numeral"><span>36</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
          </span><span class="entity"><span>check_ops</span></span><span> </span><span class="entity"><span>ringN</span></span><span> </span><span class="entity"><span>r_ops</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
          </span><span class="entity"><span>check_rules</span></span><span> </span><span class="entity"><span>ringN</span></span><span> </span><span class="entity"><span>r_rules</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
          </span><span class="entity"><span>check_ops</span></span><span> </span><span class="entity"><span>fieldN</span></span><span> </span><span class="entity"><span>f_ops</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
          </span><span class="entity"><span>check_rules</span></span><span> </span><span class="entity"><span>fieldN</span></span><span> </span><span class="entity"><span>f_rules</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
          </span><span class="entity"><span>check_rules</span></span><span> </span><span class="entity"><span>idomN</span></span><span> </span><span class="entity"><span>idom</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_meta</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Local_Defs.meta_rewrite_rule</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sr_rules'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_meta</span></span><span> </span><span class="entity"><span>sr_rules</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>r_rules'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_meta</span></span><span> </span><span class="entity"><span>r_rules</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>f_rules'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_meta</span></span><span> </span><span class="entity"><span>f_rules</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>sr_rules'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_binop</span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>sr_ops</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cz</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="inner_numeral"><span>34</span></span><span> </span><span>|&gt;</span><span> </span><span>Thm.rhs_of</span><span> </span><span>|&gt;</span><span> </span><span>Thm.dest_arg</span><span> </span><span>|&gt;</span><span> </span><span>Thm.dest_arg</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cn</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="inner_numeral"><span>36</span></span><span> </span><span>|&gt;</span><span> </span><span>Thm.rhs_of</span><span> </span><span>|&gt;</span><span> </span><span>Thm.dest_arg</span><span> </span><span>|&gt;</span><span> </span><span>Thm.dest_arg</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>clx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>crx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cly</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cry</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>rule</span></span><span> </span><span class="inner_numeral"><span>13</span></span><span> </span><span>|&gt;</span><span> </span><span>Thm.rhs_of</span><span> </span><span>|&gt;</span><span> </span><span>Thm.dest_binop</span><span> </span><span>|&gt;</span><span> </span><span>apply2</span><span> </span><span>Thm.dest_binop</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cb</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cc</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cd</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>rule</span></span><span> </span><span class="inner_numeral"><span>20</span></span><span> </span><span>|&gt;</span><span> </span><span>Thm.lhs_of</span><span> </span><span>|&gt;</span><span> </span><span>Thm.dest_binop</span><span> </span><span>|&gt;</span><span> </span><span>apply2</span><span> </span><span>Thm.dest_binop</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>|&gt;</span><span> </span><span>Thm.rhs_of</span><span> </span><span>|&gt;</span><span> </span><span>Thm.dest_arg</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cp</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cq</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="inner_numeral"><span>26</span></span><span> </span><span>|&gt;</span><span> </span><span>Thm.lhs_of</span><span> </span><span>|&gt;</span><span> </span><span>Thm.dest_binop</span><span> </span><span>|&gt;</span><span> </span><span>apply2</span><span> </span><span>Thm.dest_arg</span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cb</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cc</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cn</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cp</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cq</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cz</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>clx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>crx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cly</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cry</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>semiring</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sr_ops</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sr_rules'</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ring</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r_ops</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r_rules'</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>field</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f_ops</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f_rules'</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ideal'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.symmetric</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_meta</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ideal</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>context</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Data.map</span><span> </span><span class="main"><span>(</span></span><span>AList.update</span><span> </span><span>Thm.eq_thm</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>key</span></span><span class="main"><span>,</span></span><span>
            </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span>vars </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>,</span></span><span> semiring </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>semiring</span></span><span class="main"><span>,</span></span><span> ring </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ring</span></span><span class="main"><span>,</span></span><span> field </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>field</span></span><span class="main"><span>,</span></span><span> idom </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>idom</span></span><span class="main"><span>,</span></span><span> ideal </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ideal'</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>f_ops</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>semiring_funs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>field_funs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(** auxiliary **)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_comb</span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.cprop_of</span><span> </span><span>#&gt;</span><span> </span><span>Thm.dest_arg</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_binop</span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="entity"><span>ct'</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="entity"><span>c</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct</span></span><span> </span><span>aconv</span><span> </span><span class="entity"><span>c</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dest_binop</span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="entity"><span>ct'</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_binop</span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="entity"><span>ct'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Thm.dest_binop</span><span> </span><span class="entity"><span>ct'</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"dest_binop: bad binop"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ct</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ct'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Thm.instantiate</span><span> </span><span class="main"><span>(</span></span><span>TVars.empty</span><span class="main"><span>,</span></span><span> </span><span>Vars.make</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>dest_Var</span><span> </span><span>o</span><span> </span><span>Thm.term_of</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>inst</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dest_number</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.term_of</span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>HOLogic.dest_number</span></span><span> </span><span>#&gt;</span><span> </span><span>snd</span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>is_number</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>can</span><span> </span><span class="entity"><span>dest_number</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>numeral01_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Simplifier.rewrite</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>addsimps</span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../Num.html#Num.numeral_class.numeral.numeral_One|fact"><span>numeral_One</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>zero1_numeral_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Simplifier.rewrite</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>addsimps</span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../Num.html#Num.numeral_class.numeral.numeral_One|fact"><span>numeral_One</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>zerone_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>cv</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>zero1_numeral_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>then_conv</span><span> </span><span class="entity"><span>cv</span></span><span> </span><span>then_conv</span><span> </span><span class="entity"><span>numeral01_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nat_add_ss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>simpset_of</span><span>
  </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span><span class="hidden">\&lt;^</span><span class="control">context</span><span class="hidden">&gt;</span></span></span></span></span><span>
     </span><span>addsimps</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../Num.html#Num.arith_simps|fact"><span>arith_simps</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../Int.html#Int.diff_nat_numeral|fact"><span>diff_nat_numeral</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../Num.html#Num.rel_simps|fact"><span>rel_simps</span></a><span class="antiquote"><span>}</span></span></span></span><span>
       </span><span>@</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../HOL.html#HOL.if_False|fact"><span>if_False</span></a><span> </span><a class="entity_ref" href="../../../../HOL.html#HOL.if_True|fact"><span>if_True</span></a><span> </span><a class="entity_ref" href="../../../../Nat.html#Nat.plus_nat.add_0|fact"><span>Nat.add_0</span></a><span> </span><a class="entity_ref" href="../../../../Nat.html#Nat.plus_nat.add_Suc|fact"><span>add_Suc</span></a><span> </span><a class="entity_ref" href="../../../../Num.html#Num.add_numeral_left|fact"><span>add_numeral_left</span></a><span> </span><a class="entity_ref" href="../../../../Nat.html#Nat.Suc_eq_plus1|fact"><span>Suc_eq_plus1</span></a><span class="antiquote"><span>}</span></span></span></span><span>
       </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../Num.html#Num.numerals|fact"><span>numerals</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>nat_add_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>zerone_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Simplifier.rewrite</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>nat_add_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>zeron_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../../../Nat.html#Nat.nat|type"><span>nat</span></a><span>›</span></span></span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>onen_tm</span></span><span>  </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../../../Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../../../Nat.html#Nat.nat|type"><span>nat</span></a><span>›</span></span></span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>true_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../HOL.html#HOL.True|const"><span>True</span></a><span>›</span></span></span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(** normalizing conversions **)</span></span><span>

</span><span class="comment1"><span>(* core conversion *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>semiring_normalizers_conv</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sr_ops</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sr_rules</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r_ops</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r_rules</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f_ops</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f_rules</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>is_semiring_constant</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>semiring_add_conv</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>semiring_mul_conv</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>semiring_pow_conv</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>pthm_02</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_03</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_04</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_05</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_07</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_08</span></span><span class="main"><span>,</span></span><span>
     </span><span class="entity"><span>pthm_09</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_10</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_11</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_12</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_13</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_14</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_15</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_16</span></span><span class="main"><span>,</span></span><span>
     </span><span class="entity"><span>pthm_17</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_18</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_19</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_21</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_22</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_23</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_24</span></span><span class="main"><span>,</span></span><span>
     </span><span class="entity"><span>pthm_25</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_26</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_27</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_28</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_29</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_30</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_31</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_32</span></span><span class="main"><span>,</span></span><span>
     </span><span class="entity"><span>pthm_33</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_34</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_35</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_36</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_37</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pthm_38</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sr_rules</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cb</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cc</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cn</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cp</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cq</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cz</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>clx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>crx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cly</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cry</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>add_pat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mul_pat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pow_pat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>zero_tm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>one_tm</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sr_ops</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>add_tm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mul_tm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pow_tm</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_fun</span><span> </span><span>o</span><span> </span><span>Thm.dest_fun</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>add_pat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mul_pat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pow_pat</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dest_add</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_binop</span></span><span> </span><span class="entity"><span>add_tm</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dest_mul</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_binop</span></span><span> </span><span class="entity"><span>mul_tm</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dest_pow</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_binop</span></span><span> </span><span class="entity"><span>pow_tm</span></span><span> </span><span class="entity"><span>tm</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_number</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"dest_pow"</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>tm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>is_add</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_binop</span></span><span> </span><span class="entity"><span>add_tm</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>is_mul</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_binop</span></span><span> </span><span class="entity"><span>mul_tm</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>neg_mul</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub_add</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub_tm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>neg_tm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dest_sub</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cx'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cy'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r_ops</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r_rules</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>sub_pat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>neg_pat</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>neg_mul</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub_add</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sub_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_fun</span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_fun</span><span> </span><span class="entity"><span>sub_pat</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>neg_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_fun</span><span> </span><span class="entity"><span>neg_pat</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dest_sub</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_binop</span></span><span> </span><span class="entity"><span>sub_tm</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>neg_mul</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub_add</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sub_tm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>neg_tm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dest_sub</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>neg_mul</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>concl</span></span><span> </span><span>|&gt;</span><span> </span><span>Thm.dest_arg</span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>sub_add</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>concl</span></span><span> </span><span>|&gt;</span><span> </span><span>Thm.dest_arg</span><span> </span><span>|&gt;</span><span> </span><span>Thm.dest_arg</span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TrueI</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TrueI</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>true_tm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>true_tm</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>true_tm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>true_tm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>divide_inverse</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>divide_tm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>inverse_tm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f_ops</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f_rules</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
   </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>divide_pat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>inverse_pat</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>div_inv</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>div_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>funpow</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span>Thm.dest_fun</span><span> </span><span class="entity"><span>divide_pat</span></span><span>
         </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inv_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_fun</span><span> </span><span class="entity"><span>inverse_pat</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>div_inv</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>div_tm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>inv_tm</span></span><span class="main"><span>)</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
   </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TrueI</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>true_tm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>true_tm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>variable_ord</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>

</span><span class="comment1"><span>(* Conversion for "x^n * x^m", with either x^n = x and/or x^m = x possible.  *)</span></span><span>
</span><span class="comment1"><span>(* Also deals with "const * const", but both terms must involve powers of    *)</span></span><span>
</span><span class="comment1"><span>(* the same variable, or both be constants, or behaviour may be incorrect.   *)</span></span><span>

 </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>powvar_mul_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_mul</span></span><span> </span><span class="entity"><span>tm</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_semiring_constant</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>is_semiring_constant</span></span><span> </span><span class="entity"><span>r</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>semiring_mul_conv</span></span><span> </span><span class="entity"><span>tm</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
         </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lx</span></span><span class="main"><span>,</span></span><span class="entity"><span>ln</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_pow</span></span><span> </span><span class="entity"><span>l</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
         </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rn</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_pow</span></span><span> </span><span class="entity"><span>r</span></span><span>
               </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>cx</span></span><span class="main"><span>,</span></span><span class="entity"><span>lx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cp</span></span><span class="main"><span>,</span></span><span class="entity"><span>ln</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cq</span></span><span class="main"><span>,</span></span><span class="entity"><span>rn</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_29</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm1</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
               </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>(</span></span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>tm1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nat_add_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
           </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>cx</span></span><span class="main"><span>,</span></span><span class="entity"><span>lx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cq</span></span><span class="main"><span>,</span></span><span class="entity"><span>ln</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_31</span></span><span>
                 </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm1</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
               </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>(</span></span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>tm1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nat_add_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
       </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
           </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rx</span></span><span class="main"><span>,</span></span><span class="entity"><span>rn</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_pow</span></span><span> </span><span class="entity"><span>r</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>cx</span></span><span class="main"><span>,</span></span><span class="entity"><span>rx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cq</span></span><span class="main"><span>,</span></span><span class="entity"><span>rn</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_30</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm1</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
               </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>(</span></span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>tm1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nat_add_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
           </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>cx</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_32</span></span><span>

</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* Remove "1 * m" from a monomial, and just leave m.                         *)</span></span><span>

 </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>monomial_deone</span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>=</span></span><span>
       </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_mul</span></span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>one_tm</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_13</span></span><span class="main"><span>)</span></span><span>  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
       </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>th</span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* Conversion for "(monomial)^n", where n is a numeral.                      *)</span></span><span>

 </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>monomial_pow_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
   </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>monomial_pow</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="entity"><span>bod</span></span><span> </span><span class="entity"><span>ntm</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span class="main"><span>(</span></span><span class="entity"><span>is_comb</span></span><span> </span><span class="entity"><span>bod</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Thm.reflexive</span><span> </span><span class="entity"><span>tm</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_semiring_constant</span></span><span> </span><span class="entity"><span>bod</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>semiring_pow_conv</span></span><span> </span><span class="entity"><span>tm</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lopr</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>bod</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span class="main"><span>(</span></span><span class="entity"><span>is_comb</span></span><span> </span><span class="entity"><span>lopr</span></span><span class="main"><span>)</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Thm.reflexive</span><span> </span><span class="entity"><span>tm</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>opr</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>lopr</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>opr</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>pow_tm</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>is_number</span></span><span> </span><span class="entity"><span>r</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>cx</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cp</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cq</span></span><span class="main"><span>,</span></span><span class="entity"><span>ntm</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_34</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>(</span></span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nat_add_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>opr</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>mul_tm</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>cx</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cy</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cq</span></span><span class="main"><span>,</span></span><span class="entity"><span>ntm</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_33</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xy</span></span><span class="main"><span>,</span></span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>xy</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>monomial_pow</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="entity"><span>ntm</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>monomial_pow</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="entity"><span>ntm</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.combination</span><span> </span><span class="main"><span>(</span></span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>thl</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thr</span></span><span class="main"><span>)</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Thm.reflexive</span><span> </span><span class="entity"><span>tm</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lopr</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>tm</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>opr</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>lopr</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>opr</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>pow_tm</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>not</span><span class="main"><span>(</span></span><span class="entity"><span>is_number</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"monomial_pow_conv"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>tm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>zeron_tm</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>cx</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_35</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>onen_tm</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>cx</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_36</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>monomial_deone</span></span><span class="main"><span>(</span></span><span class="entity"><span>monomial_pow</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* Multiplication of canonical monomials.                                    *)</span></span><span>
 </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>monomial_mul_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
   </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>powvar</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_semiring_constant</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>one_tm</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
     </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lopr</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>tm</span></span><span>
           </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>opr</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>lopr</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>opr</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>pow_tm</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>is_number</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>l</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"monomial_mul_conv"</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>tm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
     </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span>   </span><span class="comment1"><span>(* FIXME !? *)</span></span><span>
   </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span>  </span><span class="entity"><span>vorder</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>one_tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_numeral"><span>~1</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>one_tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>is_less</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>variable_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
   </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>monomial_mul</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lx</span></span><span class="main"><span>,</span></span><span class="entity"><span>ly</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_mul</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>powvar</span></span><span> </span><span class="entity"><span>lx</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rx</span></span><span class="main"><span>,</span></span><span class="entity"><span>ry</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_mul</span></span><span> </span><span class="entity"><span>r</span></span><span>
         </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>powvar</span></span><span> </span><span class="entity"><span>rx</span></span><span>
         </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>vorder</span></span><span> </span><span class="entity"><span>vl</span></span><span> </span><span class="entity"><span>vr</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>clx</span></span><span class="main"><span>,</span></span><span class="entity"><span>lx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cly</span></span><span class="main"><span>,</span></span><span class="entity"><span>ly</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>crx</span></span><span class="main"><span>,</span></span><span class="entity"><span>rx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cry</span></span><span class="main"><span>,</span></span><span class="entity"><span>ry</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_15</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm1</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm3</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm4</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>tm1</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Drule.fun_cong_rule</span><span> </span><span class="main"><span>(</span></span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>tm3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>powvar_mul_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tm4</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tm2</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th3</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="entity"><span>th2</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span>  </span><span class="main"><span>(</span></span><span class="entity"><span>tm5</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm6</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th3</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span>  </span><span class="main"><span>(</span></span><span class="entity"><span>tm7</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm8</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>tm6</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span>  </span><span class="entity"><span>th4</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>monomial_mul</span></span><span> </span><span class="entity"><span>tm6</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_arg</span><span> </span><span class="entity"><span>tm7</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tm8</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th3</span></span><span> </span><span class="main"><span>(</span></span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>tm5</span></span><span> </span><span class="entity"><span>th4</span></span><span class="main"><span>)</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span>&lt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>pthm_16</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>pthm_17</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>clx</span></span><span class="main"><span>,</span></span><span class="entity"><span>lx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cly</span></span><span class="main"><span>,</span></span><span class="entity"><span>ly</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>crx</span></span><span class="main"><span>,</span></span><span class="entity"><span>rx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cry</span></span><span class="main"><span>,</span></span><span class="entity"><span>ry</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>th0</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm1</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm3</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm4</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>tm2</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>(</span></span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>tm1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>monomial_mul</span></span><span> </span><span class="entity"><span>tm2</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_arg</span><span> </span><span class="entity"><span>tm3</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tm4</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
       </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>powvar</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>vorder</span></span><span> </span><span class="entity"><span>vl</span></span><span> </span><span class="entity"><span>vr</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
           </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>clx</span></span><span class="main"><span>,</span></span><span class="entity"><span>lx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cly</span></span><span class="main"><span>,</span></span><span class="entity"><span>ly</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>crx</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_18</span></span><span>
                 </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm1</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span>
           </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm3</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm4</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>tm1</span></span><span>
           </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Drule.fun_cong_rule</span><span> </span><span class="main"><span>(</span></span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>tm3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>powvar_mul_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tm4</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tm2</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="entity"><span>th2</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span>&lt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>clx</span></span><span class="main"><span>,</span></span><span class="entity"><span>lx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cly</span></span><span class="main"><span>,</span></span><span class="entity"><span>ly</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>crx</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_19</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm1</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm3</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm4</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>tm2</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>(</span></span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>tm1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>monomial_mul</span></span><span> </span><span class="entity"><span>tm2</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_arg</span><span> </span><span class="entity"><span>tm3</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tm4</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cb</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_09</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
     </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>powvar</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rx</span></span><span class="main"><span>,</span></span><span class="entity"><span>ry</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_mul</span></span><span> </span><span class="entity"><span>r</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>powvar</span></span><span> </span><span class="entity"><span>rx</span></span><span>
           </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>vorder</span></span><span> </span><span class="entity"><span>vl</span></span><span> </span><span class="entity"><span>vr</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>clx</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>crx</span></span><span class="main"><span>,</span></span><span class="entity"><span>rx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cry</span></span><span class="main"><span>,</span></span><span class="entity"><span>ry</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_21</span></span><span>
                 </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm1</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span>
                 </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm3</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm4</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>tm1</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>(</span></span><span>Drule.fun_cong_rule</span><span> </span><span class="main"><span>(</span></span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>tm3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>powvar_mul_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tm4</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>clx</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>crx</span></span><span class="main"><span>,</span></span><span class="entity"><span>rx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cry</span></span><span class="main"><span>,</span></span><span class="entity"><span>ry</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_22</span></span><span>
                     </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm1</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm3</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm4</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>tm2</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>(</span></span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>tm1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>monomial_mul</span></span><span> </span><span class="entity"><span>tm2</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_arg</span><span> </span><span class="entity"><span>tm3</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tm4</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Thm.reflexive</span><span> </span><span class="entity"><span>tm</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>powvar</span></span><span> </span><span class="entity"><span>r</span></span><span>
               </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span>  </span><span class="entity"><span>ord</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>vorder</span></span><span> </span><span class="entity"><span>vl</span></span><span> </span><span class="entity"><span>vr</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>powvar_mul_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tm</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cb</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_09</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Thm.reflexive</span><span> </span><span class="entity"><span>tm</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_mul</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>monomial_deone</span></span><span class="main"><span>(</span></span><span class="entity"><span>monomial_mul</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span><span class="comment1"><span>(* Multiplication by monomial of a polynomial.                               *)</span></span><span>

 </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>polynomial_monomial_mul_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
   </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pmm_conv</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_mul</span></span><span> </span><span class="entity"><span>tm</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_add</span></span><span> </span><span class="entity"><span>r</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>cx</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cy</span></span><span class="main"><span>,</span></span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cz</span></span><span class="main"><span>,</span></span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_37</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm1</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm3</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm4</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>tm1</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th2</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span>Thm.combination</span><span> </span><span class="main"><span>(</span></span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>tm3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>monomial_mul_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tm4</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pmm_conv</span></span><span> </span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="entity"><span>th2</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
     </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>monomial_mul_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>pmm_conv</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* Addition of two monomials identical except for constant multiples.        *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>monomial_add_conv</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_add</span></span><span> </span><span class="entity"><span>tm</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_semiring_constant</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>is_semiring_constant</span></span><span> </span><span class="entity"><span>r</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>semiring_add_conv</span></span><span> </span><span class="entity"><span>tm</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_mul</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>is_semiring_constant</span></span><span class="main"><span>(</span></span><span>Thm.dest_arg1</span><span> </span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_mul</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>is_semiring_constant</span></span><span class="main"><span>(</span></span><span>Thm.dest_arg1</span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                    </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span>Thm.dest_arg1</span><span> </span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cm</span></span><span class="main"><span>,</span></span><span>Thm.dest_arg</span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cb</span></span><span class="main"><span>,</span></span><span>Thm.dest_arg1</span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_02</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span>Thm.dest_arg1</span><span> </span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cm</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_03</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_mul</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>is_semiring_constant</span></span><span class="main"><span>(</span></span><span>Thm.dest_arg1</span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>cm</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span>Thm.dest_arg1</span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_04</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>cm</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_05</span></span><span>
         </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm1</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span>
         </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm3</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm4</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>tm1</span></span><span>
         </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>tm3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>semiring_add_conv</span></span><span> </span><span class="entity"><span>tm4</span></span><span class="main"><span>)</span></span><span>
         </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th3</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>(</span></span><span>Drule.fun_cong_rule</span><span> </span><span class="entity"><span>th2</span></span><span> </span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span>
         </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tm5</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th3</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_arg1</span><span> </span><span class="entity"><span>tm5</span></span><span class="main"><span>)</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>zero_tm</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span>Thm.dest_arg</span><span> </span><span class="entity"><span>tm5</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_11</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>monomial_deone</span></span><span> </span><span class="entity"><span>th3</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* Ordering on monomials.                                                    *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>striplist</span></span><span> </span><span class="entity"><span>dest</span></span><span> </span><span class="main"><span>=</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>strip</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>acc</span></span><span> </span><span class="main"><span>=</span></span><span>
   </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>strip</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>strip</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="entity"><span>acc</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>x</span></span><span>::</span><span class="entity"><span>acc</span></span><span class="main"><span>)</span></span><span>    </span><span class="comment1"><span>(* FIXME !? *)</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>strip</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>


</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>powervars</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ptms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>striplist</span></span><span> </span><span class="entity"><span>dest_mul</span></span><span> </span><span class="entity"><span>tm</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_semiring_constant</span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>ptms</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>tl</span><span> </span><span class="entity"><span>ptms</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>ptms</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>num_0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>num_1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dest_varpow</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span>
 </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_pow</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span class="entity"><span>dest_number</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
   </span><span class="main"><span>(</span></span><span class="entity"><span>tm</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_semiring_constant</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>num_0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>num_1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>morder</span></span><span> </span><span class="main"><span>=</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>lexorder</span></span><span> </span><span class="entity"><span>ls</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>ls</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span> </span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_numeral"><span>~1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>x1</span></span><span class="main"><span>,</span></span><span class="entity"><span>n1</span></span><span class="main"><span>)</span></span><span>::</span><span class="entity"><span>vs1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>x2</span></span><span class="main"><span>,</span></span><span class="entity"><span>n2</span></span><span class="main"><span>)</span></span><span>::</span><span class="entity"><span>vs2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
     </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>variable_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x2</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
       </span><span>LESS</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span>GREATER</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_numeral"><span>~1</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span>EQUAL</span><span> </span><span class="main"><span>=&gt;</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n1</span></span><span> </span><span>&lt;</span><span> </span><span class="entity"><span>n2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_numeral"><span>~1</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n2</span></span><span> </span><span>&lt;</span><span> </span><span class="entity"><span>n1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>lexorder</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vs1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vs2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>tm1</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>tm2</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vdegs1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>dest_varpow</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>powervars</span></span><span> </span><span class="entity"><span>tm1</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vdegs2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>dest_varpow</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>powervars</span></span><span> </span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deg1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>Integer.add</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vdegs1</span></span><span> </span><span class="entity"><span>num_0</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deg2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>Integer.add</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vdegs2</span></span><span> </span><span class="entity"><span>num_0</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>deg1</span></span><span> </span><span>&lt;</span><span> </span><span class="entity"><span>deg2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>deg1</span></span><span> </span><span>&gt;</span><span> </span><span class="entity"><span>deg2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
                            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>lexorder</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vdegs1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vdegs2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* Addition of two polynomials.                                              *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>polynomial_add_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
 </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dezero_rule</span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
   </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span class="main"><span>(</span></span><span class="entity"><span>is_add</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lopr</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>tm</span></span><span>
       </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_arg</span><span> </span><span class="entity"><span>lopr</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>zero_tm</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_07</span></span><span class="main"><span>)</span></span><span>   </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>zero_tm</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_08</span></span><span class="main"><span>)</span></span><span>  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>th</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
 </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>padd</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
   </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_add</span></span><span> </span><span class="entity"><span>tm</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>zero_tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_07</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>zero_tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_08</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_add</span></span><span> </span><span class="entity"><span>l</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_add</span></span><span> </span><span class="entity"><span>l</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_add</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span class="entity"><span>d</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_add</span></span><span> </span><span class="entity"><span>r</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>morder</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="entity"><span>c</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span class="entity"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cb</span></span><span class="main"><span>,</span></span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cc</span></span><span class="main"><span>,</span></span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cd</span></span><span class="main"><span>,</span></span><span class="entity"><span>d</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_23</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm1</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm3</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm4</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>tm1</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>tm3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>monomial_add_conv</span></span><span> </span><span class="entity"><span>tm4</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>dezero_rule</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.combination</span><span> </span><span class="entity"><span>th2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>padd</span></span><span> </span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="comment1"><span>(* ord &lt;&gt; 0*)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span class="entity"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cb</span></span><span class="main"><span>,</span></span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cc</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_24</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cc</span></span><span class="main"><span>,</span></span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cd</span></span><span class="main"><span>,</span></span><span class="entity"><span>d</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_25</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm1</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>dezero_rule</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>(</span></span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>tm1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>padd</span></span><span> </span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="comment1"><span>(* not (is_add r)*)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>morder</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="entity"><span>r</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span class="entity"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cb</span></span><span class="main"><span>,</span></span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cc</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_26</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm1</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm3</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm4</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>tm1</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Drule.fun_cong_rule</span><span> </span><span class="main"><span>(</span></span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>tm3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>monomial_add_conv</span></span><span> </span><span class="entity"><span>tm4</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tm2</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>dezero_rule</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="entity"><span>th2</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="comment1"><span>(* ord &lt;&gt; 0*)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span class="entity"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cb</span></span><span class="main"><span>,</span></span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cc</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_24</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm1</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>dezero_rule</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>(</span></span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>tm1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>padd</span></span><span> </span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>dezero_rule</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cc</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_27</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="comment1"><span>(* not (is_add l)*)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_add</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span class="entity"><span>d</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_add</span></span><span> </span><span class="entity"><span>r</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span>  </span><span class="entity"><span>ord</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>morder</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="entity"><span>c</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cc</span></span><span class="main"><span>,</span></span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cd</span></span><span class="main"><span>,</span></span><span class="entity"><span>d</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_28</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm1</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm3</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm4</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>tm1</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Drule.fun_cong_rule</span><span> </span><span class="main"><span>(</span></span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>tm3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>monomial_add_conv</span></span><span> </span><span class="entity"><span>tm4</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tm2</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>dezero_rule</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="entity"><span>th2</span></span><span class="main"><span>)</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Thm.reflexive</span><span> </span><span class="entity"><span>tm</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cc</span></span><span class="main"><span>,</span></span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cd</span></span><span class="main"><span>,</span></span><span class="entity"><span>d</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_25</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm1</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>dezero_rule</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>(</span></span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>tm1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>padd</span></span><span> </span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>morder</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="entity"><span>r</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>monomial_add_conv</span></span><span> </span><span class="entity"><span>tm</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>dezero_rule</span></span><span class="main"><span>(</span></span><span>Thm.reflexive</span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>dezero_rule</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cc</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_27</span></span><span class="main"><span>)</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>padd</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* Multiplication of two polynomials.                                        *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>polynomial_mul_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pmul</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_mul</span></span><span> </span><span class="entity"><span>tm</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span class="main"><span>(</span></span><span class="entity"><span>is_add</span></span><span> </span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>polynomial_monomial_mul_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tm</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span class="main"><span>(</span></span><span class="entity"><span>is_add</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cb</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_09</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>polynomial_monomial_mul_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_add</span></span><span> </span><span class="entity"><span>l</span></span><span>
           </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span class="entity"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cb</span></span><span class="main"><span>,</span></span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cc</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_10</span></span><span>
           </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm1</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span>
           </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm3</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm4</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>tm1</span></span><span>
           </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>tm3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>polynomial_monomial_mul_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tm4</span></span><span class="main"><span>)</span></span><span>
           </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th3</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.combination</span><span> </span><span class="entity"><span>th2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pmul</span></span><span> </span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>polynomial_add_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th3</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_mul</span></span><span> </span><span class="entity"><span>tm</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>zero_tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_11</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>zero_tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_12</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>one_tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_13</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>one_tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ca</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_14</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>pmul</span></span><span> </span><span class="entity"><span>tm</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* Power of polynomial (optimized for the monomial and trivial cases).       *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>num_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>nat_add_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.apply</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../Nat.html#Nat.Suc|const"><span>Suc</span></a><span>›</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Numeral.mk_cnumber</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">ctyp</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../Nat.html#Nat.nat|type"><span>nat</span></a><span>›</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dest_number</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span>|&gt;</span><span> </span><span>Thm.symmetric</span><span class="main"><span>;</span></span><span>


</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>polynomial_pow_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>ppow</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span class="main"><span>,</span></span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_pow</span></span><span> </span><span class="entity"><span>tm</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>zeron_tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>cx</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_35</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>onen_tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>cx</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_36</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>num_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>n</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>cx</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>cq</span></span><span class="main"><span>,</span></span><span>Thm.dest_arg</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pthm_38</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm1</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th2</span></span><span class="main"><span>)</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th3</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th2</span></span><span> </span><span class="main"><span>(</span></span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>tm1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ppow</span></span><span> </span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th4</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.transitive</span><span> </span><span class="main"><span>(</span></span><span>Drule.arg_cong_rule</span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_fun</span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>th3</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th4</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>polynomial_mul_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th4</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_add</span></span><span class="main"><span>(</span></span><span>Thm.dest_arg1</span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>ppow</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>monomial_pow_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tm</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* Negation.                                                                 *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>polynomial_neg_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>neg_tm</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"polynomial_neg_conv"</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>tm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>cx'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>neg_mul</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>(</span></span><span>Conv.arg1_conv</span><span> </span><span class="entity"><span>semiring_mul_conv</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>polynomial_monomial_mul_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(* Subtraction.                                                              *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>polynomial_sub_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_sub</span></span><span> </span><span class="entity"><span>tm</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inst_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>cx'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cy'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>sub_add</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm1</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>tm1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>polynomial_neg_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tm2</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.transitive</span><span> </span><span class="entity"><span>th2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>polynomial_add_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* Conversion from HOL term.                                                 *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>polynomial_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_semiring_constant</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>semiring_add_conv</span></span><span> </span><span class="entity"><span>tm</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span class="main"><span>(</span></span><span class="entity"><span>is_comb</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Thm.reflexive</span><span> </span><span class="entity"><span>tm</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lopr</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>tm</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>lopr</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>neg_tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>lopr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>polynomial_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>polynomial_neg_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>lopr</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>inverse_tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>lopr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>polynomial_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>semiring_mul_conv</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span class="main"><span>(</span></span><span class="entity"><span>is_comb</span></span><span> </span><span class="entity"><span>lopr</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Thm.reflexive</span><span> </span><span class="entity"><span>tm</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>opr</span></span><span class="main"><span>,</span></span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>lopr</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>opr</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>pow_tm</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>is_number</span></span><span> </span><span class="entity"><span>r</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Drule.fun_cong_rule</span><span> </span><span class="main"><span>(</span></span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>opr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>polynomial_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>r</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>polynomial_pow_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>opr</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>divide_tm</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.combination</span><span> </span><span class="main"><span>(</span></span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>opr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>polynomial_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                                        </span><span class="main"><span>(</span></span><span class="entity"><span>polynomial_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>Conv.rewr_conv</span><span> </span><span class="entity"><span>divide_inverse</span></span><span> </span><span>then_conv</span><span> </span><span class="entity"><span>polynomial_mul_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
                              </span><span class="main"><span>(</span></span><span>Thm.rhs_of</span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="entity"><span>th2</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>opr</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>add_tm</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>opr</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>mul_tm</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>opr</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>sub_tm</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>=</span></span><span>
                    </span><span>Thm.combination</span><span>
                      </span><span class="main"><span>(</span></span><span>Drule.arg_cong_rule</span><span> </span><span class="entity"><span>opr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>polynomial_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>polynomial_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span>
                   </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>opr</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>add_tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>polynomial_add_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
                      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>opr</span></span><span> </span><span>aconvc</span><span> </span><span class="entity"><span>mul_tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>polynomial_mul_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
                      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>polynomial_sub_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.transitive</span><span> </span><span class="entity"><span>th1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Thm.reflexive</span><span> </span><span class="entity"><span>tm</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
   </span><span class="main"><span>{</span></span><span>main </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>polynomial_conv</span></span><span class="main"><span>,</span></span><span>
    add </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>polynomial_add_conv</span></span><span class="main"><span>,</span></span><span>
    mul </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>polynomial_mul_conv</span></span><span class="main"><span>,</span></span><span>
    pow </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>polynomial_pow_conv</span></span><span class="main"><span>,</span></span><span>
    neg </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>polynomial_neg_conv</span></span><span class="main"><span>,</span></span><span>
    sub </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>polynomial_sub_conv</span></span><span class="main"><span>}</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nat_exp_ss</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>simpset_of</span><span>
   </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span><span class="hidden">\&lt;^</span><span class="control">context</span><span class="hidden">&gt;</span></span></span></span></span><span>
    </span><span>addsimps</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../Num.html#Num.eval_nat_numeral|fact"><span>eval_nat_numeral</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../Int.html#Int.diff_nat_numeral|fact"><span>diff_nat_numeral</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../Num.html#Num.arith_simps|fact"><span>arith_simps</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../Num.html#Num.rel_simps|fact"><span>rel_simps</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
    </span><span>addsimps</span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../HOL.html#HOL.Let_def|fact"><span>Let_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../HOL.html#HOL.if_False|fact"><span>if_False</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../HOL.html#HOL.if_True|fact"><span>if_True</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../Nat.html#Nat.plus_nat.add_0|fact"><span>Nat.add_0</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../Nat.html#Nat.plus_nat.add_Suc|fact"><span>add_Suc</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(* various normalizing conversions *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>semiring_normalizers_ord_wrapper</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="entity"><span>vars</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>semiring</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ring</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>field</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idom</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ideal</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span>
                                     </span><span class="main"><span>{</span></span><span class="entity"><span>conv</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dest_const</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_const</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>is_const</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>term_ord</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pow_conv</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Conv.arg_conv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Simplifier.rewrite</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>nat_exp_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>then_conv</span><span> </span><span class="entity"><span>Simplifier.rewrite</span></span><span>
        </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>addsimps</span><span> </span><span class="main"><span>[</span></span><span>nth</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>semiring</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>31</span></span><span class="main"><span>,</span></span><span> </span><span>nth</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>semiring</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>34</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span>then_conv</span><span> </span><span class="entity"><span>conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dat</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_const</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pow_conv</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>semiring_normalizers_conv</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>semiring</span></span><span> </span><span class="entity"><span>ring</span></span><span> </span><span class="entity"><span>field</span></span><span> </span><span class="entity"><span>dat</span></span><span> </span><span class="entity"><span>term_ord</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>semiring_normalize_ord_wrapper</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
  </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="entity"><span>vars</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>semiring</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ring</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>field</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idom</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ideal</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>conv</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dest_const</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_const</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>is_const</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>term_ord</span></span><span> </span><span class="main"><span>=</span></span><span>
 </span><span class="main"><span>#</span></span><span>main </span><span class="main"><span>(</span></span><span class="entity"><span>semiring_normalizers_ord_wrapper</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
  </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span>vars </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>,</span></span><span> semiring </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>semiring</span></span><span class="main"><span>,</span></span><span> ring </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ring</span></span><span class="main"><span>,</span></span><span> field </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>field</span></span><span class="main"><span>,</span></span><span> idom </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>idom</span></span><span class="main"><span>,</span></span><span> ideal </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ideal</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span>
   </span><span class="main"><span>{</span></span><span>conv </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>conv</span></span><span class="main"><span>,</span></span><span> dest_const </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_const</span></span><span class="main"><span>,</span></span><span> mk_const </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_const</span></span><span class="main"><span>,</span></span><span> is_const </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_const</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>term_ord</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>semiring_normalize_wrapper</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>semiring_normalize_ord_wrapper</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span>Thm.term_ord</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>semiring_normalize_ord_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>match</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Thm.reflexive</span><span> </span><span class="entity"><span>tm</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>res</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>semiring_normalize_ord_wrapper</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>res</span></span><span> </span><span class="entity"><span>ord</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>semiring_normalize_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>semiring_normalize_ord_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>Thm.term_ord</span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span></pre>
</body>

</html>