<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Tools/Sledgehammer/sledgehammer_prover.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Tools/Sledgehammer/sledgehammer_prover.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      HOL/Tools/Sledgehammer/sledgehammer_prover.ML
    Author:     Fabian Immler, TU Muenchen
    Author:     Makarius
    Author:     Jasmin Blanchette, TU Muenchen

Generic prover abstraction for Sledgehammer.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>SLEDGEHAMMER_PROVER</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>atp_failure</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ATP_Proof.atp_failure</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>stature</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ATP_Problem_Generate.stature</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>type_enc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ATP_Problem_Generate.type_enc</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>fact</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Sledgehammer_Fact.fact</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>proof_method</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Sledgehammer_Proof_Methods.proof_method</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>play_outcome</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Sledgehammer_Proof_Methods.play_outcome</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>base_slice</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Sledgehammer_ATP_Systems.base_slice</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>atp_slice</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Sledgehammer_ATP_Systems.atp_slice</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Auto_Try</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Try</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Normal</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Minimize</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>MaSh</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>induction_rules</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Include</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Exclude</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Instantiate</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> induction_rules_of_string </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>induction_rules</span></span><span> </span><span>option</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> maybe_filter_out_induction_rules </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>induction_rules</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fact</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fact</span></span><span> </span><span>list</span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>{</span></span><span>debug </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     verbose </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     overlord </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     spy </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     provers </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     abduce </span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
     falsify </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
     type_enc </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
     strict </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     lam_trans </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
     uncurried_aliases </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
     learn </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     fact_filter </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
     induction_rules </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>induction_rules</span></span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
     max_facts </span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
     fact_thresholds </span><span class="main"><span>:</span></span><span> </span><span>real</span><span> * </span><span>real</span><span class="main"><span>,</span></span><span>
     max_mono_iters </span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
     max_new_mono_instances </span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
     max_proofs </span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
     isar_proofs </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
     compress </span><span class="main"><span>:</span></span><span> </span><span>real</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
     try0 </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     smt_proofs </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     minimize </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     slices </span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
     timeout </span><span class="main"><span>:</span></span><span> </span><span>Time.time</span><span class="main"><span>,</span></span><span>
     preplay_timeout </span><span class="main"><span>:</span></span><span> </span><span>Time.time</span><span class="main"><span>,</span></span><span>
     expect </span><span class="main"><span>:</span></span><span> </span><span>string</span><span class="main"><span>}</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> string_of_params </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> slice_timeout </span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>Time.time</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>Time.time</span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>prover_problem</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>{</span></span><span>comment </span><span class="main"><span>:</span></span><span> </span><span>string</span><span class="main"><span>,</span></span><span>
     state </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.state</span></span><span class="main"><span>,</span></span><span>
     goal </span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
     subgoal </span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
     subgoal_count </span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
     factss </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span class="entity"><span>fact</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     has_already_found_something </span><span class="main"><span>:</span></span><span> </span><span>unit</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
     found_something </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>unit</span><span class="main"><span>}</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>prover_slice_extra</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>ATP_Slice</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> atp_slice
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SMT_Slice</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string list

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>prover_slice</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>base_slice</span></span><span> * </span><span class="entity"><span>prover_slice_extra</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>prover_result</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>{</span></span><span>outcome </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>atp_failure</span></span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
     used_facts </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span class="entity"><span>stature</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     used_from </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>fact</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     preferred_methss </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>proof_method</span></span><span> * </span><span class="entity"><span>proof_method</span></span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     run_time </span><span class="main"><span>:</span></span><span> </span><span>Time.time</span><span class="main"><span>,</span></span><span>
     message </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>unit</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span class="entity"><span>stature</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span> * </span><span class="main"><span>(</span></span><span class="entity"><span>proof_method</span></span><span> * </span><span class="entity"><span>play_outcome</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span class="main"><span>}</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>prover</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>prover_problem</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>prover_slice</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>prover_result</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> SledgehammerN </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> default_abduce_max_candidates </span><span class="main"><span>:</span></span><span> </span><span>int</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> str_of_mode </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> overlord_file_location_of_prover </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> * </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> proof_banner </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_atp </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> bunches_of_proof_methods </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>proof_method</span></span><span> </span><span>list</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> facts_of_filter </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span class="entity"><span>fact</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fact</span></span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> facts_of_basic_slice </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>base_slice</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span class="entity"><span>fact</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fact</span></span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_fact_chained </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>'a * </span><span class="entity"><span>stature</span></span><span class="main"><span>)</span></span><span> * 'b</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> filter_used_facts </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>''a * </span><span class="entity"><span>stature</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>''a * </span><span class="entity"><span>stature</span></span><span class="main"><span>)</span></span><span> * 'b</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>''a * </span><span class="entity"><span>stature</span></span><span class="main"><span>)</span></span><span> * 'b</span><span class="main"><span>)</span></span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> repair_monomorph_context </span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>option</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span>option</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="entity"><span>Proof.context</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> supported_provers </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>unit</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Sledgehammer_Prover</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>SLEDGEHAMMER_PROVER</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>ATP_Proof</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>ATP_Util</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>ATP_Problem</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>ATP_Problem_Generate</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>ATP_Proof_Reconstruct</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Metis_Tactic</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Sledgehammer_Fact</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Sledgehammer_Proof_Methods</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Sledgehammer_ATP_Systems</span><span>

</span><span class="comment1"><span>(* Identifier that distinguishes Sledgehammer from other tools that could use "Async_Manager". *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>SledgehammerN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Sledgehammer"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>default_abduce_max_candidates</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Auto_Try</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Try</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Normal</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Minimize</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>MaSh</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>str_of_mode</span></span><span> </span><span class="entity"><span>Auto_Try</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Auto Try"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_mode</span></span><span> </span><span class="entity"><span>Try</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Try"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_mode</span></span><span> </span><span class="entity"><span>Normal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Normal"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_mode</span></span><span> </span><span class="entity"><span>Minimize</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Minimize"</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>str_of_mode</span></span><span> </span><span class="entity"><span>MaSh</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"MaSh"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>induction_rules</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Include</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Exclude</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Instantiate</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>induction_rules_of_string</span></span><span> </span><span class="inner_quoted"><span>"include"</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>Include</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>induction_rules_of_string</span></span><span> </span><span class="inner_quoted"><span>"exclude"</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>Exclude</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>induction_rules_of_string</span></span><span> </span><span class="inner_quoted"><span>"instantiate"</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>Instantiate</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>induction_rules_of_string</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>is_atp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>all_atps</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>debug </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   verbose </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   overlord </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   spy </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   provers </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   abduce </span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
   falsify </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
   type_enc </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
   strict </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   lam_trans </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
   uncurried_aliases </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
   learn </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   fact_filter </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
   induction_rules </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>induction_rules</span></span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
   max_facts </span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
   fact_thresholds </span><span class="main"><span>:</span></span><span> </span><span>real</span><span> * </span><span>real</span><span class="main"><span>,</span></span><span>
   max_mono_iters </span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
   max_new_mono_instances </span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
   max_proofs </span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
   isar_proofs </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
   compress </span><span class="main"><span>:</span></span><span> </span><span>real</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
   try0 </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   smt_proofs </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   minimize </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   slices </span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
   timeout </span><span class="main"><span>:</span></span><span> </span><span>Time.time</span><span class="main"><span>,</span></span><span>
   preplay_timeout </span><span class="main"><span>:</span></span><span> </span><span>Time.time</span><span class="main"><span>,</span></span><span>
   expect </span><span class="main"><span>:</span></span><span> </span><span>string</span><span class="main"><span>}</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>string_of_params</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>YXML.content_of</span><span> </span><span class="main"><span>(</span></span><span>ML_Pretty.string_of_polyml</span><span> </span><span class="main"><span>(</span></span><span>ML_system_pretty</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>params</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>100</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>maybe_filter_out_induction_rules</span></span><span> </span><span class="entity"><span>induction_rules</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>fact</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fact</span></span><span> </span><span>list</span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>induction_rules</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Exclude</span></span><span> </span><span>?</span><span>
    </span><span>filter_out</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ATP_Problem_Generate.Induction</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>slice_timeout</span></span><span> </span><span class="entity"><span>slice_size</span></span><span> </span><span class="entity"><span>slices</span></span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>max_threads</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Multithreading.max_threads</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>batches</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>slices</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>max_threads</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>div</span><span> </span><span class="entity"><span>max_threads</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>seconds</span><span> </span><span class="main"><span>(</span></span><span>Real.fromInt</span><span> </span><span class="entity"><span>slice_size</span></span><span> </span><span>*</span><span> </span><span>Time.toReal</span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span>/</span><span> </span><span>Real.fromInt</span><span> </span><span class="entity"><span>batches</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>prover_problem</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>comment </span><span class="main"><span>:</span></span><span> </span><span>string</span><span class="main"><span>,</span></span><span>
   state </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.state</span></span><span class="main"><span>,</span></span><span>
   goal </span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
   subgoal </span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
   subgoal_count </span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
   factss </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span class="entity"><span>fact</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   has_already_found_something </span><span class="main"><span>:</span></span><span> </span><span>unit</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span class="main"><span>,</span></span><span>
   found_something </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>unit</span><span class="main"><span>}</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>prover_slice_extra</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>ATP_Slice</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> atp_slice
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>SMT_Slice</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> string list

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>prover_slice</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>base_slice</span></span><span> * </span><span class="entity"><span>prover_slice_extra</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>prover_result</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>outcome </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>atp_failure</span></span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
   used_facts </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span class="entity"><span>stature</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   used_from </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>fact</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   preferred_methss </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>proof_method</span></span><span> * </span><span class="entity"><span>proof_method</span></span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   run_time </span><span class="main"><span>:</span></span><span> </span><span>Time.time</span><span class="main"><span>,</span></span><span>
   message </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>unit</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span class="entity"><span>stature</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span> * </span><span class="main"><span>(</span></span><span class="entity"><span>proof_method</span></span><span> * </span><span class="entity"><span>play_outcome</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span class="main"><span>}</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>prover</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>prover_problem</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>prover_slice</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>prover_result</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>overlord_file_location_of_prover</span></span><span> </span><span class="entity"><span>prover</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>getenv</span><span> </span><span class="inner_quoted"><span>"ISABELLE_HOME_USER"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"prob_"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>prover</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>proof_banner</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="entity"><span>prover_name</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="entity"><span>Auto_Try</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"Auto Sledgehammer ("</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>prover_name</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>") found a proof: "</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Try</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"Sledgehammer ("</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>prover_name</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>") found a proof: "</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"Try this: "</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>bunches_of_proof_methods</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>smt_proofs</span></span><span> </span><span class="entity"><span>needs_full_types</span></span><span> </span><span class="entity"><span>desperate_lam_trans</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>misc_methodss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="entity"><span>Simp_Method</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Auto_Method</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Blast_Method</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Linarith_Method</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Meson_Method</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>Metis_Method</span></span><span> </span><span class="main"><span>(</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Fastforce_Method</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Force_Method</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Presburger_Method</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>metis_methodss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>[</span></span><span class="entity"><span>Metis_Method</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>full_typesN</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span>::</span><span>
       </span><span class="entity"><span>Metis_Method</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>really_full_type_enc</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>desperate_lam_trans</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span>
       </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>needs_full_types</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="main"><span>[</span></span><span class="entity"><span>Metis_Method</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>really_full_type_enc</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="entity"><span>Metis_Method</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>full_typesN</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>desperate_lam_trans</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
          </span><span class="main"><span>[</span></span><span class="entity"><span>Metis_Method</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>no_typesN</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>desperate_lam_trans</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>smt_methodss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>smt_proofs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="main"><span>[</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>SMT_Method</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>SMT_Verit</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Verit_Strategies.all_veriT_stgies</span></span><span> </span><span class="main"><span>(</span></span><span>Context.Proof</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
         </span><span class="main"><span>[</span></span><span class="entity"><span>SMT_Method</span></span><span> </span><span class="entity"><span>SMT_Z3</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>misc_methodss</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>metis_methodss</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>smt_methodss</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>facts_of_filter</span></span><span> </span><span class="entity"><span>fact_filter</span></span><span> </span><span class="entity"><span>factss</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>AList.lookup</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>factss</span></span><span> </span><span class="entity"><span>fact_filter</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span>SOME</span><span> </span><span class="entity"><span>facts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>facts</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>snd</span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>factss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>facts_of_basic_slice</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>num_facts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fact_filter</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>factss</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>facts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>facts_of_filter</span></span><span> </span><span class="entity"><span>fact_filter</span></span><span> </span><span class="entity"><span>factss</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>goal_facts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nongoal_facts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>List.partition</span><span> </span><span class="main"><span>(</span></span><span>equal</span><span> </span><span class="entity"><span>sledgehammer_goal_as_fact</span></span><span> </span><span>o</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>facts</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>goal_facts</span></span><span> </span><span>@</span><span> </span><span>take</span><span> </span><span class="entity"><span>num_facts</span></span><span> </span><span class="entity"><span>nongoal_facts</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_fact_chained</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sc</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Chained</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>filter_used_facts</span></span><span> </span><span class="entity"><span>keep_chained</span></span><span> </span><span class="entity"><span>used</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>member</span><span> </span><span class="main"><span>(</span></span><span>eq_fst</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>used</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span>orf</span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>keep_chained</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>is_fact_chained</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>K</span><span> </span><span>false</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>max_fact_instances</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>10</span></span><span> </span><span class="comment1"><span>(* FUDGE *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>max_schematics</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>20</span></span><span> </span><span class="comment1"><span>(* FUDGE *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>repair_monomorph_context</span></span><span> </span><span class="entity"><span>max_iters</span></span><span> </span><span class="entity"><span>best_max_iters</span></span><span> </span><span class="entity"><span>max_new_instances</span></span><span> </span><span class="entity"><span>best_max_new_instances</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Config.put</span><span> </span><span class="entity"><span>Monomorph.max_rounds</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>max_iters</span></span><span> </span><span>|&gt;</span><span> </span><span>the_default</span><span> </span><span class="entity"><span>best_max_iters</span></span><span class="main"><span>)</span></span><span>
  </span><span>#&gt;</span><span> </span><span>Config.put</span><span> </span><span class="entity"><span>Monomorph.max_new_instances</span></span><span>
       </span><span class="main"><span>(</span></span><span class="entity"><span>max_new_instances</span></span><span> </span><span>|&gt;</span><span> </span><span>the_default</span><span> </span><span class="entity"><span>best_max_new_instances</span></span><span class="main"><span>)</span></span><span>
  </span><span>#&gt;</span><span> </span><span>Config.put</span><span> </span><span class="entity"><span>Monomorph.max_thm_instances</span></span><span> </span><span class="entity"><span>max_fact_instances</span></span><span>
  </span><span>#&gt;</span><span> </span><span>Config.put</span><span> </span><span class="entity"><span>Monomorph.max_schematics</span></span><span> </span><span class="entity"><span>max_schematics</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>supported_provers</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>local_provers</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>sort_strings</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>local_atps</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>SMT_Config.available_solvers_of</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>remote_provers</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>sort_strings</span><span> </span><span class="entity"><span>remote_atps</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>writeln</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Supported provers: "</span></span><span> </span><span>^</span><span> </span><span>commas</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>local_provers</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>remote_provers</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span></pre>
</body>

</html>