<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Tools/BNF/bnf_lift.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Tools/BNF/bnf_lift.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      HOL/Tools/BNF/bnf_lift.ML
    Author:     Julian Biendarra, TU Muenchen
    Author:     Basil Fürer, ETH Zurich
    Author:     Joshua Schneider, ETH Zurich
    Author:     Dmitriy Traytel, ETH Zurich
    Copyright   2015, 2019

Lifting of BNFs through typedefs.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>BNF_LIFT</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>lift_bnf_option</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Plugins_Option</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> Proof.context </span><span class="main"><span>-&gt;</span></span><span> Plugin_Name.filter
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>No_Warn_Wits</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>No_Warn_Transfer</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> copy_bnf</span><span class="main"><span>:</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>lift_bnf_option</span></span><span> </span><span>list</span><span> * </span><span class="main"><span>(</span></span><span>binding</span><span> </span><span>option</span><span> * </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>sort</span><span> </span><span>option</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> *
      </span><span>string</span><span class="main"><span>)</span></span><span> * </span><span>thm</span><span> </span><span>option</span><span class="main"><span>)</span></span><span> * </span><span class="main"><span>(</span></span><span>binding</span><span> * </span><span>binding</span><span> * </span><span>binding</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>
      </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> copy_bnf_cmd</span><span class="main"><span>:</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>lift_bnf_option</span></span><span> </span><span>list</span><span> * </span><span class="main"><span>(</span></span><span>binding</span><span> </span><span>option</span><span> * </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>string</span><span> </span><span>option</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> *
      </span><span>string</span><span class="main"><span>)</span></span><span> * </span><span class="main"><span>(</span></span><span>Facts.ref</span><span> * </span><span>Token.src</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>option</span><span class="main"><span>)</span></span><span> * </span><span class="main"><span>(</span></span><span>binding</span><span> * </span><span>binding</span><span> * </span><span>binding</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>
      </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> lift_bnf</span><span class="main"><span>:</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>lift_bnf_option</span></span><span> </span><span>list</span><span> * </span><span class="main"><span>(</span></span><span>binding</span><span> </span><span>option</span><span> * </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>sort</span><span> </span><span>option</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> *
      </span><span>string</span><span class="main"><span>)</span></span><span> * </span><span>term</span><span> </span><span>list</span><span> </span><span>option</span><span class="main"><span>)</span></span><span> * </span><span>thm</span><span> </span><span>list</span><span> </span><span>option</span><span class="main"><span>)</span></span><span> * </span><span class="main"><span>(</span></span><span>binding</span><span> * </span><span>binding</span><span> * </span><span>binding</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span class="main"><span>,</span></span><span> prems</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>}</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
      </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> lift_bnf_cmd</span><span class="main"><span>:</span></span><span>
     </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>lift_bnf_option</span></span><span> </span><span>list</span><span> * </span><span class="main"><span>(</span></span><span>binding</span><span> </span><span>option</span><span> * </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>string</span><span> </span><span>option</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> *
       </span><span>string</span><span class="main"><span>)</span></span><span> * </span><span>string</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> * </span><span class="main"><span>(</span></span><span>Facts.ref</span><span> * </span><span>Token.src</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span>option</span><span class="main"><span>)</span></span><span> *
       </span><span class="main"><span>(</span></span><span>binding</span><span> * </span><span>binding</span><span> * </span><span>binding</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.state</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>BNF_Lift</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>BNF_LIFT</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Ctr_Sugar_Tactics</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>BNF_Util</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>BNF_Comp</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>BNF_Def</span><span>


</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>lift_bnf_option</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Plugins_Option</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> Proof.context </span><span class="main"><span>-&gt;</span></span><span> Plugin_Name.filter
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>No_Warn_Wits</span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>No_Warn_Transfer</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>equiv_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Typedef</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Quotient</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> thm

</span><span class="comment1"><span>(** Util **)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>last2</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>last2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>last2</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span>|&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>last2</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Match</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>strip3</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Term.strip_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.dest_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.prop_of</span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x3</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x3</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"strip3: wrong number of arguments"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_Free</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>yield_singleton</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_Frees</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>TWICE</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>fvars</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fvars</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>context</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>context</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(** Term construction **)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_relT</span></span><span> </span><span class="entity"><span>aT</span></span><span> </span><span class="entity"><span>bT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>aT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>bT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_relcompp</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sT</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apply2</span><span> </span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>xT</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>zTs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apply2</span><span> </span><span>dest_funT</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sT</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>sT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>mk_relT</span></span><span> </span><span class="entity"><span>xT</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>dest_funT</span><span> </span><span class="entity"><span>zTs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcompp|const"><span>relcompp</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>r</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_OO</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span class="entity"><span>mk_relcompp</span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* option from sum *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_MaybeT</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_sumT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.unitT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_Nothing</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>BNF_FP_Util.mk_Inl</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>HOLogic.unit</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Just_const</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>BNF_FP_Util.Inr_const</span></span><span> </span><span class="entity"><span>HOLogic.unitT</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_Just</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Just_const</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>Maybe_map_const</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>yT</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>dest_funT</span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../Sum_Type.html#Sum_Type.map_sum|const"><span>map_sum</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.unitT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.unitT</span></span><span class="main"><span>)</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>mk_MaybeT</span></span><span> </span><span class="entity"><span>xT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>mk_MaybeT</span></span><span> </span><span class="entity"><span>yT</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span>
      </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>HOLogic.unitT</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_Maybe_map</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Maybe_map_const</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fromJust_const</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../Sum_Type.html#Sum_Type.sum.projr|const"><span>sum.projr</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_MaybeT</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rel_Maybe_const</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.rel_sum|const"><span>rel_sum</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.unitT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.unitT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span> </span><span>--&gt;</span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>U</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>mk_MaybeT</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>mk_MaybeT</span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span>
  </span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span class="entity"><span>HOLogic.unitT</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>set_Maybe_const</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../Basic_BNFs.html#Basic_BNFs.setr|const"><span>Basic_BNFs.setr</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_MaybeT</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>Inf_const</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../Complete_Lattices.html#Complete_Lattices.Inf_class.Inf|const"><span>Inf</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>Image_const</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>relT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_prodT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>setT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.Image|const"><span>Image</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>relT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>setT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>setT</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>bot_const</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.bot_class.bot|const"><span>bot</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_insert</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>S</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.insert|const"><span>Set.insert</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>--&gt;</span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>S</span></span><span> </span><span>--&gt;</span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>S</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>S</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_vimage</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>yT</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>dest_funT</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.vimage|const"><span>vimage</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>yT</span></span><span class="main"><span>)</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>yT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>xT</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>s</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_case_prod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
     </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xT</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>yT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apply2</span><span> </span><span>dest_Free</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
     </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prodT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_prodT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>yT</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>HOLogic.Collect_const</span></span><span> </span><span class="entity"><span>prodT</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.prod.case_prod|const"><span>case_prod</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="entity"><span>xT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>yT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>prodT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xT</span></span><span class="main"><span>)</span></span><span>
       </span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>yT</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_Trueprop_implies</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_Collect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>dest_Free</span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
  </span><span class="entity"><span>HOLogic.mk_Collect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(** witnesses **)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prepare_wits</span></span><span> </span><span class="entity"><span>is_quotient</span></span><span> </span><span class="entity"><span>RepT</span></span><span> </span><span class="entity"><span>wits</span></span><span> </span><span class="entity"><span>opts</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>wits_F</span></span><span> </span><span class="entity"><span>var_as</span></span><span> </span><span class="entity"><span>var_as'</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>binder_types_until_eq</span></span><span> </span><span class="entity"><span>V</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>strip</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TU</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"fun"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>V</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>TU</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>strip</span></span><span> </span><span class="entity"><span>U</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>strip</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>V</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
              </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Bad type for witness: "</span></span><span> </span><span>^</span><span> </span><span>quote</span><span> </span><span class="main"><span>(</span></span><span>Syntax.string_of_typ</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>strip</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Iwits</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>the_default</span><span> </span><span class="entity"><span>wits_F</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>`</span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span>find_index</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alphas</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>binder_types_until_eq</span></span><span> </span><span class="entity"><span>RepT</span></span><span> </span><span>o</span><span> </span><span>fastype_of</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>wits</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Iwits</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_quotient</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subsumed_Iwits</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>J</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>subset</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>J</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>wits_F</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Iwits</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>subsumed_Iwits</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>No_Warn_Wits</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>opts</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suffix1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>suffix2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>be</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>subsumed_Iwits</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"is"</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"s"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"es"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"are"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span class="entity"><span>subsumed_Iwits</span></span><span>
                </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Syntax.pretty_typ</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span>o</span><span> </span><span>fastype_of</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span>Pretty.big_list</span><span>
                  </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"The following type"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>suffix1</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" of nonemptiness witness"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>suffix2</span></span><span> </span><span>^</span><span>
                    </span><span class="inner_quoted"><span>" of the raw type's BNF "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>be</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" subsumed by the existing raw witnesses:"</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Pretty.chunks</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>pt</span></span><span class="main"><span>,</span></span><span>
                  </span><span>Pretty.para</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"You do not need to lift these subsumed witnesses."</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span>Pretty.string_of</span><span>
                </span><span>|&gt;</span><span> </span><span>warning</span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span>filter_out</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>J</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>subset</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>J</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>wits_F</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Iwits</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>Iwits</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wit_goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BNF_Def.mk_wit_goals</span></span><span> </span><span class="entity"><span>var_as</span></span><span> </span><span class="entity"><span>var_as'</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Iwits</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lost_wits</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_quotient</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span>filter_out</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>J</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>subset</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>J</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Iwits</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>wits_F</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>lost_wits</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>No_Warn_Wits</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>opts</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>what</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_quotient</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"quotient type"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"typedef"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suffix1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>suffix2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>be</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>lost_wits</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"was"</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"s"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"es"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"were"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="entity"><span>lost_wits</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Syntax.pretty_typ</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span>o</span><span> </span><span>fastype_of</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Pretty.big_list</span><span>
            </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"The following type"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>suffix1</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" of nonemptiness witness"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>suffix2</span></span><span> </span><span>^</span><span>
              </span><span class="inner_quoted"><span>" of the raw type's BNF "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>be</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" lost:"</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Pretty.chunks</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>pt</span></span><span class="main"><span>,</span></span><span>
            </span><span>Pretty.para</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"You can specify a liftable witness (e.g., a term of one of the above types\
              \ that satisfies the "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>what</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"'s invariant)\
              \ using the annotation [wits: &lt;term&gt;]."</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Pretty.string_of</span><span>
          </span><span>|&gt;</span><span> </span><span>warning</span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Iwits</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit_goals</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(** transfer theorems **)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_transfer_thms'</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="entity"><span>consts</span></span><span> </span><span class="entity"><span>Tss</span></span><span> </span><span class="entity"><span>crel_def</span></span><span> </span><span class="entity"><span>pcrel_def</span></span><span> </span><span class="entity"><span>defs</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alphas </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pcrel_tm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>crel_tm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span>Thm.prop_of</span><span> </span><span>#&gt;</span><span> </span><span>Logic.dest_equals</span><span> </span><span>#&gt;</span><span> </span><span>fst</span><span> </span><span>#&gt;</span><span> </span><span>head_of</span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>pcrel_def</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>crel_def</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_Qs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_Rs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span>Variable.declare_typ</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alphas </span><span class="entity"><span>Tss</span></span><span> </span><span>@</span><span> </span><span class="main"><span>#</span></span><span>deads </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"Q"</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_relT</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alphas </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>betas </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"R"</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_relT</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>gammas </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>deltas </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>fst</span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* get the "pcrel :: args_raw =&gt; rep =&gt; abs ⇒ bool" term and instantiate types *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>args_raw</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rep</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>abs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pcrel_tm</span></span><span>
      </span><span>|&gt;</span><span> </span><span>fastype_of</span><span>
      </span><span>|&gt;</span><span> </span><span>binder_types</span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>last2</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyenv_match</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Vartab.empty</span><span>
      </span><span>|&gt;</span><span> </span><span>Sign.typ_match</span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>rep</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>rep </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Sign.typ_match</span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>abs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>abs </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Envir.subst_type</span><span> </span><span class="entity"><span>tyenv_match</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args_raw</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pcrel_a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pcrel_b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Envir.subst_term</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyenv_match</span></span><span class="main"><span>,</span></span><span> </span><span>Vartab.empty</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pcrel_tm</span></span><span>
      </span><span>|&gt;</span><span> </span><span>`</span><span class="main"><span>(</span></span><span>subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alphas </span><span class="entity"><span>Tss</span></span><span> </span><span>@</span><span> </span><span class="main"><span>#</span></span><span>betas </span><span class="entity"><span>Tss</span></span><span> </span><span>~~</span><span> </span><span class="main"><span>#</span></span><span>gammas </span><span class="entity"><span>Tss</span></span><span> </span><span>@</span><span> </span><span class="main"><span>#</span></span><span>deltas </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* match "crel :: {?a F} ⇒ a G" with "rep_G :: {a F}" *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyenv_match</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Vartab.empty</span><span> </span><span>|&gt;</span><span> </span><span>Sign.typ_match</span><span> </span><span class="entity"><span>thy</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>crel_tm</span></span><span> </span><span>|&gt;</span><span> </span><span>fastype_of</span><span> </span><span>|&gt;</span><span> </span><span>binder_types</span><span> </span><span>|&gt;</span><span> </span><span>hd</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>rep </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>crel_b</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Envir.subst_term</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyenv_match</span></span><span class="main"><span>,</span></span><span> </span><span>Vartab.empty</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>crel_tm</span></span><span>
      </span><span>|&gt;</span><span> </span><span>subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alphas </span><span class="entity"><span>Tss</span></span><span> </span><span>~~</span><span> </span><span class="main"><span>#</span></span><span>betas </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>crel_d</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>betas </span><span class="entity"><span>Tss</span></span><span> </span><span>~~</span><span> </span><span class="main"><span>#</span></span><span>deltas </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>crel_b</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* instantiate pcrel with Qs and Rs*)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dead_args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>binder_types</span><span> </span><span class="entity"><span>args</span></span><span>
      </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span class="entity"><span>U</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parametrize</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>go</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>T</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>dTs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>go</span></span><span> </span><span class="entity"><span>dTs</span></span><span> </span><span class="entity"><span>tms</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>go</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>dTs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tm</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>tms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>go</span></span><span> </span><span class="entity"><span>dTs</span></span><span> </span><span class="entity"><span>tms</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>go</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>dTs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>go</span></span><span> </span><span class="entity"><span>dTs</span></span><span> </span><span class="entity"><span>tms</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>go</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>go</span></span><span> </span><span class="entity"><span>dead_args</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pcrel_Qs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pcrel_b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>parametrize</span></span><span> </span><span class="entity"><span>var_Qs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pcrel_Rs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pcrel_a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>parametrize</span></span><span> </span><span class="entity"><span>var_Rs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* get the order of the dead variables right *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ds0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>maps</span><span> </span><span>the_list</span><span> </span><span class="entity"><span>dead_args</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>permute_Ds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_T_of_bnf</span></span><span> </span><span class="entity"><span>Ds0</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>betas </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span class="main"><span>,</span></span><span> </span><span>nth</span><span> </span><span class="main"><span>(</span></span><span>binder_types</span><span> </span><span class="main"><span>(</span></span><span>type_of</span><span> </span><span class="entity"><span>pcrel_Qs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span>~~</span><span> </span><span>|&gt;</span><span> </span><span>typ_subst_atomic</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ds0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>permute_Ds</span></span><span> </span><span class="entity"><span>Ds0</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* terms for sets of the set_transfer thms *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_sets_Q</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>aT</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bT</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Q</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="entity"><span>mk_rel</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>aT</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>bT</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.rel_set|const"><span>rel_set</span></a></span><span class="antiquote"><span>}</span></span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Q</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alphas </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>betas </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>var_Qs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* rewrite rules for pcrel and BNF's relator: "pcrel Q = rel_F OO crel" *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_pcr_rel_F_eq</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>Us</span></span><span> </span><span class="entity"><span>pcrel</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>crel</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pcrel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_relcompp</span></span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rel_of_bnf</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>deads </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Us</span></span><span> </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>crel</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pcrel_def</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>defs</span></span><span> </span><span>@</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Composition.html#BNF_Composition.id_bnf_apply|fact"><span>id_bnf_apply</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>::</span><span>
          </span><span class="entity"><span>Transfer.get_relator_eq</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span> </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_abs_def</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pcr_rel_F_eqs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>[</span></span><span class="entity"><span>mk_pcr_rel_F_eq</span></span><span> </span><span class="main"><span>#</span></span><span>alphas </span><span class="main"><span>#</span></span><span>betas </span><span class="entity"><span>pcrel_Qs</span></span><span> </span><span class="entity"><span>var_Qs</span></span><span> </span><span class="entity"><span>crel_b</span></span><span class="main"><span>,</span></span><span>
       </span><span class="entity"><span>mk_pcr_rel_F_eq</span></span><span> </span><span class="main"><span>#</span></span><span>gammas </span><span class="main"><span>#</span></span><span>deltas </span><span class="entity"><span>pcrel_Rs</span></span><span> </span><span class="entity"><span>var_Rs</span></span><span> </span><span class="entity"><span>crel_d</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* create transfer-relations from term('s type) *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_transfer_rel'</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>go</span></span><span> </span><span class="entity"><span>T'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>q</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>T'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"fun"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"fun"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="entity"><span>go</span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>q</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;&gt;</span><span> </span><span class="entity"><span>mk_rel_fun</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>go</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>q</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"fun"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="entity"><span>go</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>q</span></span><span class="main"><span>)</span></span><span> </span><span>|-&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>go</span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span>|&gt;&gt;</span><span> </span><span class="entity"><span>mk_rel_fun</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>type_name</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.bool|type"><span>bool</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>q</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>type_name</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.set|type"><span>set</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>rel_sets_Q</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>q</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>Type</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>q</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>pcrel_Qs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>pcrel_Rs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span>not</span><span> </span><span class="entity"><span>q</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>TFree</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>q</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>var_Qs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>var_Rs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span>not</span><span> </span><span class="entity"><span>q</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Match</span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>go</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>fst</span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* prove transfer rules *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prove_transfer_thm'</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>new_tm</span></span><span> </span><span class="entity"><span>const</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_transfer_rel'</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>new_tm</span></span><span> </span><span>$</span><span> </span><span class="main"><span>#</span></span><span>raw </span><span class="entity"><span>const</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>new_tm</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pcr_rel_F_eqs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>crel_def</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
          </span><span class="main"><span>#</span></span><span>tac </span><span class="entity"><span>const</span></span><span> </span><span class="main"><span>{</span></span><span>Rs</span><span class="main"><span>=</span></span><span class="entity"><span>var_Rs</span></span><span class="main"><span>,</span></span><span>Qs</span><span class="main"><span>=</span></span><span class="entity"><span>var_Qs</span></span><span class="main"><span>}</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prove_transfer_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prove_transfer_thm'</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* map transfer: "((Q ===&gt; R) ===&gt; pcr_G Q ===&gt; pcr_G R) map_F' map_G" *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_G</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>Ds0</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>betas </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>deltas </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_transfer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prove_transfer_thm</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_Qs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>var_Rs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>map_G</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map </span><span class="entity"><span>consts</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* pred_transfer: "((Q ===&gt; (=)) ===&gt; pcr_G Q ===&gt; (=)) pred_F' pred_G" *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_G</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_pred_of_bnf</span></span><span> </span><span class="entity"><span>Ds0</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>betas </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_transfer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>consts</span></span><span> </span><span>|&gt;</span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"pred"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>prove_transfer_thm</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_Qs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>var_Rs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pred_G</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* rel_transfer: "((Q ===&gt; R ===&gt; (=)) ===&gt; pcr_G Q ===&gt; pcr_G R ===&gt; (=)) rel_F' rel_G" *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_G</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rel_of_bnf</span></span><span> </span><span class="entity"><span>Ds0</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>betas </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>deltas </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_transfer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prove_transfer_thm</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_Qs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>var_Rs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel_G</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel </span><span class="entity"><span>consts</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* set_transfer: "(pcr_G Q ===&gt; rel_set Q) set_F' set_G" *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sets_G</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_sets_of_bnf</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>Ds0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>betas </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_set_transfer</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>set_G</span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prove_transfer_thm'</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>var_Qs</span></span><span> </span><span class="entity"><span>set_G</span></span><span> </span><span class="main"><span>{</span></span><span>raw</span><span class="main"><span>=</span></span><span class="entity"><span>raw</span></span><span class="main"><span>,</span></span><span> tac</span><span class="main"><span>=</span></span><span class="entity"><span>tac</span></span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sets_transfer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_set_transfer</span></span><span>
      </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>live</span></span><span>-</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sets_G</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raws </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>sets </span><span class="entity"><span>consts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>tacs </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>sets </span><span class="entity"><span>consts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* export transfer theorems *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>transform</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm_morphism</span><span> </span><span class="inner_quoted"><span>"BNF"</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>defs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Binding.qualified_name</span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>qualify</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>qs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Binding.path_of</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mand</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Binding.qualify</span><span> </span><span class="entity"><span>mand</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>qs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_binding</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Binding.name</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"_transfer_raw"</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Binding.qualify</span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span>Binding.name_of</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>qualify</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>notes</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"map"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>map_transfer</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"rel"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rel_transfer</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span>the_list</span><span> </span><span class="entity"><span>pred_transfer</span></span><span> </span><span>@</span><span>
      </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"set"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sets_transfer</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>mk_binding</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>transform</span></span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>attributes</span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="../Transfer/transfer.ML.html#Transfer.transfer_rule|attribute"><span class="operator"><span>transfer_rule</span></span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span>|&gt;</span><span> </span><span>Local_Theory.notes</span><span> </span><span class="entity"><span>notes</span></span><span> </span><span>|&gt;</span><span> </span><span>snd</span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(* transfer theorems for map, pred (in case of a typedef), rel and sets *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_transfer_thms</span></span><span> </span><span class="entity"><span>quiet</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="entity"><span>consts</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="entity"><span>Tss</span></span><span> </span><span class="entity"><span>defs</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_crel_def</span></span><span> </span><span class="entity"><span>quot_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span class="entity"><span>Quotient</span></span><span> </span><span class="entity"><span>equiv</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.Quotient_crel_quotient|fact"><span>Quotient_crel_quotient</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>quot_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>equiv</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Typedef</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>hd</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>quot_thm</span></span><span class="main"><span>]</span></span><span> </span><span>RL</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.Quotient_crel_typedef|fact"><span>Quotient_crel_typedef</span></a><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.Quotient_crel_typecopy|fact"><span>Quotient_crel_typecopy</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>no_quotient</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span>Pretty.para</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"No quotient theorem has been registered for "</span></span><span> </span><span>^</span><span>
        </span><span>Binding.name_of</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name_of_bnf</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"."</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span>Pretty.para</span><span> </span><span class="inner_quoted"><span>"Use setup_lifting to register a quotient or type definition theorem."</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>wrong_quotient</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span>Pretty.para</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"A wrong quotient theorem has been registered for "</span></span><span> </span><span>^</span><span>
        </span><span>Binding.name_of</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name_of_bnf</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"."</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span>Pretty.para</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Expected raw type "</span></span><span> </span><span>^</span><span>
        </span><span>Pretty.string_of</span><span> </span><span class="main"><span>(</span></span><span>Syntax.pretty_typ</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
        </span><span class="inner_quoted"><span>" but the quotient theorem has raw type "</span></span><span> </span><span>^</span><span>
        </span><span>Pretty.string_of</span><span> </span><span class="main"><span>(</span></span><span>Syntax.pretty_typ</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"."</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span>Pretty.para</span><span> </span><span class="inner_quoted"><span>"Use setup_lifting to register a different quotient or type definition theorem."</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pcr_why</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span>Pretty.para</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"The pcr_"</span></span><span> </span><span>^</span><span> </span><span>Binding.name_of</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name_of_bnf</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
      </span><span class="inner_quoted"><span>" relator has not been defined."</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>warn_transfer</span></span><span> </span><span class="entity"><span>why</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span>Pretty.para</span><span> </span><span class="inner_quoted"><span>"The transfer theorems can't be generated:"</span></span><span> </span><span>::</span><span>  </span><span class="entity"><span>why</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Pretty.chunks</span><span> </span><span>|&gt;</span><span> </span><span>Pretty.string_of</span><span> </span><span>|&gt;</span><span> </span><span>warning</span><span> </span><span>|&gt;</span><span> </span><span>K</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>maybe_warn_transfer</span></span><span> </span><span class="entity"><span>why</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>not</span><span> </span><span class="entity"><span>quiet</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>warn_transfer</span></span><span> </span><span class="entity"><span>why</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>Lifting_Info.lookup_quotients</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span>SOME</span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>pcr_info</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>quot_thm</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>crel_def</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_crel_def</span></span><span> </span><span class="entity"><span>quot_thm</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Lifting_Util.quot_thm_rty_qty</span></span><span> </span><span class="entity"><span>quot_thm</span></span><span> </span><span>|&gt;</span><span> </span><span>fst</span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Sign.typ_instance</span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>pcr_info</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span>SOME</span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>pcrel_def</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="entity"><span>mk_transfer_thms'</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="entity"><span>consts</span></span><span> </span><span class="entity"><span>Tss</span></span><span> </span><span class="entity"><span>crel_def</span></span><span> </span><span class="entity"><span>pcrel_def</span></span><span> </span><span class="entity"><span>defs</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>maybe_warn_transfer</span></span><span> </span><span class="entity"><span>pcr_why</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>maybe_warn_transfer</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>wrong_quotient</span></span><span> </span><span class="entity"><span>rty</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>maybe_warn_transfer</span></span><span> </span><span class="entity"><span>no_quotient</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(** typedef_bnf **)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_typedef_transfer_tacs</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="entity"><span>old_defs</span></span><span>
  </span><span class="entity"><span>map_raw</span></span><span> </span><span class="entity"><span>rel_raw</span></span><span> </span><span class="entity"><span>pred_raw</span></span><span> </span><span class="entity"><span>sets_raw</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>live_of_bnf</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Abs_G_inverse</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Typedef.html#Typedef.type_definition.Abs_inverse|fact"><span>type_definition.Abs_inverse</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>typedef </span><span class="entity"><span>thms</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Rep_G</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Typedef.html#Typedef.type_definition.Rep|fact"><span>type_definition.Rep</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>typedef </span><span class="entity"><span>thms</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>common_tac</span></span><span> </span><span class="entity"><span>addefs</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>addefs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>rel_funI</span></span><span class="main"><span>,</span></span><span>
        </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.o_apply|fact"><span>o_apply</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppE|fact"><span>relcomppE</span></a><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.exE|fact"><span>exE</span></a><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.conjE|fact"><span>conjE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppI|fact"><span>relcomppI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
      </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rel_funDN</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>live</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_transfer_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span>REPEAT_DETERM_N</span><span> </span><span class="entity"><span>live</span></span><span> </span><span>o</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
      </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Abs_G_inverse</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>map_closed </span><span class="entity"><span>thms</span></span><span class="main"><span>]</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Rep_G</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>common_tac</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>map </span><span class="entity"><span>old_defs</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>map_tac</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rel_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rel_funDN</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>live</span></span><span>+</span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_transfer_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>THEN'</span><span>
        </span><span>REPEAT_DETERM_N</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>live</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>common_tac</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel </span><span class="entity"><span>old_defs</span></span><span> </span><span>::</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.vimage2p_def|fact"><span>vimage2p_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel_tac</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pred_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rel_funDN</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>live</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pred_transfer_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>THEN'</span><span>
        </span><span>REPEAT_DETERM_N</span><span> </span><span class="entity"><span>live</span></span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>common_tac</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>old_defs</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>pred_tac</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>set_tac</span></span><span> </span><span class="entity"><span>set_transfer_thm</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_funD</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>set_transfer_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_set_tac</span></span><span> </span><span class="entity"><span>set_def</span></span><span> </span><span class="entity"><span>set_transfer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>common_tac</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>set_def</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_tac</span></span><span> </span><span class="entity"><span>set_transfer</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_tacs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_set_tac</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>sets </span><span class="entity"><span>old_defs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_transfer_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>{</span></span><span>map</span><span class="main"><span>=</span></span><span class="main"><span>{</span></span><span>raw</span><span class="main"><span>=</span></span><span class="entity"><span>map_raw</span></span><span class="main"><span>,</span></span><span>tac</span><span class="main"><span>=</span></span><span class="entity"><span>map_tac</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span>rel</span><span class="main"><span>=</span></span><span class="main"><span>{</span></span><span>raw</span><span class="main"><span>=</span></span><span class="entity"><span>rel_raw</span></span><span class="main"><span>,</span></span><span>tac</span><span class="main"><span>=</span></span><span class="entity"><span>rel_tac</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span>
      sets</span><span class="main"><span>=</span></span><span class="main"><span>{</span></span><span>raws</span><span class="main"><span>=</span></span><span class="entity"><span>sets_raw</span></span><span class="main"><span>,</span></span><span>tacs</span><span class="main"><span>=</span></span><span class="entity"><span>set_tacs</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span>pred</span><span class="main"><span>=</span></span><span>SOME</span><span class="main"><span>{</span></span><span>raw</span><span class="main"><span>=</span></span><span class="entity"><span>pred_raw</span></span><span class="main"><span>,</span></span><span>tac</span><span class="main"><span>=</span></span><span class="entity"><span>pred_tac</span></span><span class="main"><span>}</span></span><span class="main"><span>}</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>typedef_bnf</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="entity"><span>wits</span></span><span> </span><span class="entity"><span>specs</span></span><span> </span><span class="entity"><span>map_b</span></span><span> </span><span class="entity"><span>rel_b</span></span><span> </span><span class="entity"><span>pred_b</span></span><span> </span><span class="entity"><span>opts</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>plugins</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>get_first</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Plugins_Option</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>rev</span><span> </span><span class="entity"><span>opts</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>the_default</span><span> </span><span class="entity"><span>Plugin_Name.default_filter</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* extract Rep Abs F RepT AbsT *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rep_G</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Abs_G</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>strip3</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>typ_Abs_G</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>dest_funT</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>Abs_G</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>RepT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="entity"><span>typ_Abs_G</span></span><span class="main"><span>;</span></span><span> </span><span class="comment1"><span>(* F *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>AbsT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>snd</span><span> </span><span class="entity"><span>typ_Abs_G</span></span><span class="main"><span>;</span></span><span> </span><span class="comment1"><span>(* G *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>AbsT_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>dest_Type</span><span> </span><span class="entity"><span>AbsT</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tvs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>AbsT</span></span><span> </span><span>|&gt;</span><span> </span><span>dest_Type</span><span> </span><span>|&gt;</span><span> </span><span>snd</span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_TVar</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha0s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>TFree</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>tvs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>alpha0s</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
      </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Expected "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>tvs</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" type argument(s) to "</span></span><span> </span><span>^</span><span> </span><span>quote</span><span> </span><span class="entity"><span>AbsT_name</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* instantiate the new type variables newtvs to oldtvs *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>subst_TVars</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tvs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>alpha0s</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>typ_subst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>typ_subst_TVars</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tvs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>alpha0s</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Rep_G</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>Rep_G</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Abs_G</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>Abs_G</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>F</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>RepT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>typ_subst</span></span><span> </span><span class="entity"><span>RepT</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>AbsT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>typ_subst</span></span><span> </span><span class="entity"><span>AbsT</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>flatten_tyargs</span></span><span> </span><span class="entity"><span>Ass</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>map</span><span> </span><span>dest_TFree</span><span> </span><span class="entity"><span>alpha0s</span></span><span>
      </span><span>|&gt;</span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>member</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ass</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ds0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span>is_none</span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>specs</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>snd</span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* get the bnf for RepT *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>bnf_F</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deads</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alphas</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>unfolds</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>bnf_of_typ</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>Dont_Inline</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.qualify</span><span> </span><span>true</span><span> </span><span class="entity"><span>AbsT_name</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>flatten_tyargs</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
        </span><span class="entity"><span>Ds0</span></span><span> </span><span class="entity"><span>RepT</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>empty_comp_cache</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>empty_unfolds</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_bs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>find_index</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alpha0s</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alphas</span></span><span>
      </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>the_default</span><span> </span><span>Binding.empty</span><span> </span><span>o</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span>nth</span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"No live variables"</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>map_unfolds </span><span class="entity"><span>unfolds</span></span><span> </span><span>@</span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_unfoldss </span><span class="entity"><span>unfolds</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>#</span></span><span>rel_unfolds </span><span class="entity"><span>unfolds</span></span><span> </span><span>@</span><span> </span><span class="main"><span>#</span></span><span>pred_unfolds </span><span class="entity"><span>unfolds</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* number of live variables *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>alphas</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* state the three required properties *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sorts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>Type.sort_of_atyp</span><span> </span><span class="entity"><span>alphas</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>names_lthy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span>Variable.declare_typ</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alphas</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>deads</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>alphas'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>betas'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_TFrees'</span></span><span> </span><span class="entity"><span>sorts</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_TFrees'</span></span><span> </span><span class="entity"><span>sorts</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_TFrees'</span></span><span> </span><span class="entity"><span>sorts</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_F</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>betas</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>typ_fs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>typ_aF</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>map_F</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>strip_typeN</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span>||&gt;</span><span> </span><span>domain_type</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>typ_pairs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_prodT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alphas</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>alphas'</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>typ_subst_pair</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>typ_subst_atomic</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alphas</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>typ_pairs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>typ_pair</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>typ_subst_pair</span></span><span> </span><span class="entity"><span>RepT</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subst_b</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alphas</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subst_a'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alphas</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>alphas'</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subst_pair</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alphas</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>typ_pairs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>aF_set</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>F</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>aF_set'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>subst_a'</span></span><span> </span><span class="entity"><span>F</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pairF_set</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>subst_pair</span></span><span> </span><span class="entity"><span>F</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bF_set</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>subst_b</span></span><span> </span><span class="entity"><span>F</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_F_fst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>typ_pairs</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_F_snd</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>typ_pairs</span></span><span> </span><span class="entity"><span>alphas'</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sets_F_pairs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_sets_of_bnf</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>deads</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>typ_pairs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wits_F</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_wits_of_bnf</span></span><span>
      </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nwits_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>deads</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nwits_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alphas</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* val map_closed_F = @{term "⋀f x. x ∈ F ⟹ map_F f x ∈ F"}; *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_fs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"f"</span></span><span> </span><span class="entity"><span>typ_fs</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"x"</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>typ_aF</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span> </span><span>|&gt;&gt;</span><span> </span><span>the_single</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mem_x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>aF_set</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_F</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_fs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mem_map</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bF_set</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>imp_map</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mem_x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mem_map</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_closed_F</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>var_fs</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.all</span><span> </span><span class="entity"><span>var_x</span></span><span> </span><span class="entity"><span>imp_map</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* val zip_closed_F =
      @{term "⋀z. ⟦map_F fst z ∈ F; map_F snd z ∈ F⟧ ⟹
        ∃z' ∈ F. set_F z' ⊆ set_F z ∧ map_F fst z' = map_F fst z ∧ map_F snd z' = map_F snd z"}; *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Free</span></span><span> </span><span class="inner_quoted"><span>"z"</span></span><span> </span><span class="entity"><span>typ_pair</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_z'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Free</span></span><span> </span><span class="inner_quoted"><span>"z'"</span></span><span> </span><span class="entity"><span>typ_pair</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pairs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"tmp"</span></span><span> </span><span class="entity"><span>typ_pairs</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_map</span></span><span> </span><span class="entity"><span>mfs</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mfs</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>Term.strip_comb</span><span> </span><span>o</span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pairs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_set</span></span><span> </span><span class="entity"><span>var</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sets_F_pairs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_fst'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_fst</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_map</span></span><span> </span><span class="entity"><span>map_F_fst</span></span><span> </span><span class="entity"><span>HOLogic.mk_fst</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_z'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_z</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_snd'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_snd</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_map</span></span><span> </span><span class="entity"><span>map_F_snd</span></span><span> </span><span class="entity"><span>HOLogic.mk_snd</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_z'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_z</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mem_map_fst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_fst</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>aF_set</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mem_map_snd</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_snd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>aF_set'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ex_conj</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_leq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_set</span></span><span> </span><span class="entity"><span>var_z'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_set</span></span><span> </span><span class="entity"><span>var_z</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span>
      </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_fst'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_fst</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_snd'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_snd</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>zip_concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Bex</span></span><span> </span><span class="entity"><span>pairF_set</span></span><span> </span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>var_z'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ex_conj</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>zip_closed_F</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>var_z</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>mem_map_fst</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mem_map_snd</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>zip_concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* val wit_closed_F = @{term "wit_F a ∈ F"}; *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_as</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"a"</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_bs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"a"</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_sets_of_bnf</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>deads</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>alphas</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Iwits</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit_goals</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>prepare_wits</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>RepT</span></span><span> </span><span class="entity"><span>wits</span></span><span> </span><span class="entity"><span>opts</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>wits_F</span></span><span> </span><span class="entity"><span>var_as</span></span><span> </span><span class="entity"><span>var_bs</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wit_closed_Fs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>Iwits</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit_F</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>var_as</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>I</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wit_a</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>wit_F</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>wit_a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>aF_set</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>map_closed_F</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>zip_closed_F</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>wit_closed_Fs</span></span><span> </span><span>@</span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>wits</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>wit_goals</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>after_qed</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>map_closed_thm</span></span><span class="main"><span>]</span></span><span> </span><span>::</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>zip_closed_thm</span></span><span class="main"><span>]</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>wit_thmss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>wit_closed_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit_thms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>wits</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>the_single</span><span> </span><span class="entity"><span>wit_thmss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit_thms_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>chop</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>wit_closed_Fs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>the_single</span><span> </span><span class="entity"><span>wit_thmss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

            </span><span class="comment1"><span>(*  construct map set bd rel wit *)</span></span><span>
            </span><span class="comment1"><span>(* val map_G = @{term "λf. Abs_G o map_F f o Rep_G"}; *)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Abs_Gb</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>subst_b</span></span><span> </span><span class="entity"><span>Abs_G</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_G</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>lambda</span><span> </span><span class="entity"><span>var_fs</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Abs_Gb</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_f</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rep_G</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_raw</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>lambda</span><span> </span><span class="entity"><span>var_fs</span></span><span> </span><span class="entity"><span>map_f</span></span><span class="main"><span>;</span></span><span>

            </span><span class="comment1"><span>(* val sets_G = [@{term "set_F o Rep_G"}]; *)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sets_F</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_sets_of_bnf</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>deads</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>alphas</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sets_G</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set_F</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_F</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rep_G</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sets_F</span></span><span class="main"><span>;</span></span><span>

            </span><span class="comment1"><span>(* val bd_G = @{term "bd_F"}; *)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_F</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bd_of_bnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_G</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bd_F</span></span><span class="main"><span>;</span></span><span>

            </span><span class="comment1"><span>(* val rel_G = @{term "λR. BNF_Def.vimage2p Rep_G Rep_G (rel_F R)"}; *)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_F</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rel_of_bnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>betas</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>typ_Rs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>strip_typeN</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>rel_F</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_Rs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"R"</span></span><span> </span><span class="entity"><span>typ_Rs</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Rep_Gb</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>subst_b</span></span><span> </span><span class="entity"><span>Rep_G</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_G</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>dest_Free</span><span> </span><span class="entity"><span>var_Rs</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>mk_vimage2p</span></span><span> </span><span class="entity"><span>Rep_G</span></span><span> </span><span class="entity"><span>Rep_Gb</span></span><span> </span><span>$</span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_F</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_Rs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_raw</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>dest_Free</span><span> </span><span class="entity"><span>var_Rs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_F</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_Rs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="comment1"><span>(* val pred_G = @{term "λP. pred_F P o Rep_G"}; *)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_F</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_pred_of_bnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>typ_Ps</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>strip_typeN</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>pred_F</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_Ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"P"</span></span><span> </span><span class="entity"><span>typ_Ps</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_G</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>dest_Free</span><span> </span><span class="entity"><span>var_Ps</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pred_F</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_Ps</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rep_G</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_raw</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>dest_Free</span><span> </span><span class="entity"><span>var_Ps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pred_F</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_Ps</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="comment1"><span>(* val wits_G = [@{term "Abs_G o wit_F"}]; *)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_as</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"a"</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wits_G</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit_F</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>var_as</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>I</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>fold_rev</span><span> </span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>dest_Free</span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Abs_G</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>wit_F</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>Iwits</span></span><span class="main"><span>;</span></span><span>

            </span><span class="comment1"><span>(* tactics *)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Rep_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Typedef.html#Typedef.type_definition.Rep|fact"><span>type_definition.Rep</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Abs_inverse_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Typedef.html#Typedef.type_definition.Abs_inverse|fact"><span>type_definition.Abs_inverse</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Abs_inject_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Typedef.html#Typedef.type_definition.Abs_inject|fact"><span>type_definition.Abs_inject</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Rep_cases_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Typedef.html#Typedef.type_definition.Rep_cases|fact"><span>type_definition.Rep_cases</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Rep_inverse_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Typedef.html#Typedef.type_definition.Rep_inverse|fact"><span>type_definition.Rep_inverse</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_id0_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ext</span></span><span class="main"><span>,</span></span><span>
                </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>map_id0_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>id_apply</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>o_apply</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>Rep_inverse_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_comp0_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ext</span></span><span class="main"><span>,</span></span><span>
                </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>map_comp0_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>o_apply</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>Rep_thm</span></span><span> </span><span>RS</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_closed_thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>Abs_inverse_thm</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_cong0_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>o_apply</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>Rep_thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>map_closed_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rep_thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>map_closed_thm</span></span><span class="main"><span>]</span></span><span> </span><span>MRS</span><span>
                  </span><span class="entity"><span>Abs_inject_thm</span></span><span class="main"><span>)</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>iffD2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_cong0_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>(</span></span><span>Goal.assume_rule_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_map0s_tac</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set_map</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ext</span></span><span class="main"><span>,</span></span><span>
                  </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>set_map</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>o_apply</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>Rep_thm</span></span><span> </span><span>RS</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_closed_thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>Abs_inverse_thm</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>set_map_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>card_order_bd_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bd_card_order_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>cinfinite_bd_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bd_cinfinite_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>regularCard_bd_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bd_regularCard_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_bds_tac</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set_bd</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>o_apply</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>set_bd</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>set_bd_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>le_rel_OO_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Composition.html#BNF_Composition.vimage2p_relcompp_mono|fact"><span>vimage2p_relcompp_mono</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>rel_OO_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.ord_class.ord_eq_le_trans|fact"><span>ord_eq_le_trans</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.preorder_class.order_refl|fact"><span>order_refl</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rel_OO_Grp_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span>REPEAT_DETERM</span><span> </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ext</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.OO_Grp_alt|fact"><span>OO_Grp_alt</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mem_Collect_eq</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>o_apply</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.vimage2p_def|fact"><span>vimage2p_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>in_rel_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Bex_def</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mem_Collect_eq</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>iffI</span></span><span class="main"><span>,</span></span><span>
                </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span>REPEAT_DETERM</span><span> </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>exE</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>forward_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                  </span><span class="main"><span>[</span></span><span class="entity"><span>zip_closed_thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rep_thm</span></span><span> </span><span>RSN</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Composition.html#BNF_Composition.ssubst_mem|fact"><span>ssubst_mem</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span>REPEAT_DETERM</span><span> </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>bexE</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Rep_cases_thm</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span>REPEAT_DETERM</span><span> </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>exI</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
                </span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span>
                  </span><span class="main"><span>(</span></span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>TRY</span><span> </span><span>o</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.preorder_class.order_trans|fact"><span>order_trans</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span>
                </span><span class="main"><span>[</span></span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span>REPEAT_DETERM</span><span> </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM_N</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span>o</span><span> </span><span>EVERY'</span><span>
                  </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>trans</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Abs_inject_thm</span></span><span> </span><span>OF</span><span>
                      </span><span class="main"><span>[</span></span><span class="entity"><span>map_closed_thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Rep_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rep_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rep_inverse_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span>REPEAT_DETERM</span><span> </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>exE</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>exI</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
                </span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>live</span></span><span>-</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span> </span><span>THEN'</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span>
                </span><span class="main"><span>[</span></span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM_N</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span>o</span><span> </span><span>EVERY'</span><span>
                  </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD1</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Abs_inject_thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>map_closed_thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Rep_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rep_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rep_inverse_thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span> </span><span>RSN</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pred_set_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span>
                </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pred_set_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.arg_cong|fact"><span>arg_cong</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>λ</span></span><span class="bound"><span>f</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>f</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../Fun.html#Fun.comp|const"><span>∘</span></a></span><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Composition.html#BNF_Composition.Ball_comp_iff|fact"><span>Ball_comp_iff</span></a><span> </span><a class="entity_ref" href="../../../../../BNF_Composition.html#BNF_Composition.conj_comp_iff|fact"><span>conj_comp_iff</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>wit_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span>
                </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span>
                  </span><span class="main"><span>[</span></span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>o_apply</span></span><span> </span><span>::</span><span>
                    </span><span class="main"><span>(</span></span><span class="entity"><span>wit_closed_thms</span></span><span> </span><span>RL</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Abs_inverse_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span class="entity"><span>wit_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tactics</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>map_id0_tac</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_comp0_tac</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_cong0_tac</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>set_map0s_tac</span></span><span> </span><span>@</span><span>
              </span><span class="main"><span>[</span></span><span class="entity"><span>card_order_bd_tac</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cinfinite_bd_tac</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>regularCard_bd_tac</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>set_bds_tac</span></span><span> </span><span>@</span><span>
              </span><span class="main"><span>[</span></span><span class="entity"><span>le_rel_OO_tac</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_OO_Grp_tac</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pred_set_tac</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_G</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bnf_def</span></span><span> </span><span class="entity"><span>Dont_Inline</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>user_policy</span></span><span> </span><span class="entity"><span>Note_Some</span></span><span class="main"><span>)</span></span><span> </span><span>true</span><span> </span><span>I</span><span>
              </span><span class="entity"><span>tactics</span></span><span> </span><span class="entity"><span>wit_tac</span></span><span> </span><span>NONE</span><span> </span><span class="entity"><span>map_b</span></span><span> </span><span class="entity"><span>rel_b</span></span><span> </span><span class="entity"><span>pred_b</span></span><span> </span><span class="entity"><span>set_bs</span></span><span>
              </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Binding.empty</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>AbsT</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_G</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sets_G</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bd_G</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wits_G</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>rel_G</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>pred_G</span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>old_defs</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="main"><span>{</span></span><span>sets </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>set_defs_of_bnf</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span class="main"><span>,</span></span><span> map </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_def_of_bnf</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span class="main"><span>,</span></span><span> rel </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_def_of_bnf</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span class="main"><span>,</span></span><span>
               pred </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pred_def_of_bnf</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unfold_morphism</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm_morphism</span><span> </span><span class="inner_quoted"><span>"BNF"</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>defs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_G</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>morph_bnf_defs</span></span><span> </span><span class="entity"><span>unfold_morphism</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span>
              </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>note_bnf_defs</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>quiet</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>No_Warn_Transfer</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>opts</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>transfer_consts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_typedef_transfer_tacs</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span>
              </span><span class="main"><span>{</span></span><span>map_closed</span><span class="main"><span>=</span></span><span class="entity"><span>map_closed_thm</span></span><span class="main"><span>,</span></span><span>typedef</span><span class="main"><span>=</span></span><span class="entity"><span>thm</span></span><span class="main"><span>}</span></span><span> </span><span class="entity"><span>old_defs</span></span><span> </span><span class="entity"><span>map_raw</span></span><span> </span><span class="entity"><span>rel_raw</span></span><span> </span><span class="entity"><span>pred_raw</span></span><span> </span><span class="entity"><span>sets_F</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>lthy</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>BNF_Def.register_bnf</span></span><span> </span><span class="entity"><span>plugins</span></span><span> </span><span class="entity"><span>AbsT_name</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span> </span><span>|&gt;</span><span>
              </span><span class="entity"><span>mk_transfer_thms</span></span><span> </span><span class="entity"><span>quiet</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span> </span><span class="entity"><span>AbsT_name</span></span><span> </span><span class="entity"><span>transfer_consts</span></span><span> </span><span class="entity"><span>Typedef</span></span><span>
              </span><span class="main"><span>{</span></span><span>abs</span><span class="main"><span>=</span></span><span>typ_subst_atomic</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alphas</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>alphas'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>AbsT</span></span><span class="main"><span>,</span></span><span> rep</span><span class="main"><span>=</span></span><span class="entity"><span>RepT</span></span><span class="main"><span>,</span></span><span> Ds0</span><span class="main"><span>=</span></span><span>map</span><span> </span><span>TFree</span><span> </span><span class="entity"><span>Ds0</span></span><span class="main"><span>,</span></span><span>
               deads </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deads</span></span><span class="main"><span>,</span></span><span> alphas</span><span class="main"><span>=</span></span><span class="entity"><span>alphas</span></span><span class="main"><span>,</span></span><span> betas</span><span class="main"><span>=</span></span><span class="entity"><span>alphas'</span></span><span class="main"><span>,</span></span><span> gammas</span><span class="main"><span>=</span></span><span class="entity"><span>betas</span></span><span class="main"><span>,</span></span><span> deltas</span><span class="main"><span>=</span></span><span class="entity"><span>betas'</span></span><span class="main"><span>}</span></span><span> </span><span class="entity"><span>defs</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>after_qed</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Match</span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>goals</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>after_qed</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>defs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(** quotient_bnf **)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_quotient_transfer_tacs</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span> </span><span class="entity"><span>Tss</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>qthms</span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="entity"><span>set_F'_thmss</span></span><span> </span><span class="entity"><span>old_defs</span></span><span>
  </span><span class="entity"><span>inst_REL_pos_distrI</span></span><span> </span><span class="entity"><span>map_raw</span></span><span> </span><span class="entity"><span>rel_raw</span></span><span> </span><span class="entity"><span>sets_raw</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>common_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>addefs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>REL </span><span class="entity"><span>qthms</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>addefs</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
      </span><span class="main"><span>(</span></span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>HEADGOAL</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>rel_funI</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* quotient.map_transfer tactic *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_F_transfer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_transfer_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_rel_funDN</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>live</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_transfer_q</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>common_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map </span><span class="entity"><span>old_defs</span></span><span> </span><span>::</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.o_def|fact"><span>o_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
      </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppE|fact"><span>relcomppE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppI|fact"><span>relcomppI</span></a><span class="main"><span>[</span></span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>THEN'</span><span> </span><span>EVERY'</span><span>
        </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>rel_abs </span><span class="entity"><span>qthms</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>map_F_rsp </span><span class="entity"><span>thms</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rep_abs_rsp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>reflp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>map_F_transfer</span></span><span class="main"><span>,</span></span><span> </span><span>REPEAT_DETERM_N</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>live</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* quotient.rel_transfer tactic *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_F_maps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_map_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_F_map_iffD2s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel_F_maps</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>inst_REL_pos_distrI_order_refls</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>aTs</span></span><span> </span><span class="entity"><span>bTs</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>inst_REL_pos_distrI</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>aTs</span></span><span> </span><span class="entity"><span>bTs</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>live</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>asm_rl</span><span> </span><span>@</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.preorder_class.order_refl|fact"><span>order_refl</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rel_transfer_q</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>Qs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>}</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>EVERY</span><span>
      </span><span class="main"><span>[</span></span><span class="entity"><span>common_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>rel </span><span class="entity"><span>old_defs</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.vimage2p_def|fact"><span>vimage2p_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
      </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>iffI</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>ALLGOALS</span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.exE|fact"><span>exE</span></a><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.conjE|fact"><span>conjE</span></a><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppE|fact"><span>relcomppE</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>ORELSE'</span><span> </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>[</span></span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.rel_fun_rel_OO1|fact"><span>rel_fun_rel_OO1</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst_REL_pos_distrI</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>mk_conversep</span></span><span> </span><span class="entity"><span>Qs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>betas </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alphas </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppI|fact"><span>relcomppI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>symp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_F_rsp </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rep_abs_rsp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>reflp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppI|fact"><span>relcomppI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_flip_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.iffD1|fact"><span>iffD1</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>rel_F_map_iffD2s</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>rel_F_map_iffD2s</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel_monoD_rotated </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span>REPEAT_DETERM_N</span><span> </span><span class="entity"><span>live</span></span><span> </span><span>o</span><span> </span><span>HEADGOAL</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.predicate2I|fact"><span>predicate2I</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.conversepI|fact"><span>conversepI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Basic_BNFs.html#Basic_BNFs.rel_sum_simps|fact"><span>Basic_BNFs.rel_sum_simps</span></a><span class="main"><span>(</span></span><span>4</span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.conversepI|fact"><span>conversepI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst_REL_pos_distrI_order_refls</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>gammas </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>deltas </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="main"><span>(</span></span><span>SELECT_GOAL</span><span> </span><span>o</span><span> </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>HEADGOAL</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppI|fact"><span>relcomppI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppI|fact"><span>relcomppI</span></a><span class="main"><span>[</span></span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_F_rsp </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rep_abs_rsp </span><span class="entity"><span>qthms</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>reflp </span><span class="entity"><span>qthms</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Basic_BNFs.html#Basic_BNFs.rel_sum_simps|fact"><span>rel_sum_simps</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>rel_F_maps</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span>REPEAT_DETERM_N</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span>*</span><span class="entity"><span>live</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>HEADGOAL</span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.rel_sum_eq2_nonempty|fact"><span>rel_sum_eq2_nonempty</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>ORELSE'</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.rel_sum_eq3_nonempty|fact"><span>rel_sum_eq3_nonempty</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span>REPEAT_DETERM_N</span><span> </span><span class="entity"><span>live</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Basic_BNFs.html#Basic_BNFs.Sum_Type.sum.rel_compp|fact"><span>sum.rel_compp</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.eq_OO|fact"><span>eq_OO</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>THEN</span><span>
        </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Basic_BNFs.html#Basic_BNFs.Sum_Type.sum.rel_mono|fact"><span>sum.rel_mono</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.preorder_class.order_refl|fact"><span>order_refl</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span>SELECT_GOAL</span><span> </span><span>o</span><span> </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>HEADGOAL</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.rel_fun_rel_OO2|fact"><span>rel_fun_rel_OO2</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst_REL_pos_distrI</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="entity"><span>Qs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alphas </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>betas </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppI|fact"><span>relcomppI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>reflp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppI|fact"><span>relcomppI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>rel_F_map_iffD2s</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>rel_F_map_iffD2s</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel_monoD_rotated </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span>REPEAT_DETERM_N</span><span> </span><span class="entity"><span>live</span></span><span> </span><span>o</span><span> </span><span>HEADGOAL</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.predicate2I|fact"><span>predicate2I</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.rel_sum.intros|fact"><span>rel_sum.intros</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>inst_REL_pos_distrI_order_refls</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>mk_conversep</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>deltas </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>gammas </span><span class="entity"><span>Tss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppI|fact"><span>relcomppI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>rotate_prems</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>transp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_F_rsp </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rep_abs_rsp </span><span class="entity"><span>qthms</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>reflp </span><span class="entity"><span>qthms</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppI|fact"><span>relcomppI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppI|fact"><span>relcomppI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>transp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>symp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_F_rsp </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rep_abs_rsp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>reflp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppI|fact"><span>relcomppI</span></a><span class="main"><span>[</span></span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>reflp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_flip_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.iffD1|fact"><span>iffD1</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>rel_F_map_iffD2s</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>rel_F_map_iffD2s</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel_monoD_rotated </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span>REPEAT_DETERM_N</span><span> </span><span class="entity"><span>live</span></span><span> </span><span>o</span><span> </span><span>HEADGOAL</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.predicate2I|fact"><span>predicate2I</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.conversepI|fact"><span>conversepI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.rel_sum.intros|fact"><span>rel_sum.intros</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.conversepI|fact"><span>conversepI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span>REPEAT_DETERM_N</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span>*</span><span class="entity"><span>live</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>HEADGOAL</span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.rel_sum_eq2_nonempty|fact"><span>rel_sum_eq2_nonempty</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>ORELSE'</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.rel_sum_eq3_nonempty|fact"><span>rel_sum_eq3_nonempty</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span>REPEAT_DETERM_N</span><span> </span><span class="entity"><span>live</span></span><span> </span><span>o</span><span> </span><span>EVERY</span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>[</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Basic_BNFs.html#Basic_BNFs.Sum_Type.sum.rel_compp|fact"><span>sum.rel_compp</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.eq_OO|fact"><span>eq_OO</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Basic_BNFs.html#Basic_BNFs.Sum_Type.sum.rel_mono|fact"><span>sum.rel_mono</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.preorder_class.order_refl|fact"><span>order_refl</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* quotient.set_transfer tactics *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>set_transfer_q</span></span><span> </span><span class="entity"><span>set_G_def</span></span><span> </span><span class="entity"><span>set_F'_thms</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_F'_rsp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rel_funDN</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_F'_respect </span><span class="entity"><span>set_F'_thms</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>common_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_G_def</span></span><span> </span><span>::</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.o_def|fact"><span>o_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
        </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>[</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppE|fact"><span>relcomppE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
          </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
            </span><span class="main"><span>[</span></span><span class="entity"><span>set_F'_rsp</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>rep_abs </span><span class="entity"><span>qthms</span></span><span class="main"><span>]</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>reflp </span><span class="entity"><span>qthms</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.rel_set_def|fact"><span>rel_set_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel_F_rel_F' </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>]</span></span><span> </span><span>THEN</span><span>
        </span><span class="main"><span>(</span></span><span>REPEAT_DETERM_N</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span>o</span><span> </span><span>HEADGOAL</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>[</span></span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>rel_F'_set </span><span class="entity"><span>thms</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>exE</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_sym</span></span><span> </span><span class="entity"><span>set_F'_rsp</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>set_map_F' </span><span class="entity"><span>set_F'_thms</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ballI</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.equalityD1|fact"><span>equalityD1</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.subsetD|fact"><span>subsetD</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
          </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.image_iff|fact"><span>image_iff</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>bexE</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>set_mp</span></span><span class="main"><span>,</span></span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
          </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.mem_Collect_eq|fact"><span>mem_Collect_eq</span></a><span> </span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.case_prod_beta|fact"><span>case_prod_beta</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>bexI</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.hypsubst|fact"><span>hypsubst</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.imageI|fact"><span>imageI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>]</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
     </span><span class="main"><span>{</span></span><span>map</span><span class="main"><span>=</span></span><span class="main"><span>{</span></span><span>raw</span><span class="main"><span>=</span></span><span class="entity"><span>map_raw</span></span><span class="main"><span>,</span></span><span> tac</span><span class="main"><span>=</span></span><span class="entity"><span>map_transfer_q</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span>
      rel</span><span class="main"><span>=</span></span><span class="main"><span>{</span></span><span>raw</span><span class="main"><span>=</span></span><span class="entity"><span>rel_raw</span></span><span class="main"><span>,</span></span><span> tac</span><span class="main"><span>=</span></span><span class="entity"><span>rel_transfer_q</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span>
      sets</span><span class="main"><span>=</span></span><span class="main"><span>{</span></span><span>raws</span><span class="main"><span>=</span></span><span class="entity"><span>sets_raw</span></span><span class="main"><span>,</span></span><span>tacs</span><span class="main"><span>=</span></span><span>map2</span><span> </span><span class="entity"><span>set_transfer_q</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>sets </span><span class="entity"><span>old_defs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_F'_thmss</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span>
      pred</span><span class="main"><span>=</span></span><span>NONE</span><span class="main"><span>}</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>


</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>quotient_bnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>equiv_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>quot_thm</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>wits</span></span><span> </span><span class="entity"><span>specs</span></span><span> </span><span class="entity"><span>map_b</span></span><span> </span><span class="entity"><span>rel_b</span></span><span> </span><span class="entity"><span>pred_b</span></span><span> </span><span class="entity"><span>opts</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="comment1"><span>(* extract rep_G and abs_G *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>equiv_rel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>abs_G</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rep_G</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>strip3</span></span><span> </span><span class="entity"><span>quot_thm</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>repT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>absT</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>dest_funT</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>abs_G</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="comment1"><span>(* ("?'a F", "?'a G") *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>absT_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>dest_Type</span><span> </span><span class="entity"><span>absT</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tvs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_TVar</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="main"><span>(</span></span><span>dest_Type</span><span> </span><span class="entity"><span>absT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>tvs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>specs</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
      </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Expected "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>tvs</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
        </span><span class="inner_quoted"><span>" type argument"</span></span><span> </span><span>^</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>tvs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"s"</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" to "</span></span><span> </span><span>^</span><span> </span><span>quote</span><span> </span><span class="entity"><span>absT_name</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* instantiate TVars *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha0s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>TFree</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>typ_subst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>typ_subst_TVars</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tvs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>alpha0s</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>repT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>absT</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apply2</span><span> </span><span class="entity"><span>typ_subst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>repT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>absT</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* get the bnf for RepT *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ds0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span>is_none</span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>specs</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>snd</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>flatten_tyargs</span></span><span> </span><span class="entity"><span>Ass</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>map</span><span> </span><span>dest_TFree</span><span> </span><span class="entity"><span>alpha0s</span></span><span> </span><span>|&gt;</span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>member</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ass</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>bnf_F</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deads</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alphas</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>unfolds</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>bnf_of_typ</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>Dont_Inline</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.qualify</span><span> </span><span>true</span><span> </span><span class="entity"><span>absT_name</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>flatten_tyargs</span></span><span>
        </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>Ds0</span></span><span> </span><span class="entity"><span>repT</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>empty_comp_cache</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>empty_unfolds</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>alphas</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"No live variables"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>map_unfolds </span><span class="entity"><span>unfolds</span></span><span> </span><span>@</span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_unfoldss </span><span class="entity"><span>unfolds</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>#</span></span><span>rel_unfolds </span><span class="entity"><span>unfolds</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_bs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>find_index</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alpha0s</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alphas</span></span><span>
      </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>the_default</span><span> </span><span>Binding.empty</span><span> </span><span>o</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span>nth</span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* create and instantiate all the needed type variables *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>subst_TVars</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tvs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>alpha0s</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>abs_G</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rep_G</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apply2</span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>abs_G</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rep_G</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sorts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>Type.sort_of_atyp</span><span> </span><span class="entity"><span>alphas</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>betas</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gammas</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>deltas</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span>Variable.declare_typ</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alphas</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>deads</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_TFrees'</span></span><span> </span><span class="entity"><span>sorts</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_TFrees'</span></span><span> </span><span class="entity"><span>sorts</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_TFrees'</span></span><span> </span><span class="entity"><span>sorts</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>subst_Ts</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alphas</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subst_b</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alphas</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subst_Maybe</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>subst_atomic_types</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>swap</span><span> </span><span>o</span><span> </span><span>`</span><span class="entity"><span>mk_MaybeT</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>equiv_rel_a</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>equiv_rel</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_F</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>betas</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_F_ab</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rel_of_bnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>betas</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_F_bc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rel_of_bnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>betas</span></span><span> </span><span class="entity"><span>gammas</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_F_ac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rel_of_bnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>gammas</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_F_option</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rel_of_bnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>mk_MaybeT</span></span><span> </span><span class="entity"><span>alphas</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>mk_MaybeT</span></span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sets_F</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_sets_of_bnf</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>deads</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>alphas</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wits_F</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_wits_of_bnf</span></span><span>
      </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nwits_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>deads</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nwits_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alphas</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>typ_fs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>typ_aF</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>typ_bF</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>strip_typeN</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>map_F</span></span><span class="main"><span>)</span></span><span> </span><span>||&gt;</span><span> </span><span>dest_funT</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>typ_MaybeF</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>typ_subst_atomic</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alphas</span></span><span> </span><span>~~</span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_MaybeT</span></span><span> </span><span class="entity"><span>alphas</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>typ_aF</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>typ_a_sets</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>alphas</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>typ_pairs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_prodT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alphas</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>typ_fs'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>typ_subst_atomic</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>swap</span><span> </span><span>o</span><span> </span><span>`</span><span class="entity"><span>mk_MaybeT</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>typ_fs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* create all the needed variables *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>var_Ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_Qs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_Rs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_x</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_x'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_y</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_y'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_mx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="entity"><span>var_As</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_As'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_Ss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_Bs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_as</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_as'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_bs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_bs'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_R</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_fs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="entity"><span>var_fs'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_gs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_gs'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_z</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"Ps"</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_relT</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>)</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"Qs"</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_relT</span></span><span> </span><span class="entity"><span>betas</span></span><span> </span><span class="entity"><span>gammas</span></span><span class="main"><span>)</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"Rs"</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_relT</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>gammas</span></span><span class="main"><span>)</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Free</span></span><span> </span><span class="inner_quoted"><span>"x"</span></span><span> </span><span class="entity"><span>typ_aF</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Free</span></span><span> </span><span class="inner_quoted"><span>"x'"</span></span><span> </span><span class="entity"><span>typ_aF</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Free</span></span><span> </span><span class="inner_quoted"><span>"y"</span></span><span> </span><span class="entity"><span>typ_bF</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Free</span></span><span> </span><span class="inner_quoted"><span>"y'"</span></span><span> </span><span class="main"><span>(</span></span><span>typ_subst_atomic</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alphas</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>gammas</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>typ_aF</span></span><span class="main"><span>)</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Free</span></span><span> </span><span class="inner_quoted"><span>"mx"</span></span><span> </span><span class="entity"><span>typ_MaybeF</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"As"</span></span><span> </span><span class="entity"><span>typ_a_sets</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"As'"</span></span><span> </span><span class="entity"><span>typ_a_sets</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"Ss"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>typ_a_sets</span></span><span class="main"><span>)</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"Bs"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>)</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"as"</span></span><span> </span><span class="entity"><span>alphas</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"as'"</span></span><span> </span><span class="entity"><span>alphas</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"bs"</span></span><span> </span><span class="entity"><span>betas</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"bs'"</span></span><span> </span><span class="entity"><span>betas</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Free</span></span><span> </span><span class="inner_quoted"><span>"R"</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>typ_aF</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>typ_bF</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"fs"</span></span><span> </span><span class="entity"><span>typ_fs</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"fs'"</span></span><span> </span><span class="entity"><span>typ_fs'</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"gs"</span></span><span> </span><span class="entity"><span>typ_fs</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"gs'"</span></span><span> </span><span class="entity"><span>typ_fs'</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Free</span></span><span> </span><span class="inner_quoted"><span>"z"</span></span><span> </span><span class="main"><span>(</span></span><span>typ_subst_atomic</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alphas</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>typ_pairs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>typ_aF</span></span><span class="main"><span>)</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"ts"</span></span><span> </span><span class="entity"><span>typ_pairs</span></span><span>
        </span><span>|&gt;</span><span> </span><span>fst</span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* create local definitions `b = tm` with n arguments *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>suffix</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>dest_Const</span><span> </span><span class="entity"><span>tm</span></span><span> </span><span>|&gt;</span><span> </span><span>fst</span><span> </span><span>|&gt;</span><span> </span><span>Long_Name.base_name</span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>define</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Binding.qualify</span><span> </span><span>true</span><span> </span><span class="entity"><span>absT_name</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.qualified_name</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>tm</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>def</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy_old</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>Local_Theory.begin_nested</span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Local_Theory.define_internal</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Binding.concealed</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span>NoSyn</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.empty_atts</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>lthy_old</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.subst_atomic_types</span><span>
          </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>`</span><span class="main"><span>(</span></span><span>Morphism.typ</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alphas</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>betas</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>gammas</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span>TFree</span><span> </span><span class="entity"><span>Ds0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_unabs_def</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_obj_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>def</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span>def</span><span class="main"><span>=</span></span><span class="entity"><span>def</span></span><span class="main"><span>,</span></span><span> tm</span><span class="main"><span>=</span></span><span class="entity"><span>tm</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* internally use REL, not the user-provided definition *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>REL</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>define</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="inner_quoted"><span>"REL"</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="entity"><span>equiv_rel_a</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>REL_def</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>eq_reflection</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>def </span><span class="entity"><span>REL</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>REL_rewr_all</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Conv.fconv_rule</span><span>
      </span><span class="main"><span>(</span></span><span>Conv.top_conv</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Conv.try_conv</span><span> </span><span class="main"><span>(</span></span><span>Conv.rewr_conv</span><span> </span><span class="entity"><span>REL_def</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>equiv_rel_a'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>equiv_rel_a</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>equiv_rel_a</span></span><span>  </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>tm </span><span class="entity"><span>REL</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>equiv_rel_b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>equiv_rel_c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subst_Ts</span></span><span> </span><span class="entity"><span>equiv_rel_a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>betas</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gammas</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* rel_pos_distr: @{term "⋀A B.
      A ∘∘ B ≠ bot ⟹ REL ∘∘ rel_F A ∘∘ REL ∘∘ rel_F B ∘∘ REL ≤ REL ∘∘ rel_F (A ∘∘ B) ∘∘ REL"} *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>compp_not_bot</span></span><span> </span><span class="entity"><span>comp</span></span><span> </span><span class="entity"><span>aT</span></span><span> </span><span class="entity"><span>cT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_relT</span></span><span> </span><span class="entity"><span>aT</span></span><span> </span><span class="entity"><span>cT</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>HOLogic.mk_not</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_eq</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>comp</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>bot_const</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ab_comps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_relcompp</span></span><span> </span><span class="entity"><span>var_Ps</span></span><span> </span><span class="entity"><span>var_Qs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ne_comps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>compp_not_bot</span></span><span> </span><span class="entity"><span>ab_comps</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>gammas</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ab_prem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="entity"><span>ne_comps</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>REL_pos_distrI_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>le_relcomps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_leq</span></span><span> </span><span class="entity"><span>ab_comps</span></span><span> </span><span class="entity"><span>var_Rs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>assm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_OO</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>equiv_rel_a</span></span><span class="main"><span>,</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_F_ab</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_Ps</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>equiv_rel_b</span></span><span class="main"><span>,</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_F_bc</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_Qs</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>equiv_rel_c</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_OO</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>equiv_rel_a</span></span><span class="main"><span>,</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_F_ac</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_Rs</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>equiv_rel_c</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_Trueprop_implies</span></span><span>
          </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>assm</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_y'</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ne_comps</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>le_relcomps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_y'</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ab_concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_leq</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>mk_OO</span></span><span> </span><span class="main"><span>[</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_F_ab</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_Ps</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>equiv_rel_b</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_F_bc</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_Qs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>mk_OO</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>equiv_rel_a</span></span><span class="main"><span>,</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_F_ac</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ab_comps</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>equiv_rel_c</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ab_imp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span>apply2</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ab_prem</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ab_concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_pos_distr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_Ps</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>var_Qs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ab_imp</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* {(x, y) . REL x y} *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel_pairs</span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_case_prod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_x'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_x'</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_pairs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rel_pairs</span></span><span> </span><span class="entity"><span>equiv_rel_a</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* rel_Inter: ⋀S. ⟦ S ≠ {}; ⋂S ≠ {} ⟧ ⟹
      (⋂A∈S. {(x, y). REL x y} `` {x. set_F x ⊆ A}) ⊆ {(x, y). REL x y} `` {x. set_F x ⊆ ⋂S} *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rel_Inter_from_set_F</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_A</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_S</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_F</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>typ_aset</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>var_A</span></span><span class="main"><span>;</span></span><span>

      </span><span class="comment1"><span>(* ⋂S *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inter_S</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Inf_const</span></span><span> </span><span class="entity"><span>typ_aset</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_S</span></span><span class="main"><span>;</span></span><span>

      </span><span class="comment1"><span>(* [S ≠ {}, ⋂S ≠ {}] *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>not_empty</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>x</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>HOLogic.mk_not</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bot_const</span></span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>not_empty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>var_S</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>inter_S</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

      </span><span class="comment1"><span>(* {x. set_F x ⊆ A} *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>setF_sub_A</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_in</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>var_A</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>set_F</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>typ_aF</span></span><span class="main"><span>;</span></span><span>

      </span><span class="comment1"><span>(* {x. set_F x ⊆ ⋂S} *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>setF_sub_S</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_in</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>inter_S</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>set_F</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>typ_aF</span></span><span class="main"><span>;</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Inf_const</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>typ_aF</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_image</span></span><span>
        </span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>var_A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Image_const</span></span><span> </span><span class="entity"><span>typ_aF</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>rel_pairs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>setF_sub_A</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_S</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Image_const</span></span><span> </span><span class="entity"><span>typ_aF</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>rel_pairs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>setF_sub_S</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_leq</span></span><span> </span><span class="entity"><span>lhs</span></span><span> </span><span class="entity"><span>rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

     </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>var_S</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_Inters</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>rel_Inter_from_set_F</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_As</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>var_Ss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sets_F</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* map_F_Just = map_F Just *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_F_Just</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>option_tys</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_MaybeT</span></span><span> </span><span class="entity"><span>alphas</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>somes</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>Just_const</span></span><span> </span><span class="entity"><span>alphas</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span>subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>betas</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>option_tys</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>map_F</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>somes</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_set_F'_tm</span></span><span> </span><span class="entity"><span>typ_a</span></span><span> </span><span class="entity"><span>set_F</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>typ_aset</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>typ_a</span></span><span class="main"><span>;</span></span><span>

        </span><span class="comment1"><span>(* set_F' x = (⋂y∈{y. REL (map_F Just x) y}. UNION (set_F y) set_Maybe) *)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sbind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_UNION</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subst_Maybe</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>set_F</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_mx</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_Maybe_const</span></span><span> </span><span class="entity"><span>typ_a</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>collection</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.Collect_const</span></span><span> </span><span class="entity"><span>typ_MaybeF</span></span><span> </span><span>$</span><span> </span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>var_mx</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>subst_Maybe</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>equiv_rel_a</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_F_Just</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_x</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_mx</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_F'_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>lambda</span><span> </span><span class="entity"><span>var_x</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>Inf_const</span></span><span> </span><span class="entity"><span>typ_aset</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_image</span></span><span> </span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>var_mx</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sbind</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>collection</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>set_F'_tm</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_sets_of_bnf</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>deads</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>alphas</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sets'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_set_F'_tm</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Iwits</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit_goals</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>prepare_wits</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>repT</span></span><span> </span><span class="entity"><span>wits</span></span><span> </span><span class="entity"><span>opts</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>wits_F</span></span><span> </span><span class="entity"><span>var_as</span></span><span> </span><span class="entity"><span>var_as'</span></span><span> </span><span class="entity"><span>sets'</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_pos_distr</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>rel_Inters</span></span><span> </span><span>@</span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>wits</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>wit_goals</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>plugins</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>get_first</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Plugins_Option</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>rev</span><span> </span><span class="entity"><span>opts</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span>
      </span><span>the_default</span><span> </span><span class="entity"><span>Plugin_Name.default_filter</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>after_qed</span></span><span> </span><span class="entity"><span>thmss</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>thmss</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rel_pos_distr_thm0</span></span><span class="main"><span>]</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>thmss</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>equiv_thm'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>REL_rewr_all</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>equiv_thm</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_pos_distr_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.equivp_add_relconj|fact"><span>equivp_add_relconj</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>equiv_thm'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>equiv_thm'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_pos_distr_thm0</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_Inter_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit_thmss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>thmss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>take</span><span class="main"><span>,</span></span><span> </span><span>drop</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="comment1"><span>(* construct map_G, sets_G, bd_G, rel_G and wits_G *)</span></span><span>

          </span><span class="comment1"><span>(* map_G f = abs_G o map_F f o rep_G *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_G</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>lambda</span><span> </span><span class="entity"><span>var_fs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_comp</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>subst_Ts</span></span><span> </span><span class="entity"><span>abs_G</span></span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>,</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_F</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_fs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rep_G</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_raw</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>lambda</span><span> </span><span class="entity"><span>var_fs</span></span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_F</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_fs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>betas</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>gammas</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="comment1"><span>(* Define set_G and the three auxiliary definitions (set_F', F_in, F_in') *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_set_G</span></span><span> </span><span class="entity"><span>var_A</span></span><span> </span><span class="entity"><span>set_F</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>typ_a</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.dest_setT</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>var_A</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_F'_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_set_F'_tm</span></span><span> </span><span class="entity"><span>typ_a</span></span><span> </span><span class="entity"><span>set_F</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_F'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>define</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suffix</span></span><span> </span><span class="entity"><span>set_F</span></span><span> </span><span class="inner_quoted"><span>"'"</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="entity"><span>set_F'_tm</span></span><span class="main"><span>;</span></span><span>

              </span><span class="comment1"><span>(* set_G = set_F' o rep_G *)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_G</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>tm </span><span class="entity"><span>set_F'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rep_G</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

              </span><span class="comment1"><span>(* F_in A = {x. set_F x ⊆ A} *)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>F_in_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>lambda</span><span> </span><span class="entity"><span>var_A</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_in</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>var_A</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>set_F</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>typ_aF</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>F_in</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>define</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suffix</span></span><span> </span><span class="entity"><span>set_F</span></span><span> </span><span class="inner_quoted"><span>"_in"</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="entity"><span>F_in_tm</span></span><span class="main"><span>;</span></span><span>

              </span><span class="comment1"><span>(* F_in' A = map_F Inr -` ({(x, y). REL x y} `` F_in (insert (Inl ()) (Inr ` A))) *)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>F_in'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>lambda</span><span> </span><span class="entity"><span>var_A</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_vimage</span></span><span> </span><span class="entity"><span>map_F_Just</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Image_const</span></span><span> </span><span class="entity"><span>typ_MaybeF</span></span><span> </span><span>$</span><span>
                </span><span class="entity"><span>subst_Maybe</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>rel_pairs</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subst_Maybe</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>tm </span><span class="entity"><span>F_in</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>mk_insert</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Nothing</span></span><span> </span><span class="entity"><span>typ_a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_image</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Just_const</span></span><span> </span><span class="entity"><span>typ_a</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_A</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>F_in'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>define</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suffix</span></span><span> </span><span class="entity"><span>set_F</span></span><span> </span><span class="inner_quoted"><span>"_in'"</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="entity"><span>F_in'</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>set_G</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>{</span></span><span>set_F'</span><span class="main"><span>=</span></span><span class="entity"><span>set_F'</span></span><span class="main"><span>,</span></span><span> F_in</span><span class="main"><span>=</span></span><span class="entity"><span>F_in</span></span><span class="main"><span>,</span></span><span> F_in'</span><span class="main"><span>=</span></span><span class="entity"><span>F_in'</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>sets_G</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_F'_aux_defs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 2</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_set_G</span></span><span> </span><span class="entity"><span>var_As</span></span><span> </span><span class="entity"><span>sets_F</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span>|&gt;&gt;</span><span> </span><span>split_list</span><span class="main"><span>;</span></span><span>

          </span><span class="comment1"><span>(* bd_G = bd_F *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_G</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bd_of_bnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>

          </span><span class="comment1"><span>(* rel_F' A =
               BNF_Def.vimage2p (map_F Just) (map_F Just) ((≅) OO rel_F (rel_Maybe A) OO (≅)) *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_Maybes</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>aT</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bT</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>rel_Maybe_const</span></span><span> </span><span class="entity"><span>aT</span></span><span> </span><span class="entity"><span>bT</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_F'_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>equiv_equiv_rel_option</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>subst_Ts</span></span><span> </span><span class="entity"><span>equiv_rel_a'</span></span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_MaybeT</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>mk_vimage2p</span></span><span> </span><span class="entity"><span>map_F_Just</span></span><span> </span><span class="main"><span>(</span></span><span>subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alphas</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>map_F_Just</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span>
              </span><span class="entity"><span>mk_OO</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>equiv_equiv_rel_option</span></span><span> </span><span class="entity"><span>alphas</span></span><span class="main"><span>,</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_F_option</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_Maybes</span></span><span> </span><span class="entity"><span>var_Ps</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>equiv_equiv_rel_option</span></span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_F'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="entity"><span>define</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suffix</span></span><span> </span><span class="entity"><span>rel_F_ab</span></span><span> </span><span class="inner_quoted"><span>"'"</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>live</span></span><span>+</span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span>lambda</span><span> </span><span class="entity"><span>var_Ps</span></span><span> </span><span class="entity"><span>rel_F'_tm</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="comment1"><span>(* rel_G A = vimage2p rep_G rep_G (rel_F' A) *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_G</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>lambda</span><span> </span><span class="entity"><span>var_Ps</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_vimage2p</span></span><span> </span><span class="entity"><span>rep_G</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subst_Ts</span></span><span> </span><span class="entity"><span>rep_G</span></span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>rel_F'_tm</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_raw</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>lambda</span><span> </span><span class="entity"><span>var_Ps</span></span><span> </span><span class="entity"><span>rel_F'_tm</span></span><span>
            </span><span>|&gt;</span><span> </span><span>subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>betas</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>gammas</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="comment1"><span>(* auxiliary lemmas *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_card_order</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bd_card_order_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_cinfinite</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bd_cinfinite_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd_regularCard</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bd_regularCard_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>in_rel</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>in_rel_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_F_comp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_comp_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_F_comp0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_comp0_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_F_cong</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_cong_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_F_id0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_id0_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_F_id</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_id_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_conversep</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_conversep_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_flip</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_flip_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_eq_onp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_eq_onp_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_Grp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_Grp_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_OO</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_OO_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_map</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_map_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_refl_strong</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_refl_strong_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_bd_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>set_bd_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_map_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>set_map_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>



          </span><span class="comment1"><span>(* map_F_respect: @{term "((=) ===&gt; REL ===&gt; REL) map_F map_F"} *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_F_respect</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span class="entity"><span>mk_rel_fun</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>xT</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>yT</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>yT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>betas</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>equiv_rel_a</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>equiv_rel_b</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>map_F</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>map_F</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_F_respect_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span>
             </span><span class="main"><span>[</span></span><span>REPEAT_DETERM_N</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>live</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.rel_funI|fact"><span>rel_funI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BNF_FP_Util.split_conj_prems</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>rel_pos_distr_thm0</span></span><span> </span><span>OF</span><span>
                </span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.Grp_conversep_nonempty|fact"><span>Grp_conversep_nonempty</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>rev_mp</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>impI</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.predicate2D|fact"><span>predicate2D</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.relcomppI2|fact"><span>relcomppI2</span></a><span class="main"><span>[</span></span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_Grp</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.predicate2_eqD|fact"><span>predicate2_eqD</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>iffD2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.GrpI|fact"><span>GrpI</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>CollectI</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>subset_UNIV</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_flip</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>iffD2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_Grp</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.predicate2_eqD|fact"><span>predicate2_eqD</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>iffD2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.GrpI|fact"><span>GrpI</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>CollectI</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>subset_UNIV</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
              </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_eq_onp</span></span><span> </span><span>::</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.Grp_conversep_eq_onp|fact"><span>Grp_conversep_eq_onp</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.predicate2D|fact"><span>predicate2D</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.rel_conj_eq_onp|fact"><span>rel_conj_eq_onp</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>equiv_thm'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_F_respect_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>map_F_respect</span></span><span> </span><span class="entity"><span>map_F_respect_tac</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_funD</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rel_funDN</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>live</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_F_rsp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_funD</span></span><span> </span><span class="entity"><span>map_F_respect_thm</span></span><span class="main"><span>)</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_F_rsp_of</span></span><span> </span><span class="entity"><span>tms</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>NONE</span><span> </span><span>::</span><span> </span><span>NONE</span><span>
            </span><span>::</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tms</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>map_F_rsp</span></span><span class="main"><span>)</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>qthms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>equivp_THEN</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>REL_rewr_all</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>equiv_thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>Quotient3_THEN</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>REL_rewr_all</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>quot_thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="main"><span>{</span></span><span>abs_rep </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Quotient3_THEN</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.Quotient3_abs_rep|fact"><span>Quotient3_abs_rep</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
               rel_abs </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Quotient3_THEN</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.Quotient3_rel_abs|fact"><span>Quotient3_rel_abs</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
               rep_abs </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Quotient3_THEN</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.Quotient3_rep_abs|fact"><span>Quotient3_rep_abs</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
               rep_reflp </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Quotient3_THEN</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.Quotient3_rep_reflp|fact"><span>Quotient3_rep_reflp</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
               rep_abs_rsp </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Quotient3_THEN</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.rep_abs_rsp|fact"><span>rep_abs_rsp</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
               reflp </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>equivp_THEN</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Equiv_Relations.html#Equiv_Relations.equivp_reflp|fact"><span>equivp_reflp</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
               symp </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>equivp_THEN</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Equiv_Relations.html#Equiv_Relations.equivp_symp|fact"><span>equivp_symp</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
               transp </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>equivp_THEN</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Equiv_Relations.html#Equiv_Relations.equivp_transp|fact"><span>equivp_transp</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
               REL </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>REL_def</span></span><span class="main"><span>}</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="comment1"><span>(* lemma REL_OO_REL_left: REL OO REL OO R = REL OO R *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>REL_OO_REL_left_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>mk_OO</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>equiv_rel_a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>equiv_rel_a</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>var_R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_relcompp</span></span><span> </span><span class="entity"><span>equiv_rel_a</span></span><span> </span><span class="entity"><span>var_R</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span>
                </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ext</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ext</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>iffI</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>TWICE</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppE|fact"><span>relcomppE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppI|fact"><span>relcomppI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>transp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>TWICE</span></span><span> </span><span class="main"><span>(</span></span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppE|fact"><span>relcomppE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppI|fact"><span>relcomppI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppI|fact"><span>relcomppI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>reflp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>var_R</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="comment1"><span>(* Generate theorems related to the setters *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_F_fs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_F</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_fs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="comment1"><span>(* aset aset asetset bset typ_b typ_b *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_set_F'_thmss</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>var_A</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_A'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_S</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_B</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_b</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_b'</span></span><span class="main"><span>)</span></span><span>
                </span><span class="entity"><span>set_F</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>set_F'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>F_in</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>F_in'</span></span><span class="main"><span>}</span></span><span> </span><span class="entity"><span>rel_Inter_thm</span></span><span> </span><span class="entity"><span>set_map_F_thm</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>idx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vf</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_fs'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>vf</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"won't happen"</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>typ_a</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>var_f</span></span><span> </span><span>|&gt;</span><span> </span><span>dest_funT</span><span> </span><span>|&gt;</span><span> </span><span>fst</span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>typ_b</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>var_b</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>typ_asetset</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>typ_aset</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>`</span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>var_A</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_F_fs_x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_F_fs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_x</span></span><span class="main"><span>;</span></span><span>

              </span><span class="comment1"><span>(* F_in'_mono: A ⊆ B ⟹ F_in' A ⊆ F_in' B *)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>F_in'_mono_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_implies</span></span><span>
                </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>mk_leq</span></span><span> </span><span class="entity"><span>var_A</span></span><span> </span><span class="entity"><span>var_A'</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_leq</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>tm </span><span class="entity"><span>F_in'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>tm </span><span class="entity"><span>F_in'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_A'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>F_in'_mono_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>def </span><span class="entity"><span>F_in'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>def </span><span class="entity"><span>F_in</span></span><span class="main"><span>]</span></span><span> </span><span>THEN</span><span>
                </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span>
                  </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>subsetI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>vimageE</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.ImageE|fact"><span>ImageE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectE</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectE</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.case_prodD|fact"><span>case_prodD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vimageI</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>refl</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.ImageI|fact"><span>ImageI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.case_prodI|fact"><span>case_prodI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>ORELSE'</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>subset_trans</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.insert_mono|fact"><span>insert_mono</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.image_mono|fact"><span>image_mono</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>F_in'_mono_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>var_A</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_A'</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>F_in'_mono_tm</span></span><span> </span><span class="entity"><span>F_in'_mono_tac</span></span><span class="main"><span>;</span></span><span>

              </span><span class="comment1"><span>(* F_in'_Inter: F_in' (⋂S) = (⋂A∈S. F_in' A) *)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>F_in'_Inter_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>tm </span><span class="entity"><span>F_in'</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Inf_const</span></span><span> </span><span class="entity"><span>typ_aset</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_S</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>Inf_const</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>typ_aF</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_image</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>tm </span><span class="entity"><span>F_in'</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_S</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>F_in'_Inter_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span>Local_Defs.unfold_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>def </span><span class="entity"><span>F_in'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>def </span><span class="entity"><span>F_in</span></span><span class="main"><span>]</span></span><span>
                </span><span>THEN</span><span> </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                  </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_S</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bot_const</span></span><span> </span><span class="entity"><span>typ_asetset</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.case_split|fact"><span>case_split</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
                  </span><span>THEN'</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                    </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                    </span><span>SELECT_GOAL</span><span>
                      </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Complete_Lattices.html#Complete_Lattices.Inter_empty|fact"><span>Inter_empty</span></a><span> </span><a class="entity_ref" href="../../../../../Complete_Lattices.html#Complete_Lattices.INT_empty|fact"><span>INT_empty</span></a><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.UNIV_sum_unit_conv|fact"><span>UNIV_sum_unit_conv</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.set_eqI|fact"><span>set_eqI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>iffI</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>UNIV_I</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vimageI</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>refl</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.ImageI|fact"><span>ImageI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectI</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.case_prodI|fact"><span>case_prodI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>reflp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectI</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>subset_UNIV</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.exE|fact"><span>exE</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.ex_in_conv|fact"><span>ex_in_conv</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Complete_Lattices.html#Complete_Lattices.image_INT|fact"><span>image_INT</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../Set.html#Set.UNIV|const"><span>UNIV</span></a></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../Fun.html#Fun.id|const"><span>id</span></a></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>simplified</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Sum_Type.html#Sum_Type.inj_Inr|fact"><span>inj_Inr</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                    </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Complete_Lattices.html#Complete_Lattices.INT_extend_simps|fact"><span>INT_extend_simps</span></a><span> </span><a class="entity_ref" href="../../../../../Complete_Lattices.html#Complete_Lattices.vimage_INT|fact"><span>vimage_INT</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.arg_cong2|fact"><span>arg_cong2</span></a><span class="main"><span>[</span></span><span class="operator"><span>where</span></span><span> f</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><a class="entity_ref" href="../../../../../Set.html#Set.vimage|const"><span>vimage</span></a></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>equalityI</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>subsetI</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Complete_Lattices.html#Complete_Lattices.InterI|fact"><span>InterI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>imageE</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.ImageE|fact"><span>ImageE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectE</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectE</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.case_prodD|fact"><span>case_prodD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.ImageI|fact"><span>ImageI</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.CollectI|fact"><span>CollectI</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.case_prodI|fact"><span>case_prodI</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>ORELSE'</span><span> </span><span class="main"><span>(</span></span><span>SELECT_GOAL</span><span>
                      </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.refl|fact"><span>refl</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectI</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>subset_trans</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Complete_Lattices.html#Complete_Lattices.INT_lower|fact"><span>INT_lower</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.imageI|fact"><span>imageI</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.subset_trans|fact"><span>subset_trans</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>asm_rl</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_Inter_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.image_image|fact"><span>image_image</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>subset_refl</span></span><span class="main"><span>,</span></span><span>
                    </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Complete_Lattices.html#Complete_Lattices.INT_extend_simps|fact"><span>INT_extend_simps</span></a><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.ex_in_conv|fact"><span>ex_in_conv</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>exI</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>imageI</span></span><span class="main"><span>,</span></span><span>
                    </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>exI</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Complete_Lattices.html#Complete_Lattices.InterI|fact"><span>InterI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>imageE</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.insertI1|fact"><span>insertI1</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>F_in'_Inter_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>var_S</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>F_in'_Inter_tm</span></span><span> </span><span class="entity"><span>F_in'_Inter_tac</span></span><span class="main"><span>;</span></span><span>

              </span><span class="comment1"><span>(* set_F'_respect: (REL ===&gt; (=)) set_F' set_F' *)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_F'_respect_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rel_fun</span></span><span> </span><span class="entity"><span>equiv_rel_a</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span class="entity"><span>typ_aset</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>#</span></span><span>tm </span><span class="entity"><span>set_F'</span></span><span> </span><span>$</span><span> </span><span class="main"><span>#</span></span><span>tm </span><span class="entity"><span>set_F'</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>set_F'_respect_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>def </span><span class="entity"><span>set_F'</span></span><span> </span><span>::</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.rel_fun_def|fact"><span>rel_fun_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
                </span><span>THEN</span><span> </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span>
                  </span><span class="main"><span>[</span></span><span class="entity"><span>TWICE</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>allI</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>impI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_F_rsp_of</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>Just_const</span></span><span> </span><span class="entity"><span>alphas</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Complete_Lattices.html#Complete_Lattices.Inf_class.INF_cong|fact"><span>INF_cong</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.Collect_eqI|fact"><span>Collect_eqI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>iffI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>transp </span><span class="entity"><span>qthms</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>symp </span><span class="entity"><span>qthms</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>transp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

              </span><span class="comment1"><span>(* F_in'_alt2: F_in' A = {x. set_F' x ⊆ A} *)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>F_in'_alt2_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span>
                </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>tm </span><span class="entity"><span>F_in'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_A</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_in</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>var_A</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>tm </span><span class="entity"><span>set_F'</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>typ_aF</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>F_in'_alt2_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>equalityI</span></span><span> </span><span>THEN'</span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>Subgoal.FOCUS</span></span><span> </span><span>o</span><span> </span><span>K</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>def </span><span class="main"><span>[</span></span><span class="entity"><span>set_F'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>F_in'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>F_in</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
                </span><span>THEN'</span><span> </span><span>EVERY'</span><span>
                  </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>subsetI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>subsetI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>vimageD</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.ImageE|fact"><span>ImageE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectE</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectE</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.case_prodD|fact"><span>case_prodD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Complete_Lattices.html#Complete_Lattices.InterD|fact"><span>InterD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.imageI|fact"><span>imageI</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.CollectI|fact"><span>CollectI</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>symp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Complete_Lattices.html#Complete_Lattices.UnionE|fact"><span>UnionE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>imageE</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.subset_lift_sum_unitD|fact"><span>subset_lift_sum_unitD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Basic_BNFs.html#Basic_BNFs.setr.cases|fact"><span>setr.cases</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                  </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                </span><span>THEN</span><span> </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>def </span><span class="entity"><span>set_F'</span></span><span class="main"><span>]</span></span><span> </span><span>THEN</span><span>
                </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>subsetI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectE</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subsetD</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>F_in'_mono_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>F_in'_Inter_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Complete_Lattices.html#Complete_Lattices.InterI|fact"><span>InterI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span> </span><span>THEN</span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.imageE|fact"><span>imageE</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
                </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>[</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectE</span></span><span class="main"><span>,</span></span><span>
                  </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>def </span><span class="main"><span>[</span></span><span class="entity"><span>F_in'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>F_in</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.vimageI|fact"><span>vimageI</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.ImageI|fact"><span>ImageI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.case_prodI|fact"><span>case_prodI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>symp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>subsetI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.sum_insert_Inl_unit|fact"><span>sum_insert_Inl_unit</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>imageI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Complete_Lattices.html#Complete_Lattices.UnionI|fact"><span>UnionI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>imageI</span></span><span class="main"><span>,</span></span><span>
                  </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Basic_BNFs.html#Basic_BNFs.setr.intros|fact"><span>setr.intros</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>F_in'_alt2_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>var_A</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>F_in'_alt2_tm</span></span><span> </span><span class="entity"><span>F_in'_alt2_tac</span></span><span class="main"><span>;</span></span><span>

              </span><span class="comment1"><span>(* set_F'_alt: set_F' x = ⋂{A. x ∈ F_in' A} *)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_F'_alt_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>tm </span><span class="entity"><span>set_F'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_x</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>Inf_const</span></span><span> </span><span class="entity"><span>typ_aset</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>mk_Collect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_A</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_x</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>tm </span><span class="entity"><span>F_in'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_A</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>set_F'_alt_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>F_in'_alt2_thm</span></span><span class="main"><span>]</span></span><span>
                </span><span>THEN</span><span> </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span>
                  </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.set_eqI|fact"><span>set_eqI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>iffI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Complete_Lattices.html#Complete_Lattices.InterI|fact"><span>InterI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectE</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectE</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>subsetD</span></span><span class="main"><span>,</span></span><span>
                  </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                  </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Complete_Lattices.html#Complete_Lattices.InterD|fact"><span>InterD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>subset_refl</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_F'_alt_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>var_x</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>set_F'_alt_tm</span></span><span> </span><span class="entity"><span>set_F'_alt_tac</span></span><span class="main"><span>;</span></span><span>

              </span><span class="comment1"><span>(* map_F_in_F_in'I: x ∈ F_in' B ⟹ map_F f x ∈ F_in' (f ` B) *)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_F_in_F_in'I_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_implies</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_x</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>tm </span><span class="entity"><span>F_in'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_A'</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_F_fs_x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>subst_b</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>tm </span><span class="entity"><span>F_in'</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_image</span></span><span> </span><span class="entity"><span>var_f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_A'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_F_in_F_in'I_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span>Local_Defs.unfold_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>def </span><span class="entity"><span>F_in'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>def </span><span class="entity"><span>F_in</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Bex_def</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.vimage_def|fact"><span>vimage_def</span></a><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.Image_iff|fact"><span>Image_iff</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
                </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span>
                  </span><span class="main"><span>[</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.CollectE|fact"><span>CollectE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>exE</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.CollectE|fact"><span>CollectE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.CollectE|fact"><span>CollectE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.case_prodD|fact"><span>case_prodD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.CollectI|fact"><span>CollectI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>exI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span>[</span></span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.CollectI|fact"><span>CollectI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.case_prodI|fact"><span>case_prodI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_F_rsp_of</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>mk_Maybe_map</span></span><span> </span><span class="entity"><span>var_fs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_F_comp</span></span><span> </span><span>::</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.o_def|fact"><span>o_def</span></a><span> </span><a class="entity_ref" href="../../../../../Sum_Type.html#Sum_Type.map_sum.simps|fact"><span>map_sum.simps</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectI</span></span><span class="main"><span>,</span></span><span>
                  </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>set_map_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.image_map_sum_unit_subset|fact"><span>image_map_sum_unit_subset</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_F_in_F_in'I_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_A'</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>var_x</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>var_fs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>map_F_in_F_in'I_tm</span></span><span> </span><span class="entity"><span>map_F_in_F_in'I_tac</span></span><span class="main"><span>;</span></span><span>

              </span><span class="comment1"><span>(* REL_preimage_eq: C ∩ range f ≠ {} ⟹
                    {(a, b). REL a b} `` {x. set_F x ⊆ f -` C} =
                        map_F f -` {(a, b). REL a b} `` {x. set_F x ⊆ C} *)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>REL_preimage_eq_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_implies</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_not</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_binop</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../Lattices.html#Lattices.inf_class.inf|const"><span>inf</span></a><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_B</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_image</span></span><span> </span><span class="entity"><span>var_f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span> </span><span class="entity"><span>typ_a</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>bot_const</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>typ_b</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Image_const</span></span><span> </span><span class="entity"><span>typ_aF</span></span><span> </span><span>$</span><span>
                    </span><span class="entity"><span>rel_pairs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>mk_in</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mk_vimage</span></span><span> </span><span class="entity"><span>var_f</span></span><span> </span><span class="entity"><span>var_B</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>set_F</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>typ_aF</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_vimage</span></span><span> </span><span class="entity"><span>map_F_fs</span></span><span>
                    </span><span class="main"><span>(</span></span><span class="entity"><span>Image_const</span></span><span> </span><span class="entity"><span>typ_bF</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>subst_b</span></span><span> </span><span class="entity"><span>rel_pairs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>mk_in</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>var_B</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>subst_b</span></span><span> </span><span class="entity"><span>set_F</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>typ_bF</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

              </span><span class="comment1"><span>(* Bs ∩ range fs ≠ {} ⟹ set_F xb ⊆ Bs ⟹ REL xb (map_F fs x)
                    ⟹ x ∈ {(x, x'). REL x x'} `` {x. set_F x ⊆ fs -` Bs}              *)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>subgoal_tac</span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>params</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                    </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"won't happen"</span></span><span class="main"><span>;</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cond</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span>apply2</span><span> </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>var_b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_B</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_b'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_B</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

                  </span><span class="comment1"><span>(* ["λx y. x ∈ B ∧ y ∈ B", "(Grp UNIV f_1)¯¯"] *)</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cvars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>var_fs</span></span><span> </span><span>|&gt;</span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                    </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
                      </span><span class="main"><span>[</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>var_f</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                        </span><span>fold_rev</span><span> </span><span>lambda</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>var_b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_b'</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>cond</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span class="main"><span>(</span></span><span>range_type</span><span> </span><span class="entity"><span>fT</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span class="entity"><span>mk_conversep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Grp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span> </span><span class="main"><span>(</span></span><span>domain_type</span><span> </span><span class="entity"><span>fT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_pos_distr_thm_inst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cvars</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span>SOME</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.predicate2D|fact"><span>predicate2D</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rel_pos_distr_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

                  </span><span class="comment1"><span>(* GrpI[of "map_F f1 .. fN" x, OF refl CollectI, OF "B1 ⊆ UNIV ∧ ... ∧ Bn ⊆ UNIV"] *)</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>subset_UNIVs</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>conjI</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span>-</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.subset_UNIV|fact"><span>subset_UNIV</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.subset_UNIV|fact"><span>subset_UNIV</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>GrpI_inst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>SOME</span><span> </span><span class="main"><span>[</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>map_F_fs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.GrpI|fact"><span>GrpI</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>refl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>CollectI</span></span><span class="main"><span>]</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>subset_UNIVs</span></span><span> </span><span class="entity"><span>live</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

                </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>EVERY</span><span> </span><span class="main"><span>[</span></span><span>
                  </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Method.insert_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rel_pos_distr_thm_inst</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rel_conversep</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_OO</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_Grp</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                  </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../../Pure/Pure/Pure.html#Pure.meta_impE|fact"><span>meta_impE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM_N</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>live</span></span><span>-</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span>[</span></span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM_N</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.relcompp_mem_Grp_neq_bot|fact"><span>relcompp_mem_Grp_neq_bot</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>ORELSE'</span><span>
                      </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.relcompp_eq_Grp_neq_bot|fact"><span>relcompp_eq_Grp_neq_bot</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../../Pure/Pure/Pure.html#Pure.meta_impE|fact"><span>meta_impE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppI|fact"><span>relcomppI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>reflp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppI|fact"><span>relcomppI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>rel_refl_strong</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM_N</span><span> </span><span class="entity"><span>idx</span></span><span> </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>TWICE</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>subsetD</span></span><span> </span><span>THEN'</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM_N</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>live</span></span><span>-</span><span class="entity"><span>idx</span></span><span>-</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span>
                    </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppI|fact"><span>relcomppI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppI|fact"><span>relcomppI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.conversepI|fact"><span>conversepI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>GrpI_inst</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>reflp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppE|fact"><span>relcomppE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppE|fact"><span>relcomppE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppE|fact"><span>relcomppE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.conversepE|fact"><span>conversepE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.GrpE|fact"><span>GrpE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.ImageI|fact"><span>ImageI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectI</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.case_prodI|fact"><span>case_prodI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>EqSubst.eqsubst_asm_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>rel_map</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>EqSubst.eqsubst_asm_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>in_rel_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>exE</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectE</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectE</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectI</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>set_map_thms</span></span><span class="main"><span>,</span></span><span>
                  </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subsetI</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>vimageI</span></span><span class="main"><span>]</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>refl</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>THEN'</span><span>
                            </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.imageE|fact"><span>imageE</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM_N</span><span> </span><span class="inner_numeral"><span>6</span></span><span> </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>Drule.thin_rl</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM_N</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>live</span></span><span>-</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>subsetD</span></span><span class="main"><span>,</span></span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectE</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.split_beta|fact"><span>split_beta</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjunct2</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>REL_preimage_eq_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span>
                </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.set_eqI|fact"><span>set_eqI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>iffI</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.ImageE|fact"><span>ImageE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectE</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectE</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.case_prodD|fact"><span>case_prodD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vimageI</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>refl</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.ImageI|fact"><span>ImageI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectI</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.case_prodI|fact"><span>case_prodI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>map_F_rsp</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectI</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>set_map_F_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.subset_vimage_image_subset|fact"><span>subset_vimage_image_subset</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>vimageE</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.ImageE|fact"><span>ImageE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>TWICE</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectE</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.case_prodD|fact"><span>case_prodD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>Subgoal.FOCUS_PARAMS</span></span><span> </span><span class="entity"><span>subgoal_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>REL_preimage_eq_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_B</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>var_fs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>REL_preimage_eq_tm</span></span><span> </span><span class="entity"><span>REL_preimage_eq_tac</span></span><span class="main"><span>;</span></span><span>

              </span><span class="comment1"><span>(* set_map_F': set_F' (map_F f x) = f ` set_F' x *)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_map_F'_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subst_b</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>tm </span><span class="entity"><span>set_F'</span></span><span class="main"><span>)</span></span><span>
                </span><span>$</span><span> </span><span class="entity"><span>map_F_fs_x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_image</span></span><span> </span><span class="entity"><span>var_f</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>tm </span><span class="entity"><span>set_F'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>set_map_F'_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span>
                  </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.set_eqI|fact"><span>set_eqI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>iffI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>EqSubst.eqsubst_asm_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>set_F'_alt_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Complete_Lattices.html#Complete_Lattices.InterD|fact"><span>InterD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>map_F_in_F_in'I_thm</span></span><span class="main"><span>,</span></span><span>
                  </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>F_in'_alt2_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>subset_refl</span></span><span class="main"><span>,</span></span><span>
                  </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>set_F'_alt_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Complete_Lattices.html#Complete_Lattices.InterI|fact"><span>InterI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>imageE</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectE</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.vimageD|fact"><span>vimageD</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../Complete_Lattices.html#Complete_Lattices.InterD|fact"><span>InterD</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectI</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
                  </span><span class="comment1"><span>(* map_F f x ∈ F_in' X ⟹ x ∈ F_in' (f -` X) *)</span></span><span>
                  </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Subgoal.FOCUS_PARAMS</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>params</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>|&gt;</span><span> </span><span>snd</span><span> </span><span>|&gt;</span><span> </span><span>Thm.term_of</span><span class="main"><span>;</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Inr_img</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_image</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Just_const</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.dest_setT</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>;</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>cvars_of</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cut_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cvars_of</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Inr_img</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_f</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.insert_Inl_int_map_sum_unit|fact"><span>insert_Inl_int_map_sum_unit</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>preimage_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cvars_of</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
                          </span><span class="main"><span>(</span></span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>var_f</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>var_fs</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_Maybe_map</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                        </span><span class="main"><span>(</span></span><span class="entity"><span>cut_thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>REL_preimage_eq_thm</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>EVERY</span><span> </span><span class="main"><span>[</span></span><span>
                      </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>def </span><span class="main"><span>[</span></span><span class="entity"><span>F_in'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>F_in</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>preimage_thm</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>map_F_comp</span></span><span> </span><span>::</span><span>
                          </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.lift_sum_unit_vimage_commute|fact"><span>lift_sum_unit_vimage_commute</span></a><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.vimage_comp|fact"><span>vimage_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.o_def|fact"><span>o_def</span></a><span> </span><a class="entity_ref" href="../../../../../Sum_Type.html#Sum_Type.map_sum.simps|fact"><span>map_sum.simps</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.o_def|fact"><span>o_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_F_comp0</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                      </span><span>Local_Defs.fold_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.vimage_comp|fact"><span>vimage_comp</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                      </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vimageI</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>refl</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

              </span><span class="comment1"><span>(* set_F'_subset: set_F' x ⊆ set_F x *)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_F'_subset_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_leq</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>tm </span><span class="entity"><span>set_F'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_F</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>set_F'_subset_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>int_e_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                  </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="inner_numeral"><span>3</span></span><span> </span><span>NONE</span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_F_Just</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Complete_Lattices.html#Complete_Lattices.INT_E|fact"><span>INT_E</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span>Local_Defs.unfold_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>def </span><span class="entity"><span>set_F'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>subsetI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>int_e_thm</span></span><span class="main"><span>,</span></span><span>
                  </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>set_map_F_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Complete_Lattices.html#Complete_Lattices.UN_E|fact"><span>UN_E</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>imageE</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                  </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Fixpoint_Base.html#BNF_Fixpoint_Base.sum_set_simps|fact"><span>sum_set_simps</span></a><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.singleton_iff|fact"><span>singleton_iff</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                  </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>notE</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>reflp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span>F_in'_mono </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>F_in'_mono_thm</span></span><span class="main"><span>,</span></span><span>
                F_in'_Inter </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>F_in'_Inter_thm</span></span><span class="main"><span>,</span></span><span>
                set_F'_respect </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>set_F'_respect_tm</span></span><span> </span><span class="entity"><span>set_F'_respect_tac</span></span><span class="main"><span>,</span></span><span>
                F_in'_alt2 </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>F_in'_alt2_thm</span></span><span class="main"><span>,</span></span><span>
                set_F'_alt </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>set_F'_alt_thm</span></span><span class="main"><span>,</span></span><span>
                map_F_in_F_in'I </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_F_in_F_in'I_thm</span></span><span class="main"><span>,</span></span><span>
                set_map_F' </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_x</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>var_fs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_map_F'_tm</span></span><span> </span><span class="entity"><span>set_map_F'_tac</span></span><span class="main"><span>,</span></span><span>
                set_F'_subset </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>var_x</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>set_F'_subset_tm</span></span><span> </span><span class="entity"><span>set_F'_subset_tac</span></span><span class="main"><span>,</span></span><span>
                set_F'_def </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>def </span><span class="entity"><span>set_F'</span></span><span class="main"><span>,</span></span><span>
                F_in_def </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>def </span><span class="entity"><span>F_in</span></span><span class="main"><span>,</span></span><span>
                F_in'_def </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>def </span><span class="entity"><span>F_in'</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>idx</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_fs'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_F'_thmss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_set_F'_thmss</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>var_As</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>var_As'</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>var_Ss</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>var_Bs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>var_bs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>var_bs'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sets_F</span></span><span> </span><span class="entity"><span>set_F'_aux_defs</span></span><span>
            </span><span class="entity"><span>rel_Inter_thms</span></span><span> </span><span class="entity"><span>set_map_thms</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_fs</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>fst</span><span class="main"><span>;</span></span><span>

          </span><span class="comment1"><span>(* F_in'D: x ∈ F_in' A ⟹ ∀a∈A. f a = g a ⟹ REL (map_F f x) (map_F g x) *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rel_map_F_fs_map_F_gs</span></span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>gs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>equiv_rel_b</span></span><span> </span><span>$</span><span>
            </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>map_F</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_x</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>map_F</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>F_in'D_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prem</span></span><span> </span><span class="entity"><span>var_a</span></span><span> </span><span class="entity"><span>var_Aset</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>F_in'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="entity"><span>var_f</span></span><span> </span><span class="entity"><span>var_g</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_x</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>tm </span><span class="entity"><span>F_in'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_Aset</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_Ball</span></span><span> </span><span class="entity"><span>var_Aset</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>var_a</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_g</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_a</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_prem</span></span><span> </span><span class="entity"><span>var_as</span></span><span> </span><span class="entity"><span>var_As</span></span><span> </span><span class="entity"><span>set_F'_aux_defs</span></span><span> </span><span class="entity"><span>var_fs'</span></span><span> </span><span class="entity"><span>var_gs'</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>F_in'D_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_implies</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rel_map_F_fs_map_F_gs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subst_Maybe</span></span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>var_fs'</span></span><span> </span><span class="entity"><span>var_gs'</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_F_rsp_of_case_sums</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_F_rsp_of</span></span><span>
                </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 2</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>BNF_FP_Util.mk_case_sum</span></span><span>
                  </span><span class="main"><span>(</span></span><span>Term.absdummy</span><span> </span><span class="entity"><span>HOLogic.unitT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Nothing</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_var_fgs</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>take</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>var_gs'</span></span><span> </span><span>@</span><span> </span><span>drop</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>var_fs'</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>F_in'D_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>EVERY</span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
                  </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>F_in'_def</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>F_in_def</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>F_in'_def</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>F_in_def</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_F'_thmss</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span>
                </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>REPEAT_DETERM_N</span><span> </span><span class="entity"><span>live</span></span><span> </span><span>o</span><span> </span><span>HEADGOAL</span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>[</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>vimageE</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.ImageE|fact"><span>ImageE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectE</span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectE</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.case_prodD|fact"><span>case_prodD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
                </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>THEN'</span><span> </span><span>rotate_tac</span><span> </span><span class="main"><span>(</span></span><span>~</span><span class="entity"><span>live</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span>
                </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>[</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>&lt;</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>transp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>K</span><span> </span><span>all_tac</span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>Ctr_Sugar_Tactics.select_prem_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>(</span></span><span>dresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>asm_rl</span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>transp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_F_rsp_of_case_sums</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_var_fgs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span>-</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_F_comp</span></span><span> </span><span>::</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.case_sum_o_inj|fact"><span>case_sum_o_inj</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>symp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_F_rsp_of_case_sums</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_var_fgs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_F_comp</span></span><span> </span><span>::</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.case_sum_o_inj|fact"><span>case_sum_o_inj</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>map_F_cong</span></span><span> </span><span>OF</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>refl</span></span><span> </span><span>@</span><span> </span><span>asm_rl</span><span> </span><span>::</span><span> </span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>live</span></span><span>-</span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Sum_Type.html#Sum_Type.sum.case_cong|fact"><span>sum.case_cong</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.refl|fact"><span>refl</span></a><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>bspec</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.subset_lift_sum_unitD|fact"><span>subset_lift_sum_unitD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                  </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>live</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_x</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>var_As</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>var_fs'</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>var_gs'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>F_in'D_tm</span></span><span> </span><span class="entity"><span>F_in'D_tac</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="comment1"><span>(* map_F_cong': (⋀a. a ∈ set_F' x ⟹ f a = g a) ⟹ REL (map_F f x) (map_F g x) *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_F_cong'_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prem</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>set_F'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="entity"><span>var_a</span></span><span> </span><span class="entity"><span>var_f</span></span><span> </span><span class="entity"><span>var_g</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>var_a</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_implies</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_a</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>tm </span><span class="entity"><span>set_F'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_x</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_g</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_a</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_F_cong'_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.list_implies</span><span>
                </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_prem</span></span><span> </span><span class="entity"><span>set_F'_aux_defs</span></span><span> </span><span class="entity"><span>var_as</span></span><span> </span><span class="entity"><span>var_fs</span></span><span> </span><span class="entity"><span>var_gs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>rel_map_F_fs_map_F_gs</span></span><span> </span><span>I</span><span> </span><span class="entity"><span>var_fs</span></span><span> </span><span class="entity"><span>var_gs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>Just_o_fun</span></span><span> </span><span class="entity"><span>bT</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Just_const</span></span><span> </span><span class="entity"><span>bT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_F_Just_o_funs</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>list_comb</span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>subst_Maybe</span></span><span> </span><span class="entity"><span>betas</span></span><span> </span><span class="entity"><span>map_F</span></span><span class="main"><span>,</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>Just_o_fun</span></span><span> </span><span class="entity"><span>betas</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_x</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_F_cong'_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_F_respect_inst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_F_rsp</span></span><span>
                    </span><span>|&gt;</span><span> </span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
                      </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>map_F_Just_o_funs</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>var_fs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_gs</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>fromJust_const</span></span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                    </span><span>|&gt;</span><span> </span><span>Local_Defs.unfold</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_F_comp</span></span><span> </span><span>::</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.o_assoc|fact"><span>o_assoc</span></a><span>
                      </span><a class="entity_ref" href="../../../../../Fun.html#Fun.o_apply|fact"><span>Fun.o_apply</span></a><span class="main"><span>[</span></span><span class="operator"><span>where</span></span><span> f</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><a class="entity_ref" href="../../../../../Sum_Type.html#Sum_Type.sum.projr|const"><span>projr</span></a></span><span> </span><span class="quasi_keyword"><span class="quasi_keyword"><span>and</span></span></span><span> g</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><a class="entity_ref" href="../../../../../Sum_Type.html#Sum_Type.Inr|const"><span>Inr</span></a></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="../../../../../Sum_Type.html#Sum_Type.sum.sel|fact"><span>sum.sel</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.id_def|fact"><span>id_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
                    </span><span>|&gt;</span><span> </span><span>Local_Defs.unfold</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.id_comp|fact"><span>id_comp</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                  </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>map_F_respect_inst</span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>F_in'D_thm</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
                  </span><span>EVERY</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>F_in'_alt2</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                    </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>F_in'_alt2</span></span><span class="main"><span>]</span></span><span> </span><span>THEN</span><span>
                    </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span>
                      </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectI</span></span><span class="main"><span>,</span></span><span>
                      </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>subset_refl</span></span><span class="main"><span>,</span></span><span>
                      </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ballI</span></span><span class="main"><span>,</span></span><span>
                      </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>o_apply</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.arg_cong|fact"><span>arg_cong</span></a><span class="main"><span>[</span></span><span class="operator"><span>where</span></span><span> f</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><a class="entity_ref" href="../../../../../Sum_Type.html#Sum_Type.Inr|const"><span>Inr</span></a></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                      </span><span class="entity"><span>asm_full_simp_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_F'_thmss</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_x</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>var_fs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>var_gs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>map_F_cong'_tm</span></span><span> </span><span class="entity"><span>map_F_cong'_tac</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="comment1"><span>(* rel_F'_set: "rel_F' P x y ⟷
            (∃z. set_F' z ⊆ {(x, y). P x y} ∧ REL (map_F fst z) x ∧ REL (map_F snd z) y)" *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_F'_set_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>tm </span><span class="entity"><span>rel_F'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_Ps</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_y</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_subset_A</span></span><span> </span><span class="entity"><span>var_a</span></span><span> </span><span class="entity"><span>var_b</span></span><span> </span><span class="entity"><span>var_P</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>set_F'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>collect_A</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_case_prod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_P</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_a</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_b</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>mk_leq</span></span><span> </span><span class="main"><span>(</span></span><span>subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alphas</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>typ_pairs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>tm </span><span class="entity"><span>set_F'</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_z</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>collect_A</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subset_As</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_subset_A</span></span><span> </span><span class="entity"><span>var_as</span></span><span> </span><span class="entity"><span>var_bs</span></span><span> </span><span class="entity"><span>var_Ps</span></span><span> </span><span class="entity"><span>set_F'_aux_defs</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_map</span></span><span> </span><span class="entity"><span>mfs</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mfs</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>Term.strip_comb</span><span> </span><span>o</span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>var_ts</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_F_fst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>typ_pairs</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_F_snd</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>typ_pairs</span></span><span> </span><span class="entity"><span>betas</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_fst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>equiv_rel_a</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_map</span></span><span> </span><span class="entity"><span>map_F_fst</span></span><span> </span><span class="entity"><span>HOLogic.mk_fst</span></span><span> </span><span class="entity"><span>var_z</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_x</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_snd</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>equiv_rel_b</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_map</span></span><span> </span><span class="entity"><span>map_F_snd</span></span><span> </span><span class="entity"><span>HOLogic.mk_snd</span></span><span> </span><span class="entity"><span>var_z</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_y</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>dest_Free</span><span> </span><span class="entity"><span>var_z</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>HOLogic.mk_exists</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>subset_As</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>map_fst</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>map_snd</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_F'_set_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lhs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>maybePairsTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_prodT</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>mk_MaybeT</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span>~~</span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_MaybeT</span></span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_map_prod_projr</span></span><span> </span><span class="entity"><span>aT</span></span><span> </span><span class="entity"><span>bT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mabT</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>maT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mbT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>`</span><span class="entity"><span>HOLogic.mk_prodT</span></span><span> </span><span class="main"><span>(</span></span><span>apply2</span><span> </span><span class="entity"><span>mk_MaybeT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>aT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_prod_const</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.map_prod|const"><span>map_prod</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>maT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>aT</span></span><span class="main"><span>)</span></span><span> </span><span>--&gt;</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mbT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>bT</span></span><span class="main"><span>)</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>mabT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_prodT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>aT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>map_prod_const</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>fromJust_const</span></span><span> </span><span class="entity"><span>aT</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>fromJust_const</span></span><span> </span><span class="entity"><span>bT</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>exI_OF_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
              </span><span class="main"><span>(</span></span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>NONE</span><span> </span><span>::</span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>exI</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="comment1"><span>(* REL (map_F Inr x) (map_F fst z) ⟹ REL (map_F snd z) (map_F Inr y) ⟹
                 set_F z ⊆ {(x, y). rel_sum (=) P x y} ⟹
                 ∃z. set_F' z ⊆ {(x, y). P x y} ∧ REL (map_F fst z) x ∧ REL (map_F snd z) y *)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>subgoal1_tac</span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>params</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                    </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span> </span><span>::</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ct</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct</span></span><span>
                  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"won't happen"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_F_projr_z</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>maybePairsTs</span></span><span> </span><span class="entity"><span>typ_pairs</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>,</span></span><span>
                  </span><span>map2</span><span> </span><span class="entity"><span>mk_map_prod_projr</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>exI_OF_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>map_F_projr_z</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
                </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>set_F'_subset</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_F'_respect</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_map_F'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_F'_subset</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.preorder_class.order_trans|fact"><span>order_trans</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>TWICE</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_F'_respect</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.rel_funD|fact"><span>rel_funD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>set_map_F'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.in_rel_sum_in_image_projr|fact"><span>in_rel_sum_in_image_projr</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>TWICE</span></span><span> </span><span class="main"><span>(</span></span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_F'_thmss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
                </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>FIRST'</span><span>
                  </span><span class="main"><span>[</span></span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_F_rsp_of</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>fromJust_const</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="main"><span>,</span></span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>alphas</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
                </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_F_comp</span></span><span> </span><span>::</span><span>
                  </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.fst_comp_map_prod|fact"><span>fst_comp_map_prod</span></a><span> </span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.snd_comp_map_prod|fact"><span>snd_comp_map_prod</span></a><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.comp_projr_Inr|fact"><span>comp_projr_Inr</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>map_F_id</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
                </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
                </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>symp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span> </span><span>THEN'</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                  </span><span>ORELSE'</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                    </span><span class="main"><span>[</span></span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_F_rsp_of</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>fromJust_const</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_F_comp</span></span><span> </span><span>::</span><span>
                      </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.fst_comp_map_prod|fact"><span>fst_comp_map_prod</span></a><span> </span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.snd_comp_map_prod|fact"><span>snd_comp_map_prod</span></a><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.comp_projr_Inr|fact"><span>comp_projr_Inr</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>map_F_id</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>alphas</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

            </span><span class="comment1"><span>(* set_F' z ⊆ {(x, y). P x y} ⟹ REL (map_F fst z) x ⟹ REL (map_F snd z) y ⟹
                 ∃b. REL (map_F Inr x) b ∧ (∃ba. rel_F (rel_sum (=) P) b ba ∧ REL ba (map_F Inr y)) *)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>subgoal2_tac</span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>params</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                  </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ct</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct</span></span><span>
                </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"won't happen"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

                </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>exI_map_Ifs_tac</span></span><span> </span><span class="entity"><span>mk_proj</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>exI_OF_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>mk_map_of_bnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>typ_pairs</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>mk_MaybeT</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span>
                    </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>var_t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>set_F'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>lambda</span><span> </span><span class="entity"><span>var_t</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BNF_FP_Util.mk_If</span></span><span>
                      </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>subst_Ts</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>tm </span><span class="entity"><span>set_F'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>typ_pairs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                      </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Just</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_proj</span></span><span> </span><span class="entity"><span>var_t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Nothing</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>var_ts</span></span><span> </span><span class="entity"><span>set_F'_aux_defs</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span>

                </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_REL_trans_map_F</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>rotate_prems</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>transp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span> </span><span>OF</span><span>
                  </span><span class="main"><span>[</span></span><span class="entity"><span>rel_funD</span></span><span> </span><span class="entity"><span>map_F_respect_thm</span></span><span class="main"><span>]</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>refl</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>symp </span><span class="entity"><span>qthms</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span>
                  </span><span class="main"><span>[</span></span><span class="entity"><span>exI_map_Ifs_tac</span></span><span> </span><span class="entity"><span>HOLogic.mk_fst</span></span><span> </span><span class="entity"><span>alphas</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_REL_trans_map_F</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
                </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>map_F_comp</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.o_def|fact"><span>o_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span> </span><span>THEN</span><span>
                </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>map_F_cong'_thm</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
                </span><span>REPEAT_DETERM_N</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.if_P|fact"><span>if_P</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
                </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>exI_map_Ifs_tac</span></span><span> </span><span class="entity"><span>HOLogic.mk_snd</span></span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
                </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>rel_map</span></span><span> </span><span>THEN</span><span>
                </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>rel_refl_strong</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
                </span><span>REPEAT_DETERM_N</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.subset_rel_sumI|fact"><span>subset_rel_sumI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
                </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_REL_trans_map_F</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>symp </span><span class="entity"><span>qthms</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
                </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>map_F_comp</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.o_def|fact"><span>o_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span> </span><span>THEN</span><span>
                </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>map_F_cong'_thm</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
                </span><span>REPEAT_DETERM_N</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.if_P|fact"><span>if_P</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rel_F'_set_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>EVERY</span><span>
              </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>def </span><span class="entity"><span>rel_F'</span></span><span> </span><span>::</span><span> </span><span class="main"><span>#</span></span><span>REL </span><span class="entity"><span>qthms</span></span><span> </span><span>::</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.vimage2p_def|fact"><span>vimage2p_def</span></a><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcompp_apply|fact"><span>relcompp_apply</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>iffI</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span>o</span><span> </span><span class="entity"><span>TWICE</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>exE</span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span>
                </span><span class="main"><span>[</span></span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>in_rel</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>iffD1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>exE</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>TWICE</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>CollectE</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="main"><span>(</span></span><span>REPEAT_DETERM_N</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>live</span></span><span>-</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>HEADGOAL</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Subgoal.FOCUS_PARAMS</span></span><span> </span><span class="entity"><span>subgoal1_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>exE</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="main"><span>(</span></span><span>REPEAT_DETERM_N</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>live</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>HEADGOAL</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Subgoal.FOCUS_PARAMS</span></span><span> </span><span class="entity"><span>subgoal2_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_x</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>var_y</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>var_Ps</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel_F'_set_tm</span></span><span> </span><span class="entity"><span>rel_F'_set_tac</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="comment1"><span>(* tactics *)</span></span><span>

          </span><span class="comment1"><span>(* map_G_id0: abs_G ∘ map_F id ∘ rep_G = id *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_G_id0_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
            </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.fun_eq_iff|fact"><span>fun_eq_iff</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>o_apply</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_F_id0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>id_apply</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>abs_rep </span><span class="entity"><span>qthms</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>allI</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="comment1"><span>(* map_G (g ∘ f) = map_G g ∘ map_G f *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_G_comp0_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ext</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
            </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>o_apply</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_F_comp0</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel_abs </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>map_F_rsp</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rep_abs </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>reflp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="comment1"><span>(* map_G_cong: (⋀z. z ∈ set_G x ⟹ f z = g z) ⟹ map_G f x = map_G g x *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_G_cong_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>EVERY</span><span>
            </span><span class="main"><span>[</span></span><span>Local_Defs.fold_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>set_F'_def </span><span class="entity"><span>set_F'_thmss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>o_apply</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel_abs </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>map_F_cong'_thm</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM_N</span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>asm_full_simp_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

          </span><span class="comment1"><span>(* set_G_map0_G: set_G ∘ map_G f = f ` set_G *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_set_G_map0_G_tac</span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ext</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span>
            </span><span>EVERY</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>o_apply</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
              </span><span>Local_Defs.fold_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>set_F'_def </span><span class="entity"><span>thms</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span> </span><span>THEN</span><span>
            </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>[</span></span><span class="entity"><span>trans</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>set_map_F' </span><span class="entity"><span>thms</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>]</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
               </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.rel_funD|fact"><span>rel_funD</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>set_F'_respect </span><span class="entity"><span>thms</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
               </span><span class="main"><span>#</span></span><span>rep_abs </span><span class="entity"><span>qthms</span></span><span class="main"><span>,</span></span><span>
               </span><span class="entity"><span>map_F_rsp</span></span><span class="main"><span>,</span></span><span>
               </span><span class="main"><span>#</span></span><span>rep_reflp </span><span class="entity"><span>qthms</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="comment1"><span>(* bd_card_order: card_order bd_F *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>bd_card_order_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>bd_card_order</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="comment1"><span>(* bd_cinfinite: BNF_Cardinal_Arithmetic.cinfinite bd_F *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>bd_cinfinite_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>bd_cinfinite</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="comment1"><span>(* bd_regularCard: regularCard bd_F *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>bd_regularCard_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>bd_regularCard</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="comment1"><span>(*target: ordLess2 (card_of (set_F' (rep_G x_))) bd_F*)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_set_G_bd_tac</span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="entity"><span>set_bd_thm</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>EVERY</span><span>
            </span><span class="main"><span>[</span></span><span>Local_Defs.fold_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>set_F'_def </span><span class="entity"><span>thms</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>o_apply</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Wellorder_Constructions.html#BNF_Wellorder_Constructions.ordLeq_ordLess_trans|fact"><span>ordLeq_ordLess_trans</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span>
              </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Cardinal_Order_Relation.html#BNF_Cardinal_Order_Relation.card_of_mono1|fact"><span>card_of_mono1</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>set_F'_subset </span><span class="entity"><span>thms</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_bd_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

          </span><span class="comment1"><span>(* rel_compp: rel_G R OO rel_G S ≤ rel_G (R OO S) *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rel_compp_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>EVERY</span><span>
            </span><span class="main"><span>[</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>REL </span><span class="entity"><span>qthms</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TWICE</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Composition.html#BNF_Composition.vimage2p_relcompp_mono|fact"><span>vimage2p_relcompp_mono</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>REL_OO_REL_left_thm</span></span><span> </span><span>::</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcompp_assoc|fact"><span>relcompp_assoc</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>Local_Defs.unfold</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.eq_OO|fact"><span>eq_OO</span></a><span class="antiquote"><span>}</span></span></span></span><span>
              </span><span class="main"><span>(</span></span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span class="entity"><span>HOLogic.unitT</span></span><span> </span><span>|&gt;</span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>|&gt;</span><span> </span><span>SOME</span><span class="main"><span>]</span></span><span>
                </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Basic_BNFs.html#Basic_BNFs.Sum_Type.sum.rel_compp|fact"><span>sum.rel_compp</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>rel_pos_distr_thm</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.fun_eq_iff|fact"><span>fun_eq_iff</span></a><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.bot_apply|fact"><span>bot_apply</span></a><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.bot_bool_def|fact"><span>bot_bool_def</span></a><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.not_all|fact"><span>not_all</span></a><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.eq_False|fact"><span>eq_False</span></a><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.not_not|fact"><span>not_not</span></a><span> </span><a class="entity_ref" href="../../../../../Transfer.html#Transfer.OO_def|fact"><span>OO_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>exI</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.rel_sum.intros|fact"><span>rel_sum.intros</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

          </span><span class="comment1"><span>(* rel_G R_ = (λx y. ∃z. set_G z ⊆ {(x, y). R x y} ∧ map_G fst z = x ∧ map_G snd z = y) *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rel_compp_Grp_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>EVERY</span><span> </span><span class="main"><span>[</span></span><span>Local_Defs.fold_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.Grp_def|fact"><span>Grp_def</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>::</span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>set_F'_def </span><span class="entity"><span>set_F'_thmss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
                </span><span class="main"><span>[</span></span><span class="entity"><span>o_apply</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.mem_Collect_eq|fact"><span>mem_Collect_eq</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.OO_Grp_alt|fact"><span>OO_Grp_alt</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.vimage2p_def|fact"><span>vimage2p_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
              </span><span>Local_Defs.fold_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>Local_Defs.unfold</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.vimage2p_def|fact"><span>vimage2p_def</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>def </span><span class="entity"><span>rel_F'</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rel_F'_set_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
              </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TWICE</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ext</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>iffI</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span class="main"><span>(</span></span><span>ALLGOALS</span><span> </span><span class="main"><span>(</span></span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>exE</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>exI</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_FIRST</span><span> </span><span class="main"><span>(</span></span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>conjI</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>set_F'_respect</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="main"><span>[</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.subset_trans|fact"><span>subset_trans</span></a><span class="main"><span>[</span></span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>equalityD1</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.rel_funD|fact"><span>rel_funD</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>set_F'_respect</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rep_abs </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>reflp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_F'_thmss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span>o</span><span> </span><span class="entity"><span>TWICE</span></span><span> </span><span>o</span><span> </span><span>EVERY'</span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>trans</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>asm_rl</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>abs_rep </span><span class="entity"><span>qthms</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rel_abs </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>rotate_prems</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>transp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>map_F_rsp</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rep_abs </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>reflp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
              </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>exI</span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="main"><span>(</span></span><span>REPEAT_DETERM_N</span><span> </span><span class="entity"><span>live</span></span><span> </span><span>o</span><span> </span><span>HEADGOAL</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>[</span></span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
              </span><span class="main"><span>(</span></span><span>HEADGOAL</span><span> </span><span>o</span><span> </span><span class="entity"><span>TWICE</span></span><span> </span><span>o</span><span> </span><span>EVERY'</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span>
                </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rep_abs_rsp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>map_F_rsp</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rep_reflp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pred_G_set_G_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tactics</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_G_id0_tac</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>map_G_comp0_tac</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>map_G_cong_tac</span></span><span> </span><span>::</span><span>
            </span><span>map</span><span> </span><span class="entity"><span>mk_set_G_map0_G_tac</span></span><span> </span><span class="entity"><span>set_F'_thmss</span></span><span> </span><span>@</span><span>
            </span><span class="entity"><span>bd_card_order_tac</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>bd_cinfinite_tac</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>bd_regularCard_tac</span></span><span> </span><span>::</span><span>
            </span><span>map2</span><span> </span><span class="entity"><span>mk_set_G_bd_tac</span></span><span> </span><span class="entity"><span>set_F'_thmss</span></span><span> </span><span class="entity"><span>set_bd_thms</span></span><span> </span><span>@</span><span>
            </span><span class="entity"><span>rel_compp_tac</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>rel_compp_Grp_tac</span></span><span> </span><span>::</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>pred_G_set_G_tac</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

          </span><span class="comment1"><span>(* val wits_G = [abs_G o wit_F] *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>wits_G</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit_thms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wit_F_thmss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set_F'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>wit</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                    </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_F'_subset </span><span class="entity"><span>set_F'</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>set_mp</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>wit</span></span><span class="main"><span>)</span></span><span>
                    </span><span>|&gt;</span><span> </span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>set_F'_def </span><span class="entity"><span>set_F'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_F'_thmss</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>wit_thmss_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>wits_F</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit_F_thmss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>split_list</span><span>
                </span><span class="main"><span>(</span></span><span>filter_out</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>J</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>subset</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>J</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Iwits</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>wits_F</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>wit_F_thmss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_wit</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>I</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>var_as</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>I</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>fold_rev</span><span> </span><span>lambda</span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>abs_G</span></span><span> </span><span>$</span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>wit</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>mk_wit</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Iwits</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>wits_F</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wit_thmss</span></span><span> </span><span>@</span><span> </span><span>flat</span><span> </span><span class="entity"><span>wit_F_thmss</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_wit_tacs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="entity"><span>set_F'_def</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_F'_respect</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>set_F'_thmss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>w</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ws</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span>EVERY</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Fun.html#Fun.o_def|fact"><span>o_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>set_F'_respect</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.rel_funD|fact"><span>rel_funD</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>rep_abs </span><span class="entity"><span>qthms</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>reflp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>set_F'_def</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                  </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
                </span><span>THEN</span><span> </span><span class="entity"><span>mk_wit_tacs</span></span><span> </span><span class="entity"><span>set_F'_thmss</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_wit_tacs</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_wit_tacs</span></span><span> </span><span class="entity"><span>set_F'_thmss</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_wit_tacs</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>all_tac</span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_G</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bnf_def</span></span><span> </span><span class="entity"><span>Dont_Inline</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>user_policy</span></span><span> </span><span class="entity"><span>Note_Some</span></span><span class="main"><span>)</span></span><span> </span><span>true</span><span> </span><span>I</span><span>
            </span><span class="entity"><span>tactics</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_wit_tacs</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>wit_thms</span></span><span class="main"><span>)</span></span><span> </span><span>NONE</span><span> </span><span class="entity"><span>map_b</span></span><span> </span><span class="entity"><span>rel_b</span></span><span> </span><span class="entity"><span>pred_b</span></span><span> </span><span class="entity"><span>set_bs</span></span><span>
            </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Binding.empty</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>absT</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_G</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sets_G</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bd_G</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wits_G</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>rel_G</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>old_defs</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="main"><span>{</span></span><span>sets </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>set_defs_of_bnf</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span class="main"><span>,</span></span><span> map </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_def_of_bnf</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span class="main"><span>,</span></span><span> rel </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_def_of_bnf</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_F'_defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_abs_def</span></span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>set_F'_def</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_F'_thmss</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unfold_morphism</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm_morphism</span><span> </span><span class="inner_quoted"><span>"BNF"</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>defs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>#</span></span><span>def </span><span class="entity"><span>REL</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>set_F'_defs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_G</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>morph_bnf_defs</span></span><span> </span><span class="entity"><span>unfold_morphism</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>note_bnf_defs</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="comment1"><span>(* auxiliary lemmas transfer for transfer *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_monoD_rotated</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_mono_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.predicate2D|fact"><span>predicate2D</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>REL_pos_distrI</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>EVERY</span><span>
                </span><span class="main"><span>[</span></span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_pos_distr_thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.predicate2D|fact"><span>predicate2D</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="main"><span>(</span></span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>HEADGOAL</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span> </span><span>ORELSE'</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="main"><span>(</span></span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>HEADGOAL</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppE|fact"><span>relcomppE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>rel_monoD_rotated</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="main"><span>(</span></span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>HEADGOAL</span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>(</span></span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>ORELSE'</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Relation.html#Relation.relcomppI|fact"><span>relcomppI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_x</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>var_y'</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>var_Ps</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>var_Qs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>var_Rs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>REL_pos_distrI_tm</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_F_rel_F'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_F</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rel_of_bnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>alphas</span></span><span> </span><span class="entity"><span>betas</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_F_rel_F'_tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_F</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>tm </span><span class="entity"><span>rel_F'</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_Ps</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>var_y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span>Logic.mk_implies</span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rel_F_rel_F'_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>EVERY</span><span>
                </span><span class="main"><span>[</span></span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>in_rel_of_bnf</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>iffD1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_F'_set_thm</span></span><span> </span><span>::</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.mem_Collect_eq|fact"><span>mem_Collect_eq</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="main"><span>(</span></span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>HEADGOAL</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>exE</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>exI</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>EVERY'</span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>subsetI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_mp</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>set_F'_subset </span><span class="entity"><span>thms</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>subsetD</span></span><span class="main"><span>,</span></span><span>
                  </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_F'_thmss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="main"><span>(</span></span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>HEADGOAL</span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span> </span><span>ORELSE'</span><span> </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>reflp </span><span class="entity"><span>qthms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>var_x</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>var_y</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>var_Ps</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel_F_rel_F'_tm</span></span><span> </span><span class="entity"><span>rel_F_rel_F'_tac</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>inst_REL_pos_distrI</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>aTs</span></span><span> </span><span class="entity"><span>bTs</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>NONE</span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_Maybes</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>aTs</span></span><span> </span><span class="entity"><span>bTs</span></span><span>
              </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>REL_pos_distrI</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Tss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>abs </span><span class="main"><span>=</span></span><span> </span><span>typ_subst_atomic</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alphas</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>absT</span></span><span class="main"><span>,</span></span><span> rep </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>repT</span></span><span class="main"><span>,</span></span><span> Ds0 </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>TFree</span><span> </span><span class="entity"><span>Ds0</span></span><span class="main"><span>,</span></span><span>
            deads </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deads</span></span><span class="main"><span>,</span></span><span> alphas </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>alphas</span></span><span class="main"><span>,</span></span><span> betas </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>betas</span></span><span class="main"><span>,</span></span><span> gammas </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gammas</span></span><span class="main"><span>,</span></span><span> deltas </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deltas</span></span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="main"><span>{</span></span><span>map_F_rsp </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_F_rsp</span></span><span class="main"><span>,</span></span><span>
             rel_F'_def </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>def </span><span class="entity"><span>rel_F'</span></span><span class="main"><span>,</span></span><span>
             rel_F_rel_F' </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_F_rel_F'</span></span><span class="main"><span>,</span></span><span>
             rel_F'_set </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_F'_set_thm</span></span><span class="main"><span>,</span></span><span>
             rel_monoD_rotated </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_monoD_rotated</span></span><span class="main"><span>}</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>transfer_consts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_quotient_transfer_tacs</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span> </span><span class="entity"><span>Tss</span></span><span> </span><span class="entity"><span>live</span></span><span>
            </span><span class="entity"><span>qthms</span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="entity"><span>set_F'_thmss</span></span><span> </span><span class="entity"><span>old_defs</span></span><span> </span><span class="entity"><span>inst_REL_pos_distrI</span></span><span>
            </span><span class="entity"><span>map_raw</span></span><span> </span><span class="entity"><span>rel_raw</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>tm </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>set_F'</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_F'_aux_defs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>quiet</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>No_Warn_Transfer</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>opts</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="entity"><span>lthy</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>BNF_Def.register_bnf</span></span><span> </span><span class="entity"><span>plugins</span></span><span> </span><span class="entity"><span>absT_name</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span> </span><span>|&gt;</span><span>
            </span><span class="entity"><span>mk_transfer_thms</span></span><span> </span><span class="entity"><span>quiet</span></span><span> </span><span class="entity"><span>bnf_F</span></span><span> </span><span class="entity"><span>bnf_G</span></span><span> </span><span class="entity"><span>absT_name</span></span><span> </span><span class="entity"><span>transfer_consts</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Quotient</span></span><span> </span><span class="entity"><span>equiv_thm</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Tss</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>defs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>#</span></span><span>def </span><span class="entity"><span>REL</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>set_F'_defs</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Match</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>goals</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>after_qed</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>def </span><span class="entity"><span>REL</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>defs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>


</span><span class="comment1"><span>(** main commands **)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prepare_common</span></span><span> </span><span class="entity"><span>prepare_name</span></span><span> </span><span class="entity"><span>prepare_sort</span></span><span> </span><span class="entity"><span>prepare_term</span></span><span> </span><span class="entity"><span>prepare_thm</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>plugins</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>raw_specs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>raw_absT_name</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>raw_wits</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xthms_opt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pred_b</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>absT_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prepare_name</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>raw_absT_name</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>bad_input</span></span><span> </span><span class="entity"><span>input</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Pretty.chunks</span><span> </span><span class="main"><span>[</span></span><span>Pretty.para</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Expected theorem(s) of either form:"</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span>Pretty.item</span><span> </span><span class="main"><span>[</span></span><span>Pretty.enum</span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="main"><span>[</span></span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../../../../Lifting.html#Lifting.Quotient|const"><span>Quotient</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>Abs</span></span><span> </span><span class="free"><span>Rep</span></span><span> </span><span class="free"><span>T</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span>
        </span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../../../../Relation.html#Relation.reflp|const"><span>reflp</span></a><span> </span><span class="free"><span>R</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
      </span><span>Pretty.item</span><span> </span><span class="main"><span>[</span></span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../../../../Lifting.html#Lifting.Quotient|const"><span>Quotient</span></a><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>Abs</span></span><span> </span><span class="free"><span>Rep</span></span><span> </span><span class="free"><span>T</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
      </span><span>Pretty.item</span><span> </span><span class="main"><span>[</span></span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../../../../Typedef.html#Typedef.type_definition|const"><span>type_definition</span></a><span> </span><span class="free"><span>Rep</span></span><span> </span><span class="free"><span>Abs</span></span><span> </span><span class="free"><span>A</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
      </span><span>Pretty.para</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Got"</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.enum</span><span> </span><span class="inner_quoted"><span>","</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.pretty_thm</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>input</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Pretty.string_of</span><span>
      </span><span>|&gt;</span><span> </span><span>error</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>no_refl</span></span><span> </span><span class="entity"><span>qthm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Pretty.chunks</span><span> </span><span class="main"><span>[</span></span><span>Pretty.para</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Could not find a reflexivity rule for the Quotient theorem:"</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span>Pretty.item</span><span> </span><span class="main"><span>[</span></span><span>Thm.pretty_thm</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>qthm</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
      </span><span>Pretty.para</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Try supplying a reflexivity theorem manually or registering it in setup_lifting."</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Pretty.string_of</span><span>
      </span><span>|&gt;</span><span> </span><span>error</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>find_equiv_thm_via_Quotient</span></span><span> </span><span class="entity"><span>qthm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>refl_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Lifting_Info.get_reflexivity_rules</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
         </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.reflp_eq|fact"><span>reflp_eq</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>refl_thms</span></span><span> </span><span>RL</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>qthm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.Quotient_reflp_imp_equivp|fact"><span>Quotient_reflp_imp_equivp</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>no_refl</span></span><span> </span><span class="entity"><span>qthm</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lift_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>equiv_thm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prepare_thm</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xthms_opt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thms</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>qthm</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>try</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.Quotient_reflp_imp_equivp|fact"><span>Quotient_reflp_imp_equivp</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span>SOME</span><span> </span><span class="entity"><span>equiv_thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>qthm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.Quotient_Quotient3|fact"><span>Quotient_Quotient3</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Quotient</span></span><span> </span><span class="entity"><span>equiv_thm</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>bad_input</span></span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>try</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.Quotient_Quotient3|fact"><span>Quotient_Quotient3</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span>SOME</span><span> </span><span class="entity"><span>qthm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>qthm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Quotient</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>find_equiv_thm_via_Quotient</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>can</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Typedef.html#Typedef.type_definition.Rep|fact"><span>type_definition.Rep</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thm</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Typedef</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>bad_input</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>Lifting_Info.lookup_quotients</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>absT_name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span>SOME</span><span> </span><span class="main"><span>{</span></span><span>quot_thm </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>qthm</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>qthm</span></span><span class="main"><span>]</span></span><span> </span><span>RL</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.Quotient_eq_onp_typedef|fact"><span>Quotient_eq_onp_typedef</span></a><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.Quotient_eq_onp_type_copy|fact"><span>Quotient_eq_onp_type_copy</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                </span><span class="entity"><span>thm</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Typedef</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>qthm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Quotient.html#Quotient.Quotient_Quotient3|fact"><span>Quotient_Quotient3</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                 </span><span class="entity"><span>Quotient</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>find_equiv_thm_via_Quotient</span></span><span> </span><span class="entity"><span>qthm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Typedef.get_info</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>absT_name</span></span><span> </span><span>|&gt;</span><span> </span><span>hd</span><span> </span><span>|&gt;</span><span> </span><span>snd</span><span> </span><span>|&gt;</span><span> </span><span class="main"><span>#</span></span><span>type_definition</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Typedef</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>bad_input</span></span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wits</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span>o</span><span> </span><span>map</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prepare_term</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>raw_wits</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>specs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span>the_default</span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>sort</span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../HOL.html#HOL.type|class"><span>type</span></a></span><span class="antiquote"><span>}</span></span></span><span> </span><span>o</span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prepare_sort</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>raw_specs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>which_bnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>equiv_thm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span class="entity"><span>Quotient</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>quotient_bnf</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lift_thm</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Typedef</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>typedef_bnf</span></span><span> </span><span class="entity"><span>lift_thm</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>which_bnf</span></span><span> </span><span class="entity"><span>wits</span></span><span> </span><span class="entity"><span>specs</span></span><span> </span><span class="entity"><span>map_b</span></span><span> </span><span class="entity"><span>rel_b</span></span><span> </span><span class="entity"><span>pred_b</span></span><span> </span><span class="entity"><span>plugins</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prepare_lift_bnf</span></span><span> </span><span class="entity"><span>prepare_name</span></span><span> </span><span class="entity"><span>prepare_sort</span></span><span> </span><span class="entity"><span>prepare_term</span></span><span> </span><span class="entity"><span>prepare_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>goals</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>after_qed</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>definitions</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="entity"><span>lthy</span></span><span>
    </span><span>|&gt;</span><span> </span><span class="entity"><span>Proof.theorem</span></span><span> </span><span>NONE</span><span> </span><span class="entity"><span>after_qed</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>single</span><span> </span><span>o</span><span> </span><span>rpair</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>)</span></span><span>
    </span><span>|&gt;</span><span> </span><span class="entity"><span>Proof.refine_singleton</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>Method.Basic</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>SIMPLE_METHOD</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>definitions</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span>|&gt;</span><span> </span><span class="entity"><span>Proof.refine_singleton</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Method.primitive_text</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>I</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>oo</span><span>
  </span><span class="entity"><span>prepare_common</span></span><span> </span><span class="entity"><span>prepare_name</span></span><span> </span><span class="entity"><span>prepare_sort</span></span><span> </span><span class="entity"><span>prepare_term</span></span><span> </span><span class="entity"><span>prepare_thm</span></span><span> </span><span>o</span><span> </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span>SOME</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prepare_solve</span></span><span> </span><span class="entity"><span>prepare_name</span></span><span> </span><span class="entity"><span>prepare_typ</span></span><span> </span><span class="entity"><span>prepare_sort</span></span><span> </span><span class="entity"><span>prepare_thm</span></span><span> </span><span class="entity"><span>tacs</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>goals</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>after_qed</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>definitions</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="entity"><span>lthy</span></span><span>
    </span><span>|&gt;</span><span> </span><span class="entity"><span>after_qed</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxtprems</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>definitions</span></span><span> </span><span>THEN</span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>ctxtprems</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tacs</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>oo</span><span>
  </span><span class="entity"><span>prepare_common</span></span><span> </span><span class="entity"><span>prepare_name</span></span><span> </span><span class="entity"><span>prepare_typ</span></span><span> </span><span class="entity"><span>prepare_sort</span></span><span> </span><span class="entity"><span>prepare_thm</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lift_bnf_cmd</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>prepare_lift_bnf</span></span><span>
    </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_Type</span><span> </span><span>oo</span><span> </span><span>Proof_Context.read_type_name</span><span> </span><span class="main"><span>{</span></span><span>proper </span><span class="main"><span>=</span></span><span> </span><span>true</span><span class="main"><span>,</span></span><span> strict </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>
    </span><span>Syntax.read_sort</span><span> </span><span>Syntax.read_term</span><span> </span><span class="entity"><span>Attrib.eval_thms</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>lift_bnf</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="entity"><span>tacs</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>prepare_solve</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>I</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>I</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>I</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>I</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>tacs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>copy_bnf_tac</span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>REPEAT_DETERM</span><span> </span><span class="main"><span>(</span></span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>bexI</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>UNIV_I</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>subset_refl</span></span><span class="main"><span>]</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>copy_bnf</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>rpair</span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span>#&gt;</span><span> </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span>single</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span>#&gt;</span><span> </span><span class="entity"><span>prepare_solve</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>I</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>I</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>I</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>I</span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>copy_bnf_tac</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>copy_bnf_cmd</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>rpair</span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span>#&gt;</span><span> </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span>single</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span>#&gt;</span><span> </span><span class="entity"><span>prepare_solve</span></span><span>
    </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_Type</span><span> </span><span>oo</span><span> </span><span>Proof_Context.read_type_name</span><span> </span><span class="main"><span>{</span></span><span>proper </span><span class="main"><span>=</span></span><span> </span><span>true</span><span class="main"><span>,</span></span><span> strict </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>
    </span><span>Syntax.read_sort</span><span> </span><span>Syntax.read_term</span><span> </span><span class="entity"><span>Attrib.eval_thms</span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>copy_bnf_tac</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(** outer syntax **)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>

</span><span class="comment1"><span>(* parsers *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parse_wits</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>keyword</span></span><span> "</span><span class="keyword2"><span>[</span></span><span>"</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>|--</span><span> </span><span class="main"><span>(</span></span><span>Parse.name</span><span> </span><span>--|</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>keyword</span></span><span> "</span><span class="keyword2"><span>:</span></span><span>"</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>--</span><span> </span><span>Scan.repeat</span><span> </span><span>Parse.term</span><span> </span><span>&gt;&gt;</span><span>
    </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"wits"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Ts</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Unknown label "</span></span><span> </span><span>^</span><span> </span><span>quote</span><span> </span><span class="entity"><span>s</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" (expected \"wits\")"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>--|</span><span>
  </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>keyword</span></span><span> "</span><span class="keyword2"><span>]</span></span><span>"</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>||</span><span> </span><span>Scan.succeed</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_common_opts</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Scan.optional</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>keyword</span></span><span> "</span><span class="keyword2"><span>(</span></span><span>"</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>|--</span><span>
    </span><span>Parse.list1</span><span> </span><span class="main"><span>(</span></span><span>Parse.group</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="inner_quoted"><span>"option"</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span>Scan.first</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span> </span><span>::</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Plugin_Name.parse_filter</span></span><span> </span><span>&gt;&gt;</span><span> </span><span class="entity"><span>Plugins_Option</span></span><span class="main"><span>,</span></span><span>
          </span><span>Parse.reserved</span><span> </span><span class="inner_quoted"><span>"no_warn_transfer"</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span class="entity"><span>No_Warn_Transfer</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span>--|</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>keyword</span></span><span> "</span><span class="keyword2"><span>)</span></span><span>"</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parse_lift_opts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Parse.reserved</span><span> </span><span class="inner_quoted"><span>"no_warn_wits"</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span class="entity"><span>No_Warn_Wits</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>parse_common_opts</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parse_copy_opts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>parse_common_opts</span></span><span> </span><span>Scan.fail</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parse_xthm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span>Parse.reserved</span><span> </span><span class="inner_quoted"><span>"via"</span></span><span> </span><span>|--</span><span> </span><span>Parse.thm</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parse_xthms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span>Parse.reserved</span><span> </span><span class="inner_quoted"><span>"via"</span></span><span> </span><span>|--</span><span> </span><span>Parse.thms1</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>

</span><span class="comment1"><span>(* exposed commands *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Outer_Syntax.local_theory_to_proof</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>command_keyword</span></span><span> </span><span class="keyword1"><span>lift_bnf</span></span><span class="antiquote"><span>}</span></span></span></span><span>
    </span><span class="inner_quoted"><span>"register a quotient type/subtype of a bounded natural functor (BNF) as a BNF"</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>parse_lift_opts</span></span><span> </span><span>--</span><span> </span><span class="entity"><span>parse_type_args_named_constrained</span></span><span> </span><span>--</span><span> </span><span>Parse.type_const</span><span> </span><span>--</span><span> </span><span class="entity"><span>parse_wits</span></span><span> </span><span>--</span><span>
      </span><span class="entity"><span>parse_xthms</span></span><span> </span><span>--</span><span> </span><span class="entity"><span>parse_map_rel_pred_bindings</span></span><span class="main"><span>)</span></span><span> </span><span>&gt;&gt;</span><span> </span><span class="entity"><span>lift_bnf_cmd</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Outer_Syntax.local_theory</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>command_keyword</span></span><span> </span><span class="keyword1"><span>copy_bnf</span></span><span class="antiquote"><span>}</span></span></span></span><span>
    </span><span class="inner_quoted"><span>"register a type copy of a bounded natural functor (BNF) as a BNF"</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>parse_copy_opts</span></span><span> </span><span>--</span><span> </span><span class="entity"><span>parse_type_args_named_constrained</span></span><span> </span><span>--</span><span> </span><span>Parse.type_const</span><span> </span><span>--</span><span>
      </span><span class="entity"><span>parse_xthm</span></span><span> </span><span>--</span><span> </span><span class="entity"><span>parse_map_rel_pred_bindings</span></span><span class="main"><span>)</span></span><span> </span><span>&gt;&gt;</span><span> </span><span class="entity"><span>copy_bnf_cmd</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span></pre>
</body>

</html>