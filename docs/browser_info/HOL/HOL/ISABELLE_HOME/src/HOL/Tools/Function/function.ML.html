<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Tools/Function/function.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Tools/Function/function.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      HOL/Tools/Function/function.ML
    Author:     Alexander Krauss, TU Muenchen

Main entry points to the function package.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>FUNCTION</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>info</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Function_Common.info</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> add_function</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>binding</span><span> * </span><span>typ</span><span> </span><span>option</span><span> * </span><span>mixfix</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="entity"><span>Specification.multi_specs</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Function_Common.function_config</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>info</span></span><span> * </span><span>local_theory</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> add_function_cmd</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>binding</span><span> * </span><span>string</span><span> </span><span>option</span><span> * </span><span>mixfix</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="entity"><span>Specification.multi_specs_cmd</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Function_Common.function_config</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>info</span></span><span> * </span><span>local_theory</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> function</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>binding</span><span> * </span><span>typ</span><span> </span><span>option</span><span> * </span><span>mixfix</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="entity"><span>Specification.multi_specs</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Function_Common.function_config</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.state</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> function_cmd</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>binding</span><span> * </span><span>string</span><span> </span><span>option</span><span> * </span><span>mixfix</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="entity"><span>Specification.multi_specs_cmd</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Function_Common.function_config</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.state</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> prove_termination</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>option</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="entity"><span>info</span></span><span> * </span><span>local_theory</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> prove_termination_cmd</span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>option</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="entity"><span>info</span></span><span> * </span><span>local_theory</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> termination </span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>option</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.state</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> termination_cmd </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>option</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.state</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> get_congs </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> get_info </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>info</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>


</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Function</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>FUNCTION</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Function_Lib</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Function_Common</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>simp_attribs</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>attributes</span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.nitpick_simp|attribute"><span class="operator"><span>nitpick_simp</span></span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>psimp_attribs</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>attributes</span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="../../../../../HOL.html#HOL.nitpick_psimp|attribute"><span class="operator"><span>nitpick_psimp</span></span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>note_derived</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>atts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fname</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Local_Theory.note</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>derived_name</span></span><span> </span><span class="entity"><span>fname</span></span><span> </span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>atts</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span>apfst</span><span> </span><span>snd</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_simps</span></span><span> </span><span class="entity"><span>fnames</span></span><span> </span><span class="entity"><span>post</span></span><span> </span><span class="entity"><span>sort</span></span><span> </span><span class="entity"><span>extra_qualify</span></span><span> </span><span class="entity"><span>label</span></span><span> </span><span class="entity"><span>mod_binding</span></span><span> </span><span class="entity"><span>moreatts</span></span><span> </span><span class="entity"><span>simps</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>spec</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>post</span></span><span> </span><span class="entity"><span>simps</span></span><span>
      </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ats</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>moreatts</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ats</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="entity"><span>extra_qualify</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>saved_spec_simps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>fold_map</span><span> </span><span>Local_Theory.note</span><span> </span><span class="entity"><span>spec</span></span><span> </span><span class="entity"><span>lthy</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>saved_simps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>maps</span><span> </span><span>snd</span><span> </span><span class="entity"><span>saved_spec_simps</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>simps_by_f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sort</span></span><span> </span><span class="entity"><span>saved_simps</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>note</span></span><span> </span><span class="entity"><span>fname</span></span><span> </span><span class="entity"><span>simps</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Local_Theory.note</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>mod_binding</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>derived_name</span></span><span> </span><span class="entity"><span>fname</span></span><span> </span><span class="entity"><span>label</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>simps</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span>snd</span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>saved_simps</span></span><span class="main"><span>,</span></span><span> </span><span>fold2</span><span> </span><span class="entity"><span>note</span></span><span> </span><span class="entity"><span>fnames</span></span><span> </span><span class="entity"><span>simps_by_f</span></span><span> </span><span class="entity"><span>lthy'</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prepare_function</span></span><span> </span><span class="entity"><span>do_print</span></span><span> </span><span class="entity"><span>prep</span></span><span> </span><span class="entity"><span>fixspec</span></span><span> </span><span class="entity"><span>eqns</span></span><span> </span><span class="entity"><span>config</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>fixes0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>spec0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prep</span></span><span> </span><span class="entity"><span>fixspec</span></span><span> </span><span class="entity"><span>eqns</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fixes</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span>Binding.name_of</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fixes0</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>spec</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prop</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnd</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>prop</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>spec0</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>eqs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>post</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sort_cont</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cnames</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>get_preproc</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>config</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span> </span><span class="entity"><span>fixes</span></span><span> </span><span class="entity"><span>spec</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fnames</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fixes0</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>defname</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Binding.conglomerate</span><span> </span><span class="entity"><span>fnames</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>FunctionConfig</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>partials</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>default</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>config</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>is_some</span><span> </span><span class="entity"><span>default</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>legacy_feature</span><span> </span><span class="inner_quoted"><span>"\"function (default)\" -- use 'partial_function' instead"</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>goal_state</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cont</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>Function_Mutual.prepare_function_mutual</span></span><span> </span><span class="entity"><span>config</span></span><span> </span><span class="entity"><span>defname</span></span><span> </span><span class="entity"><span>fixes0</span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span class="entity"><span>lthy</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>afterqed</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="entity"><span>proof</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>lthy1</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>result</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>cont</span></span><span> </span><span class="entity"><span>lthy1</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span> </span><span class="entity"><span>proof</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>FunctionResult</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>fs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dom</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>psimps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>simple_pinducts</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>termination</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>domintros</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cases</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>result</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pelims</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Function_Elims.mk_partial_elim_rules</span></span><span> </span><span class="entity"><span>lthy1</span></span><span> </span><span class="entity"><span>result</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concealed_partial</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>partials</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>I</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Binding.concealed</span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>addsmps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>add_simps</span></span><span> </span><span class="entity"><span>fnames</span></span><span> </span><span class="entity"><span>post</span></span><span> </span><span class="entity"><span>sort_cont</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>psimps'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>pinducts'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>termination'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cases'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pelims'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>lthy1</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>addsmps</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concealed_partial</span></span><span> </span><span>o</span><span> </span><span>Binding.qualify</span><span> </span><span>false</span><span> </span><span class="inner_quoted"><span>"partial"</span></span><span class="main"><span>)</span></span><span>
               </span><span class="inner_quoted"><span>"psimps"</span></span><span> </span><span class="entity"><span>concealed_partial</span></span><span> </span><span class="entity"><span>psimp_attribs</span></span><span> </span><span class="entity"><span>psimps</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span>Local_Theory.notes</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>concealed_partial</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>derived_name</span></span><span> </span><span class="entity"><span>defname</span></span><span> </span><span class="inner_quoted"><span>"pinduct"</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>simple_pinducts</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>th</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                 </span><span class="main"><span>[</span></span><span class="entity"><span>Attrib.case_names</span></span><span> </span><span class="entity"><span>cnames</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Attrib.consumes</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>-</span><span> </span><span>Thm.nprems_of</span><span> </span><span class="entity"><span>th</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
                 </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>attributes</span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="../../../Tools/induct.ML.html#HOL.induct|attribute"><span class="operator"><span>induct</span></span></a><span> pred</span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span>snd</span><span> </span><span>o</span><span>
            </span><span>Local_Theory.note</span><span>
              </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Binding.concealed</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>derived_name</span></span><span> </span><span class="entity"><span>defname</span></span><span> </span><span class="inner_quoted"><span>"termination"</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>termination</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>note_derived</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"cases"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Attrib.case_names</span></span><span> </span><span class="entity"><span>cnames</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>fnames</span></span><span> </span><span>~~</span><span> </span><span>map</span><span> </span><span>single</span><span> </span><span class="entity"><span>cases</span></span><span class="main"><span>)</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>note_derived</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"pelims"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Attrib.consumes</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Attrib.constraints</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>fnames</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>pelims</span></span><span class="main"><span>)</span></span><span>
          </span><span>||&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>domintros</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>I</span><span> </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span>Local_Theory.note</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>derived_name</span></span><span> </span><span class="entity"><span>defname</span></span><span> </span><span class="inner_quoted"><span>"domintros"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>info</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>{</span></span><span> add_simps</span><span class="main"><span>=</span></span><span class="entity"><span>addsmps</span></span><span class="main"><span>,</span></span><span> fnames</span><span class="main"><span>=</span></span><span class="entity"><span>fnames</span></span><span class="main"><span>,</span></span><span> case_names</span><span class="main"><span>=</span></span><span class="entity"><span>cnames</span></span><span class="main"><span>,</span></span><span> psimps</span><span class="main"><span>=</span></span><span class="entity"><span>psimps'</span></span><span class="main"><span>,</span></span><span>
          pinducts</span><span class="main"><span>=</span></span><span>snd</span><span> </span><span class="entity"><span>pinducts'</span></span><span class="main"><span>,</span></span><span> simps</span><span class="main"><span>=</span></span><span>NONE</span><span class="main"><span>,</span></span><span> inducts</span><span class="main"><span>=</span></span><span>NONE</span><span class="main"><span>,</span></span><span> termination</span><span class="main"><span>=</span></span><span class="entity"><span>termination'</span></span><span class="main"><span>,</span></span><span> totality</span><span class="main"><span>=</span></span><span>NONE</span><span class="main"><span>,</span></span><span>
          fs</span><span class="main"><span>=</span></span><span class="entity"><span>fs</span></span><span class="main"><span>,</span></span><span> R</span><span class="main"><span>=</span></span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> dom</span><span class="main"><span>=</span></span><span class="entity"><span>dom</span></span><span class="main"><span>,</span></span><span> defname</span><span class="main"><span>=</span></span><span class="entity"><span>defname</span></span><span class="main"><span>,</span></span><span> is_partial</span><span class="main"><span>=</span></span><span>true</span><span class="main"><span>,</span></span><span> cases</span><span class="main"><span>=</span></span><span>flat</span><span> </span><span class="entity"><span>cases'</span></span><span class="main"><span>,</span></span><span>
          pelims</span><span class="main"><span>=</span></span><span class="entity"><span>pelims'</span></span><span class="main"><span>,</span></span><span>elims</span><span class="main"><span>=</span></span><span>NONE</span><span class="main"><span>}</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>Proof_Display.print_consts</span></span><span> </span><span class="entity"><span>do_print</span></span><span> </span><span class="main"><span>(</span></span><span>Position.thread_data</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy2</span></span><span>
            </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>fixes</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>info</span></span><span class="main"><span>,</span></span><span>
         </span><span class="entity"><span>lthy2</span></span><span> </span><span>|&gt;</span><span> </span><span>Local_Theory.declaration</span><span> </span><span class="main"><span>{</span></span><span>syntax </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> pervasive </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> pos </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>}</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>add_function_data</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transform_function_data</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>info</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>goal_state</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>afterqed</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy'</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>gen_add_function</span></span><span> </span><span class="entity"><span>do_print</span></span><span> </span><span class="entity"><span>prep</span></span><span> </span><span class="entity"><span>fixspec</span></span><span> </span><span class="entity"><span>eqns</span></span><span> </span><span class="entity"><span>config</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>goal_state</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>afterqed</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>prepare_function</span></span><span> </span><span class="entity"><span>do_print</span></span><span> </span><span class="entity"><span>prep</span></span><span> </span><span class="entity"><span>fixspec</span></span><span> </span><span class="entity"><span>eqns</span></span><span> </span><span class="entity"><span>config</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pattern_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>SINGLE</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>lthy'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal_state</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"pattern completeness and compatibility proof failed"</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.finish</span><span> </span><span class="entity"><span>lthy'</span></span><span> </span><span class="entity"><span>st</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>lthy'</span></span><span>
    </span><span>|&gt;</span><span> </span><span class="entity"><span>afterqed</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="entity"><span>pattern_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>add_function</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_add_function</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>Specification.check_multi_specs</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_function_cmd</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="entity"><span>d</span></span><span> </span><span class="entity"><span>int</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_add_function</span></span><span> </span><span class="entity"><span>int</span></span><span> </span><span class="entity"><span>Specification.read_multi_specs</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="entity"><span>d</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>gen_function</span></span><span> </span><span class="entity"><span>do_print</span></span><span> </span><span class="entity"><span>prep</span></span><span> </span><span class="entity"><span>fixspec</span></span><span> </span><span class="entity"><span>eqns</span></span><span> </span><span class="entity"><span>config</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>goal_state</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>afterqed</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>prepare_function</span></span><span> </span><span class="entity"><span>do_print</span></span><span> </span><span class="entity"><span>prep</span></span><span> </span><span class="entity"><span>fixspec</span></span><span> </span><span class="entity"><span>eqns</span></span><span> </span><span class="entity"><span>config</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>lthy'</span></span><span>
    </span><span>|&gt;</span><span> </span><span class="entity"><span>Proof.theorem</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>oo</span><span> </span><span class="entity"><span>afterqed</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span>Logic.unprotect</span><span> </span><span class="main"><span>(</span></span><span>Thm.concl_of</span><span> </span><span class="entity"><span>goal_state</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>
    </span><span>|&gt;</span><span> </span><span class="entity"><span>Proof.refine_singleton</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Method.primitive_text</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>goal_state</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>function</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_function</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>Specification.check_multi_specs</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>function_cmd</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="entity"><span>int</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_function</span></span><span> </span><span class="entity"><span>int</span></span><span> </span><span class="entity"><span>Specification.read_multi_specs</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="entity"><span>c</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prepare_termination_proof</span></span><span> </span><span class="entity"><span>prep_binding</span></span><span> </span><span class="entity"><span>prep_term</span></span><span> </span><span class="entity"><span>raw_term_opt</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>term_opt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prep_term</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>raw_term_opt</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>info</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>term_opt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span>SOME</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>import_function_data</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span>SOME</span><span> </span><span class="entity"><span>info</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>info</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Not a function: "</span></span><span> </span><span>^</span><span> </span><span>quote</span><span> </span><span class="main"><span>(</span></span><span>Syntax.string_of_term</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>import_last_function</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span>SOME</span><span> </span><span class="entity"><span>info</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>info</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"Not a function"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>termination</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>add_simps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>case_names</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>psimps</span></span><span class="main"><span>,</span></span><span>
      </span><span class="entity"><span>pinducts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>defname</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fnames</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cases</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dom</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pelims</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>info</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>domT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>domain_type</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>R</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_all</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"x"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>domT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_acc</span></span><span> </span><span class="entity"><span>domT</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span>$</span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"x"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>domT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>afterqed</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="entity"><span>raw_totality</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>lthy1</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>totality</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span> </span><span class="entity"><span>raw_totality</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>remove_domain_condition</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>full_simplify</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="entity"><span>lthy1</span></span><span>
            </span><span>addsimps</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>totality</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.True_implies_equals|fact"><span>True_implies_equals</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tsimps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>remove_domain_condition</span></span><span> </span><span class="entity"><span>psimps</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tinduct</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>remove_domain_condition</span></span><span> </span><span class="entity"><span>pinducts</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>telims</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>remove_domain_condition</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pelims</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>lthy1</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="entity"><span>add_simps</span></span><span> </span><span class="entity"><span>prep_binding</span></span><span> </span><span class="inner_quoted"><span>"simps"</span></span><span> </span><span class="entity"><span>prep_binding</span></span><span> </span><span class="entity"><span>simp_attribs</span></span><span> </span><span class="entity"><span>tsimps</span></span><span>
        </span><span>||&gt;</span><span> </span><span class="entity"><span>Code.declare_default_eqns</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>rpair</span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tsimps</span></span><span class="main"><span>)</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span>Local_Theory.note</span><span>
          </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>prep_binding</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>derived_name</span></span><span> </span><span class="entity"><span>defname</span></span><span> </span><span class="inner_quoted"><span>"induct"</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Attrib.case_names</span></span><span> </span><span class="entity"><span>case_names</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tinduct</span></span><span class="main"><span>)</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>note_derived</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"elims"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Attrib.consumes</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Attrib.constraints</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>prep_binding</span></span><span> </span><span class="entity"><span>fnames</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>telims</span></span><span class="main"><span>)</span></span><span>
        </span><span>|-&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>simps</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>inducts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>elims</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>lthy2</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>info'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span> is_partial</span><span class="main"><span>=</span></span><span>false</span><span class="main"><span>,</span></span><span> defname</span><span class="main"><span>=</span></span><span class="entity"><span>defname</span></span><span class="main"><span>,</span></span><span> fnames</span><span class="main"><span>=</span></span><span class="entity"><span>fnames</span></span><span class="main"><span>,</span></span><span> add_simps</span><span class="main"><span>=</span></span><span class="entity"><span>add_simps</span></span><span class="main"><span>,</span></span><span>
            case_names</span><span class="main"><span>=</span></span><span class="entity"><span>case_names</span></span><span class="main"><span>,</span></span><span> fs</span><span class="main"><span>=</span></span><span class="entity"><span>fs</span></span><span class="main"><span>,</span></span><span> R</span><span class="main"><span>=</span></span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> dom</span><span class="main"><span>=</span></span><span class="entity"><span>dom</span></span><span class="main"><span>,</span></span><span> psimps</span><span class="main"><span>=</span></span><span class="entity"><span>psimps</span></span><span class="main"><span>,</span></span><span> pinducts</span><span class="main"><span>=</span></span><span class="entity"><span>pinducts</span></span><span class="main"><span>,</span></span><span>
            simps</span><span class="main"><span>=</span></span><span>SOME</span><span> </span><span class="entity"><span>simps</span></span><span class="main"><span>,</span></span><span> inducts</span><span class="main"><span>=</span></span><span>SOME</span><span> </span><span class="entity"><span>inducts</span></span><span class="main"><span>,</span></span><span> termination</span><span class="main"><span>=</span></span><span class="entity"><span>termination</span></span><span class="main"><span>,</span></span><span> totality</span><span class="main"><span>=</span></span><span>SOME</span><span> </span><span class="entity"><span>totality</span></span><span class="main"><span>,</span></span><span>
            cases</span><span class="main"><span>=</span></span><span class="entity"><span>cases</span></span><span class="main"><span>,</span></span><span> pelims</span><span class="main"><span>=</span></span><span class="entity"><span>pelims</span></span><span class="main"><span>,</span></span><span> elims</span><span class="main"><span>=</span></span><span>SOME</span><span> </span><span class="entity"><span>elims</span></span><span class="main"><span>}</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="entity"><span>transform_function_data</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.binding_morphism</span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="entity"><span>prep_binding</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>info'</span></span><span class="main"><span>,</span></span><span>
             </span><span class="entity"><span>lthy2</span></span><span>
             </span><span>|&gt;</span><span> </span><span>Local_Theory.declaration</span><span> </span><span class="main"><span>{</span></span><span>syntax </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> pervasive </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> pos </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>}</span></span><span>
               </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>add_function_data</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transform_function_data</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>info'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
             </span><span>|&gt;</span><span> </span><span class="entity"><span>Spec_Rules.add</span></span><span> </span><span>Binding.empty</span><span> </span><span class="entity"><span>Spec_Rules.equational_recdef</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>tsimps</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>goal</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>afterqed</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>termination</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>gen_prove_termination</span></span><span> </span><span class="entity"><span>prep_term</span></span><span> </span><span class="entity"><span>raw_term_opt</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>goal</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>afterqed</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>termination</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>prepare_termination_proof</span></span><span> </span><span>I</span><span> </span><span class="entity"><span>prep_term</span></span><span> </span><span class="entity"><span>raw_term_opt</span></span><span> </span><span class="entity"><span>lthy</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>totality</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Goal.prove</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>tac</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>afterqed</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="entity"><span>totality</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prove_termination</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_prove_termination</span></span><span> </span><span>Syntax.check_term</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prove_termination_cmd</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_prove_termination</span></span><span> </span><span>Syntax.read_term</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>gen_termination</span></span><span> </span><span class="entity"><span>prep_term</span></span><span> </span><span class="entity"><span>raw_term_opt</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>goal</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>afterqed</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>termination</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>prepare_termination_proof</span></span><span> </span><span>Binding.reset_pos</span><span> </span><span class="entity"><span>prep_term</span></span><span> </span><span class="entity"><span>raw_term_opt</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>lthy</span></span><span>
    </span><span>|&gt;</span><span> </span><span>Proof_Context.note_thms</span><span> </span><span class="inner_quoted"><span>""</span></span><span>
       </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Binding.empty</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Context_Rules.rule_del</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>allI</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>snd</span><span>
    </span><span>|&gt;</span><span> </span><span>Proof_Context.note_thms</span><span> </span><span class="inner_quoted"><span>""</span></span><span>
       </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Binding.empty</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Context_Rules.intro_bang</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>allI</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>snd</span><span>
    </span><span>|&gt;</span><span> </span><span>Proof_Context.note_thms</span><span> </span><span class="inner_quoted"><span>""</span></span><span>
       </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Binding.name</span><span> </span><span class="inner_quoted"><span>"termination"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Context_Rules.intro_bang</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
         </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span>Goal.norm_result</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>termination</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>snd</span><span>
    </span><span>|&gt;</span><span> </span><span class="entity"><span>Proof.theorem</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>oo</span><span> </span><span class="entity"><span>afterqed</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>goal</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>termination</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_termination</span></span><span> </span><span>Syntax.check_term</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>termination_cmd</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_termination</span></span><span> </span><span>Syntax.read_term</span><span>


</span><span class="comment1"><span>(* Datatype hook to declare datatype congs as "function_congs" *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_case_cong</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cong</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>case_cong </span><span class="main"><span>(</span></span><span class="entity"><span>Old_Datatype_Data.the_info</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>safe_mk_meta_eq</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>Context.theory_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Function_Context_Tree.add_function_cong</span></span><span> </span><span class="entity"><span>cong</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thy</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Theory.setup</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Old_Datatype_Data.interpretation</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span class="entity"><span>add_case_cong</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>


</span><span class="comment1"><span>(* get info *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>get_congs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Function_Context_Tree.get_function_congs</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>get_info</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Function_Common.retrieve_function_data</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t</span></span><span>
  </span><span>|&gt;</span><span> </span><span>the_single</span><span> </span><span>|&gt;</span><span> </span><span>snd</span><span>


</span><span class="comment1"><span>(* outer syntax *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Outer_Syntax.local_theory_to_proof'</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">command_keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword1"><span>function</span></span><span>›</span></span></span><span>
    </span><span class="inner_quoted"><span>"define general recursive functions"</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>function_parser</span></span><span> </span><span class="entity"><span>default_config</span></span><span>
      </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>config</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fixes</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>function_cmd</span></span><span> </span><span class="entity"><span>fixes</span></span><span> </span><span class="entity"><span>specs</span></span><span> </span><span class="entity"><span>config</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Outer_Syntax.local_theory_to_proof</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">command_keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword1"><span>termination</span></span><span>›</span></span></span><span>
    </span><span class="inner_quoted"><span>"prove termination of a recursive function"</span></span><span>
    </span><span class="main"><span>(</span></span><span>Scan.option</span><span> </span><span>Parse.term</span><span> </span><span>&gt;&gt;</span><span> </span><span class="entity"><span>termination_cmd</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span></pre>
</body>

</html>