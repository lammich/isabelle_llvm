<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Tools/BNF/bnf_fp_def_sugar.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Tools/BNF/bnf_fp_def_sugar.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      HOL/Tools/BNF/bnf_fp_def_sugar.ML
    Author:     Jasmin Blanchette, TU Muenchen
    Author:     Martin Desharnais, TU Muenchen
    Copyright   2012, 2013, 2014

Sugared datatype and codatatype constructions.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>BNF_FP_DEF_SUGAR</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>fp_ctr_sugar</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>{</span></span><span>ctrXs_Tss</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     ctor_iff_dtor</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
     ctr_defs</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     ctr_sugar</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Ctr_Sugar.ctr_sugar</span></span><span class="main"><span>,</span></span><span>
     ctr_transfers</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     case_transfers</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     disc_transfers</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     sel_transfers</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>}</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>fp_bnf_sugar</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>{</span></span><span>map_thms</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     map_disc_iffs</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     map_selss</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     rel_injects</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     rel_distincts</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     rel_sels</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     rel_intros</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     rel_cases</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     pred_injects</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     set_thms</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     set_selssss</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     set_introssss</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     set_cases</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>}</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>fp_co_induct_sugar</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>{</span></span><span>co_rec</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
     common_co_inducts</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     co_inducts</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     co_rec_def</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
     co_rec_thms</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     co_rec_discs</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     co_rec_disc_iffs</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     co_rec_selss</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     co_rec_codes</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     co_rec_transfers</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     co_rec_o_maps</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     common_rel_co_inducts</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     rel_co_inducts</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     common_set_inducts</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     set_inducts</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>}</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>fp_sugar</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>{</span></span><span>T</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span class="main"><span>,</span></span><span>
     BT</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span class="main"><span>,</span></span><span>
     X</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span class="main"><span>,</span></span><span>
     fp</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>BNF_Util.fp_kind</span></span><span class="main"><span>,</span></span><span>
     fp_res_index</span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
     fp_res</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>BNF_FP_Util.fp_result</span></span><span class="main"><span>,</span></span><span>
     pre_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>BNF_Def.bnf</span></span><span class="main"><span>,</span></span><span>
     fp_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>BNF_Def.bnf</span></span><span class="main"><span>,</span></span><span>
     absT_info</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>BNF_Comp.absT_info</span></span><span class="main"><span>,</span></span><span>
     fp_nesting_bnfs</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>BNF_Def.bnf</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     live_nesting_bnfs</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>BNF_Def.bnf</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
     fp_ctr_sugar</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>fp_ctr_sugar</span></span><span class="main"><span>,</span></span><span>
     fp_bnf_sugar</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>fp_bnf_sugar</span></span><span class="main"><span>,</span></span><span>
     fp_co_induct_sugar</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>fp_co_induct_sugar</span></span><span> </span><span>option</span><span class="main"><span>}</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> co_induct_of</span><span class="main"><span>:</span></span><span> 'a </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> 'a
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> strong_co_induct_of</span><span class="main"><span>:</span></span><span> 'a </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> 'a

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> morph_fp_bnf_sugar</span><span class="main"><span>:</span></span><span> </span><span>morphism</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fp_bnf_sugar</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fp_bnf_sugar</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> morph_fp_co_induct_sugar</span><span class="main"><span>:</span></span><span> </span><span>morphism</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fp_co_induct_sugar</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fp_co_induct_sugar</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> morph_fp_ctr_sugar</span><span class="main"><span>:</span></span><span> </span><span>morphism</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fp_ctr_sugar</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fp_ctr_sugar</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> morph_fp_sugar</span><span class="main"><span>:</span></span><span> </span><span>morphism</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fp_sugar</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fp_sugar</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> transfer_fp_sugar</span><span class="main"><span>:</span></span><span> </span><span>theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fp_sugar</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fp_sugar</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> fp_sugar_of</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fp_sugar</span></span><span> </span><span>option</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> fp_sugar_of_global</span><span class="main"><span>:</span></span><span> </span><span>theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fp_sugar</span></span><span> </span><span>option</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> fp_sugars_of</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fp_sugar</span></span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> fp_sugars_of_global</span><span class="main"><span>:</span></span><span> </span><span>theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fp_sugar</span></span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> fp_sugars_interpretation</span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fp_sugar</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>theory</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> interpret_fp_sugars</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fp_sugar</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> register_fp_sugars_raw</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>fp_sugar</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> register_fp_sugars</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fp_sugar</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> merge_type_args</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>BNF_Util.fp_kind</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> ''a </span><span>list</span><span> * ''a </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> ''a </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> type_args_named_constrained_of_spec</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>'a * 'b</span><span class="main"><span>)</span></span><span> * 'c</span><span class="main"><span>)</span></span><span> * 'd</span><span class="main"><span>)</span></span><span> * 'e</span><span class="main"><span>)</span></span><span> * 'f </span><span class="main"><span>-&gt;</span></span><span> 'a
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> type_binding_of_spec</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>'a * 'b</span><span class="main"><span>)</span></span><span> * 'c</span><span class="main"><span>)</span></span><span> * 'd</span><span class="main"><span>)</span></span><span> * 'e</span><span class="main"><span>)</span></span><span> * 'f </span><span class="main"><span>-&gt;</span></span><span> 'b
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mixfix_of_spec</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>'a * 'b</span><span class="main"><span>)</span></span><span> * 'c</span><span class="main"><span>)</span></span><span> * 'd</span><span class="main"><span>)</span></span><span> * 'e </span><span class="main"><span>-&gt;</span></span><span> 'b
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mixfixed_ctr_specs_of_spec</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>'a * 'b</span><span class="main"><span>)</span></span><span> * 'c</span><span class="main"><span>)</span></span><span> * 'd </span><span class="main"><span>-&gt;</span></span><span> 'b
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> map_binding_of_spec</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>'a * </span><span class="main"><span>(</span></span><span>'b * 'c * 'd</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> * 'e </span><span class="main"><span>-&gt;</span></span><span> 'b
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rel_binding_of_spec</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>'a * </span><span class="main"><span>(</span></span><span>'b * 'c * 'd</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> * 'e </span><span class="main"><span>-&gt;</span></span><span> 'c
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> pred_binding_of_spec</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>'a * </span><span class="main"><span>(</span></span><span>'b * 'c * 'd</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> * 'e </span><span class="main"><span>-&gt;</span></span><span> 'd
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> sel_default_eqs_of_spec</span><span class="main"><span>:</span></span><span> 'a * 'b </span><span class="main"><span>-&gt;</span></span><span> 'b

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_parametricity_goal</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> flat_corec_preds_predsss_gettersss</span><span class="main"><span>:</span></span><span> 'a </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> 'a </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> 'a </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    'a </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_ctor</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_dtor</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_bnf_sets</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>BNF_Def.bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> * </span><span>term</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> liveness_of_fp_bnf</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>BNF_Def.bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> nesting_bnfs</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>BNF_Def.bnf</span></span><span> </span><span>list</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> massage_simple_notes</span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>bstring</span><span> * 'a </span><span>list</span><span> * </span><span class="main"><span>(</span></span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> 'b</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>binding</span><span> * 'c </span><span>list</span><span class="main"><span>)</span></span><span> * </span><span class="main"><span>(</span></span><span>'a </span><span>list</span><span> * 'b</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> massage_multi_notes</span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span>string</span><span> * 'a </span><span>list</span><span> </span><span>list</span><span> * </span><span class="main"><span>(</span></span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> 'b</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>binding</span><span> * 'b</span><span class="main"><span>)</span></span><span> * </span><span class="main"><span>(</span></span><span>'a </span><span>list</span><span> * 'c </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> define_ctrs_dtrs_for_type</span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>mixfix</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>term</span><span> </span><span>list</span><span> * </span><span>thm</span><span> * </span><span>thm</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> * </span><span>local_theory</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> wrap_ctrs</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>BNF_Util.fp_kind</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Ctr_Sugar.ctr_sugar</span></span><span> * </span><span>local_theory</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> derive_map_set_rel_pred_thms</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>BNF_Util.fp_kind</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>BNF_Def.bnf</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>BNF_Def.bnf</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Ctr_Sugar.ctr_sugar</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span>thm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span>
     * </span><span>thm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span>
     * </span><span>thm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> * </span><span>local_theory</span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>lfp_sugar_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>thm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> * </span><span>Token.src</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> * </span><span class="main"><span>(</span></span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>Token.src</span><span> </span><span>list</span><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> morph_lfp_sugar_thms</span><span class="main"><span>:</span></span><span> </span><span>morphism</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>lfp_sugar_thms</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>lfp_sugar_thms</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> transfer_lfp_sugar_thms</span><span class="main"><span>:</span></span><span> </span><span>theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>lfp_sugar_thms</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>lfp_sugar_thms</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>gfp_sugar_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>thm</span><span> </span><span>list</span><span> * </span><span>thm</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> * </span><span class="main"><span>(</span></span><span>Token.src</span><span> </span><span>list</span><span> * </span><span>Token.src</span><span> </span><span>list</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    * </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span>
    * </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span>
    * </span><span class="main"><span>(</span></span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>Token.src</span><span> </span><span>list</span><span class="main"><span>)</span></span><span>
    * </span><span class="main"><span>(</span></span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>Token.src</span><span> </span><span>list</span><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> morph_gfp_sugar_thms</span><span class="main"><span>:</span></span><span> </span><span>morphism</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>gfp_sugar_thms</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>gfp_sugar_thms</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> transfer_gfp_sugar_thms</span><span class="main"><span>:</span></span><span> </span><span>theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>gfp_sugar_thms</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>gfp_sugar_thms</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_co_recs_prelims</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>BNF_Util.fp_kind</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
     </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
     </span><span>term</span><span> </span><span>list</span><span>
     * </span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>option</span><span>
     * </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>term</span><span> </span><span>list</span><span> * </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span>
        * </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>)</span></span><span>
            * </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> * </span><span>typ</span><span> </span><span>list</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>option</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> repair_nullary_single_ctr</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_corec_p_pred_types</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_corec_fun_arg_types</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>int</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span>
    * </span><span class="main"><span>(</span></span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>typ</span><span> </span><span>list</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> define_co_rec_as</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>BNF_Util.fp_kind</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span>term</span><span> * </span><span>thm</span><span class="main"><span>)</span></span><span> * </span><span>local_theory</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> define_rec</span><span class="main"><span>:</span></span><span>
    </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span>term</span><span> * </span><span>thm</span><span class="main"><span>)</span></span><span> * </span><span class="entity"><span>Proof.context</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> define_corec</span><span class="main"><span>:</span></span><span> 'a * </span><span>term</span><span> </span><span>list</span><span> * </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span>
      * </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>)</span></span><span>
          * </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> * </span><span>typ</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> 'b </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>term</span><span> * </span><span>thm</span><span class="main"><span>)</span></span><span> * </span><span>local_theory</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_induct_raw_prem</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>term</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>term</span><span> </span><span>list</span><span> * </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>term</span><span> * </span><span class="main"><span>(</span></span><span>term</span><span> * </span><span>term</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span> * </span><span class="main"><span>(</span></span><span>int</span><span> * </span><span>term</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span> * </span><span>term</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> finish_induct_prem</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>term</span><span> </span><span>list</span><span> * </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>term</span><span> * </span><span class="main"><span>(</span></span><span>term</span><span> * </span><span>term</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span> * </span><span class="main"><span>(</span></span><span>int</span><span> * </span><span>term</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span> * </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_coinduct_prem</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_induct_attrs</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>Token.src</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_coinduct_attrs</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>Token.src</span><span> </span><span>list</span><span> * </span><span>Token.src</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> derive_induct_recs_thms_for_types</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>BNF_Def.bnf</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
     </span><span class="main"><span>(</span></span><span>'a * </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> * 'b</span><span class="main"><span>)</span></span><span> </span><span>option</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
     </span><span class="entity"><span>BNF_Def.bnf</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>BNF_Def.bnf</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
     </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
     </span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>lfp_sugar_thms</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> derive_coinduct_thms_for_types</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>BNF_Def.bnf</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>BNF_Def.bnf</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Ctr_Sugar.ctr_sugar</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span>thm</span><span> </span><span>list</span><span> * </span><span>thm</span><span class="main"><span>)</span></span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> derive_coinduct_corecs_thms_for_types</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>BNF_Def.bnf</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>string</span><span> * </span><span>term</span><span> </span><span>list</span><span> * </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span>
      * </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>)</span></span><span>
          * </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> * </span><span>typ</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>BNF_Def.bnf</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>typ</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Ctr_Sugar.ctr_sugar</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>gfp_sugar_thms</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> co_datatypes</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>BNF_Util.fp_kind</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>mixfix</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
      </span><span>binding</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>sort</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
      </span><span>typ</span><span> </span><span>list</span><span> * </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>BNF_Def.bnf</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>BNF_Comp.absT_info</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span>
      </span><span class="entity"><span>BNF_FP_Util.fp_result</span></span><span> * </span><span>local_theory</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="entity"><span>Ctr_Sugar.ctr_options</span></span><span>
    * </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>binding</span><span> </span><span>option</span><span> * </span><span class="main"><span>(</span></span><span>typ</span><span> * </span><span>sort</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span> * </span><span>binding</span><span class="main"><span>)</span></span><span> * </span><span>mixfix</span><span class="main"><span>)</span></span><span>
         * </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>binding</span><span class="main"><span>,</span></span><span> </span><span>binding</span><span> * </span><span>typ</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ctr_Sugar.ctr_spec</span></span><span> * </span><span>mixfix</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> *
         </span><span class="main"><span>(</span></span><span>binding</span><span> * </span><span>binding</span><span> * </span><span>binding</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
       * </span><span>term</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> co_datatype_cmd</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>BNF_Util.fp_kind</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span>mixfix</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
      </span><span>binding</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>sort</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> * </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>BNF_Def.bnf</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
     </span><span class="entity"><span>BNF_Comp.absT_info</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>BNF_FP_Util.fp_result</span></span><span> * </span><span class="entity"><span>Proof.context</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Plugin_Name.filter</span></span><span class="main"><span>)</span></span><span> * </span><span>bool</span><span class="main"><span>)</span></span><span>
    * </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>binding</span><span> </span><span>option</span><span> * </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>string</span><span> </span><span>option</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span> * </span><span>binding</span><span class="main"><span>)</span></span><span> * </span><span>mixfix</span><span class="main"><span>)</span></span><span>
         * </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>binding</span><span class="main"><span>,</span></span><span> </span><span>binding</span><span> * </span><span>string</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ctr_Sugar.ctr_spec</span></span><span> * </span><span>mixfix</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span>
        * </span><span class="main"><span>(</span></span><span>binding</span><span> * </span><span>binding</span><span> * </span><span>binding</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> * </span><span>string</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> parse_ctr_arg</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>binding</span><span> * </span><span>string</span><span class="main"><span>)</span></span><span> </span><span>parser</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> parse_ctr_specs</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>binding</span><span class="main"><span>,</span></span><span> </span><span>binding</span><span> * </span><span>string</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ctr_Sugar.ctr_spec</span></span><span> * </span><span>mixfix</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span>parser</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> parse_spec</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>binding</span><span> </span><span>option</span><span> * </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>string</span><span> </span><span>option</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span> * </span><span>binding</span><span class="main"><span>)</span></span><span> * </span><span>mixfix</span><span class="main"><span>)</span></span><span>
      * </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>binding</span><span class="main"><span>,</span></span><span> </span><span>binding</span><span> * </span><span>string</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ctr_Sugar.ctr_spec</span></span><span> * </span><span>mixfix</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span>
    * </span><span class="main"><span>(</span></span><span>binding</span><span> * </span><span>binding</span><span> * </span><span>binding</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> * </span><span>string</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>parser</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> parse_co_datatype</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ctr_Sugar.ctr_options_cmd</span></span><span>
        * </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>binding</span><span> </span><span>option</span><span> * </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>string</span><span> </span><span>option</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span> * </span><span>binding</span><span class="main"><span>)</span></span><span> * </span><span>mixfix</span><span class="main"><span>)</span></span><span>
      * </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>binding</span><span class="main"><span>,</span></span><span> </span><span>binding</span><span> * </span><span>string</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ctr_Sugar.ctr_spec</span></span><span> * </span><span>mixfix</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span>
    * </span><span class="main"><span>(</span></span><span>binding</span><span> * </span><span>binding</span><span> * </span><span>binding</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> * </span><span>string</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>parser</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> parse_co_datatype_cmd</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>BNF_Util.fp_kind</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>mixfix</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
      </span><span>binding</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>sort</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
      </span><span>typ</span><span> </span><span>list</span><span> * </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>BNF_Def.bnf</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>BNF_Comp.absT_info</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span>
      </span><span class="entity"><span>BNF_FP_Util.fp_result</span></span><span> * </span><span>local_theory</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span class="main"><span>)</span></span><span> </span><span>parser</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>BNF_FP_Def_Sugar</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>BNF_FP_DEF_SUGAR</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Ctr_Sugar</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>BNF_FP_Rec_Sugar_Util</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>BNF_Util</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>BNF_Comp</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>BNF_Def</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>BNF_FP_Util</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>BNF_FP_Def_Sugar_Tactics</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Eq_prefix</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Eq_"</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>case_transferN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"case_transfer"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctor_iff_dtorN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"ctor_iff_dtor"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctr_transferN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"ctr_transfer"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>disc_transferN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"disc_transfer"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sel_transferN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"sel_transfer"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>corec_codeN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"corec_code"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>corec_transferN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"corec_transfer"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_disc_iffN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"map_disc_iff"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_o_corecN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"map_o_corec"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_selN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"map_sel"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_injectN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"pred_inject"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rec_o_mapN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"rec_o_map"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rec_transferN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"rec_transfer"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set0N</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"set0"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_casesN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"set_cases"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_introsN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"set_intros"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_inductN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"set_induct"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_selN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"set_sel"</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>fp_ctr_sugar</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>ctrXs_Tss</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   ctor_iff_dtor</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
   ctr_defs</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   ctr_sugar</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Ctr_Sugar.ctr_sugar</span></span><span class="main"><span>,</span></span><span>
   ctr_transfers</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   case_transfers</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   disc_transfers</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   sel_transfers</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>fp_bnf_sugar</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>map_thms</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   map_disc_iffs</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   map_selss</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   rel_injects</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   rel_distincts</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   rel_sels</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   rel_intros</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   rel_cases</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   pred_injects</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   set_thms</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   set_selssss</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   set_introssss</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   set_cases</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>fp_co_induct_sugar</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>co_rec</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
   common_co_inducts</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   co_inducts</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   co_rec_def</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
   co_rec_thms</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   co_rec_discs</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   co_rec_disc_iffs</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   co_rec_selss</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   co_rec_codes</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   co_rec_transfers</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   co_rec_o_maps</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   common_rel_co_inducts</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   rel_co_inducts</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   common_set_inducts</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   set_inducts</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>fp_sugar</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>T</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span class="main"><span>,</span></span><span>
   BT</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span class="main"><span>,</span></span><span>
   X</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span class="main"><span>,</span></span><span>
   fp</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>fp_kind</span></span><span class="main"><span>,</span></span><span>
   fp_res_index</span><span class="main"><span>:</span></span><span> </span><span>int</span><span class="main"><span>,</span></span><span>
   fp_res</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>fp_result</span></span><span class="main"><span>,</span></span><span>
   pre_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>,</span></span><span>
   fp_bnf</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>,</span></span><span>
   absT_info</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>absT_info</span></span><span class="main"><span>,</span></span><span>
   fp_nesting_bnfs</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   live_nesting_bnfs</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
   fp_ctr_sugar</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>fp_ctr_sugar</span></span><span class="main"><span>,</span></span><span>
   fp_bnf_sugar</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>fp_bnf_sugar</span></span><span class="main"><span>,</span></span><span>
   fp_co_induct_sugar</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>fp_co_induct_sugar</span></span><span> </span><span>option</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>co_induct_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>strong_co_induct_of</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>morph_fp_bnf_sugar</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="entity"><span>map_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_disc_iffs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_selss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_injects</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_distincts</span></span><span class="main"><span>,</span></span><span>
    </span><span class="entity"><span>rel_sels</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_intros</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_cases</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pred_injects</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_selssss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_introssss</span></span><span class="main"><span>,</span></span><span>
    </span><span class="entity"><span>set_cases</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>fp_bnf_sugar</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>map_thms </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>map_thms</span></span><span class="main"><span>,</span></span><span>
   map_disc_iffs </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>map_disc_iffs</span></span><span class="main"><span>,</span></span><span>
   map_selss </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>map_selss</span></span><span class="main"><span>,</span></span><span>
   rel_injects </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel_injects</span></span><span class="main"><span>,</span></span><span>
   rel_distincts </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel_distincts</span></span><span class="main"><span>,</span></span><span>
   rel_sels </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel_sels</span></span><span class="main"><span>,</span></span><span>
   rel_intros </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel_intros</span></span><span class="main"><span>,</span></span><span>
   rel_cases </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel_cases</span></span><span class="main"><span>,</span></span><span>
   pred_injects </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pred_injects</span></span><span class="main"><span>,</span></span><span>
   set_thms </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_thms</span></span><span class="main"><span>,</span></span><span>
   set_selssss </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_selssss</span></span><span class="main"><span>,</span></span><span>
   set_introssss </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_introssss</span></span><span class="main"><span>,</span></span><span>
   set_cases </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_cases</span></span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>morph_fp_co_induct_sugar</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="entity"><span>co_rec</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>common_co_inducts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>co_inducts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>co_rec_def</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>co_rec_thms</span></span><span class="main"><span>,</span></span><span>
    </span><span class="entity"><span>co_rec_discs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>co_rec_disc_iffs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>co_rec_selss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>co_rec_codes</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>co_rec_transfers</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>co_rec_o_maps</span></span><span class="main"><span>,</span></span><span>
    </span><span class="entity"><span>common_rel_co_inducts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_co_inducts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>common_set_inducts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_inducts</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>fp_co_induct_sugar</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>co_rec </span><span class="main"><span>=</span></span><span> </span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>co_rec</span></span><span class="main"><span>,</span></span><span>
   common_co_inducts </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>common_co_inducts</span></span><span class="main"><span>,</span></span><span>
   co_inducts </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>co_inducts</span></span><span class="main"><span>,</span></span><span>
   co_rec_def </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>co_rec_def</span></span><span class="main"><span>,</span></span><span>
   co_rec_thms </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>co_rec_thms</span></span><span class="main"><span>,</span></span><span>
   co_rec_discs </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>co_rec_discs</span></span><span class="main"><span>,</span></span><span>
   co_rec_disc_iffs </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>co_rec_disc_iffs</span></span><span class="main"><span>,</span></span><span>
   co_rec_selss </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>co_rec_selss</span></span><span class="main"><span>,</span></span><span>
   co_rec_codes </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>co_rec_codes</span></span><span class="main"><span>,</span></span><span>
   co_rec_transfers </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>co_rec_transfers</span></span><span class="main"><span>,</span></span><span>
   co_rec_o_maps </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>co_rec_o_maps</span></span><span class="main"><span>,</span></span><span>
   common_rel_co_inducts </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>common_rel_co_inducts</span></span><span class="main"><span>,</span></span><span>
   rel_co_inducts </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel_co_inducts</span></span><span class="main"><span>,</span></span><span>
   common_set_inducts </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>common_set_inducts</span></span><span class="main"><span>,</span></span><span>
   set_inducts </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_inducts</span></span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>morph_fp_ctr_sugar</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="entity"><span>ctrXs_Tss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctor_iff_dtor</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctr_defs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctr_sugar</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctr_transfers</span></span><span class="main"><span>,</span></span><span>
    </span><span class="entity"><span>case_transfers</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>disc_transfers</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sel_transfers</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>fp_ctr_sugar</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>ctrXs_Tss </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.typ</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctrXs_Tss</span></span><span class="main"><span>,</span></span><span>
   ctor_iff_dtor </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>ctor_iff_dtor</span></span><span class="main"><span>,</span></span><span>
   ctr_defs </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctr_defs</span></span><span class="main"><span>,</span></span><span>
   ctr_sugar </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>morph_ctr_sugar</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>ctr_sugar</span></span><span class="main"><span>,</span></span><span>
   ctr_transfers </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctr_transfers</span></span><span class="main"><span>,</span></span><span>
   case_transfers </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>case_transfers</span></span><span class="main"><span>,</span></span><span>
   disc_transfers </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>disc_transfers</span></span><span class="main"><span>,</span></span><span>
   sel_transfers </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sel_transfers</span></span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>morph_fp_sugar</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>BT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fp</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fp_res</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fp_res_index</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pre_bnf</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fp_bnf</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>absT_info</span></span><span class="main"><span>,</span></span><span>
    </span><span class="entity"><span>fp_nesting_bnfs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>live_nesting_bnfs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fp_ctr_sugar</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fp_bnf_sugar</span></span><span class="main"><span>,</span></span><span>
    </span><span class="entity"><span>fp_co_induct_sugar</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>fp_sugar</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>{</span></span><span>T </span><span class="main"><span>=</span></span><span> </span><span>Morphism.typ</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span>
   BT </span><span class="main"><span>=</span></span><span> </span><span>Morphism.typ</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>BT</span></span><span class="main"><span>,</span></span><span>
   X </span><span class="main"><span>=</span></span><span> </span><span>Morphism.typ</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>,</span></span><span>
   fp </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fp</span></span><span class="main"><span>,</span></span><span>
   fp_res </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>morph_fp_result</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>fp_res</span></span><span class="main"><span>,</span></span><span>
   fp_res_index </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fp_res_index</span></span><span class="main"><span>,</span></span><span>
   pre_bnf </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>morph_bnf</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>pre_bnf</span></span><span class="main"><span>,</span></span><span>
   fp_bnf </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>morph_bnf</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>fp_bnf</span></span><span class="main"><span>,</span></span><span>
   absT_info </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>morph_absT_info</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>absT_info</span></span><span class="main"><span>,</span></span><span>
   fp_nesting_bnfs </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>morph_bnf</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fp_nesting_bnfs</span></span><span class="main"><span>,</span></span><span>
   live_nesting_bnfs </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>morph_bnf</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>live_nesting_bnfs</span></span><span class="main"><span>,</span></span><span>
   fp_ctr_sugar </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>morph_fp_ctr_sugar</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>fp_ctr_sugar</span></span><span class="main"><span>,</span></span><span>
   fp_bnf_sugar </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>morph_fp_bnf_sugar</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>fp_bnf_sugar</span></span><span class="main"><span>,</span></span><span>
   fp_co_induct_sugar </span><span class="main"><span>=</span></span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>morph_fp_co_induct_sugar</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fp_co_induct_sugar</span></span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>transfer_fp_sugar</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>morph_fp_sugar</span></span><span> </span><span>o</span><span> </span><span>Morphism.transfer_morphism</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Data</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Generic_Data</span><span>
</span><span class="main"><span>(</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fp_sugar</span></span><span> </span><span>Symtab.table</span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>empty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symtab.empty</span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>merge</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symtab.merge</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>data</span></span><span class="main"><span>;</span></span><span>
</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fp_sugar_of_generic</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transfer_fp_sugar</span></span><span> </span><span class="main"><span>(</span></span><span>Context.theory_of</span><span> </span><span class="entity"><span>context</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>Symtab.lookup</span><span> </span><span class="main"><span>(</span></span><span>Data.get</span><span> </span><span class="entity"><span>context</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fp_sugars_of_generic</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Symtab.fold</span><span> </span><span class="main"><span>(</span></span><span>cons</span><span> </span><span>o</span><span> </span><span class="entity"><span>transfer_fp_sugar</span></span><span> </span><span class="main"><span>(</span></span><span>Context.theory_of</span><span> </span><span class="entity"><span>context</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Data.get</span><span> </span><span class="entity"><span>context</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fp_sugar_of</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fp_sugar_of_generic</span></span><span> </span><span>o</span><span> </span><span>Context.Proof</span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fp_sugar_of_global</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fp_sugar_of_generic</span></span><span> </span><span>o</span><span> </span><span>Context.Theory</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fp_sugars_of</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fp_sugars_of_generic</span></span><span> </span><span>o</span><span> </span><span>Context.Proof</span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fp_sugars_of_global</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fp_sugars_of_generic</span></span><span> </span><span>o</span><span> </span><span>Context.Theory</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>FP_Sugar_Plugin</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Plugin</span></span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fp_sugar</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fp_sugars_interpretation</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>FP_Sugar_Plugin.interpretation</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fp_sugars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transfer_fp_sugar</span></span><span> </span><span class="main"><span>(</span></span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fp_sugars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>interpret_fp_sugars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>FP_Sugar_Plugin.data</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>register_fp_sugars_raw</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fp_sugar</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span>T </span><span class="main"><span>=</span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span>Local_Theory.declaration</span><span> </span><span class="main"><span>{</span></span><span>syntax </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> pervasive </span><span class="main"><span>=</span></span><span> </span><span>true</span><span class="main"><span>,</span></span><span> pos </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>}</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Data.map</span><span> </span><span class="main"><span>(</span></span><span>Symtab.update</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>morph_fp_sugar</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>fp_sugar</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>register_fp_sugars</span></span><span> </span><span class="entity"><span>plugins</span></span><span> </span><span class="entity"><span>fp_sugars</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>register_fp_sugars_raw</span></span><span> </span><span class="entity"><span>fp_sugars</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>interpret_fp_sugars</span></span><span> </span><span class="entity"><span>plugins</span></span><span> </span><span class="entity"><span>fp_sugars</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>interpret_bnfs_register_fp_sugars</span></span><span> </span><span class="entity"><span>plugins</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>BTs</span></span><span> </span><span class="entity"><span>Xs</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="entity"><span>pre_bnfs</span></span><span> </span><span class="entity"><span>absT_infos</span></span><span> </span><span class="entity"><span>fp_nesting_bnfs</span></span><span>
    </span><span class="entity"><span>live_nesting_bnfs</span></span><span> </span><span class="entity"><span>fp_res</span></span><span> </span><span class="entity"><span>ctrXs_Tsss</span></span><span> </span><span class="entity"><span>ctor_iff_dtors</span></span><span> </span><span class="entity"><span>ctr_defss</span></span><span> </span><span class="entity"><span>ctr_sugars</span></span><span> </span><span class="entity"><span>co_recs</span></span><span> </span><span class="entity"><span>co_rec_defs</span></span><span>
    </span><span class="entity"><span>map_thmss</span></span><span> </span><span class="entity"><span>common_co_inducts</span></span><span> </span><span class="entity"><span>co_inductss</span></span><span> </span><span class="entity"><span>co_rec_thmss</span></span><span> </span><span class="entity"><span>co_rec_discss</span></span><span> </span><span class="entity"><span>co_rec_selsss</span></span><span> </span><span class="entity"><span>rel_injectss</span></span><span>
    </span><span class="entity"><span>rel_distinctss</span></span><span> </span><span class="entity"><span>map_disc_iffss</span></span><span> </span><span class="entity"><span>map_selsss</span></span><span> </span><span class="entity"><span>rel_selss</span></span><span> </span><span class="entity"><span>rel_intross</span></span><span> </span><span class="entity"><span>rel_casess</span></span><span> </span><span class="entity"><span>pred_injectss</span></span><span>
    </span><span class="entity"><span>set_thmss</span></span><span> </span><span class="entity"><span>set_selsssss</span></span><span> </span><span class="entity"><span>set_introsssss</span></span><span> </span><span class="entity"><span>set_casess</span></span><span> </span><span class="entity"><span>ctr_transferss</span></span><span> </span><span class="entity"><span>case_transferss</span></span><span> </span><span class="entity"><span>disc_transferss</span></span><span>
    </span><span class="entity"><span>sel_transferss</span></span><span> </span><span class="entity"><span>co_rec_disc_iffss</span></span><span> </span><span class="entity"><span>co_rec_codess</span></span><span> </span><span class="entity"><span>co_rec_transferss</span></span><span> </span><span class="entity"><span>common_rel_co_inducts</span></span><span>
    </span><span class="entity"><span>rel_co_inductss</span></span><span> </span><span class="entity"><span>common_set_inducts</span></span><span> </span><span class="entity"><span>set_inductss</span></span><span> </span><span class="entity"><span>co_rec_o_mapss</span></span><span> </span><span class="entity"><span>noted</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fp_sugars</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>map_index</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="main"><span>{</span></span><span>T </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> BT </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>BTs</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span> X </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>Xs</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span> fp </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fp</span></span><span class="main"><span>,</span></span><span> fp_res </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fp_res</span></span><span class="main"><span>,</span></span><span> fp_res_index </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
         pre_bnf </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>pre_bnfs</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span> absT_info </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>absT_infos</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
         fp_bnf </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>bnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
         fp_nesting_bnfs </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fp_nesting_bnfs</span></span><span class="main"><span>,</span></span><span> live_nesting_bnfs </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>live_nesting_bnfs</span></span><span class="main"><span>,</span></span><span>
         fp_ctr_sugar </span><span class="main"><span>=</span></span><span>
           </span><span class="main"><span>{</span></span><span>ctrXs_Tss </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>ctrXs_Tsss</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            ctor_iff_dtor </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>ctor_iff_dtors</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            ctr_defs </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>ctr_defss</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            ctr_sugar </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>ctr_sugars</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            ctr_transfers </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>ctr_transferss</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            case_transfers </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>case_transferss</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            disc_transfers </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>disc_transferss</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            sel_transfers </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>sel_transferss</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span>
         fp_bnf_sugar </span><span class="main"><span>=</span></span><span>
           </span><span class="main"><span>{</span></span><span>map_thms </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>map_thmss</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            map_disc_iffs </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>map_disc_iffss</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            map_selss </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>map_selsss</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            rel_injects </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>rel_injectss</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            rel_distincts </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>rel_distinctss</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            rel_sels </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>rel_selss</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            rel_intros </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>rel_intross</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            rel_cases </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>rel_casess</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            pred_injects </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>pred_injectss</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            set_thms </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>set_thmss</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            set_selssss </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>set_selsssss</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            set_introssss </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>set_introsssss</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            set_cases </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>set_casess</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span>
         fp_co_induct_sugar </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span>
           </span><span class="main"><span>{</span></span><span>co_rec </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>co_recs</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            common_co_inducts </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>common_co_inducts</span></span><span class="main"><span>,</span></span><span>
            co_inducts </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>co_inductss</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            co_rec_def </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>co_rec_defs</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            co_rec_thms </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>co_rec_thmss</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            co_rec_discs </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>co_rec_discss</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            co_rec_disc_iffs </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>co_rec_disc_iffss</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            co_rec_selss </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>co_rec_selsss</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            co_rec_codes </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>co_rec_codess</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            co_rec_transfers </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>co_rec_transferss</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            co_rec_o_maps </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>co_rec_o_mapss</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            common_rel_co_inducts </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>common_rel_co_inducts</span></span><span class="main"><span>,</span></span><span>
            rel_co_inducts </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>rel_co_inductss</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span>
            common_set_inducts </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>common_set_inducts</span></span><span class="main"><span>,</span></span><span>
            set_inducts </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>set_inductss</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>}</span></span><span class="main"><span>}</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="entity"><span>morph_fp_sugar</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>substitute_noted_thm</span></span><span> </span><span class="entity"><span>noted</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>register_fp_sugars_raw</span></span><span> </span><span class="entity"><span>fp_sugars</span></span><span>
    </span><span>#&gt;</span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>interpret_bnf</span></span><span> </span><span class="entity"><span>plugins</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>bnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span>
    </span><span>#&gt;</span><span> </span><span class="entity"><span>interpret_fp_sugars</span></span><span> </span><span class="entity"><span>plugins</span></span><span> </span><span class="entity"><span>fp_sugars</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>quasi_unambiguous_case_names</span></span><span> </span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>`</span><span>Long_Name.base_name</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>names</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dups</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Library.duplicates</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>ps</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>underscore</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Long_Name.explode</span><span> </span><span class="entity"><span>s</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>space_implode</span><span> </span><span class="inner_quoted"><span>"_"</span></span><span> </span><span class="main"><span>(</span></span><span>drop</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>ss</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>base</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>full</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dups</span></span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>underscore</span></span><span> </span><span class="entity"><span>full</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>base</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ps</span></span><span>
    </span><span>|&gt;</span><span> </span><span>Name.variant_list</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>zipper_map</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>zed</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>zed</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>y</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>zed</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>zed</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>cannot_merge_types</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Mutually "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>co_prefix</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"recursive types must have the same type parameters"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>merge_type_arg</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>T'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>cannot_merge_types</span></span><span> </span><span class="entity"><span>fp</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>merge_type_args</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>As</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>As'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>merge_type_arg</span></span><span> </span><span class="entity"><span>fp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>cannot_merge_types</span></span><span> </span><span class="entity"><span>fp</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>type_args_named_constrained_of_spec</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ncAs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ncAs</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>type_binding_of_spec</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mixfix_of_spec</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mx</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mixfixed_ctr_specs_of_spec</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mx_ctr_specs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mx_ctr_specs</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_binding_of_spec</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rel_binding_of_spec</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pred_binding_of_spec</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>sel_default_eqs_of_spec</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>ctr_sugar_kind_of_fp_kind</span></span><span> </span><span class="entity"><span>Least_FP</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Datatype</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ctr_sugar_kind_of_fp_kind</span></span><span> </span><span class="entity"><span>Greatest_FP</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Codatatype</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>uncurry_thm</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>uncurry_thm</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>uncurry_thm</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>uncurry_thm</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>rotate_prems</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>conjI</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>choose_binary_fun</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>AB</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>find_first</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span>#&gt;</span><span> </span><span>binder_types</span><span> </span><span>#&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>A</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>B</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>AB</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>A</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>B</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>build_binary_fun_app</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rapp</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>rapp</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>choose_binary_fun</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>build_the_rel</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="entity"><span>B</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>build_rel</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span>o</span><span> </span><span class="entity"><span>choose_binary_fun</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>A</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>B</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>build_rel_app</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>build_the_rel</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>build_set_app</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.betapply</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>build_set</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_parametricity_goal</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>build_the_rel</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prem</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>name_of_set</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>name_of_const</span></span><span> </span><span class="inner_quoted"><span>"set function"</span></span><span> </span><span>domain_type</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fundefcong_attrs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>attributes</span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="../../../../../Fun_Def_Base.html#Fun_Def_Base.fundef_cong|attribute"><span class="operator"><span>fundef_cong</span></span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nitpicksimp_attrs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>attributes</span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="../../../../../HOL.html#HOL.nitpick_simp|attribute"><span class="operator"><span>nitpick_simp</span></span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>simp_attrs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>attributes</span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lists_bmoc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>flat_corec_predss_getterss</span></span><span> </span><span class="entity"><span>qss</span></span><span> </span><span class="entity"><span>gss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>@</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>qss</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>gss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>flat_corec_preds_predsss_gettersss</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>qss</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>gss</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>flat_corec_predss_getterss</span></span><span> </span><span class="entity"><span>qss</span></span><span> </span><span class="entity"><span>gss</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>flat_corec_preds_predsss_gettersss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>qss</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>qsss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>gss</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>gsss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>p</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>flat_corec_predss_getterss</span></span><span> </span><span class="entity"><span>qss</span></span><span> </span><span class="entity"><span>gss</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>flat_corec_preds_predsss_gettersss</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>qsss</span></span><span> </span><span class="entity"><span>gsss</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_flip</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T1</span></span><span class="main"><span>,</span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T3</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"x"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T1</span></span><span class="main"><span>,</span></span><span> </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"y"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>,</span></span><span> </span><span>Var</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T2</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>T1</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>T3</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>flip_rels</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.add_vars</span><span> </span><span class="main"><span>(</span></span><span>Thm.prop_of</span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Rs'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>rev</span><span> </span><span class="main"><span>(</span></span><span>drop</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>infer_instantiate</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_flip</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Rs'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thm</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_ctor_or_dtor</span></span><span> </span><span class="entity"><span>get_T</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>get_T</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>Term.subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ts0</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_ctor</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_ctor_or_dtor</span></span><span> </span><span>range_type</span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_dtor</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_ctor_or_dtor</span></span><span> </span><span>domain_type</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bnf_sets</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T_name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Us</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lives</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lives_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sets_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_set</span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>find_index</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lives</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.dummy</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>T_name</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_set</span></span><span> </span><span class="entity"><span>Us</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_xtor_co_recs</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>ts0</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>fpTs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fpTs0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Cs0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>fp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Greatest_FP</span></span><span> </span><span>?</span><span> </span><span>swap</span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>dest_funT</span><span> </span><span>o</span><span> </span><span>snd</span><span> </span><span>o</span><span> </span><span class="entity"><span>strip_typeN</span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span>o</span><span> </span><span>fastype_of</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts0</span></span><span>
      </span><span>|&gt;</span><span> </span><span>split_list</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rho</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>tvar_subst</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fpTs0</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Cs0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fpTs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Cs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Term.subst_TVars</span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts0</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>liveness_of_fp_bnf</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>T_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
    </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>not</span><span> </span><span>o</span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>deads_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ts</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_nesting_bnf_names</span></span><span> </span><span class="entity"><span>Us</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add</span></span><span> </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>needs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_map</span><span> </span><span class="entity"><span>add</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>exists</span><span> </span><span>I</span><span> </span><span class="entity"><span>needs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span>true</span><span class="main"><span>,</span></span><span> </span><span>insert</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>ss'</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span>false</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss'</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>add</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Us</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>snd</span><span> </span><span>oo</span><span> </span><span class="entity"><span>add</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>nesting_bnfs</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctr_Tsss</span></span><span> </span><span class="entity"><span>Us</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_of</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>add_nesting_bnf_names</span></span><span> </span><span class="entity"><span>Us</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctr_Tsss</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>indexify</span></span><span> </span><span class="entity"><span>proj</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>find_index</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>proj</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>massage_simple_notes</span></span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>filter_out</span><span> </span><span class="main"><span>(</span></span><span>null</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span>
  </span><span>#&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thmN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f_attrs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Binding.qualify</span><span> </span><span>true</span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.name</span><span> </span><span class="entity"><span>thmN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span>map_index</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f_attrs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>massage_multi_notes</span></span><span> </span><span class="entity"><span>b_names</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thmN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thmss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>attrs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>b_name</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T_name</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Binding.qualify</span><span> </span><span>true</span><span> </span><span class="entity"><span>b_name</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.name</span><span> </span><span class="entity"><span>thmN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>attrs</span></span><span> </span><span class="entity"><span>T_name</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>thms</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="entity"><span>b_names</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>thmss</span></span><span class="main"><span>)</span></span><span>
  </span><span>#&gt;</span><span> </span><span>filter_out</span><span> </span><span class="main"><span>(</span></span><span>null</span><span> </span><span>o</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span>hd</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>define_ctrs_dtrs_for_type</span></span><span> </span><span class="entity"><span>fp_b_name</span></span><span> </span><span class="entity"><span>fpT</span></span><span> </span><span class="entity"><span>ctor</span></span><span> </span><span class="entity"><span>dtor</span></span><span> </span><span class="entity"><span>ctor_dtor</span></span><span> </span><span class="entity"><span>dtor_ctor</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>abs</span></span><span> </span><span class="entity"><span>ctr_bindings</span></span><span>
    </span><span class="entity"><span>ctr_mixfixes</span></span><span> </span><span class="entity"><span>ctr_Tss</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctor_absT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>domain_type</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>ctor</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"w"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctor_absT</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Freess</span></span><span> </span><span class="inner_quoted"><span>"x"</span></span><span> </span><span class="entity"><span>ctr_Tss</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span>Variable.variant_fixes</span><span> </span><span class="entity"><span>fp_b_name</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>u'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fpT</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctor_iff_dtor_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>]</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>u</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>mk_ctor_iff_dtor_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span>Thm.ctyp_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ctor_absT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fpT</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>ctor</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>dtor</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctor_dtor</span></span><span> </span><span class="entity"><span>dtor_ctor</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctr_rhss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>fold_rev</span><span> </span><span>Term.lambda</span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>mk_absumprod</span></span><span> </span><span class="entity"><span>ctor_absT</span></span><span> </span><span class="entity"><span>abs</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>xss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>raw_ctrs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>raw_ctr_defs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy_old</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>Local_Theory.begin_nested</span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>apfst</span><span> </span><span>split_list</span><span> </span><span>o</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mx</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span>Local_Theory.define</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Thm.make_def_binding</span><span> </span><span class="main"><span>(</span></span><span>Config.get</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>bnf_internals</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>#&gt;&gt;</span><span> </span><span>apsnd</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctr_bindings</span></span><span> </span><span class="entity"><span>ctr_mixfixes</span></span><span> </span><span class="entity"><span>ctr_rhss</span></span><span>
      </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>lthy_old</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctr_defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>raw_ctr_defs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctrs0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>raw_ctrs</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>xss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctrs0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctor_iff_dtor_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctr_defs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>wrap_ctrs</span></span><span> </span><span class="entity"><span>plugins</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="entity"><span>discs_sels</span></span><span> </span><span class="entity"><span>fp_b_name</span></span><span> </span><span class="entity"><span>ctor_inject</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>ms</span></span><span> </span><span class="entity"><span>abs_inject</span></span><span> </span><span class="entity"><span>type_definition</span></span><span>
    </span><span class="entity"><span>disc_bindings</span></span><span> </span><span class="entity"><span>sel_bindingss</span></span><span> </span><span class="entity"><span>sel_default_eqs</span></span><span> </span><span class="entity"><span>ctrs0</span></span><span> </span><span class="entity"><span>ctor_iff_dtor_thm</span></span><span> </span><span class="entity"><span>ctr_defs</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sumEN_thm'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.unit_all_eq1|fact"><span>unit_all_eq1</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_absumprodE</span></span><span> </span><span class="entity"><span>type_definition</span></span><span> </span><span class="entity"><span>ms</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>exhaust_tac</span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>mk_exhaust_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>ctr_defs</span></span><span> </span><span class="entity"><span>ctor_iff_dtor_thm</span></span><span> </span><span class="entity"><span>sumEN_thm'</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inject_tacss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctr_def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="entity"><span>mk_inject_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctr_def</span></span><span> </span><span class="entity"><span>ctor_inject</span></span><span> </span><span class="entity"><span>abs_inject</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctr_defs</span></span><span> </span><span class="entity"><span>ms</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>half_distinct_tacss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>def</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>def'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>mk_half_distinct_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctor_inject</span></span><span> </span><span class="entity"><span>abs_inject</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>def</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>def'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>mk_half_pairss</span></span><span> </span><span class="main"><span>(</span></span><span>`</span><span>I</span><span> </span><span class="entity"><span>ctr_defs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tacss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>exhaust_tac</span></span><span class="main"><span>]</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>inject_tacss</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>half_distinct_tacss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>ctr_spec_of</span></span><span> </span><span class="entity"><span>disc_b</span></span><span> </span><span class="entity"><span>ctr0</span></span><span> </span><span class="entity"><span>sel_bs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>disc_b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctr0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sel_bs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctr_specs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>ctr_spec_of</span></span><span> </span><span class="entity"><span>disc_bindings</span></span><span> </span><span class="entity"><span>ctrs0</span></span><span> </span><span class="entity"><span>sel_bindingss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctr_sugar</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>case_cong</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>free_constructors</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctr_sugar_kind_of_fp_kind</span></span><span> </span><span class="entity"><span>fp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tacss</span></span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>plugins</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>discs_sels</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>standard_binding</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctr_specs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sel_default_eqs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>anonymous_notes</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>case_cong</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fundefcong_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
      </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>attrs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Binding.empty</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>thms</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>notes</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Config.get</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>bnf_internals</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ctor_iff_dtorN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ctor_iff_dtor_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="entity"><span>massage_simple_notes</span></span><span> </span><span class="entity"><span>fp_b_name</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>ctr_sugar</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span>|&gt;</span><span> </span><span>Local_Theory.notes</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>anonymous_notes</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>notes</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>derive_map_set_rel_pred_thms</span></span><span> </span><span class="entity"><span>plugins</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="entity"><span>abs_inverses</span></span><span> </span><span class="entity"><span>ctr_defs</span></span><span> </span><span class="entity"><span>fp_nesting_set_maps</span></span><span>
    </span><span class="entity"><span>fp_nesting_rel_eq_onps</span></span><span> </span><span class="entity"><span>live_nesting_map_id0s</span></span><span> </span><span class="entity"><span>live_nesting_set_maps</span></span><span> </span><span class="entity"><span>live_nesting_rel_eqs</span></span><span>
    </span><span class="entity"><span>live_nesting_rel_eq_onps</span></span><span> </span><span class="entity"><span>fp_nested_rel_eq_onps</span></span><span> </span><span class="entity"><span>fp_b_name</span></span><span> </span><span class="entity"><span>fp_bnf</span></span><span> </span><span class="entity"><span>fp_bnfs</span></span><span> </span><span class="entity"><span>fpT</span></span><span> </span><span class="entity"><span>ctor</span></span><span> </span><span class="entity"><span>ctor_dtor</span></span><span>
    </span><span class="entity"><span>dtor_ctor</span></span><span> </span><span class="entity"><span>pre_map_def</span></span><span> </span><span class="entity"><span>pre_set_defs</span></span><span> </span><span class="entity"><span>pre_rel_def</span></span><span> </span><span class="entity"><span>fp_map_thm</span></span><span> </span><span class="entity"><span>fp_set_thms</span></span><span> </span><span class="entity"><span>fp_rel_thm</span></span><span>
    </span><span class="entity"><span>extra_unfolds_map</span></span><span> </span><span class="entity"><span>extra_unfolds_set</span></span><span> </span><span class="entity"><span>extra_unfolds_rel</span></span><span> </span><span class="entity"><span>ctr_Tss</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="entity"><span>casex</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>case_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>discs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>selss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sel_defs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctrs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>exhaust</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>exhaust_discs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>disc_thmss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sel_thmss</span></span><span class="main"><span>,</span></span><span>
      </span><span class="entity"><span>injects</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>distincts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>distinct_discsss</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ctr_sugar</span></span><span class="main"><span>)</span></span><span>
    </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>ctr_Tss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>length</span><span> </span><span class="entity"><span>ctr_Tss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>B_ify_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.typ_subst_atomic</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>As</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fpBT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>B_ify_T</span></span><span> </span><span class="entity"><span>fpT</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live_AsBs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>&lt;&gt;</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>As</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live_As</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>live_AsBs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>live_AsBs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>xss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>yss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ps</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ta</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tb</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thesis</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span>Variable.declare_typ</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>As</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>]</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Freess</span></span><span> </span><span class="inner_quoted"><span>"x"</span></span><span> </span><span class="entity"><span>ctr_Tss</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Freess</span></span><span> </span><span class="inner_quoted"><span>"y"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>B_ify_T</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctr_Tss</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"f"</span></span><span> </span><span class="entity"><span>fTs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"P"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>mk_pred1T</span></span><span> </span><span class="entity"><span>live_As</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"R"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>uncurry</span><span> </span><span class="entity"><span>mk_pred2T</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>live_AsBs</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"a"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fpT</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"b"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fpBT</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>apfst</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>o</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"thesis"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctrAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_ctr</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctrs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctrBs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_ctr</span></span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctrs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctr_defs'</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_unabs_def</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_obj_eq</span></span><span> </span><span class="entity"><span>def</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ms</span></span><span> </span><span class="entity"><span>ctr_defs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ABfs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>live_AsBs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>derive_rel_case</span></span><span> </span><span class="entity"><span>relAsBs</span></span><span> </span><span class="entity"><span>rel_inject_thms</span></span><span> </span><span class="entity"><span>rel_distinct_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_Rs_a_b</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>relAsBs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ta</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>tb</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_assms</span></span><span> </span><span class="entity"><span>ctrA</span></span><span> </span><span class="entity"><span>ctrB</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>argA_Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>binder_types</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>ctrA</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>argB_Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>binder_types</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>ctrB</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>argAs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>argBs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names_ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
              </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"x"</span></span><span> </span><span class="entity"><span>argA_Ts</span></span><span>
              </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"y"</span></span><span> </span><span class="entity"><span>argB_Ts</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctrA_args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctrA</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>argAs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctrB_args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctrB</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>argBs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>argAs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>argBs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span>
               </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ta</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctrA_args</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tb</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctrB_args</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span>
                  </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>build_rel_app</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>argAs</span></span><span> </span><span class="entity"><span>argBs</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>thesis</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
             </span><span class="entity"><span>names_ctxt</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>assms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 2</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_assms</span></span><span> </span><span class="entity"><span>ctrAs</span></span><span> </span><span class="entity"><span>ctrBs</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>rel_Rs_a_b</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>assms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thesis</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>mk_rel_case_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ta</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tb</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>exhaust</span></span><span> </span><span class="entity"><span>injects</span></span><span>
            </span><span class="entity"><span>rel_inject_thms</span></span><span> </span><span class="entity"><span>distincts</span></span><span> </span><span class="entity"><span>rel_distinct_thms</span></span><span> </span><span class="entity"><span>live_nesting_rel_eqs</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>singleton</span><span> </span><span class="main"><span>(</span></span><span>Proof_Context.export</span><span> </span><span class="entity"><span>names_lthy</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>derive_case_transfer</span></span><span> </span><span class="entity"><span>rel_case_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>S</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"S"</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>E</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>caseA</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_case</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>casex</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>caseB</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_case</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="entity"><span>casex</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_parametricity_goal</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>S</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>caseA</span></span><span> </span><span class="entity"><span>caseB</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>mk_case_transfer_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>rel_case_thm</span></span><span> </span><span class="entity"><span>case_thms</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>singleton</span><span> </span><span class="main"><span>(</span></span><span>Proof_Context.export</span><span> </span><span class="entity"><span>names_lthy</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>plugins</span></span><span> </span><span class="entity"><span>transfer_plugin</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>relAsBs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span class="entity"><span>fpT</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_case_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>derive_rel_case</span></span><span> </span><span class="entity"><span>relAsBs</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>case_transfer_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>derive_case_transfer</span></span><span> </span><span class="entity"><span>rel_case_thm</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>notes</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>case_transferN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>case_transfer_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="entity"><span>massage_simple_notes</span></span><span> </span><span class="entity"><span>fp_b_name</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>noted</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Local_Theory.notes</span><span> </span><span class="entity"><span>notes</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>substitute_noted_thm</span></span><span> </span><span class="entity"><span>noted</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>case_transfer_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy'</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mapx</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_map</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_of_bnf</span></span><span> </span><span class="entity"><span>fp_bnf</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>relAsBs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rel</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_of_bnf</span></span><span> </span><span class="entity"><span>fp_bnf</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>setAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_set</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sets_of_bnf</span></span><span> </span><span class="entity"><span>fp_bnf</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>discAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_disc_or_sel</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>discs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>discBs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_disc_or_sel</span></span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>discs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>selAss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_disc_or_sel</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>selss</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>selBss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_disc_or_sel</span></span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>selss</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_ctor_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Least_FP</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="entity"><span>fp_map_thm</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctorA</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_ctor</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>ctor</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctorB</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_ctor</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ctor</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>y_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>domain_type</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>ctorA</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>y</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>y_s</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
                </span><span>|&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"y"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>y_T</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctor_cong</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span>infer_instantiate'</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>ctorB</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>arg_cong</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fp_map_thm'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fp_map_thm</span></span><span>
                </span><span>|&gt;</span><span> </span><span>infer_instantiate'</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span> </span><span>NONE</span><span> </span><span>@</span><span>
                  </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctorA</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>dtor_ctor</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>fp_map_thm'</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>ctor_cong</span></span><span> </span><span>RS</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctor_dtor</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span>Drule.generalize</span><span> </span><span class="main"><span>(</span></span><span>Names.empty</span><span class="main"><span>,</span></span><span> </span><span>Names.make1_set</span><span> </span><span class="entity"><span>y_s</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>ctrA</span></span><span> </span><span class="entity"><span>ctrB</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fmap</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

                </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_arg</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>x</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>build_map</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span>o</span><span> </span><span>AList.lookup</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ABfs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>;</span></span><span>

                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>xs'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_arg</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fmap</span></span><span> </span><span>$</span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctrA</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctrB</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>ctrAs</span></span><span> </span><span class="entity"><span>ctrBs</span></span><span> </span><span class="entity"><span>xss</span></span><span> </span><span class="entity"><span>yss</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_conjunction_balanced</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="entity"><span>mk_map_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>abs_inverses</span></span><span> </span><span class="entity"><span>pre_map_def</span></span><span> </span><span class="entity"><span>map_ctor_thm</span></span><span> </span><span class="entity"><span>live_nesting_map_id0s</span></span><span> </span><span class="entity"><span>ctr_defs'</span></span><span>
                </span><span class="entity"><span>extra_unfolds_map</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
            </span><span>|&gt;</span><span> </span><span>Conjunction.elim_balanced</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set0_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="entity"><span>setA</span></span><span> </span><span class="entity"><span>ctrA</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>build_set_app</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>A</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>(</span></span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>exists_subtype_in</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>A</span></span><span class="main"><span>]</span></span><span> </span><span>o</span><span> </span><span>fastype_of</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>setA</span></span><span> </span><span>$</span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctrA</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>HOLogic.mk_set</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Library.foldl1</span><span> </span><span class="entity"><span>mk_union</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 2</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>live_A</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>setA</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>live_A</span></span><span> </span><span class="entity"><span>setA</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctrAs</span></span><span> </span><span class="entity"><span>xss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>live_As</span></span><span> </span><span class="entity"><span>setAs</span></span><span>
              </span><span>|&gt;</span><span> </span><span>flat</span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
              </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_conjunction_balanced</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="entity"><span>mk_set0_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>abs_inverses</span></span><span> </span><span class="entity"><span>pre_set_defs</span></span><span> </span><span class="entity"><span>dtor_ctor</span></span><span> </span><span class="entity"><span>fp_set_thms</span></span><span>
                    </span><span class="entity"><span>fp_nesting_set_maps</span></span><span> </span><span class="entity"><span>live_nesting_set_maps</span></span><span> </span><span class="entity"><span>ctr_defs'</span></span><span> </span><span class="entity"><span>extra_unfolds_set</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
                </span><span>|&gt;</span><span> </span><span>Conjunction.elim_balanced</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>set0_thms</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.insert_is_Un|fact"><span>insert_is_Un</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.sym|fact"><span>sym</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.Un_empty_left|fact"><span>Un_empty_left</span></a><span> </span><a class="entity_ref" href="../../../../../Set.html#Set.Un_insert_left|fact"><span>Un_insert_left</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_ctor_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Least_FP</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="entity"><span>fp_rel_thm</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctorA</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_ctor</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>ctor</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctorB</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_ctor</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ctor</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>y_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>domain_type</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>ctorA</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>z_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>domain_type</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>ctorB</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>y</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>y_s</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z_s</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
                </span><span>|&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"y"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>y_T</span></span><span>
                </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"z"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>z_T</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>fp_rel_thm</span></span><span>
              </span><span>|&gt;</span><span> </span><span>infer_instantiate'</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>live</span></span><span> </span><span>NONE</span><span> </span><span>@</span><span>
                </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctorA</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctorB</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>dtor_ctor</span></span><span class="main"><span>]</span></span><span>
              </span><span>|&gt;</span><span> </span><span>Drule.generalize</span><span> </span><span class="main"><span>(</span></span><span>Names.empty</span><span class="main"><span>,</span></span><span> </span><span>Names.make2_set</span><span> </span><span class="entity"><span>y_s</span></span><span> </span><span class="entity"><span>z_s</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_inject_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>ctrA</span></span><span> </span><span class="entity"><span>ctrB</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>relAsBs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctrA</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctrB</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>conjuncts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>build_rel_app</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>conjuncts</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>lhs</span></span><span>
                   </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lhs</span></span><span class="main"><span>,</span></span><span> </span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="entity"><span>conjuncts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>ctrAs</span></span><span> </span><span class="entity"><span>ctrBs</span></span><span> </span><span class="entity"><span>xss</span></span><span> </span><span class="entity"><span>yss</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_conjunction_balanced</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="entity"><span>mk_rel_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>abs_inverses</span></span><span> </span><span class="entity"><span>pre_rel_def</span></span><span> </span><span class="entity"><span>rel_ctor_thm</span></span><span> </span><span class="entity"><span>live_nesting_rel_eqs</span></span><span> </span><span class="entity"><span>ctr_defs'</span></span><span>
                </span><span class="entity"><span>extra_unfolds_rel</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
            </span><span>|&gt;</span><span> </span><span>Conjunction.elim_balanced</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>half_rel_distinct_thmss</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ctrA</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctrB</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_not</span></span><span>
                </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>relAsBs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctrA</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctrB</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_infos</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctrAs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>xss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctrBs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>yss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goalss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>mk_goal</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_half_pairss</span></span><span> </span><span class="entity"><span>rel_infos</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>goalss</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>unflat</span><span> </span><span class="entity"><span>goalss</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                 </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                   </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_conjunction_balanced</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>;</span></span><span>
                   </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                   </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                     </span><span class="entity"><span>mk_rel_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>abs_inverses</span></span><span> </span><span class="entity"><span>pre_rel_def</span></span><span> </span><span class="entity"><span>rel_ctor_thm</span></span><span> </span><span class="entity"><span>live_nesting_rel_eqs</span></span><span>
                       </span><span class="entity"><span>ctr_defs'</span></span><span> </span><span class="entity"><span>extra_unfolds_rel</span></span><span class="main"><span>)</span></span><span>
                   </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
                   </span><span>|&gt;</span><span> </span><span>Conjunction.elim_balanced</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>)</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_flip</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_flip_of_bnf</span></span><span> </span><span class="entity"><span>fp_bnf</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_other_half_rel_distinct_thm</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>flip_rels</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_flip</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.arg_cong|fact"><span>arg_cong</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../HOL.html#HOL.Not|const"><span>Not</span></a></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>iffD2</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>other_half_rel_distinct_thmss</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>mk_other_half_rel_distinct_thm</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>half_rel_distinct_thmss</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_distinct_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>join_halves</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>half_rel_distinct_thmss</span></span><span> </span><span class="entity"><span>other_half_rel_distinct_thmss</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel_intro_thm</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>uncurry_thm</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>iffD2</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>THM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_intro_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_rel_intro_thm</span></span><span> </span><span class="entity"><span>ms</span></span><span> </span><span class="entity"><span>rel_inject_thms</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_code_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.eq_False|fact"><span>eq_False</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel_distinct_thms</span></span><span> </span><span>@</span><span>
          </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.eq_True|fact"><span>eq_True</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel_inject_thms</span></span><span> </span><span class="entity"><span>ms</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctr_transfer_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_parametricity_goal</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctrAs</span></span><span> </span><span class="entity"><span>ctrBs</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_conjunction_balanced</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                 </span><span class="entity"><span>mk_ctr_transfer_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>rel_intro_thms</span></span><span> </span><span class="entity"><span>live_nesting_rel_eqs</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
            </span><span>|&gt;</span><span> </span><span>Conjunction.elim_balanced</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_cases_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_cases_attrss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prems</span></span><span> </span><span class="entity"><span>assms</span></span><span> </span><span class="entity"><span>elem</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>type_name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>bnf_of</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>type_name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                  </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span>apfst</span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.dest_setT</span></span><span> </span><span class="main"><span>(</span></span><span>range_type</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>set</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>new_var</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>elem</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
                        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>new_var</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"x"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>elem</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                      </span><span class="entity"><span>mk_prems</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>assms</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>elem</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span>
                      </span><span>|&gt;&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>new_var</span></span><span> </span><span>?</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_set</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sets_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>rpair</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>elem</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span>Logic.mk_implies</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>assms</span></span><span> </span><span class="entity"><span>thesis</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>split_list</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.dest_setT</span></span><span> </span><span class="main"><span>(</span></span><span>range_type</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>set</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>elem</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"e"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>premss</span></span><span> </span><span class="main"><span>=</span></span><span>
                  </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctr</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>args</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
                        </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"z"</span></span><span> </span><span class="main"><span>(</span></span><span>binder_types</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>ctr</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>;</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                      </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>zipper_map</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prev_args</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>arg</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>next_args</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>args_with_elem</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args_without_elem</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
                            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>arg</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                              </span><span class="main"><span>(</span></span><span class="entity"><span>prev_args</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>elem</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>next_args</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prev_args</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>next_args</span></span><span class="main"><span>)</span></span><span>
                            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                              </span><span>`</span><span>I</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prev_args</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>arg</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>next_args</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                          </span><span class="entity"><span>mk_prems</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ta</span></span><span class="main"><span>,</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctr</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args_with_elem</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
                            </span><span class="entity"><span>elem</span></span><span> </span><span class="entity"><span>arg</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span>
                          </span><span>|&gt;</span><span> </span><span>fst</span><span>
                          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>args_without_elem</span></span><span class="main"><span>)</span></span><span>
                        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctrAs</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>elem</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ta</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thesis</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span>
                  </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>premss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                    </span><span class="entity"><span>mk_set_cases_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ta</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="entity"><span>exhaust</span></span><span> </span><span class="entity"><span>set_thms</span></span><span class="main"><span>)</span></span><span>
                  </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
                  </span><span>|&gt;</span><span> </span><span>rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>;</span></span><span>

                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cases_set_attr</span></span><span> </span><span class="main"><span>=</span></span><span>
                  </span><span class="entity"><span>Attrib.internal</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Induct.cases_pred</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name_of_set</span></span><span> </span><span class="entity"><span>set</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctr_names</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>quasi_unambiguous_case_names</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span>
                  </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>uncurry</span><span> </span><span class="entity"><span>mk_names</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>map_prod</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>name_of_ctr</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>premss</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>ctrAs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span class="comment1"><span>(* TODO: @{attributes [elim?]} *)</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Attrib.consumes</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cases_set_attr</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Attrib.case_names</span></span><span> </span><span class="entity"><span>ctr_names</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>setAs</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_intros_thmssss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_intros_thms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_goals</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="entity"><span>setA</span></span><span> </span><span class="entity"><span>ctr_args</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>type_name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>innerTs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>bnf_of</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>type_name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                  </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span>apfst</span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.dest_setT</span></span><span> </span><span class="main"><span>(</span></span><span>range_type</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>set</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"y"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>;</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>assm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                      </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Logic.mk_implies</span><span> </span><span>o</span><span> </span><span>pair</span><span> </span><span class="entity"><span>assm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_goals</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="entity"><span>setA</span></span><span> </span><span class="entity"><span>ctr_args</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_set</span></span><span> </span><span class="entity"><span>innerTs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sets_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mk_Trueprop_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>setA</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ctr_args</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>goalssss</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.dest_setT</span></span><span> </span><span class="main"><span>(</span></span><span>range_type</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>set</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                  </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 2</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctr</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                      </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_goals</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctr</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="entity"><span>ctrAs</span></span><span> </span><span class="entity"><span>xss</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>setAs</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>goalssss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>`</span><span class="main"><span>(</span></span><span class="entity"><span>unflattt</span></span><span> </span><span class="entity"><span>goalssss</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                 </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                   </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_conjunction_balanced</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>;</span></span><span>
                   </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                   </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
                     </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_set_intros_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>set0_thms</span></span><span class="main"><span>)</span></span><span>
                   </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
                   </span><span>|&gt;</span><span> </span><span>Conjunction.elim_balanced</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>)</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_sel_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>discAs</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_conjunct</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>discA</span></span><span> </span><span class="entity"><span>selAs</span></span><span> </span><span class="entity"><span>discB</span></span><span> </span><span class="entity"><span>selBs</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>discA</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ta</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>discB</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>tb</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span>
              </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>selAs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                 </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                 </span><span class="main"><span>[</span></span><span>Library.foldr</span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span>
                    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>discA</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ta</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>discB</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>tb</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                     </span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>build_rel_app</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                       </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rapp</span></span><span> </span><span class="entity"><span>ta</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>selAs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rapp</span></span><span> </span><span class="entity"><span>tb</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>selBs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                </span><span class="main"><span>[</span></span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>build_rel_app</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>ta</span></span><span> </span><span class="entity"><span>tb</span></span><span class="main"><span>,</span></span><span>
                   </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_conjunct</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>discAs</span></span><span> </span><span class="entity"><span>selAss</span></span><span> </span><span class="entity"><span>discBs</span></span><span> </span><span class="entity"><span>selBss</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                     </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.True|const"><span>True</span></a><span>›</span></span></span><span>
                   </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>conjuncts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="entity"><span>conjuncts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
              </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="entity"><span>mk_rel_sel_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ta</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tb</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>exhaust</span></span><span>
                  </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>disc_thmss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>sel_thmss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel_inject_thms</span></span><span> </span><span class="entity"><span>distincts</span></span><span> </span><span class="entity"><span>rel_distinct_thms</span></span><span>
                  </span><span class="entity"><span>live_nesting_rel_eqs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>map</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>goals</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_case_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_case_attrs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>derive_rel_case</span></span><span> </span><span class="entity"><span>relAsBs</span></span><span> </span><span class="entity"><span>rel_inject_thms</span></span><span> </span><span class="entity"><span>rel_distinct_thms</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctr_names</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>quasi_unambiguous_case_names</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>name_of_ctr</span></span><span> </span><span class="entity"><span>ctrAs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Attrib.case_names</span></span><span> </span><span class="entity"><span>ctr_names</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Attrib.consumes</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>attributes</span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="../../../Tools/induct.ML.html#HOL.cases|attribute"><span class="operator"><span>cases</span></span></a><span> pred</span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>case_transfer_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>derive_case_transfer</span></span><span> </span><span class="entity"><span>rel_case_thm</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sel_transfer_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>selAss</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>shared_sels</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>foldl1</span><span> </span><span class="main"><span>(</span></span><span>uncurry</span><span> </span><span class="main"><span>(</span></span><span>inter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>~~</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>selAss</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>selBss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>uncurry</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_parametricity_goal</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>shared_sels</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_conjunction_balanced</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>;</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                  </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
                    </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                       </span><span class="entity"><span>mk_sel_transfer_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>sel_defs</span></span><span> </span><span class="entity"><span>case_transfer_thm</span></span><span class="main"><span>)</span></span><span>
                  </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
                  </span><span>|&gt;</span><span> </span><span>Conjunction.elim_balanced</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>disc_transfer_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_parametricity_goal</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>discAs</span></span><span> </span><span class="entity"><span>discBs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
              </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_conjunction_balanced</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_disc_transfer_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
                     </span><span class="main"><span>(</span></span><span>the_single</span><span> </span><span class="entity"><span>rel_sel_thms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>the_single</span><span> </span><span class="entity"><span>exhaust_discs</span></span><span class="main"><span>)</span></span><span>
                     </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>distinct_discsss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
                </span><span>|&gt;</span><span> </span><span>Conjunction.elim_balanced</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_disc_iff_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>discsB</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_disc_or_sel</span></span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>discs</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>discsA_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>disc1</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.betapply</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>disc1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ta</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>discAs</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>discA_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>discB</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>head_of</span><span> </span><span class="entity"><span>discA_t</span></span><span> </span><span>aconv</span><span> </span><span class="entity"><span>HOLogic.Not</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>is_refl_bool</span></span><span> </span><span class="entity"><span>discA_t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                </span><span>NONE</span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>betapply</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>discB</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ta</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>discA_t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map_filter</span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>discsA_t</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>discsB</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
              </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_conjunction_balanced</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                     </span><span class="entity"><span>mk_map_disc_iff_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ta</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>exhaust</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>disc_thmss</span></span><span class="main"><span>)</span></span><span>
                       </span><span class="entity"><span>map_thms</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
                </span><span>|&gt;</span><span> </span><span>Conjunction.elim_balanced</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_sel_thmss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_sel_thms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>discA</span></span><span> </span><span class="entity"><span>selA</span></span><span> </span><span class="entity"><span>selB</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.betapply</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>discA</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ta</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>selB</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ta</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lhsT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>lhs</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_rhsT</span></span><span> </span><span class="main"><span>=</span></span><span>
                  </span><span>map_atyps</span><span> </span><span class="main"><span>(</span></span><span>perhaps</span><span> </span><span class="main"><span>(</span></span><span>AList.lookup</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>swap</span><span> </span><span class="entity"><span>live_AsBs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lhsT</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>build_map</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
                  </span><span class="main"><span>(</span></span><span>the</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span>AList.lookup</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>live_AsBs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_rhsT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lhsT</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>map_rhs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                    </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Fun.html#Fun.id|const"><span>id</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>selA</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ta</span></span><span>
                  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>map_rhs</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>selA</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ta</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lhs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_refl_bool</span></span><span> </span><span class="entity"><span>prem</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>concl</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>prem</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goalss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_goal</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>discAs</span></span><span> </span><span class="entity"><span>selAss</span></span><span> </span><span class="entity"><span>selBss</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>goalss</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>`</span><span class="main"><span>(</span></span><span>unflat</span><span> </span><span class="entity"><span>goalss</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                 </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                   </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_conjunction_balanced</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>;</span></span><span>
                   </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                   </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
                     </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                        </span><span class="entity"><span>mk_map_sel_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ta</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>exhaust</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>disc_thmss</span></span><span class="main"><span>)</span></span><span>
                          </span><span class="entity"><span>map_thms</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>sel_thmss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>live_nesting_map_id0s</span></span><span class="main"><span>)</span></span><span>
                   </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
                   </span><span>|&gt;</span><span> </span><span>Conjunction.elim_balanced</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>)</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_sel_thmssss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_sel_thms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>setA</span></span><span> </span><span class="entity"><span>discA</span></span><span> </span><span class="entity"><span>selA</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.betapply</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>discA</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ta</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sel_rangeT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>range_type</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>selA</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.dest_setT</span></span><span> </span><span class="main"><span>(</span></span><span>range_type</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>setA</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

                </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>travese_nested_types</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                    </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>type_name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>innerTs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>bnf_of</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>type_name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                      </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>seq_assm</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
                          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.dest_setT</span></span><span> </span><span class="main"><span>(</span></span><span>range_type</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>set</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"x"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>;</span></span><span>
                            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>assm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                            </span><span class="entity"><span>travese_nested_types</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span>
                            </span><span>|&gt;&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Logic.mk_implies</span><span> </span><span>o</span><span> </span><span>pair</span><span> </span><span class="entity"><span>assm</span></span><span class="main"><span>)</span></span><span>
                          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
                      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                        </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>seq_assm</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_set</span></span><span> </span><span class="entity"><span>innerTs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sets_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
                        </span><span>|&gt;&gt;</span><span> </span><span>flat</span><span>
                      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>mk_Trueprop_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>setA</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ta</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>sel_rangeT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>mk_Trueprop_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>selA</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ta</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>setA</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ta</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>travese_nested_types</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>selA</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ta</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>exists_subtype_in</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>A</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>sel_rangeT</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_refl_bool</span></span><span> </span><span class="entity"><span>prem</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Logic.mk_implies</span><span> </span><span>o</span><span> </span><span>pair</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>prem</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>concls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                  </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>goalssss</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 2</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span>fold_map</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>set</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>discAs</span></span><span> </span><span class="entity"><span>selAss</span></span><span class="main"><span>)</span></span><span>
                </span><span class="entity"><span>setAs</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>goalssss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>`</span><span class="main"><span>(</span></span><span class="entity"><span>unflattt</span></span><span> </span><span class="entity"><span>goalssss</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                 </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                   </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_conjunction_balanced</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>;</span></span><span>
                   </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                   </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
                     </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                        </span><span class="entity"><span>mk_set_sel_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ta</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>exhaust</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>disc_thmss</span></span><span class="main"><span>)</span></span><span>
                          </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>sel_thmss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set0_thms</span></span><span class="main"><span>)</span></span><span>
                   </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
                   </span><span>|&gt;</span><span> </span><span>Conjunction.elim_balanced</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>)</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_injects</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_eq_onp_with_tops_of</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>Conv.fconv_rule</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.Trueprop_conv</span></span><span> </span><span class="main"><span>(</span></span><span>Conv.arg1_conv</span><span>
                </span><span class="main"><span>(</span></span><span>Conv.top_sweep_rewrs_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.eq_onp_top_eq_eq|fact"><span>eq_onp_top_eq_eq</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.eq_reflection|fact"><span>eq_reflection</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eq_onps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>rel_eq_onp_with_tops_of</span></span><span>
              </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>rel_eq_onp_of_bnf</span></span><span> </span><span class="entity"><span>fp_bnfs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fp_nesting_rel_eq_onps</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>live_nesting_rel_eq_onps</span></span><span> </span><span>@</span><span>
              </span><span class="entity"><span>fp_nested_rel_eq_onps</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span>Thm.ctyp_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>live_As</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>mk_eq_onp</span></span><span> </span><span class="entity"><span>Ps</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>get_rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.concl_of</span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>HOLogic.dest_Trueprop</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>HOLogic.dest_eq</span></span><span> </span><span>#&gt;</span><span> </span><span>snd</span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_eq_onp_conj</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>List.foldr</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Fixpoint_Base.html#BNF_Fixpoint_Base.eq_onp_live_step|fact"><span>eq_onp_live_step</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../HOL.html#HOL.True|const"><span>True</span></a></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>predify_rel_inject</span></span><span> </span><span class="entity"><span>rel_inject</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>conjuncts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>try</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>get_rhs</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>HOLogic.dest_conj</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel_inject</span></span><span> </span><span>|&gt;</span><span> </span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

                </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>postproc</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>conjuncts</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                    </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.eq_onp_same_args|fact"><span>eq_onp_same_args</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>iffD1</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                    </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.box_equals|fact"><span>box_equals</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.eq_onp_same_args|fact"><span>eq_onp_same_args</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                      </span><span class="entity"><span>pred_eq_onp_conj</span></span><span> </span><span class="entity"><span>conjuncts</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.simp_thms|fact"><span>simp_thms</span></a><span class="main"><span>(</span></span><span>21</span><span class="main"><span>)</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span class="entity"><span>rel_inject</span></span><span>
                </span><span>|&gt;</span><span> </span><span>Thm.instantiate'</span><span> </span><span class="entity"><span>cTs</span></span><span> </span><span class="entity"><span>cts</span></span><span>
                </span><span>|&gt;</span><span> </span><span>Conv.fconv_rule</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.Trueprop_conv</span></span><span> </span><span class="main"><span>(</span></span><span>Conv.arg_conv</span><span>
                  </span><span class="main"><span>(</span></span><span>Raw_Simplifier.rewrite</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span>false</span><span>
                     </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.eq_onp_top_eq_eq|fact"><span>eq_onp_top_eq_eq</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.eq_reflection|fact"><span>eq_reflection</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>eq_onps</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>postproc</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Fixpoint_Base.html#BNF_Fixpoint_Base.top_conj|fact"><span>top_conj</span></a><span class="antiquote"><span>}</span></span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>rel_inject_thms</span></span><span>
            </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.conj_assoc|fact"><span>conj_assoc</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>predify_rel_inject</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Proof_Context.export</span><span> </span><span class="entity"><span>names_lthy</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>anonymous_notes</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>rel_code_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nitpicksimp_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>attrs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Binding.empty</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>thms</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>notes</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Config.get</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>bnf_internals</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
             </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>set0N</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set0_thms</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
             </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span>
          </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>case_transferN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>case_transfer_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>ctr_transferN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctr_transfer_thms</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>disc_transferN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>disc_transfer_thms</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>sel_transferN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sel_transfer_thms</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>mapN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_thms</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nitpicksimp_attrs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>simp_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>map_disc_iffN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_disc_iff_thms</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="entity"><span>simp_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>map_selN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_sel_thms</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>pred_injectN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pred_injects</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="entity"><span>simp_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rel_casesN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rel_case_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="entity"><span>rel_case_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rel_distinctN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_distinct_thms</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="entity"><span>simp_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rel_injectN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_inject_thms</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="entity"><span>simp_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rel_introsN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_intro_thms</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rel_selN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_sel_thms</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>setN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_thms</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>case_fp</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="entity"><span>nitpicksimp_attrs</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>simp_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>set_casesN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_cases_thms</span></span><span class="main"><span>,</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>set_cases_attrss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>set_introsN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_intros_thms</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>set_selN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_sel_thms</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>massage_simple_notes</span></span><span> </span><span class="entity"><span>fp_b_name</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>noted</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
          </span><span>|&gt;</span><span> </span><span>uncurry</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Spec_Rules.add</span></span><span> </span><span>Binding.empty</span><span> </span><span class="entity"><span>Spec_Rules.equational</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span>`</span><span class="main"><span>(</span></span><span>single</span><span> </span><span>o</span><span> </span><span class="entity"><span>lhs_head_of</span></span><span> </span><span>o</span><span> </span><span>hd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>map_thms</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Least_FP</span></span><span> </span><span>?</span><span>
              </span><span>uncurry</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Spec_Rules.add</span></span><span> </span><span>Binding.empty</span><span> </span><span class="entity"><span>Spec_Rules.equational</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span>`</span><span class="main"><span>(</span></span><span>single</span><span> </span><span>o</span><span> </span><span class="entity"><span>lhs_head_of</span></span><span> </span><span>o</span><span> </span><span>hd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel_code_thms</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>uncurry</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Spec_Rules.add</span></span><span> </span><span>Binding.empty</span><span> </span><span class="entity"><span>Spec_Rules.equational</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span>`</span><span class="main"><span>(</span></span><span>single</span><span> </span><span>o</span><span> </span><span class="entity"><span>lhs_head_of</span></span><span> </span><span>o</span><span> </span><span>hd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set0_thms</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>plugins</span></span><span> </span><span class="entity"><span>code_plugin</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>Code.declare_default_eqns</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>rpair</span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_code_thms</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>map_thms</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>set_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Local_Theory.notes</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>anonymous_notes</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>notes</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>substitute_noted_thm</span></span><span> </span><span class="entity"><span>noted</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>map_thms</span></span><span class="main"><span>,</span></span><span>
          </span><span>map</span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>map_disc_iff_thms</span></span><span class="main"><span>,</span></span><span>
          </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>subst</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>map_sel_thmss</span></span><span class="main"><span>,</span></span><span>
          </span><span>map</span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>rel_inject_thms</span></span><span class="main"><span>,</span></span><span>
          </span><span>map</span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>rel_distinct_thms</span></span><span class="main"><span>,</span></span><span>
          </span><span>map</span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>rel_sel_thms</span></span><span class="main"><span>,</span></span><span>
          </span><span>map</span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>rel_intro_thms</span></span><span class="main"><span>,</span></span><span>
          </span><span class="main"><span>[</span></span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>rel_case_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
          </span><span>map</span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>pred_injects</span></span><span class="main"><span>,</span></span><span>
          </span><span>map</span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>set_thms</span></span><span class="main"><span>,</span></span><span>
          </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>subst</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_sel_thmssss</span></span><span class="main"><span>,</span></span><span>
          </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>subst</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_intros_thmssss</span></span><span class="main"><span>,</span></span><span>
          </span><span>map</span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>set_cases_thms</span></span><span class="main"><span>,</span></span><span>
          </span><span>map</span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>ctr_transfer_thms</span></span><span class="main"><span>,</span></span><span>
          </span><span class="main"><span>[</span></span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>case_transfer_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
          </span><span>map</span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>disc_transfer_thms</span></span><span class="main"><span>,</span></span><span>
          </span><span>map</span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="entity"><span>sel_transfer_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy'</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>lfp_sugar_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>thm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> * </span><span>Token.src</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> * </span><span class="main"><span>(</span></span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>Token.src</span><span> </span><span>list</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>morph_lfp_sugar_thms</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>inducts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>induct</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>induct_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>recss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rec_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>inducts</span></span><span class="main"><span>,</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>induct</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>induct_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
   </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>recss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rec_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>lfp_sugar_thms</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>transfer_lfp_sugar_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>morph_lfp_sugar_thms</span></span><span> </span><span>o</span><span> </span><span>Morphism.transfer_morphism</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>gfp_sugar_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>thm</span><span> </span><span>list</span><span> * </span><span>thm</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> * </span><span class="main"><span>(</span></span><span>Token.src</span><span> </span><span>list</span><span> * </span><span>Token.src</span><span> </span><span>list</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  * </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span>
  * </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span>
  * </span><span class="main"><span>(</span></span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>Token.src</span><span> </span><span>list</span><span class="main"><span>)</span></span><span>
  * </span><span class="main"><span>(</span></span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span> * </span><span>Token.src</span><span> </span><span>list</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>morph_gfp_sugar_thms</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>coinducts_pairs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>coinduct_attrs_pair</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
    </span><span class="entity"><span>corecss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>corec_discss</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>corec_disc_iffss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>corec_disc_iff_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>corec_selsss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>corec_sel_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>coinducts_pairs</span></span><span class="main"><span>,</span></span><span>
    </span><span class="entity"><span>coinduct_attrs_pair</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
   </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>corecss</span></span><span class="main"><span>,</span></span><span>
   </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>corec_discss</span></span><span class="main"><span>,</span></span><span>
   </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>corec_disc_iffss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>corec_disc_iff_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
   </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>corec_selsss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>corec_sel_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>gfp_sugar_thms</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>transfer_gfp_sugar_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>morph_gfp_sugar_thms</span></span><span> </span><span>o</span><span> </span><span>Morphism.transfer_morphism</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>unzip_recT</span></span><span> </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.prod|type"><span>prod</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>TFree</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.prod|type"><span>prod</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>TFree</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>Ts</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>unzip_recT</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Product_Type.html#Product_Type.prod|type"><span>prod</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>TFree</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Ts</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>unzip_recT</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_recs_args_types</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctr_Tsss</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>absTs</span></span><span> </span><span class="entity"><span>repTs</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>mss</span></span><span> </span><span class="entity"><span>ctor_rec_fun_Ts</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Css</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>Cs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>x_Tssss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>absT</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>repT</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ms</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctr_Tss</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctor_rec_fun_T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>unzip_recT</span></span><span class="main"><span>)</span></span><span>
            </span><span class="entity"><span>ctr_Tss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dest_absumprodT</span></span><span> </span><span class="entity"><span>absT</span></span><span> </span><span class="entity"><span>repT</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>ms</span></span><span> </span><span class="main"><span>(</span></span><span>domain_type</span><span> </span><span class="entity"><span>ctor_rec_fun_T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="entity"><span>absTs</span></span><span> </span><span class="entity"><span>repTs</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>mss</span></span><span> </span><span class="entity"><span>ctr_Tsss</span></span><span> </span><span class="entity"><span>ctor_rec_fun_Ts</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>x_Tsss'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>flat_rec_arg_args</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x_Tssss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>f_Tss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>---&gt;</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x_Tsss'</span></span><span> </span><span class="entity"><span>Css</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>fss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xssss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Freess</span></span><span> </span><span class="inner_quoted"><span>"f"</span></span><span> </span><span class="entity"><span>f_Tss</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Freessss</span></span><span> </span><span class="inner_quoted"><span>"x"</span></span><span> </span><span class="entity"><span>x_Tssss</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>f_Tss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_Tssss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xssss</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>unzip_corecT</span></span><span> </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Sum_Type.html#Sum_Type.sum|type"><span>sum</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>unzip_corecT</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">type_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../Sum_Type.html#Sum_Type.sum|type"><span>sum</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Ts</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>unzip_corecT</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="comment1"><span>(*avoid "'a itself" arguments in corecursors*)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>repair_nullary_single_ctr</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.unitT</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>repair_nullary_single_ctr</span></span><span> </span><span class="entity"><span>Tss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Tss</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_corec_fun_arg_types0</span></span><span> </span><span class="entity"><span>ctr_Tsss</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>absTs</span></span><span> </span><span class="entity"><span>repTs</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>mss</span></span><span> </span><span class="entity"><span>fun_Ts</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctr_Tsss'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>repair_nullary_single_ctr</span></span><span> </span><span class="entity"><span>ctr_Tsss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>g_absTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>range_type</span><span> </span><span class="entity"><span>fun_Ts</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>g_Tsss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>map</span><span> </span><span class="entity"><span>repair_nullary_single_ctr</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>dest_absumprodT</span></span><span> </span><span class="entity"><span>absTs</span></span><span> </span><span class="entity"><span>repTs</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>mss</span></span><span> </span><span class="entity"><span>g_absTs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>g_Tssss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>C</span></span><span class="main"><span>)</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>unzip_corecT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>ctr_Tsss'</span></span><span> </span><span class="entity"><span>g_Tsss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>q_Tssss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mk_pred1T</span></span><span> </span><span class="main"><span>(</span></span><span>domain_type</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>g_Tssss</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>q_Tssss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>g_Tsss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>g_Tssss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>g_absTs</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_corec_p_pred_types</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span>Int.max</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_pred1T</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>Cs</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_corec_fun_arg_types</span></span><span> </span><span class="entity"><span>ctr_Tsss</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>absTs</span></span><span> </span><span class="entity"><span>repTs</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>mss</span></span><span> </span><span class="entity"><span>dtor_corec</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>mk_corec_p_pred_types</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>ns</span></span><span class="main"><span>,</span></span><span>
   </span><span class="entity"><span>mk_corec_fun_arg_types0</span></span><span> </span><span class="entity"><span>ctr_Tsss</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>absTs</span></span><span> </span><span class="entity"><span>repTs</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>mss</span></span><span>
     </span><span class="main"><span>(</span></span><span class="entity"><span>binder_fun_types</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>dtor_corec</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_corecs_args_types</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctr_Tsss</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>absTs</span></span><span> </span><span class="entity"><span>repTs</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>mss</span></span><span> </span><span class="entity"><span>dtor_corec_fun_Ts</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>p_Tss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_corec_p_pred_types</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>ns</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>q_Tssss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>g_Tsss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>g_Tssss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>corec_types</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>mk_corec_fun_arg_types0</span></span><span> </span><span class="entity"><span>ctr_Tsss</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>absTs</span></span><span> </span><span class="entity"><span>repTs</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>mss</span></span><span> </span><span class="entity"><span>dtor_corec_fun_Ts</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>qssss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gssss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span>|&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"x"</span></span><span class="main"><span>)</span></span><span> </span><span>dummyT</span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"a"</span></span><span> </span><span class="entity"><span>Cs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Freess</span></span><span> </span><span class="inner_quoted"><span>"p"</span></span><span> </span><span class="entity"><span>p_Tss</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Freessss</span></span><span> </span><span class="inner_quoted"><span>"q"</span></span><span> </span><span class="entity"><span>q_Tssss</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Freessss</span></span><span> </span><span class="inner_quoted"><span>"g"</span></span><span> </span><span class="entity"><span>g_Tssss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cpss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>o</span><span> </span><span class="entity"><span>rapp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cs</span></span><span> </span><span class="entity"><span>pss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>build_sum_inj</span></span><span> </span><span class="entity"><span>mk_inj</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>build_map</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>uncurry</span><span> </span><span class="entity"><span>mk_inj</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>dest_sumT</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>build_dtor_corec_arg</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>cg</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>cg</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>build_dtor_corec_arg</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>cq</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>cg</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cg'</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>mk_If</span></span><span> </span><span class="entity"><span>cq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>build_sum_inj</span></span><span> </span><span class="entity"><span>Inl_const</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>cg</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>cg</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>build_sum_inj</span></span><span> </span><span class="entity"><span>Inr_const</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>cg'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>cg'</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pgss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>flat_corec_preds_predsss_gettersss</span></span><span> </span><span class="entity"><span>pss</span></span><span> </span><span class="entity"><span>qssss</span></span><span> </span><span class="entity"><span>gssss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cqssss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span>o</span><span> </span><span class="entity"><span>rapp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cs</span></span><span> </span><span class="entity"><span>qssss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cgssss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span>o</span><span> </span><span class="entity"><span>rapp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cs</span></span><span> </span><span class="entity"><span>gssss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cqgsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>build_dtor_corec_arg</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>g_Tsss</span></span><span> </span><span class="entity"><span>cqssss</span></span><span> </span><span class="entity"><span>cgssss</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cpss</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>pgss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>qssss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gssss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cqgsss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>corec_types</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_co_recs_prelims</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="entity"><span>ctr_Tsss</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>absTs</span></span><span> </span><span class="entity"><span>repTs</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>mss</span></span><span> </span><span class="entity"><span>xtor_co_recs0</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xtor_co_rec_fun_Ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xtor_co_recs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>mk_xtor_co_recs</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>xtor_co_recs0</span></span><span> </span><span>|&gt;</span><span> </span><span>`</span><span class="main"><span>(</span></span><span class="entity"><span>binder_fun_types</span></span><span> </span><span>o</span><span> </span><span>fastype_of</span><span> </span><span>o</span><span> </span><span>hd</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>recs_args_types</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>corecs_args_types</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Least_FP</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="entity"><span>mk_recs_args_types</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctr_Tsss</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>absTs</span></span><span> </span><span class="entity"><span>repTs</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>mss</span></span><span> </span><span class="entity"><span>xtor_co_rec_fun_Ts</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>rpair</span><span> </span><span>NONE</span><span> </span><span>o</span><span> </span><span>SOME</span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="entity"><span>mk_corecs_args_types</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctr_Tsss</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>absTs</span></span><span> </span><span class="entity"><span>repTs</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>mss</span></span><span> </span><span class="entity"><span>xtor_co_rec_fun_Ts</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>pair</span><span> </span><span>NONE</span><span> </span><span>o</span><span> </span><span>SOME</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>xtor_co_recs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>recs_args_types</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>corecs_args_types</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_preds_getterss_join</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="entity"><span>cps</span></span><span> </span><span class="entity"><span>absT</span></span><span> </span><span class="entity"><span>abs</span></span><span> </span><span class="entity"><span>cqgss</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>cqgss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_absumprod</span></span><span> </span><span class="entity"><span>absT</span></span><span> </span><span class="entity"><span>abs</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cqgss</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>Term.lambda</span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_IfN</span></span><span> </span><span class="entity"><span>absT</span></span><span> </span><span class="entity"><span>cps</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>define_co_rec_as</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>fpT</span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="entity"><span>lthy0</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>lthy0</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>cst</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>def</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lthy'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy0</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>Local_Theory.begin_nested</span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Local_Theory.define</span><span>
          </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span>NoSyn</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Thm.make_def_binding</span><span> </span><span class="main"><span>(</span></span><span>Config.get</span><span> </span><span class="entity"><span>lthy0</span></span><span> </span><span class="entity"><span>bnf_internals</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>lthy'</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cst'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_co_rec</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>fpT</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>cst</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>def'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>def</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>cst'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>def'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy'</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>define_rec</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xssss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mk_binding</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>reps</span></span><span> </span><span class="entity"><span>ctor_rec</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>fpTs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctor_rec_absTs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fpT</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>strip_typeN</span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>ctor_rec</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;&gt;</span><span> </span><span>map</span><span> </span><span>domain_type</span><span> </span><span>||&gt;</span><span> </span><span>domain_type</span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>define_co_rec_as</span></span><span> </span><span class="entity"><span>Least_FP</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>fpT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_binding</span></span><span> </span><span class="entity"><span>recN</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span>Term.lambda</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fss</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctor_rec</span></span><span class="main"><span>,</span></span><span>
         </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctor_rec_absT</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>xsss</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
             </span><span class="entity"><span>mk_case_absumprod</span></span><span> </span><span class="entity"><span>ctor_rec_absT</span></span><span> </span><span class="entity"><span>rep</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_tuple</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xsss</span></span><span class="main"><span>)</span></span><span>
               </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>flat_rec_arg_args</span></span><span> </span><span class="entity"><span>xsss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
           </span><span class="entity"><span>ctor_rec_absTs</span></span><span> </span><span class="entity"><span>reps</span></span><span> </span><span class="entity"><span>fss</span></span><span> </span><span class="entity"><span>xssss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>define_corec</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cpss</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>pgss</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cqgsss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f_absTs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mk_binding</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>abss</span></span><span>
    </span><span class="entity"><span>dtor_corec</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>fpTs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fpT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>range_type</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>strip_typeN</span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>dtor_corec</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>define_co_rec_as</span></span><span> </span><span class="entity"><span>Greatest_FP</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>fpT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_binding</span></span><span> </span><span class="entity"><span>corecN</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span>Term.lambda</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pgss</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dtor_corec</span></span><span class="main"><span>,</span></span><span>
         </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_preds_getterss_join</span></span><span> </span><span class="entity"><span>cs</span></span><span> </span><span class="entity"><span>cpss</span></span><span> </span><span class="entity"><span>f_absTs</span></span><span> </span><span class="entity"><span>abss</span></span><span> </span><span class="entity"><span>cqgsss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_induct_raw_prem_prems</span></span><span> </span><span class="entity"><span>names_ctxt</span></span><span> </span><span class="entity"><span>Xss</span></span><span> </span><span class="entity"><span>setss_fp_nesting</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T_name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Xs_Ts0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>AList.lookup</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>setss_fp_nesting</span></span><span> </span><span class="entity"><span>T_name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>raw_sets0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Xs_Ts</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>raw_sets</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>exists_subtype_in</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>Xss</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Xs_Ts0</span></span><span> </span><span>~~</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ts0</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>raw_sets0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>split_list</span><span> </span><span>||&gt;</span><span> </span><span>split_list</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_set</span></span><span> </span><span class="entity"><span>Ts0</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>raw_sets</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ys</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names_ctxt'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>names_ctxt</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>xysets</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>pair</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ys</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ppremss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_induct_raw_prem_prems</span></span><span> </span><span class="entity"><span>names_ctxt'</span></span><span> </span><span class="entity"><span>Xss</span></span><span> </span><span class="entity"><span>setss_fp_nesting</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>Xs_Ts</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>o</span><span> </span><span>apfst</span><span> </span><span>o</span><span> </span><span>cons</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xysets</span></span><span> </span><span class="entity"><span>ppremss</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_induct_raw_prem_prems</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>Xss</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>Type</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span>find_index</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Xs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Xs</span></span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Xss</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_induct_raw_prem_prems</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_induct_raw_prem</span></span><span> </span><span class="entity"><span>alter_x</span></span><span> </span><span class="entity"><span>names_ctxt</span></span><span> </span><span class="entity"><span>Xss</span></span><span> </span><span class="entity"><span>setss_fp_nesting</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="entity"><span>ctr</span></span><span> </span><span class="entity"><span>ctr_Ts</span></span><span> </span><span class="entity"><span>ctrXs_Ts</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names_ctxt'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>names_ctxt</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"x"</span></span><span> </span><span class="entity"><span>ctr_Ts</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pprems</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_induct_raw_prem_prems</span></span><span> </span><span class="entity"><span>names_ctxt'</span></span><span> </span><span class="entity"><span>Xss</span></span><span> </span><span class="entity"><span>setss_fp_nesting</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>ctrXs_Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctr</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>alter_x</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>p'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>enforce_type</span></span><span> </span><span class="entity"><span>names_ctxt</span></span><span> </span><span>domain_type</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pprems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>close_induct_prem_prem</span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span>drop</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nn</span></span><span> </span><span>+</span><span> </span><span>length</span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>(</span></span><span>rev</span><span> </span><span class="main"><span>(</span></span><span>Term.add_frees</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>dest_Free</span><span> </span><span class="entity"><span>xs</span></span><span> </span><span>@</span><span> </span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span>try</span><span> </span><span>dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ps</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>finish_induct_prem_prem</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xysets</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>p'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>enforce_type</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>domain_type</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>close_induct_prem_prem</span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="entity"><span>mk_Trueprop_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xysets</span></span><span class="main"><span>,</span></span><span>
      </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>finish_induct_prem</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>raw_pprems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span>
    </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>finish_induct_prem_prem</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>raw_pprems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_coinduct_prem_ctr_concls</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Xss</span></span><span> </span><span class="entity"><span>fpTss</span></span><span> </span><span class="entity"><span>rs'</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>udisc</span></span><span> </span><span class="entity"><span>usels</span></span><span> </span><span class="entity"><span>vdisc</span></span><span> </span><span class="entity"><span>vsels</span></span><span> </span><span class="entity"><span>ctrXs_Ts</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>build_the_rel</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>Xs_T</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>build_rel</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span>nth</span><span> </span><span class="entity"><span>rs'</span></span><span> </span><span class="main"><span>(</span></span><span>find_index</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Xs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Xs</span></span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Xss</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>enforce_type</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>domain_type</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Xs_T</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Term.subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>Xss</span></span><span> </span><span>~~</span><span> </span><span>flat</span><span> </span><span class="entity"><span>fpTss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>build_rel_app</span></span><span> </span><span class="entity"><span>usel</span></span><span> </span><span class="entity"><span>vsel</span></span><span> </span><span class="entity"><span>Xs_T</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>fold</span><span> </span><span class="entity"><span>rapp</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>usel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vsel</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>build_the_rel</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>usel</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Xs_T</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>udisc</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vdisc</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>usels</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
       </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
       </span><span class="main"><span>[</span></span><span>Library.foldr</span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>udisc</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vdisc</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
          </span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>build_rel_app</span></span><span> </span><span class="entity"><span>usels</span></span><span> </span><span class="entity"><span>vsels</span></span><span> </span><span class="entity"><span>ctrXs_Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_coinduct_prem_concl</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Xss</span></span><span> </span><span class="entity"><span>fpTss</span></span><span> </span><span class="entity"><span>rs'</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>udiscs</span></span><span> </span><span class="entity"><span>uselss</span></span><span> </span><span class="entity"><span>vdiscs</span></span><span> </span><span class="entity"><span>vselss</span></span><span> </span><span class="entity"><span>ctrXs_Tss</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_coinduct_prem_ctr_concls</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Xss</span></span><span> </span><span class="entity"><span>fpTss</span></span><span> </span><span class="entity"><span>rs'</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>udiscs</span></span><span> </span><span class="entity"><span>uselss</span></span><span> </span><span class="entity"><span>vdiscs</span></span><span> </span><span class="entity"><span>vselss</span></span><span> </span><span class="entity"><span>ctrXs_Tss</span></span><span>
  </span><span>|&gt;</span><span> </span><span>flat</span><span> </span><span>|&gt;</span><span> </span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span>
  </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>List.Empty</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.True|const"><span>True</span></a><span>›</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_coinduct_prem</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Xss</span></span><span> </span><span class="entity"><span>fpTss</span></span><span> </span><span class="entity"><span>rs'</span></span><span> </span><span class="entity"><span>uvr</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>udiscs</span></span><span> </span><span class="entity"><span>uselss</span></span><span> </span><span class="entity"><span>vdiscs</span></span><span> </span><span class="entity"><span>vselss</span></span><span> </span><span class="entity"><span>ctrXs_Tss</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>u</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>uvr</span></span><span class="main"><span>,</span></span><span>
    </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_coinduct_prem_concl</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Xss</span></span><span> </span><span class="entity"><span>fpTss</span></span><span> </span><span class="entity"><span>rs'</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>udiscs</span></span><span> </span><span class="entity"><span>uselss</span></span><span> </span><span class="entity"><span>vdiscs</span></span><span> </span><span class="entity"><span>vselss</span></span><span>
      </span><span class="entity"><span>ctrXs_Tss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>postproc_co_induct</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="entity"><span>prop</span></span><span> </span><span class="entity"><span>prop_conj</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Drule.zero_var_indexes</span><span>
  </span><span>#&gt;</span><span> </span><span>`</span><span class="main"><span>(</span></span><span class="entity"><span>conj_dests</span></span><span> </span><span class="entity"><span>nn</span></span><span class="main"><span>)</span></span><span>
  </span><span>#&gt;&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Thm.permute_prems</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>prop</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span>##&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Thm.permute_prems</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>(</span></span><span>~</span><span> </span><span class="entity"><span>nn</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>prop</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>funpow</span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.conj_assoc|fact"><span>conj_assoc</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>prop_conj</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_induct_attrs</span></span><span> </span><span class="entity"><span>ctrss</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>induct_cases</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>quasi_unambiguous_case_names</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>name_of_ctr</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctrss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Attrib.case_names</span></span><span> </span><span class="entity"><span>induct_cases</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>derive_rel_induct_thms_for_types</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="entity"><span>fpA_Ts</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ctrAss</span></span><span> </span><span class="entity"><span>ctrAs_Tsss</span></span><span> </span><span class="entity"><span>exhausts</span></span><span> </span><span class="entity"><span>ctor_rel_induct</span></span><span>
    </span><span class="entity"><span>ctor_defss</span></span><span> </span><span class="entity"><span>ctor_injects</span></span><span> </span><span class="entity"><span>pre_rel_defs</span></span><span> </span><span class="entity"><span>abs_inverses</span></span><span> </span><span class="entity"><span>live_nesting_rel_eqs</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>B_ify_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.typ_subst_atomic</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>As</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>B_ify</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.map_types</span><span> </span><span class="entity"><span>B_ify_T</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fpB_Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>B_ify_T</span></span><span> </span><span class="entity"><span>fpA_Ts</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctrBs_Tsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>B_ify_T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctrAs_Tsss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctrBss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>B_ify</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctrAss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>Rs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>IRs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctrAsss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctrBsss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names_ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"R"</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"IR"</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>fpA_Ts</span></span><span> </span><span class="entity"><span>fpB_Ts</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Freesss</span></span><span> </span><span class="inner_quoted"><span>"a"</span></span><span> </span><span class="entity"><span>ctrAs_Tsss</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Freesss</span></span><span> </span><span class="inner_quoted"><span>"b"</span></span><span> </span><span class="entity"><span>ctrBs_Tsss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prem</span></span><span> </span><span class="entity"><span>ctrA</span></span><span> </span><span class="entity"><span>ctrB</span></span><span> </span><span class="entity"><span>argAs</span></span><span> </span><span class="entity"><span>argBs</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>argAs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>argBs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span>Logic.mk_implies</span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>build_rel_app</span></span><span> </span><span class="entity"><span>names_ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>IRs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fpA_Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>argAs</span></span><span> </span><span class="entity"><span>argBs</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>build_rel_app</span></span><span> </span><span class="entity"><span>names_ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>IRs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fpA_Ts</span></span><span>
              </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctrA</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>argAs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctrB</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>argBs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_prem</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctrAss</span></span><span> </span><span class="entity"><span>ctrBss</span></span><span> </span><span class="entity"><span>ctrAsss</span></span><span> </span><span class="entity"><span>ctrBsss</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_leq</span></span><span>
      </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>build_the_rel</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>IRs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fpA_Ts</span></span><span> </span><span class="entity"><span>fpB_Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>IRs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_induct0_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="entity"><span>mk_rel_induct0_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctor_rel_induct</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>IRs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>exhausts</span></span><span>
          </span><span class="entity"><span>ctor_defss</span></span><span> </span><span class="entity"><span>ctor_injects</span></span><span> </span><span class="entity"><span>pre_rel_defs</span></span><span> </span><span class="entity"><span>abs_inverses</span></span><span> </span><span class="entity"><span>live_nesting_rel_eqs</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>postproc_co_induct</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.predicate2D|fact"><span>predicate2D</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Fixpoint_Base.html#BNF_Fixpoint_Base.predicate2D_conj|fact"><span>predicate2D_conj</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>rel_induct0_thm</span></span><span class="main"><span>,</span></span><span>
     </span><span class="entity"><span>mk_induct_attrs</span></span><span> </span><span class="entity"><span>ctrAss</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>derive_induct_recs_thms_for_types</span></span><span> </span><span class="entity"><span>plugins</span></span><span> </span><span class="entity"><span>pre_bnfs</span></span><span> </span><span class="entity"><span>rec_args_typess</span></span><span> </span><span class="entity"><span>ctor_induct</span></span><span> </span><span class="entity"><span>ctor_rec_thms</span></span><span>
    </span><span class="entity"><span>live_nesting_bnfs</span></span><span> </span><span class="entity"><span>fp_nesting_bnfs</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>Xs</span></span><span> </span><span class="entity"><span>ctrXs_Tsss</span></span><span> </span><span class="entity"><span>pre_abs_inverses</span></span><span> </span><span class="entity"><span>pre_type_definitions</span></span><span>
    </span><span class="entity"><span>abs_inverses</span></span><span> </span><span class="entity"><span>ctrss</span></span><span> </span><span class="entity"><span>ctr_defss</span></span><span> </span><span class="entity"><span>recs</span></span><span> </span><span class="entity"><span>rec_defs</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctr_Tsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>binder_types</span><span> </span><span>o</span><span> </span><span>fastype_of</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctrss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>pre_bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>length</span><span> </span><span class="entity"><span>ctr_Tsss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>length</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctr_Tsss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pre_map_defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>map_def_of_bnf</span></span><span> </span><span class="entity"><span>pre_bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pre_set_defss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>set_defs_of_bnf</span></span><span> </span><span class="entity"><span>pre_bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live_nesting_map_ident0s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>map_ident0_of_bnf</span></span><span> </span><span class="entity"><span>live_nesting_bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fp_nesting_map_ident0s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>map_ident0_of_bnf</span></span><span> </span><span class="entity"><span>fp_nesting_bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fp_nesting_set_maps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>maps</span><span> </span><span class="entity"><span>set_map_of_bnf</span></span><span> </span><span class="entity"><span>fp_nesting_bnfs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fp_b_names</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>base_name_of_typ</span></span><span> </span><span class="entity"><span>fpTs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xsss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>us'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names_ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"P"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>mk_pred1T</span></span><span> </span><span class="entity"><span>fpTs</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Freesss</span></span><span> </span><span class="inner_quoted"><span>"x"</span></span><span> </span><span class="entity"><span>ctr_Tsss</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>Variable.variant_fixes</span><span> </span><span class="entity"><span>fp_b_names</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>us</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span>Free</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>us'</span></span><span> </span><span class="entity"><span>fpTs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>setss_fp_nesting</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_bnf_sets</span></span><span> </span><span class="entity"><span>fp_nesting_bnfs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>induct_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>induct_thm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>raw_premss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span>
            </span><span>o</span><span> </span><span class="entity"><span>mk_induct_raw_prem</span></span><span> </span><span>I</span><span> </span><span class="entity"><span>names_ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>single</span><span> </span><span class="entity"><span>Xs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>setss_fp_nesting</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>ctrss</span></span><span> </span><span class="entity"><span>ctr_Tsss</span></span><span> </span><span class="entity"><span>ctrXs_Tsss</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>$</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="entity"><span>us</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Library.foldr</span><span> </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span>o</span><span> </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>finish_induct_prem</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="entity"><span>ps</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>raw_premss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>kksss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>raw_premss</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctor_induct'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctor_induct</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_absumprodE</span></span><span> </span><span class="entity"><span>pre_type_definitions</span></span><span> </span><span class="entity"><span>mss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="entity"><span>mk_induct_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>mss</span></span><span> </span><span class="entity"><span>kksss</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>ctr_defss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctor_induct'</span></span><span> </span><span class="entity"><span>pre_abs_inverses</span></span><span>
              </span><span class="entity"><span>abs_inverses</span></span><span> </span><span class="entity"><span>fp_nesting_set_maps</span></span><span> </span><span class="entity"><span>pre_set_defss</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>`</span><span class="main"><span>(</span></span><span class="entity"><span>conj_dests</span></span><span> </span><span class="entity"><span>nn</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thm</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>xctrss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span>Term.list_comb</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctrss</span></span><span> </span><span class="entity"><span>xsss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rec_thmss</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_Tssss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fss</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>recs</span></span><span> </span><span class="entity"><span>rec_defs</span></span><span> </span><span class="entity"><span>ctor_rec_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>frecs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lists_bmoc</span></span><span> </span><span class="entity"><span>fss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>recs</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>frec</span></span><span> </span><span class="entity"><span>xctr</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>fxs</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span>Logic.all</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xs</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>fss</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>frec</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>xctr</span></span><span class="main"><span>,</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fxs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>maybe_tick</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>try</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span class="entity"><span>HOLogic.dest_prodT</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span>Term.lambda</span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_prod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>u</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span class="entity"><span>f</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>build_rec</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="entity"><span>x</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>build_simple</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="entity"><span>indexify</span></span><span> </span><span class="main"><span>(</span></span><span>perhaps</span><span> </span><span class="main"><span>(</span></span><span>try</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span class="entity"><span>HOLogic.dest_prodT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Cs</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>kk</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>TU</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>maybe_tick</span></span><span> </span><span class="entity"><span>TU</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>us</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>frecs</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>build_map</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>build_simple</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fxsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>flat_rec_arg_args</span></span><span> </span><span>oo</span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>o</span><span> </span><span class="entity"><span>build_rec</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xsss</span></span><span> </span><span class="entity"><span>x_Tssss</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goalss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_goal</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>frecs</span></span><span> </span><span class="entity"><span>xctrss</span></span><span> </span><span class="entity"><span>fss</span></span><span> </span><span class="entity"><span>xsss</span></span><span> </span><span class="entity"><span>fxsss</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tacss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>ooo</span><span>
              </span><span class="entity"><span>mk_rec_tac</span></span><span> </span><span class="entity"><span>pre_map_defs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fp_nesting_map_ident0s</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>live_nesting_map_ident0s</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rec_defs</span></span><span class="main"><span>)</span></span><span>
            </span><span class="entity"><span>ctor_rec_thms</span></span><span> </span><span class="entity"><span>pre_abs_inverses</span></span><span> </span><span class="entity"><span>abs_inverses</span></span><span> </span><span class="entity"><span>ctr_defss</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tac</span></span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>context</span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>prove</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goalss</span></span><span> </span><span class="entity"><span>tacss</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rec_thmss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rec_thmss</span></span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="entity"><span>rec_args_typess</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>recs</span></span><span> </span><span class="entity"><span>rec_defs</span></span><span> </span><span class="entity"><span>ctor_rec_thms</span></span><span class="main"><span>;</span></span><span>

  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>induct_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>induct_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_induct_attrs</span></span><span> </span><span class="entity"><span>ctrss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="entity"><span>rec_thmss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nitpicksimp_attrs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>simp_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_coinduct_attrs</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="entity"><span>ctrss</span></span><span> </span><span class="entity"><span>discss</span></span><span> </span><span class="entity"><span>mss</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fp_b_names</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>base_name_of_typ</span></span><span> </span><span class="entity"><span>fpTs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_coinduct_concls</span></span><span> </span><span class="entity"><span>ms</span></span><span> </span><span class="entity"><span>discs</span></span><span> </span><span class="entity"><span>ctrs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_disc_concl</span></span><span> </span><span class="entity"><span>disc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>name_of_disc</span></span><span> </span><span class="entity"><span>disc</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_ctr_concl</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_ctr_concl</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>ctr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>name_of_ctr</span></span><span> </span><span class="entity"><span>ctr</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>disc_concls</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_disc_concl</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>split_last</span><span> </span><span class="entity"><span>discs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctr_concls</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_ctr_concl</span></span><span> </span><span class="entity"><span>ms</span></span><span> </span><span class="entity"><span>ctrs</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span>append</span><span> </span><span class="entity"><span>disc_concls</span></span><span> </span><span class="entity"><span>ctr_concls</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coinduct_cases</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>quasi_unambiguous_case_names</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>prefix</span><span> </span><span class="entity"><span>Eq_prefix</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fp_b_names</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coinduct_conclss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>quasi_unambiguous_case_names</span></span><span> </span><span>ooo</span><span> </span><span class="entity"><span>mk_coinduct_concls</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mss</span></span><span> </span><span class="entity"><span>discss</span></span><span> </span><span class="entity"><span>ctrss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coinduct_case_names_attr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Attrib.case_names</span></span><span> </span><span class="entity"><span>coinduct_cases</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coinduct_case_concl_attrs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>casex</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>concls</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Attrib.case_conclusion</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>casex</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concls</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="entity"><span>coinduct_cases</span></span><span> </span><span class="entity"><span>coinduct_conclss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>common_coinduct_attrs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>coinduct_case_names_attr</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>coinduct_case_concl_attrs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coinduct_attrs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Attrib.consumes</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>coinduct_case_names_attr</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>coinduct_case_concl_attrs</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>coinduct_attrs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>common_coinduct_attrs</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>derive_rel_coinduct_thms_for_types</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="entity"><span>fpA_Ts</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>mss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctr_sugars</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ctr_sugar</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span>
    </span><span class="entity"><span>abs_inverses</span></span><span> </span><span class="entity"><span>abs_injects</span></span><span> </span><span class="entity"><span>ctor_injects</span></span><span> </span><span class="entity"><span>dtor_ctors</span></span><span> </span><span class="entity"><span>rel_pre_defs</span></span><span> </span><span class="entity"><span>ctor_defss</span></span><span> </span><span class="entity"><span>dtor_rel_coinduct</span></span><span>
    </span><span class="entity"><span>live_nesting_rel_eqs</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>B_ify_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.typ_subst_atomic</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>As</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fpB_Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>B_ify_T</span></span><span> </span><span class="entity"><span>fpA_Ts</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>IRs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fpAs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fpBs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fp_names</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>base_name_of_typ</span></span><span> </span><span class="entity"><span>fpA_Ts</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>Rs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>IRs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fpAs_names</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fpBs_names</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names_ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"R"</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>)</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"IR"</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>fpA_Ts</span></span><span> </span><span class="entity"><span>fpB_Ts</span></span><span class="main"><span>)</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span>Variable.variant_fixes</span><span> </span><span class="entity"><span>fp_names</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span>Variable.variant_fixes</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>suffix</span><span> </span><span class="inner_quoted"><span>"'"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fp_names</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>Rs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>IRs</span></span><span class="main"><span>,</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span>Free</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fpAs_names</span></span><span> </span><span class="entity"><span>fpA_Ts</span></span><span class="main"><span>,</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span>Free</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fpBs_names</span></span><span> </span><span class="entity"><span>fpB_Ts</span></span><span class="main"><span>,</span></span><span>
         </span><span class="entity"><span>names_ctxt</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>discA_tss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>selA_tsss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>discB_tss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>selB_tsss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>discss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>discs </span><span class="entity"><span>ctr_sugars</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>selsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>selss </span><span class="entity"><span>ctr_sugars</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_discss</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>o</span><span> </span><span class="entity"><span>rapp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_disc_or_sel</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>discss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_selsss</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span>o</span><span> </span><span class="entity"><span>rapp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_disc_or_sel</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>selsss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>mk_discss</span></span><span> </span><span class="entity"><span>fpAs</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_selsss</span></span><span> </span><span class="entity"><span>fpAs</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
         </span><span class="main"><span>(</span></span><span class="entity"><span>mk_discss</span></span><span> </span><span class="entity"><span>fpBs</span></span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_selsss</span></span><span> </span><span class="entity"><span>fpBs</span></span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prem_ctr_concls</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>discA_t</span></span><span> </span><span class="entity"><span>selA_ts</span></span><span> </span><span class="entity"><span>discB_t</span></span><span> </span><span class="entity"><span>selB_ts</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>discA_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>discB_t</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>selA_ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>selB_ts</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="main"><span>[</span></span><span>Library.foldr</span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>discA_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>discB_t</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
               </span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span>
                 </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>build_rel_app</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>IRs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fpA_Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>selA_ts</span></span><span> </span><span class="entity"><span>selB_ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prem_concl</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>discA_ts</span></span><span> </span><span class="entity"><span>selA_tss</span></span><span> </span><span class="entity"><span>discB_ts</span></span><span> </span><span class="entity"><span>selB_tss</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_prem_ctr_concls</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>discA_ts</span></span><span> </span><span class="entity"><span>selA_tss</span></span><span> </span><span class="entity"><span>discB_ts</span></span><span> </span><span class="entity"><span>selB_tss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>List.Empty</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.True|const"><span>True</span></a><span>›</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prem</span></span><span> </span><span class="entity"><span>IR</span></span><span> </span><span class="entity"><span>tA</span></span><span> </span><span class="entity"><span>tB</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>discA_ts</span></span><span> </span><span class="entity"><span>selA_tss</span></span><span> </span><span class="entity"><span>discB_ts</span></span><span> </span><span class="entity"><span>selB_tss</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>tA</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tB</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IR</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>tA</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>tB</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_prem_concl</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>discA_ts</span></span><span> </span><span class="entity"><span>selA_tss</span></span><span> </span><span class="entity"><span>discB_ts</span></span><span> </span><span class="entity"><span>selB_tss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 8</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_prem</span></span><span> </span><span class="entity"><span>IRs</span></span><span> </span><span class="entity"><span>fpAs</span></span><span> </span><span class="entity"><span>fpBs</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>discA_tss</span></span><span> </span><span class="entity"><span>selA_tsss</span></span><span> </span><span class="entity"><span>discB_tss</span></span><span> </span><span class="entity"><span>selB_tsss</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_leq</span></span><span>
      </span><span class="entity"><span>IRs</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>build_the_rel</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>IRs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fpA_Ts</span></span><span> </span><span class="entity"><span>fpB_Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_coinduct0_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="entity"><span>mk_rel_coinduct0_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>dtor_rel_coinduct</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>IRs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prems</span></span><span>
          </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>exhaust </span><span class="entity"><span>ctr_sugars</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>disc_thmss</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctr_sugars</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>sel_thmss</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctr_sugars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctor_defss</span></span><span> </span><span class="entity"><span>dtor_ctors</span></span><span> </span><span class="entity"><span>ctor_injects</span></span><span> </span><span class="entity"><span>abs_injects</span></span><span>
          </span><span class="entity"><span>rel_pre_defs</span></span><span> </span><span class="entity"><span>abs_inverses</span></span><span> </span><span class="entity"><span>live_nesting_rel_eqs</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>postproc_co_induct</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.predicate2D|fact"><span>predicate2D</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Fixpoint_Base.html#BNF_Fixpoint_Base.predicate2D_conj|fact"><span>predicate2D_conj</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>rel_coinduct0_thm</span></span><span class="main"><span>,</span></span><span>
     </span><span class="entity"><span>mk_coinduct_attrs</span></span><span> </span><span class="entity"><span>fpA_Ts</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>ctrs </span><span class="entity"><span>ctr_sugars</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>discs </span><span class="entity"><span>ctr_sugars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mss</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>derive_set_induct_thms_for_types</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="entity"><span>ctrss</span></span><span> </span><span class="entity"><span>setss</span></span><span> </span><span class="entity"><span>dtor_set_inducts</span></span><span> </span><span class="entity"><span>exhausts</span></span><span> </span><span class="entity"><span>set_pre_defs</span></span><span>
    </span><span class="entity"><span>ctor_defs</span></span><span> </span><span class="entity"><span>dtor_ctors</span></span><span> </span><span class="entity"><span>Abs_pre_inverses</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prems</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span class="entity"><span>ctr_args</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>type_name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>innerTs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>bnf_of</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>type_name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>seq_assm</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.dest_setT</span></span><span> </span><span class="main"><span>(</span></span><span>range_type</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>set</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"x"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>assm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>build_binary_fun_app</span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                  </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="entity"><span>mk_prems</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span class="entity"><span>ctr_args</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span>
                  </span><span>|&gt;&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Logic.all</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>o</span><span> </span><span>Logic.mk_implies</span><span> </span><span>o</span><span> </span><span>pair</span><span> </span><span class="entity"><span>assm</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span>Logic.all</span><span> </span><span class="entity"><span>x</span></span><span>
                      </span><span class="main"><span>(</span></span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>assm</span></span><span class="main"><span>,</span></span><span>
                         </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span>
                           </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>build_binary_fun_app</span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>ctr_args</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                   </span><span class="entity"><span>ctxt'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>seq_assm</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_set</span></span><span> </span><span class="entity"><span>innerTs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sets_of_bnf</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
            </span><span>|&gt;&gt;</span><span> </span><span>flat</span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>build_binary_fun_app</span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>ctr_args</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prems_for_ctr</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span class="entity"><span>ctr</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>args</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"z"</span></span><span> </span><span class="main"><span>(</span></span><span>binder_types</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>ctr</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_prems</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctr</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span>
        </span><span>|&gt;&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>flat</span><span>
        </span><span>|&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_names</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name_of_ctr</span></span><span> </span><span class="entity"><span>ctr</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prems_and_concl_for_type</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>fpT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fp</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
          </span><span>|&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"x"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>A</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"a"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fpT</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Ball</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>fp</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>build_binary_fun_app</span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>fp</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_prems_for_ctr</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="entity"><span>Ps</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctrs</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span>
        </span><span>|&gt;&gt;</span><span> </span><span>split_list</span><span>
        </span><span>|&gt;&gt;</span><span> </span><span class="entity"><span>map_prod</span></span><span> </span><span>flat</span><span> </span><span>flat</span><span>
        </span><span>|&gt;&gt;</span><span> </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>rpair</span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_thm</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="entity"><span>ctrss</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.dest_setT</span></span><span> </span><span class="main"><span>(</span></span><span>range_type</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"P"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fpT</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>fpT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fpTs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>case_names</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt''</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_prems_and_concl_for_type</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="entity"><span>Ps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fpTs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>ctrss</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span>
          </span><span>|&gt;&gt;</span><span> </span><span>apfst</span><span> </span><span>split_list</span><span> </span><span>o</span><span> </span><span>split_list</span><span>
          </span><span>|&gt;&gt;</span><span> </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span>flat</span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;&gt;</span><span> </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;&gt;</span><span> </span><span>apsnd</span><span> </span><span>flat</span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>concl</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
               </span><span class="entity"><span>mk_set_induct0_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt''</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ps</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="entity"><span>dtor_set_inducts</span></span><span>
                 </span><span class="entity"><span>exhausts</span></span><span> </span><span class="entity"><span>set_pre_defs</span></span><span> </span><span class="entity"><span>ctor_defs</span></span><span> </span><span class="entity"><span>dtor_ctors</span></span><span> </span><span class="entity"><span>Abs_pre_inverses</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>case_names_attr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Attrib.case_names</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>quasi_unambiguous_case_names</span></span><span> </span><span class="entity"><span>case_names</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>induct_set_attrs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Attrib.internal</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span> </span><span>o</span><span> </span><span>K</span><span> </span><span>o</span><span> </span><span class="entity"><span>Induct.induct_pred</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>name_of_set</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>case_names_attr</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>induct_set_attrs</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>consumes_attr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Attrib.consumes</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_thm</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="entity"><span>ctrss</span></span><span>
        </span><span>#&gt;</span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>map_prod</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>bspec</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>cons</span><span> </span><span class="entity"><span>consumes_attr</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>setss</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_coinduct_strong_thm</span></span><span> </span><span class="entity"><span>coind</span></span><span> </span><span class="entity"><span>rel_eqs</span></span><span> </span><span class="entity"><span>rel_monos</span></span><span> </span><span class="entity"><span>mk_vimage2p</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.nprems_of</span><span> </span><span class="entity"><span>coind</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.nprems_of</span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>rel_monos</span></span><span class="main"><span>)</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_inst</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_union</span></span><span> </span><span class="main"><span>(</span></span><span>Var</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dest_pred2T</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>insts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.add_vars</span><span> </span><span class="main"><span>(</span></span><span>Thm.prop_of</span><span> </span><span class="entity"><span>coind</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span>rev</span><span> </span><span>|&gt;</span><span> </span><span>take</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_inst</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_unfold</span></span><span> </span><span class="entity"><span>rel_eq</span></span><span> </span><span class="entity"><span>rel_mono</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eq</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rel_eq</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Def.html#BNF_Def.predicate2_eqD|fact"><span>predicate2_eqD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mono</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rel_mono</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.preorder_class.order_refl|fact"><span>order_refl</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Fixpoint_Base.html#BNF_Fixpoint_Base.eq_subset|fact"><span>eq_subset</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>mk_vimage2p</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>eq</span></span><span> </span><span>RS</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mono</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Orderings.html#Orderings.predicate2D|fact"><span>predicate2D</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>eqTrueI</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unfolds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_unfold</span></span><span> </span><span class="entity"><span>rel_eqs</span></span><span> </span><span class="entity"><span>rel_monos</span></span><span> </span><span>@</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Lattices.html#Lattices.sup_fun_def|fact"><span>sup_fun_def</span></a><span> </span><a class="entity_ref" href="../../../../../Boolean_Algebras.html#Boolean_Algebras.sup_bool_def|fact"><span>sup_bool_def</span></a><span>
      </span><a class="entity_ref" href="../../../../../HOL.html#HOL.imp_disjL|fact"><span>imp_disjL</span></a><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.all_conj_distrib|fact"><span>all_conj_distrib</span></a><span> </span><a class="entity_ref" href="../../../../../BNF_Fixpoint_Base.html#BNF_Fixpoint_Base.subst_eq_imp|fact"><span>subst_eq_imp</span></a><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.simp_thms|fact"><span>simp_thms</span></a><span class="main"><span>(</span></span><span>18</span><span class="main"><span>,</span></span><span>21</span><span class="main"><span>,</span></span><span>35</span><span class="main"><span>)</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>Thm.instantiate</span><span> </span><span class="main"><span>(</span></span><span>TVars.empty</span><span class="main"><span>,</span></span><span> </span><span>Vars.make</span><span> </span><span class="entity"><span>insts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>coind</span></span><span>
    </span><span>|&gt;</span><span> </span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>unfolds</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>derive_coinduct_thms_for_types</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>strong</span></span><span> </span><span class="entity"><span>alter_r</span></span><span> </span><span class="entity"><span>pre_bnfs</span></span><span> </span><span class="entity"><span>dtor_coinduct</span></span><span> </span><span class="entity"><span>dtor_ctors</span></span><span>
    </span><span class="entity"><span>live_nesting_bnfs</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="entity"><span>Xs</span></span><span> </span><span class="entity"><span>ctrXs_Tsss</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>pre_abs_inverses</span></span><span> </span><span class="entity"><span>abs_inverses</span></span><span> </span><span class="entity"><span>mk_vimage2p</span></span><span> </span><span class="entity"><span>ctr_defss</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>ctr_sugars</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ctr_sugar</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>pre_bnfs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pre_rel_defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>rel_def_of_bnf</span></span><span> </span><span class="entity"><span>pre_bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live_nesting_rel_eqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>rel_eq_of_bnf</span></span><span> </span><span class="entity"><span>live_nesting_bnfs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fp_b_names</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>base_name_of_typ</span></span><span> </span><span class="entity"><span>fpTs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>discss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>discs </span><span class="entity"><span>ctr_sugars</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>selsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>selss </span><span class="entity"><span>ctr_sugars</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>exhausts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>exhaust </span><span class="entity"><span>ctr_sugars</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>disc_thmsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>disc_thmss </span><span class="entity"><span>ctr_sugars</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sel_thmsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>sel_thmss </span><span class="entity"><span>ctr_sugars</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>rs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>us'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vs'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"R"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fpTs</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>Variable.variant_fixes</span><span> </span><span class="entity"><span>fp_b_names</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>Variable.variant_fixes</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>suffix</span><span> </span><span class="inner_quoted"><span>"'"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fp_b_names</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>us</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span>Free</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>us'</span></span><span> </span><span class="entity"><span>fpTs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>udiscss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>o</span><span> </span><span class="entity"><span>rapp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>us</span></span><span> </span><span class="entity"><span>discss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>uselsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span>o</span><span> </span><span class="entity"><span>rapp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>us</span></span><span> </span><span class="entity"><span>selsss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span>Free</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs'</span></span><span> </span><span class="entity"><span>fpTs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vdiscss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>o</span><span> </span><span class="entity"><span>rapp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>discss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vselsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span>o</span><span> </span><span class="entity"><span>rapp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>selsss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>uvrs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>u</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rs</span></span><span> </span><span class="entity"><span>us</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>uv_eqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>us</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>strong_rs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>uvr</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>uv_eq</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span>fold_rev</span><span> </span><span>Term.lambda</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>u</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_disj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>uvr</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>uv_eq</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>us</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>uvrs</span></span><span> </span><span class="entity"><span>uv_eqs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span>
        </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>uvr</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>uvr</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>u</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
           </span><span class="entity"><span>uvrs</span></span><span> </span><span class="entity"><span>us</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>rs0'</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 9</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_coinduct_prem</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>single</span><span> </span><span class="entity"><span>Xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>single</span><span> </span><span class="entity"><span>fpTs</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>alter_r</span></span><span> </span><span class="entity"><span>rs0'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>uvrs</span></span><span> </span><span class="entity"><span>us</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>udiscss</span></span><span> </span><span class="entity"><span>uselsss</span></span><span> </span><span class="entity"><span>vdiscss</span></span><span> </span><span class="entity"><span>vselsss</span></span><span> </span><span class="entity"><span>ctrXs_Tsss</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>rs</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>strong</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>strong_rs</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>dtor_coinduct'</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="entity"><span>mk_coinduct_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>live_nesting_rel_eqs</span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>dtor_coinduct'</span></span><span> </span><span class="entity"><span>pre_rel_defs</span></span><span> </span><span class="entity"><span>pre_abs_inverses</span></span><span>
          </span><span class="entity"><span>abs_inverses</span></span><span> </span><span class="entity"><span>dtor_ctors</span></span><span> </span><span class="entity"><span>exhausts</span></span><span> </span><span class="entity"><span>ctr_defss</span></span><span> </span><span class="entity"><span>disc_thmsss</span></span><span> </span><span class="entity"><span>sel_thmsss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_eqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>rel_eq_of_bnf</span></span><span> </span><span class="entity"><span>pre_bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_monos</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>rel_mono_of_bnf</span></span><span> </span><span class="entity"><span>pre_bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dtor_coinducts</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>[</span></span><span class="entity"><span>dtor_coinduct</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>strong</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mk_coinduct_strong_thm</span></span><span> </span><span class="entity"><span>dtor_coinduct</span></span><span> </span><span class="entity"><span>rel_eqs</span></span><span> </span><span class="entity"><span>rel_monos</span></span><span> </span><span class="entity"><span>mk_vimage2p</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>]</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>postproc_co_induct</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="entity"><span>mp</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.conj_commute|fact"><span>conj_commute</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.iffD1|fact"><span>iffD1</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>prove</span></span><span class="main"><span>)</span></span><span>
      </span><span class="entity"><span>dtor_coinducts</span></span><span> </span><span class="entity"><span>goals</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>derive_coinduct_corecs_thms_for_types</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>pre_bnfs</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cpss</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>pgss</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cqgsss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dtor_coinduct</span></span><span> </span><span class="entity"><span>dtor_injects</span></span><span> </span><span class="entity"><span>dtor_ctors</span></span><span>
    </span><span class="entity"><span>dtor_corec_thms</span></span><span> </span><span class="entity"><span>live_nesting_bnfs</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>Xs</span></span><span> </span><span class="entity"><span>ctrXs_Tsss</span></span><span> </span><span class="entity"><span>kss</span></span><span> </span><span class="entity"><span>mss</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>pre_abs_inverses</span></span><span> </span><span class="entity"><span>abs_inverses</span></span><span>
    </span><span class="entity"><span>mk_vimage2p</span></span><span> </span><span class="entity"><span>ctr_defss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctr_sugars</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ctr_sugar</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>corecs</span></span><span> </span><span class="entity"><span>corec_defs</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_ctor_dtor_corec_thm</span></span><span> </span><span class="entity"><span>dtor_inject</span></span><span> </span><span class="entity"><span>dtor_ctor</span></span><span> </span><span class="entity"><span>corec</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>iffD1</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>dtor_inject</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>trans</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>corec</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_ctor</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctor_dtor_corec_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_ctor_dtor_corec_thm</span></span><span> </span><span class="entity"><span>dtor_injects</span></span><span> </span><span class="entity"><span>dtor_ctors</span></span><span> </span><span class="entity"><span>dtor_corec_thms</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pre_map_defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>map_def_of_bnf</span></span><span> </span><span class="entity"><span>pre_bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live_nesting_map_ident0s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>map_ident0_of_bnf</span></span><span> </span><span class="entity"><span>live_nesting_bnfs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fp_b_names</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>base_name_of_typ</span></span><span> </span><span class="entity"><span>fpTs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctrss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>ctrs </span><span class="entity"><span>ctr_sugars</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>discss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>discs </span><span class="entity"><span>ctr_sugars</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>selsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>selss </span><span class="entity"><span>ctr_sugars</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>disc_thmsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>disc_thmss </span><span class="entity"><span>ctr_sugars</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>discIss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>discIs </span><span class="entity"><span>ctr_sugars</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sel_thmsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>sel_thmss </span><span class="entity"><span>ctr_sugars</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coinduct_thms_pairs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>derive_coinduct_thms_for_types</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>true</span><span> </span><span>I</span><span> </span><span class="entity"><span>pre_bnfs</span></span><span> </span><span class="entity"><span>dtor_coinduct</span></span><span>
      </span><span class="entity"><span>dtor_ctors</span></span><span> </span><span class="entity"><span>live_nesting_bnfs</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="entity"><span>Xs</span></span><span> </span><span class="entity"><span>ctrXs_Tsss</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>pre_abs_inverses</span></span><span> </span><span class="entity"><span>abs_inverses</span></span><span> </span><span class="entity"><span>mk_vimage2p</span></span><span>
      </span><span class="entity"><span>ctr_defss</span></span><span> </span><span class="entity"><span>ctr_sugars</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_maybe_not</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>not</span><span> </span><span class="entity"><span>pos</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>HOLogic.mk_not</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>gcorecs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lists_bmoc</span></span><span> </span><span class="entity"><span>pgss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>corecs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>corec_thmss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>us'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Variable.variant_fixes</span><span> </span><span class="entity"><span>fp_b_names</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>us</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span>Free</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>us'</span></span><span> </span><span class="entity"><span>fpTs</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="entity"><span>cps</span></span><span> </span><span class="entity"><span>gcorec</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>ctr</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>cfs'</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span>Logic.all</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>c</span></span><span class="main"><span>]</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>pgss</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span>Logic.list_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>seq_conds</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>mk_maybe_not</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>cps</span></span><span class="main"><span>,</span></span><span>
               </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>gcorec</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctr</span></span><span class="main"><span>,</span></span><span> </span><span>take</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>cfs'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_U</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>typ_subst_nonatomic</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fpT</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_sumT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fpT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>C</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fpT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>fpTs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tack</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>x'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_sumT</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>,</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Term.lambda</span><span> </span><span class="entity"><span>x'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_case_sum</span></span><span> </span><span class="main"><span>(</span></span><span>Term.lambda</span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>,</span></span><span> </span><span>Term.lambda</span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x'</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>build_corec</span></span><span> </span><span class="entity"><span>cqg</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>cqg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>exists_subtype_in</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_U</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>build_simple</span></span><span> </span><span class="main"><span>=</span></span><span>
                  </span><span class="entity"><span>indexify</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>mk_sumT</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="entity"><span>Cs</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>kk</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>tack</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>cs</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>,</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>us</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>gcorecs</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span class="entity"><span>build_map</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>build_simple</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>cqg</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
              </span><span class="entity"><span>cqg</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cqgsss'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>build_corec</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cqgsss</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goalss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 8</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>oooo</span><span> </span><span class="entity"><span>mk_goal</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cs</span></span><span> </span><span class="entity"><span>cpss</span></span><span> </span><span class="entity"><span>gcorecs</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>kss</span></span><span> </span><span class="entity"><span>ctrss</span></span><span> </span><span class="entity"><span>mss</span></span><span> </span><span class="entity"><span>cqgsss'</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tacss</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>ooo</span><span> </span><span class="entity"><span>mk_corec_tac</span></span><span> </span><span class="entity"><span>corec_defs</span></span><span> </span><span class="entity"><span>live_nesting_map_ident0s</span></span><span class="main"><span>)</span></span><span>
            </span><span class="entity"><span>ctor_dtor_corec_thms</span></span><span> </span><span class="entity"><span>pre_map_defs</span></span><span> </span><span class="entity"><span>abs_inverses</span></span><span> </span><span class="entity"><span>ctr_defss</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tac</span></span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>context</span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>prove</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goalss</span></span><span> </span><span class="entity"><span>tacss</span></span><span>
        </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Fixpoint_Base.html#BNF_Fixpoint_Base.case_sum_if|fact"><span>case_sum_if</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>corec_disc_iff_thmss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="entity"><span>cps</span></span><span> </span><span class="entity"><span>gcorec</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>disc</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>disc</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>gcorec</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.True|const"><span>True</span></a><span>›</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Library.foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>seq_conds</span></span><span> </span><span class="entity"><span>mk_maybe_not</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>cps</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goalss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span>oooo</span><span> </span><span class="entity"><span>mk_goal</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cs</span></span><span> </span><span class="entity"><span>cpss</span></span><span> </span><span class="entity"><span>gcorecs</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>kss</span></span><span> </span><span class="entity"><span>discss</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_case_split'</span></span><span> </span><span class="entity"><span>cp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.instantiate'</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>cp</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.case_split|fact"><span>case_split</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>case_splitss'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>mk_case_split'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cpss</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tacss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>oo</span><span> </span><span class="entity"><span>mk_corec_disc_iff_tac</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>case_splitss'</span></span><span> </span><span class="entity"><span>corec_thmss</span></span><span> </span><span class="entity"><span>disc_thmsss</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tac</span></span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>context</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>proves</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>proves</span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="entity"><span>tacs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="entity"><span>tacs</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>map2</span><span> </span><span class="entity"><span>proves</span></span><span> </span><span class="entity"><span>goalss</span></span><span> </span><span class="entity"><span>tacss</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_corec_disc_thms</span></span><span> </span><span class="entity"><span>corecs</span></span><span> </span><span class="entity"><span>discIs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>RS</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>corecs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>discIs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>corec_disc_thmss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_corec_disc_thms</span></span><span> </span><span class="entity"><span>corec_thmss</span></span><span> </span><span class="entity"><span>discIss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_corec_sel_thm</span></span><span> </span><span class="entity"><span>corec_thm</span></span><span> </span><span class="entity"><span>sel</span></span><span> </span><span class="entity"><span>sel_thm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>domT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ranT</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>dest_funT</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>sel</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>arg_cong'</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Thm.instantiate'</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span>Thm.ctyp_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>domT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ranT</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>[</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sel</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>arg_cong</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Thm.varifyT_global</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sel_thm'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sel_thm</span></span><span> </span><span>RSN</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>corec_thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>arg_cong'</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sel_thm'</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_corec_sel_thms</span></span><span> </span><span class="entity"><span>corec_thmss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_corec_sel_thm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>corec_thmss</span></span><span> </span><span class="entity"><span>selsss</span></span><span> </span><span class="entity"><span>sel_thmsss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>corec_sel_thmsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_corec_sel_thms</span></span><span> </span><span class="entity"><span>corec_thmss</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>coinduct_thms_pairs</span></span><span class="main"><span>,</span></span><span>
      </span><span class="entity"><span>mk_coinduct_attrs</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>ctrs </span><span class="entity"><span>ctr_sugars</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>discs </span><span class="entity"><span>ctr_sugars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="entity"><span>corec_thmss</span></span><span class="main"><span>,</span></span><span>
     </span><span class="entity"><span>corec_disc_thmss</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="entity"><span>corec_disc_iff_thmss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>simp_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="main"><span>(</span></span><span class="entity"><span>corec_sel_thmsss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>simp_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>define_co_datatypes</span></span><span> </span><span class="entity"><span>prepare_plugins</span></span><span> </span><span class="entity"><span>prepare_constraint</span></span><span> </span><span class="entity"><span>prepare_typ</span></span><span> </span><span class="entity"><span>prepare_term</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="entity"><span>construct_fp</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>raw_plugins</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>discs_sels0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>plugins</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prepare_plugins</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>raw_plugins</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>discs_sels</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>discs_sels0</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Greatest_FP</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fp_bs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>type_binding_of_spec</span></span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fp_b_names</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>Binding.name_of</span><span> </span><span class="entity"><span>fp_bs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fp_common_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_common_name</span></span><span> </span><span class="entity"><span>fp_b_names</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_bs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>map_binding_of_spec</span></span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rel_bs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>rel_binding_of_spec</span></span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_bs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>pred_binding_of_spec</span></span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prepare_type_arg</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span>TFree</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prepare_typ</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>TFree</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prepare_constraint</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ass0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>prepare_type_arg</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>type_args_named_constrained_of_spec</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unsorted_Ass0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>resort_tfree_or_tvar</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../HOL.html#HOL.type|class"><span>type</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ass0</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unsorted_As</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Library.foldr1</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>merge_type_args</span></span><span> </span><span class="entity"><span>fp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>unsorted_Ass0</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>num_As</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>unsorted_As</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_boss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span class="entity"><span>type_args_named_constrained_of_spec</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_bss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>the_default</span><span> </span><span>Binding.empty</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_boss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_fake_type</span></span><span> </span><span class="entity"><span>spec</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>Typedecl.basic_typedecl</span></span><span> </span><span class="main"><span>{</span></span><span>final </span><span class="main"><span>=</span></span><span> </span><span>true</span><span class="main"><span>}</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>type_binding_of_spec</span></span><span> </span><span class="entity"><span>spec</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>num_As</span></span><span class="main"><span>,</span></span><span> </span><span>Mixfix.reset_pos</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mixfix_of_spec</span></span><span> </span><span class="entity"><span>spec</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fake_T_names</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fake_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_map</span><span> </span><span class="entity"><span>add_fake_type</span></span><span> </span><span class="entity"><span>specs</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>qsoty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>quote</span><span> </span><span>o</span><span> </span><span>Syntax.string_of_typ</span><span> </span><span class="entity"><span>fake_lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Library.duplicates</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>unsorted_As</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Duplicate type parameter "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>qsoty</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" in "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>co_prefix</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span>^</span><span>
          </span><span class="inner_quoted"><span>"datatype specification"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bad_args</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Logic.type_map</span><span> </span><span class="main"><span>(</span></span><span>singleton</span><span> </span><span class="main"><span>(</span></span><span>Variable.polymorphic</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>unsorted_As</span></span><span>
      </span><span>|&gt;</span><span> </span><span>filter_out</span><span> </span><span>Term.is_TVar</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>null</span><span> </span><span class="entity"><span>bad_args</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
      </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Locally fixed type argument "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>qsoty</span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>bad_args</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" in "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>co_prefix</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span>^</span><span>
        </span><span class="inner_quoted"><span>"datatype specification"</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mixfixes</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mixfix_of_spec</span></span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Library.duplicates</span><span> </span><span>Binding.eq_name</span><span> </span><span class="entity"><span>fp_bs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Duplicate type name declaration "</span></span><span> </span><span>^</span><span> </span><span>quote</span><span> </span><span class="main"><span>(</span></span><span>Binding.name_of</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mx_ctr_specss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mixfixed_ctr_specs_of_spec</span></span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctr_specss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mx_ctr_specss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctr_mixfixess</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mx_ctr_specss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>disc_bindingss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>disc_of_ctr_spec</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctr_specss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctr_bindingss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fp_b_name</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Binding.qualify</span><span> </span><span>false</span><span> </span><span class="entity"><span>fp_b_name</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>ctr_of_ctr_spec</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fp_b_names</span></span><span>
        </span><span class="entity"><span>ctr_specss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctr_argsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>args_of_ctr_spec</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctr_specss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sel_bindingsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctr_argsss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fake_ctr_Tsss0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prepare_typ</span></span><span> </span><span class="entity"><span>fake_lthy</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctr_argsss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>raw_sel_default_eqss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>sel_default_eqs_of_spec</span></span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>As</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>fake_ctr_Tsss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>burrow</span><span> </span><span class="main"><span>(</span></span><span>burrow</span><span> </span><span class="main"><span>(</span></span><span>Syntax.check_typs</span><span> </span><span class="entity"><span>fake_lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ass0</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>fake_ctr_Tsss0</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>dest_TFree</span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rhs_As'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span>Term.add_tfreesT</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fake_ctr_Tsss</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>subtract</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="entity"><span>rhs_As'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>extras</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Extra type variables on right-hand side: "</span></span><span> </span><span>^</span><span>
          </span><span>commas</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>qsoty</span></span><span> </span><span>o</span><span> </span><span>TFree</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>extras</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fake_Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fake_T_names</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>Bs0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Cs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Es</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Xs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>Variable.declare_typ</span><span> </span><span>o</span><span> </span><span class="entity"><span>resort_tfree_or_tvar</span></span><span> </span><span>dummyS</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>unsorted_As</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_TFrees</span></span><span> </span><span class="entity"><span>num_As</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_TFrees</span></span><span> </span><span class="entity"><span>nn</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_TFrees</span></span><span> </span><span class="entity"><span>nn</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>variant_tfrees</span></span><span> </span><span class="entity"><span>fp_b_names</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>eq_fpT_check</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T'</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>s'</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Ts'</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
          </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Wrong type arguments in "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>co_prefix</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"recursive type "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>qsoty</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>^</span><span>
            </span><span class="inner_quoted"><span>" (expected "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>qsoty</span></span><span> </span><span class="entity"><span>T'</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>eq_fpT_check</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>freeze_fp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>find_index</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>eq_fpT_check</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fake_Ts</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>freeze_fp</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>kk</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>Xs</span></span><span> </span><span class="entity"><span>kk</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>freeze_fp</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unfreeze_fp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.typ_subst_atomic</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Xs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>fake_Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctrXs_Tsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>freeze_fp</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fake_ctr_Tsss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctrXs_repTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_sumprodT_balanced</span></span><span> </span><span class="entity"><span>ctrXs_Tsss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_deps</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>fold_index</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>exists_subtype_in</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>X</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span>?</span><span> </span><span>insert</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Xs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>add_missing_nodes</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>AList.default</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>rpair</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>nn</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_index</span><span> </span><span class="main"><span>(</span></span><span>uncurry</span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span>o</span><span> </span><span class="entity"><span>add_deps</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctrXs_Tsss</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
          </span><span>|&gt;</span><span> </span><span>AList.group</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>add_missing_nodes</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>G</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Int_Graph.make</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>rpair</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>deps</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sccs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>sort</span><span> </span><span>int_ord</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Int_Graph.strong_conn</span><span> </span><span class="entity"><span>G</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>str_of_scc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>prefix</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>co_prefix</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"datatype "</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span>
          </span><span>space_implode</span><span> </span><span class="inner_quoted"><span>" and "</span></span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>suffix</span><span> </span><span class="inner_quoted"><span>" = …"</span></span><span> </span><span>o</span><span> </span><span>Long_Name.base_name</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>warn</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>warn</span></span><span> </span><span class="entity"><span>sccs</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span>warning</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Defined types not fully mutually "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>co_prefix</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"recursive\n\
              \Alternative specification:\n"</span></span><span> </span><span>^</span><span>
              </span><span>cat_lines</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>prefix</span><span> </span><span class="inner_quoted"><span>"  "</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>str_of_scc</span></span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>fp_b_names</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sccs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>warn</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>order_strong_conn</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span>Int_Graph.make</span><span> </span><span>Int_Graph.topological_order</span><span> </span><span class="entity"><span>deps</span></span><span> </span><span class="entity"><span>sccs</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>killed_As</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>A</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_bos</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>exists</span><span> </span><span>is_none</span><span> </span><span class="entity"><span>set_bos</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>As</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>set_boss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>pre_bnfs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>absT_infos</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fp_res</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span>bnfs </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fp_bnfs</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>any_fp_bnf</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> ctors </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctors0</span></span><span class="main"><span>,</span></span><span>
             dtors </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dtors0</span></span><span class="main"><span>,</span></span><span> xtor_co_recs </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>xtor_co_recs0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xtor_co_induct</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_ctors</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctor_dtors</span></span><span class="main"><span>,</span></span><span>
             </span><span class="entity"><span>ctor_injects</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_injects</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xtor_maps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xtor_setss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xtor_rels</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xtor_co_rec_thms</span></span><span class="main"><span>,</span></span><span>
             </span><span class="entity"><span>xtor_rel_co_induct</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dtor_set_inducts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xtor_co_rec_transfers</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xtor_co_rec_o_maps</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span>
           </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>fixpoint_bnf</span></span><span> </span><span>false</span><span> </span><span>I</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>construct_fp</span></span><span> </span><span class="entity"><span>mixfixes</span></span><span> </span><span class="entity"><span>map_bs</span></span><span> </span><span class="entity"><span>rel_bs</span></span><span> </span><span class="entity"><span>pred_bs</span></span><span> </span><span class="entity"><span>set_bss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fp_bs</span></span><span>
        </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>dest_TFree</span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>dest_TFree</span><span> </span><span class="entity"><span>killed_As</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>dest_TFree</span><span> </span><span class="entity"><span>Xs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctrXs_repTs</span></span><span>
        </span><span class="entity"><span>empty_comp_cache</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
      </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span class="entity"><span>BAD_DEAD</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>X</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>X_backdrop</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>X_backdrop</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bad_tc</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fake_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>qsoty</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfreeze_fp</span></span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fake_T_backdrop</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>qsoty</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfreeze_fp</span></span><span> </span><span class="entity"><span>X_backdrop</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>register_hint</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="inner_quoted"><span>"\nUse the "</span></span><span> </span><span>^</span><span> </span><span>quote</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">command_keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword1"><span>bnf</span></span><span>›</span></span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" command to register "</span></span><span> </span><span>^</span><span>
              </span><span>quote</span><span> </span><span class="entity"><span>bad_tc</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" as a bounded natural functor to allow nested (co)recursion through \
              \it"</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>is_some</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnf_of</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>bad_tc</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>is_some</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fp_sugar_of</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>bad_tc</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
              </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Inadmissible "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>co_prefix</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"recursive occurrence of type "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>fake_T</span></span><span> </span><span>^</span><span>
                </span><span class="inner_quoted"><span>" in type expression "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>fake_T_backdrop</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>is_some</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Old_Datatype_Data.get_info</span></span><span> </span><span class="main"><span>(</span></span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
                </span><span class="entity"><span>bad_tc</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
              </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Unsupported "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>co_prefix</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"recursive occurrence of type "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>fake_T</span></span><span> </span><span>^</span><span>
                </span><span class="inner_quoted"><span>" via the old-style datatype "</span></span><span> </span><span>^</span><span> </span><span>quote</span><span> </span><span class="entity"><span>bad_tc</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" in type expression "</span></span><span> </span><span>^</span><span>
                </span><span class="entity"><span>fake_T_backdrop</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>register_hint</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
              </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Unsupported "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>co_prefix</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"recursive occurrence of type "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>fake_T</span></span><span> </span><span>^</span><span>
                </span><span class="inner_quoted"><span>" via type constructor "</span></span><span> </span><span>^</span><span> </span><span>quote</span><span> </span><span class="entity"><span>bad_tc</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" in type expression "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>fake_T_backdrop</span></span><span> </span><span>^</span><span>
                </span><span class="entity"><span>register_hint</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>(</span></span><span>Timer.startRealTimer</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fp_nesting_bnfs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nesting_bnfs</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>ctrXs_Tsss</span></span><span> </span><span class="entity"><span>Xs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live_nesting_bnfs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nesting_bnfs</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>ctrXs_Tsss</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pre_map_defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>map_def_of_bnf</span></span><span> </span><span class="entity"><span>pre_bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pre_set_defss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>set_defs_of_bnf</span></span><span> </span><span class="entity"><span>pre_bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pre_rel_defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>rel_def_of_bnf</span></span><span> </span><span class="entity"><span>pre_bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fp_nesting_set_maps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>maps</span><span> </span><span class="entity"><span>set_map_of_bnf</span></span><span> </span><span class="entity"><span>fp_nesting_bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fp_nesting_rel_eq_onps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>rel_eq_onp_of_bnf</span></span><span> </span><span class="entity"><span>fp_nesting_bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live_nesting_map_id0s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>map_id0_of_bnf</span></span><span> </span><span class="entity"><span>live_nesting_bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live_nesting_map_ident0s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>map_ident0_of_bnf</span></span><span> </span><span class="entity"><span>live_nesting_bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live_nesting_set_maps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>maps</span><span> </span><span class="entity"><span>set_map_of_bnf</span></span><span> </span><span class="entity"><span>live_nesting_bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live_nesting_rel_eqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>rel_eq_of_bnf</span></span><span> </span><span class="entity"><span>live_nesting_bnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live_nesting_rel_eq_onps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>rel_eq_onp_of_bnf</span></span><span> </span><span class="entity"><span>live_nesting_bnfs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>liveness</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>liveness_of_fp_bnf</span></span><span> </span><span class="entity"><span>num_As</span></span><span> </span><span class="entity"><span>any_fp_bnf</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>live_of_bnf</span></span><span> </span><span class="entity"><span>any_fp_bnf</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span>not</span><span> </span><span>o</span><span> </span><span>Binding.is_empty</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_bs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>rel_bs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pred_bs</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span>warning</span><span> </span><span class="inner_quoted"><span>"Map function, relator, and predicator names ignored"</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>alive</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>TFree</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>S</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>B</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>alive</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>resort_tfree_or_tvar</span></span><span> </span><span class="entity"><span>S</span></span><span> </span><span class="entity"><span>B</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>A</span></span><span class="main"><span>)</span></span><span>
      </span><span class="entity"><span>liveness</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>Bs0</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>B_ify_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.typ_subst_atomic</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>As</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>B_ify</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.map_types</span><span> </span><span class="entity"><span>B_ify_T</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live_AsBs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>&lt;&gt;</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>As</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>abss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>abs </span><span class="entity"><span>absT_infos</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>reps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>rep </span><span class="entity"><span>absT_infos</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>absTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>absT </span><span class="entity"><span>absT_infos</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>repTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>repT </span><span class="entity"><span>absT_infos</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>abs_injects</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>abs_inject </span><span class="entity"><span>absT_infos</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>abs_inverses</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>abs_inverse </span><span class="entity"><span>absT_infos</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>type_definitions</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>type_definition </span><span class="entity"><span>absT_infos</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctors</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_ctor</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctors0</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dtors</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_dtor</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dtors0</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>domain_type</span><span> </span><span>o</span><span> </span><span>fastype_of</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dtors</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fpBTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>B_ify_T</span></span><span> </span><span class="entity"><span>fpTs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>real_unfreeze_fp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.typ_subst_atomic</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Xs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>fpTs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctr_Tsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>real_unfreeze_fp</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctrXs_Tsss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>length</span><span> </span><span class="entity"><span>ctr_Tsss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>kss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ns</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>length</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctr_Tsss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xtor_co_recs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>recs_args_types</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>corecs_args_types</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>mk_co_recs_prelims</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="entity"><span>ctr_Tsss</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>absTs</span></span><span> </span><span class="entity"><span>repTs</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>mss</span></span><span> </span><span class="entity"><span>xtor_co_recs0</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>define_ctrs_dtrs_for_type_etc</span></span><span> </span><span class="entity"><span>fp_bnf</span></span><span> </span><span class="entity"><span>fp_b</span></span><span> </span><span class="entity"><span>fpT</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="entity"><span>ctor</span></span><span> </span><span class="entity"><span>dtor</span></span><span> </span><span class="entity"><span>xtor_co_rec</span></span><span> </span><span class="entity"><span>ctor_dtor</span></span><span> </span><span class="entity"><span>dtor_ctor</span></span><span>
        </span><span class="entity"><span>ctor_inject</span></span><span> </span><span class="entity"><span>pre_map_def</span></span><span> </span><span class="entity"><span>pre_set_defs</span></span><span> </span><span class="entity"><span>pre_rel_def</span></span><span> </span><span class="entity"><span>fp_map_thm</span></span><span> </span><span class="entity"><span>fp_set_thms</span></span><span> </span><span class="entity"><span>fp_rel_thm</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>ms</span></span><span>
        </span><span class="entity"><span>abs</span></span><span> </span><span class="entity"><span>abs_inject</span></span><span> </span><span class="entity"><span>type_definition</span></span><span> </span><span class="entity"><span>ctr_bindings</span></span><span> </span><span class="entity"><span>ctr_mixfixes</span></span><span> </span><span class="entity"><span>ctr_Tss</span></span><span> </span><span class="entity"><span>disc_bindings</span></span><span> </span><span class="entity"><span>sel_bindingss</span></span><span>
        </span><span class="entity"><span>raw_sel_default_eqs</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fp_b_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Binding.name_of</span><span> </span><span class="entity"><span>fp_b</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>xss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctrs0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctor_iff_dtor_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctr_defs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>define_ctrs_dtrs_for_type</span></span><span> </span><span class="entity"><span>fp_b_name</span></span><span> </span><span class="entity"><span>fpT</span></span><span> </span><span class="entity"><span>ctor</span></span><span> </span><span class="entity"><span>dtor</span></span><span> </span><span class="entity"><span>ctor_dtor</span></span><span> </span><span class="entity"><span>dtor_ctor</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>abs</span></span><span>
            </span><span class="entity"><span>ctr_bindings</span></span><span> </span><span class="entity"><span>ctr_mixfixes</span></span><span> </span><span class="entity"><span>ctr_Tss</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctrs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_ctr</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctrs0</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sel_default_eqs</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sel_Tss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fpT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctr_Tss</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sel_bTs</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span>flat</span><span> </span><span class="entity"><span>sel_bindingss</span></span><span> </span><span>~~</span><span> </span><span>flat</span><span> </span><span class="entity"><span>sel_Tss</span></span><span>
              </span><span>|&gt;</span><span> </span><span>filter_out</span><span> </span><span class="main"><span>(</span></span><span>Binding.is_empty</span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span>distinct</span><span> </span><span class="main"><span>(</span></span><span>Binding.eq_name</span><span> </span><span>o</span><span> </span><span>apply2</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sel_default_lthy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fake_local_theory_for_sel_defaults</span></span><span> </span><span class="entity"><span>sel_bTs</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prepare_term</span></span><span> </span><span class="entity"><span>sel_default_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>raw_sel_default_eqs</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_binding</span></span><span> </span><span class="entity"><span>pre</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Binding.qualify</span><span> </span><span>false</span><span> </span><span class="entity"><span>fp_b_name</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.prefix_name</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pre</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"_"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fp_b</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>massage_res</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctr_sugar</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>maps_sets_rels</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>maps_sets_rels</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctrs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctor_iff_dtor_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctr_defs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctr_sugar</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>wrap_ctrs</span></span><span> </span><span class="entity"><span>plugins</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="entity"><span>discs_sels</span></span><span> </span><span class="entity"><span>fp_b_name</span></span><span> </span><span class="entity"><span>ctor_inject</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>ms</span></span><span> </span><span class="entity"><span>abs_inject</span></span><span> </span><span class="entity"><span>type_definition</span></span><span>
           </span><span class="entity"><span>disc_bindings</span></span><span> </span><span class="entity"><span>sel_bindingss</span></span><span> </span><span class="entity"><span>sel_default_eqs</span></span><span> </span><span class="entity"><span>ctrs0</span></span><span> </span><span class="entity"><span>ctor_iff_dtor_thm</span></span><span> </span><span class="entity"><span>ctr_defs</span></span><span>
         </span><span>#&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctr_sugar</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
           </span><span class="entity"><span>derive_map_set_rel_pred_thms</span></span><span> </span><span class="entity"><span>plugins</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>E</span></span><span> </span><span class="entity"><span>abs_inverses</span></span><span> </span><span class="entity"><span>ctr_defs</span></span><span>
             </span><span class="entity"><span>fp_nesting_set_maps</span></span><span> </span><span class="entity"><span>fp_nesting_rel_eq_onps</span></span><span> </span><span class="entity"><span>live_nesting_map_id0s</span></span><span> </span><span class="entity"><span>live_nesting_set_maps</span></span><span>
             </span><span class="entity"><span>live_nesting_rel_eqs</span></span><span> </span><span class="entity"><span>live_nesting_rel_eq_onps</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>fp_b_name</span></span><span> </span><span class="entity"><span>fp_bnf</span></span><span> </span><span class="entity"><span>fp_bnfs</span></span><span> </span><span class="entity"><span>fpT</span></span><span> </span><span class="entity"><span>ctor</span></span><span>
             </span><span class="entity"><span>ctor_dtor</span></span><span> </span><span class="entity"><span>dtor_ctor</span></span><span> </span><span class="entity"><span>pre_map_def</span></span><span> </span><span class="entity"><span>pre_set_defs</span></span><span> </span><span class="entity"><span>pre_rel_def</span></span><span> </span><span class="entity"><span>fp_map_thm</span></span><span> </span><span class="entity"><span>fp_set_thms</span></span><span>
             </span><span class="entity"><span>fp_rel_thm</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>ctr_Tss</span></span><span> </span><span class="entity"><span>ctr_sugar</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
           </span><span>|&gt;&gt;</span><span> </span><span>pair</span><span> </span><span class="entity"><span>ctr_sugar</span></span><span class="main"><span>)</span></span><span>
         </span><span>##&gt;&gt;</span><span>
           </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Least_FP</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>define_rec</span></span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="entity"><span>recs_args_types</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mk_binding</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>reps</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>define_corec</span></span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="entity"><span>corecs_args_types</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mk_binding</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>abss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xtor_co_rec</span></span><span>
         </span><span>#&gt;&gt;</span><span> </span><span>apfst</span><span> </span><span class="entity"><span>massage_res</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>wrap_ctrs_derive_map_set_rel_pred_thms_define_co_rec_for_types</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>wrap_one_etcs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>fold_map</span><span> </span><span>I</span><span> </span><span class="entity"><span>wrap_one_etcs</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;&gt;</span><span> </span><span>apsnd</span><span> </span><span>split_list</span><span> </span><span>o</span><span> </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>split_list</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>o</span><span> </span><span>apfst</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>split_list</span></span><span> 17</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>o</span><span> </span><span>split_list</span><span class="main"><span>)</span></span><span>
        </span><span>o</span><span> </span><span>split_list</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_simp_thms</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="entity"><span>injects</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>distincts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>case_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ctr_sugar</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>co_recs</span></span><span> </span><span class="entity"><span>map_thms</span></span><span> </span><span class="entity"><span>rel_injects</span></span><span>
        </span><span class="entity"><span>rel_distincts</span></span><span> </span><span class="entity"><span>set_thmss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>injects</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>distincts</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>case_thms</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>co_recs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>map_thms</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>rel_injects</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>rel_distincts</span></span><span> </span><span>@</span><span>
      </span><span class="entity"><span>set_thmss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_co_rec_transfer_goals</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>co_recs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>BE_ify</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>live_AsBs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Cs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Es</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>Rs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"R"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>uncurry</span><span> </span><span class="entity"><span>mk_pred2T</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>live_AsBs</span></span><span class="main"><span>)</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"S"</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_pred2T</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>Es</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>co_recBs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>BE_ify</span></span><span> </span><span class="entity"><span>co_recs</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>Rs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ss</span></span><span class="main"><span>,</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_parametricity_goal</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Ss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>co_recs</span></span><span> </span><span class="entity"><span>co_recBs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>derive_rec_transfer_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>recs</span></span><span> </span><span class="entity"><span>rec_defs</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xsssss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_co_rec_transfer_goals</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>recs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_conjunction_balanced</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
             </span><span class="entity"><span>mk_rec_transfer_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ss</span></span><span class="main"><span>)</span></span><span>
               </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xsssss</span></span><span> </span><span class="entity"><span>rec_defs</span></span><span> </span><span class="entity"><span>xtor_co_rec_transfers</span></span><span> </span><span class="entity"><span>pre_rel_defs</span></span><span>
               </span><span class="entity"><span>live_nesting_rel_eqs</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
        </span><span>|&gt;</span><span> </span><span>Conjunction.elim_balanced</span><span> </span><span class="entity"><span>nn</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>derive_rec_o_map_thmss</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>recs</span></span><span> </span><span class="entity"><span>rec_defs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span>replicate</span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>variant_names</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>pre</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>Variable.variant_fixes</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>pre</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>maps0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>map_of_bnf</span></span><span> </span><span class="entity"><span>fp_bnfs</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>f_names</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>variant_names</span></span><span> </span><span class="entity"><span>num_As</span></span><span> </span><span class="inner_quoted"><span>"f"</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span>Free</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>f_names</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>As</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live_gs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>AList.find</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>liveness</span></span><span class="main"><span>)</span></span><span> </span><span>true</span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>gmaps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_map</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>map0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>live_gs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>maps0</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rec_arg_Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>binder_fun_types</span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>recs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>num_rec_args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>rec_arg_Ts</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>g_Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>B_ify_T</span></span><span> </span><span class="entity"><span>rec_arg_Ts</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>g_names</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>variant_names</span></span><span> </span><span class="entity"><span>num_rec_args</span></span><span> </span><span class="inner_quoted"><span>"g"</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>gs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span>Free</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>g_names</span></span><span> </span><span class="entity"><span>g_Ts</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>grecs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>recx</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>Term.map_types</span><span> </span><span class="entity"><span>B_ify_T</span></span><span> </span><span class="entity"><span>recx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>recs</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rec_o_map_lhss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>grecs</span></span><span> </span><span class="entity"><span>gmaps</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ABfs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>As</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>)</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rec_arg_arg</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>B_ify_T</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>build_map</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span>o</span><span> </span><span>AList.lookup</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ABfs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rec_o_map_arg</span></span><span> </span><span class="entity"><span>rec_arg_T</span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>x_Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>binder_types</span><span> </span><span class="entity"><span>rec_arg_T</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>x_Ts</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>x_names</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>variant_names</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="inner_quoted"><span>"x"</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span>Free</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x_names</span></span><span> </span><span class="entity"><span>x_Ts</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>xs'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_rec_arg_arg</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span>fold_rev</span><span> </span><span>Term.lambda</span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>h</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rec_o_map_rhs</span></span><span> </span><span class="entity"><span>recx</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_rec_o_map_arg</span></span><span> </span><span class="entity"><span>rec_arg_Ts</span></span><span> </span><span class="entity"><span>gs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>recx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rec_o_map_rhss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_rec_o_map_rhs</span></span><span> </span><span class="entity"><span>recs</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rec_o_map_goals</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span>Logic.all</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>fs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>]</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>oo</span><span>
              </span><span>curry</span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rec_o_map_lhss</span></span><span> </span><span class="entity"><span>rec_o_map_rhss</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rec_o_map_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rec_def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctor_rec_o_map</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="entity"><span>mk_co_rec_o_map_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>rec_def</span></span><span> </span><span class="entity"><span>pre_map_defs</span></span><span> </span><span class="entity"><span>live_nesting_map_ident0s</span></span><span>
                    </span><span class="entity"><span>abs_inverses</span></span><span> </span><span class="entity"><span>ctor_rec_o_map</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>rec_o_map_goals</span></span><span> </span><span class="entity"><span>rec_defs</span></span><span> </span><span class="entity"><span>xtor_co_rec_o_maps</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span>map</span><span> </span><span>single</span><span> </span><span class="entity"><span>rec_o_map_thms</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>derive_note_induct_recs_thms_for_types</span></span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>map_thmss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_disc_iffss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_selsss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_injectss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_distinctss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_selss</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>rel_intross</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_casess</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pred_injectss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_thmss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_selsssss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_introsssss</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>set_casess</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctr_transferss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>case_transferss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>disc_transferss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sel_transferss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>ctrss</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctor_iff_dtors</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctr_defss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctr_sugars</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>recs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rec_defs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>induct_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>induct_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>induct_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rec_thmss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rec_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>derive_induct_recs_thms_for_types</span></span><span> </span><span class="entity"><span>plugins</span></span><span> </span><span class="entity"><span>pre_bnfs</span></span><span> </span><span class="entity"><span>recs_args_types</span></span><span> </span><span class="entity"><span>xtor_co_induct</span></span><span>
            </span><span class="entity"><span>xtor_co_rec_thms</span></span><span> </span><span class="entity"><span>live_nesting_bnfs</span></span><span> </span><span class="entity"><span>fp_nesting_bnfs</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>Xs</span></span><span> </span><span class="entity"><span>ctrXs_Tsss</span></span><span> </span><span class="entity"><span>abs_inverses</span></span><span>
            </span><span class="entity"><span>type_definitions</span></span><span> </span><span class="entity"><span>abs_inverses</span></span><span> </span><span class="entity"><span>ctrss</span></span><span> </span><span class="entity"><span>ctr_defss</span></span><span> </span><span class="entity"><span>recs</span></span><span> </span><span class="entity"><span>rec_defs</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rec_transfer_thmss</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>map</span><span> </span><span>single</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>derive_rec_transfer_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>recs</span></span><span> </span><span class="entity"><span>rec_defs</span></span><span> </span><span class="entity"><span>recs_args_types</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>induct_type_attr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Attrib.internal</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span> </span><span>o</span><span> </span><span>K</span><span> </span><span>o</span><span> </span><span class="entity"><span>Induct.induct_type</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>induct_pred_attr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Attrib.internal</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span> </span><span>o</span><span> </span><span>K</span><span> </span><span>o</span><span> </span><span class="entity"><span>Induct.induct_pred</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>rel_induct_thmss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>common_rel_induct_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
             </span><span class="main"><span>(</span></span><span class="entity"><span>rel_induct_attrs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>common_rel_induct_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>rel_induct_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>common_rel_induct_thm</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_induct_attrs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="entity"><span>derive_rel_induct_thms_for_types</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>ctrss</span></span><span> </span><span class="entity"><span>ctr_Tsss</span></span><span>
                  </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>exhaust </span><span class="entity"><span>ctr_sugars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xtor_rel_co_induct</span></span><span> </span><span class="entity"><span>ctr_defss</span></span><span> </span><span class="entity"><span>ctor_injects</span></span><span>
                  </span><span class="entity"><span>pre_rel_defs</span></span><span> </span><span class="entity"><span>abs_inverses</span></span><span> </span><span class="entity"><span>live_nesting_rel_eqs</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>map</span><span> </span><span>single</span><span> </span><span class="entity"><span>rel_induct_thms</span></span><span class="main"><span>,</span></span><span> </span><span>single</span><span> </span><span class="entity"><span>common_rel_induct_thm</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
               </span><span class="main"><span>(</span></span><span class="entity"><span>rel_induct_attrs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_induct_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rec_o_map_thmss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>derive_rec_o_map_thmss</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>recs</span></span><span> </span><span class="entity"><span>rec_defs</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>simp_thmss</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_simp_thms</span></span><span> </span><span class="entity"><span>ctr_sugars</span></span><span> </span><span class="entity"><span>rec_thmss</span></span><span> </span><span class="entity"><span>map_thmss</span></span><span> </span><span class="entity"><span>rel_injectss</span></span><span> </span><span class="entity"><span>rel_distinctss</span></span><span>
            </span><span class="entity"><span>set_thmss</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>common_notes</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
             </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>inductN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>induct_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="entity"><span>induct_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>rel_inductN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>common_rel_induct_thms</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="entity"><span>common_rel_induct_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
             </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>massage_simple_notes</span></span><span> </span><span class="entity"><span>fp_common_name</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>notes</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>inductN</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span>single</span><span> </span><span class="entity"><span>induct_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T_name</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>induct_attrs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>induct_type_attr</span></span><span> </span><span class="entity"><span>T_name</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>recN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rec_thmss</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="entity"><span>rec_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rec_o_mapN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rec_o_map_thmss</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rec_transferN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rec_transfer_thmss</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rel_inductN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_induct_thmss</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_induct_attrs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>induct_pred_attr</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>simpsN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>simp_thmss</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>massage_multi_notes</span></span><span> </span><span class="entity"><span>fp_b_names</span></span><span> </span><span class="entity"><span>fpTs</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>lthy</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="entity"><span>Spec_Rules.add</span></span><span> </span><span>Binding.empty</span><span> </span><span class="entity"><span>Spec_Rules.equational</span></span><span> </span><span class="entity"><span>recs</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>rec_thmss</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="entity"><span>plugins</span></span><span> </span><span class="entity"><span>code_plugin</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>Code.declare_default_eqns</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>rpair</span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>rec_thmss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Local_Theory.notes</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>common_notes</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>notes</span></span><span class="main"><span>)</span></span><span>
        </span><span class="comment1"><span>(* for "datatype_realizer.ML": *)</span></span><span>
        </span><span>|&gt;&gt;</span><span> </span><span class="entity"><span>name_noted_thms</span></span><span>
          </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>dest_Type</span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>fpTs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span>implode</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>prefix</span><span> </span><span class="inner_quoted"><span>"_"</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>tl</span><span> </span><span class="entity"><span>fp_b_names</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>inductN</span></span><span>
        </span><span>|-&gt;</span><span> </span><span class="entity"><span>interpret_bnfs_register_fp_sugars</span></span><span> </span><span class="entity"><span>plugins</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="entity"><span>fpBTs</span></span><span> </span><span class="entity"><span>Xs</span></span><span> </span><span class="entity"><span>Least_FP</span></span><span> </span><span class="entity"><span>pre_bnfs</span></span><span> </span><span class="entity"><span>absT_infos</span></span><span>
          </span><span class="entity"><span>fp_nesting_bnfs</span></span><span> </span><span class="entity"><span>live_nesting_bnfs</span></span><span> </span><span class="entity"><span>fp_res</span></span><span> </span><span class="entity"><span>ctrXs_Tsss</span></span><span> </span><span class="entity"><span>ctor_iff_dtors</span></span><span> </span><span class="entity"><span>ctr_defss</span></span><span> </span><span class="entity"><span>ctr_sugars</span></span><span>
          </span><span class="entity"><span>recs</span></span><span> </span><span class="entity"><span>rec_defs</span></span><span> </span><span class="entity"><span>map_thmss</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>induct_thm</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>single</span><span> </span><span class="entity"><span>induct_thms</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rec_thmss</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel_injectss</span></span><span> </span><span class="entity"><span>rel_distinctss</span></span><span> </span><span class="entity"><span>map_disc_iffss</span></span><span> </span><span class="entity"><span>map_selsss</span></span><span> </span><span class="entity"><span>rel_selss</span></span><span>
          </span><span class="entity"><span>rel_intross</span></span><span> </span><span class="entity"><span>rel_casess</span></span><span> </span><span class="entity"><span>pred_injectss</span></span><span> </span><span class="entity"><span>set_thmss</span></span><span> </span><span class="entity"><span>set_selsssss</span></span><span> </span><span class="entity"><span>set_introsssss</span></span><span> </span><span class="entity"><span>set_casess</span></span><span>
          </span><span class="entity"><span>ctr_transferss</span></span><span> </span><span class="entity"><span>case_transferss</span></span><span> </span><span class="entity"><span>disc_transferss</span></span><span> </span><span class="entity"><span>sel_transferss</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rec_transfer_thmss</span></span><span> </span><span class="entity"><span>common_rel_induct_thms</span></span><span> </span><span class="entity"><span>rel_induct_thmss</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
          </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rec_o_map_thmss</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>derive_corec_transfer_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>corecs</span></span><span> </span><span class="entity"><span>corec_defs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Rs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_co_rec_transfer_goals</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>corecs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>pgss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>qssss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gssss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>the</span><span> </span><span class="entity"><span>corecs_args_types</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_conjunction_balanced</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_free_names</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
             </span><span class="entity"><span>mk_corec_transfer_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span>
               </span><span class="entity"><span>type_definitions</span></span><span> </span><span class="entity"><span>corec_defs</span></span><span> </span><span class="entity"><span>xtor_co_rec_transfers</span></span><span> </span><span class="entity"><span>pre_rel_defs</span></span><span>
               </span><span class="entity"><span>live_nesting_rel_eqs</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>pgss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pss</span></span><span> </span><span class="entity"><span>qssss</span></span><span> </span><span class="entity"><span>gssss</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span>
        </span><span>|&gt;</span><span> </span><span>Conjunction.elim_balanced</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>derive_map_o_corec_thmss</span></span><span> </span><span class="entity"><span>lthy0</span></span><span> </span><span class="entity"><span>lthy2</span></span><span> </span><span class="entity"><span>corecs</span></span><span> </span><span class="entity"><span>corec_defs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span>replicate</span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>variant_names</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>pre</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>Variable.variant_fixes</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>pre</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy0</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>maps0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>map_of_bnf</span></span><span> </span><span class="entity"><span>fp_bnfs</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>f_names</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>variant_names</span></span><span> </span><span class="entity"><span>num_As</span></span><span> </span><span class="inner_quoted"><span>"f"</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span>Free</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>f_names</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>As</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live_fs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>AList.find</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>liveness</span></span><span class="main"><span>)</span></span><span> </span><span>true</span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fmaps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_map</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>map0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>live_fs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>maps0</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>corec_arg_Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>binder_fun_types</span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>corecs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>num_rec_args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>corec_arg_Ts</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>g_names</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>variant_names</span></span><span> </span><span class="entity"><span>num_rec_args</span></span><span> </span><span class="inner_quoted"><span>"g"</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>gs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span>Free</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>g_names</span></span><span> </span><span class="entity"><span>corec_arg_Ts</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>gcorecs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>corecx</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>corecx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>corecs</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_o_corec_lhss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fmaps</span></span><span> </span><span class="entity"><span>gcorecs</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ABfs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>As</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Bs</span></span><span class="main"><span>)</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_map_o_corec_arg</span></span><span> </span><span class="entity"><span>corec_argB_T</span></span><span> </span><span class="entity"><span>g</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>range_type</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>g</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>range_type</span><span> </span><span class="entity"><span>corec_argB_T</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>U</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                </span><span class="entity"><span>g</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>build_map</span></span><span> </span><span class="entity"><span>lthy2</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span>o</span><span> </span><span>AList.lookup</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ABfs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>U</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>g</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_map_o_corec_rhs</span></span><span> </span><span class="entity"><span>corecx</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_map_o_corec_arg</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>B_ify_T</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>corec_arg_Ts</span></span><span> </span><span class="entity"><span>gs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>B_ify</span></span><span> </span><span class="entity"><span>corecx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_o_corec_rhss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_map_o_corec_rhs</span></span><span> </span><span class="entity"><span>corecs</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_o_corec_goals</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span>Logic.all</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>fs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>]</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>oo</span><span>
              </span><span>curry</span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>map_o_corec_lhss</span></span><span> </span><span class="entity"><span>map_o_corec_rhss</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_o_corec_thms</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>corec_def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>dtor_map_o_corec</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy2</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="entity"><span>mk_co_rec_o_map_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>corec_def</span></span><span> </span><span class="entity"><span>pre_map_defs</span></span><span> </span><span class="entity"><span>live_nesting_map_ident0s</span></span><span>
                    </span><span class="entity"><span>abs_inverses</span></span><span> </span><span class="entity"><span>dtor_map_o_corec</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>map_o_corec_goals</span></span><span> </span><span class="entity"><span>corec_defs</span></span><span> </span><span class="entity"><span>xtor_co_rec_o_maps</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span>map</span><span> </span><span>single</span><span> </span><span class="entity"><span>map_o_corec_thms</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>derive_note_coinduct_corecs_thms_for_types</span></span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>map_thmss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_disc_iffss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_selsss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_injectss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_distinctss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_selss</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>rel_intross</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_casess</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pred_injectss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_thmss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_selsssss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_introsssss</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>set_casess</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctr_transferss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>case_transferss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>disc_transferss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sel_transferss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctor_iff_dtors</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctr_defss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctr_sugars</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>corecs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>corec_defs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>coinduct_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>coinduct_thm</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>coinduct_strong_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>coinduct_strong_thm</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>coinduct_attrs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>common_coinduct_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
             </span><span class="entity"><span>corec_thmss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>corec_disc_thmss</span></span><span class="main"><span>,</span></span><span>
             </span><span class="main"><span>(</span></span><span class="entity"><span>corec_disc_iff_thmss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>corec_disc_iff_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>corec_sel_thmsss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>corec_sel_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>derive_coinduct_corecs_thms_for_types</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>pre_bnfs</span></span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="entity"><span>corecs_args_types</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xtor_co_induct</span></span><span>
            </span><span class="entity"><span>dtor_injects</span></span><span> </span><span class="entity"><span>dtor_ctors</span></span><span> </span><span class="entity"><span>xtor_co_rec_thms</span></span><span> </span><span class="entity"><span>live_nesting_bnfs</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>Xs</span></span><span> </span><span class="entity"><span>ctrXs_Tsss</span></span><span> </span><span class="entity"><span>kss</span></span><span> </span><span class="entity"><span>mss</span></span><span>
            </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>abs_inverses</span></span><span> </span><span class="entity"><span>abs_inverses</span></span><span> </span><span>I</span><span> </span><span class="entity"><span>ctr_defss</span></span><span> </span><span class="entity"><span>ctr_sugars</span></span><span> </span><span class="entity"><span>corecs</span></span><span> </span><span class="entity"><span>corec_defs</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>distinct_prems</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>Goal.prove</span><span> </span><span class="comment1"><span>(*no sorry*)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>|&gt;</span><span> </span><span>Thm.prop_of</span><span> </span><span>|&gt;</span><span> </span><span>Logic.strip_horn</span><span> </span><span>|&gt;&gt;</span><span> </span><span>distinct</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconv</span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>Logic.list_implies</span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span>cut_tac</span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>THEN'</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span>THEN</span><span> </span><span>ALLGOALS</span><span> </span><span>eq_assume_tac</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>eq_ifIN</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>eq_ifIN</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>distinct_prems</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../BNF_Fixpoint_Base.html#BNF_Fixpoint_Base.eq_ifI|fact"><span>eq_ifI</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span>
                </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../HOL.html#HOL.atomize_imp|fact"><span>atomize_imp</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="quoted"><span>"</span><span class="free"><span>t</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>u</span></span><span>"</span></span><span> </span><span class="quasi_keyword"><span class="quasi_keyword"><span>for</span></span></span><span> </span><span class="free"><span>t</span></span><span> </span><span class="free"><span>u</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>eq_ifIN</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>corec_code_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>eq_ifIN</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>corec_thmss</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>corec_sel_thmss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>flat</span><span> </span><span class="entity"><span>corec_sel_thmsss</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coinduct_type_attr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Attrib.internal</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span> </span><span>o</span><span> </span><span>K</span><span> </span><span>o</span><span> </span><span class="entity"><span>Induct.coinduct_type</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>coinduct_pred_attr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Attrib.internal</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span> </span><span>o</span><span> </span><span>K</span><span> </span><span>o</span><span> </span><span class="entity"><span>Induct.coinduct_pred</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>flat_corec_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>append</span><span> </span><span>oo</span><span> </span><span>append</span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>corec_transfer_thmss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>single</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>derive_corec_transfer_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>corecs</span></span><span> </span><span class="entity"><span>corec_defs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>rel_coinduct_thmss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>common_rel_coinduct_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
             </span><span class="main"><span>(</span></span><span class="entity"><span>rel_coinduct_attrs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>common_rel_coinduct_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>rel_coinduct_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>common_rel_coinduct_thm</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                   </span><span class="main"><span>(</span></span><span class="entity"><span>rel_coinduct_attrs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>common_rel_coinduct_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="entity"><span>derive_rel_coinduct_thms_for_types</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>mss</span></span><span> </span><span class="entity"><span>ctr_sugars</span></span><span> </span><span class="entity"><span>abs_inverses</span></span><span>
                  </span><span class="entity"><span>abs_injects</span></span><span> </span><span class="entity"><span>ctor_injects</span></span><span> </span><span class="entity"><span>dtor_ctors</span></span><span> </span><span class="entity"><span>pre_rel_defs</span></span><span> </span><span class="entity"><span>ctr_defss</span></span><span> </span><span class="entity"><span>xtor_rel_co_induct</span></span><span>
                  </span><span class="entity"><span>live_nesting_rel_eqs</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>map</span><span> </span><span>single</span><span> </span><span class="entity"><span>rel_coinduct_thms</span></span><span class="main"><span>,</span></span><span> </span><span>single</span><span> </span><span class="entity"><span>common_rel_coinduct_thm</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
               </span><span class="main"><span>(</span></span><span class="entity"><span>rel_coinduct_attrs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>common_rel_coinduct_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_o_corec_thmss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>derive_map_o_corec_thmss</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>corecs</span></span><span> </span><span class="entity"><span>corec_defs</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_induct_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_induct_attrss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>derive_set_induct_thms_for_types</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>ctrs </span><span class="entity"><span>ctr_sugars</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_set</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>sets_of_bnf</span></span><span> </span><span class="entity"><span>fp_bnfs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dtor_set_inducts</span></span><span>
            </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>exhaust </span><span class="entity"><span>ctr_sugars</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>pre_set_defss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>ctr_defss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dtor_ctors</span></span><span> </span><span class="entity"><span>abs_inverses</span></span><span>
          </span><span>|&gt;</span><span> </span><span>split_list</span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>simp_thmss</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_simp_thms</span></span><span> </span><span class="entity"><span>ctr_sugars</span></span><span>
            </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>flat_corec_thms</span></span><span> </span><span class="entity"><span>corec_disc_thmss</span></span><span> </span><span class="entity"><span>corec_disc_iff_thmss</span></span><span> </span><span class="entity"><span>corec_sel_thmss</span></span><span class="main"><span>)</span></span><span>
            </span><span class="entity"><span>map_thmss</span></span><span> </span><span class="entity"><span>rel_injectss</span></span><span> </span><span class="entity"><span>rel_distinctss</span></span><span> </span><span class="entity"><span>set_thmss</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>common_notes</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>set_inductN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_induct_thms</span></span><span class="main"><span>,</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>set_induct_attrss</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>coinductN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>coinduct_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="entity"><span>common_coinduct_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
             </span><span class="main"><span>(</span></span><span class="entity"><span>coinduct_strongN</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>coinduct_strong_thm</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="entity"><span>common_coinduct_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
             </span><span class="main"><span>(</span></span><span class="entity"><span>rel_coinductN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>common_rel_coinduct_thms</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="entity"><span>common_rel_coinduct_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>massage_simple_notes</span></span><span> </span><span class="entity"><span>fp_common_name</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>notes</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>coinductN</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span>single</span><span> </span><span class="entity"><span>coinduct_thms</span></span><span class="main"><span>,</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T_name</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>coinduct_attrs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>coinduct_type_attr</span></span><span> </span><span class="entity"><span>T_name</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>coinduct_strongN</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span>single</span><span> </span><span class="entity"><span>coinduct_strong_thms</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="entity"><span>coinduct_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>corecN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>corec_thmss</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>corec_codeN</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span>single</span><span> </span><span class="entity"><span>corec_code_thms</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nitpicksimp_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>corec_discN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>corec_disc_thmss</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>corec_disc_iffN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>corec_disc_iff_thmss</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="entity"><span>corec_disc_iff_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>corec_selN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>corec_sel_thmss</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="entity"><span>corec_sel_attrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>corec_transferN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>corec_transfer_thmss</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>map_o_corecN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_o_corec_thmss</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>rel_coinductN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_coinduct_thmss</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_coinduct_attrs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>coinduct_pred_attr</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>simpsN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>simp_thmss</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>massage_multi_notes</span></span><span> </span><span class="entity"><span>fp_b_names</span></span><span> </span><span class="entity"><span>fpTs</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>lthy</span></span><span>
        </span><span>|&gt;</span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Spec_Rules.add</span></span><span> </span><span>Binding.empty</span><span> </span><span class="entity"><span>Spec_Rules.equational</span></span><span> </span><span class="entity"><span>corecs</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>[</span></span><span>flat</span><span> </span><span class="entity"><span>corec_sel_thmss</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>corec_thmss</span></span><span class="main"><span>]</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="entity"><span>plugins</span></span><span> </span><span class="entity"><span>code_plugin</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>Code.declare_default_eqns</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>rpair</span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>corec_code_thms</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Local_Theory.notes</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>common_notes</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>notes</span></span><span class="main"><span>)</span></span><span>
        </span><span>|-&gt;</span><span> </span><span class="entity"><span>interpret_bnfs_register_fp_sugars</span></span><span> </span><span class="entity"><span>plugins</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="entity"><span>fpBTs</span></span><span> </span><span class="entity"><span>Xs</span></span><span> </span><span class="entity"><span>Greatest_FP</span></span><span> </span><span class="entity"><span>pre_bnfs</span></span><span> </span><span class="entity"><span>absT_infos</span></span><span>
          </span><span class="entity"><span>fp_nesting_bnfs</span></span><span> </span><span class="entity"><span>live_nesting_bnfs</span></span><span> </span><span class="entity"><span>fp_res</span></span><span> </span><span class="entity"><span>ctrXs_Tsss</span></span><span> </span><span class="entity"><span>ctor_iff_dtors</span></span><span> </span><span class="entity"><span>ctr_defss</span></span><span> </span><span class="entity"><span>ctr_sugars</span></span><span>
          </span><span class="entity"><span>corecs</span></span><span> </span><span class="entity"><span>corec_defs</span></span><span> </span><span class="entity"><span>map_thmss</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>coinduct_thm</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>coinduct_strong_thm</span></span><span class="main"><span>]</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>coinduct_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>coinduct_strong_thms</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>corec_thmss</span></span><span> </span><span class="entity"><span>corec_disc_thmss</span></span><span>
          </span><span class="entity"><span>corec_sel_thmsss</span></span><span> </span><span class="entity"><span>rel_injectss</span></span><span> </span><span class="entity"><span>rel_distinctss</span></span><span> </span><span class="entity"><span>map_disc_iffss</span></span><span> </span><span class="entity"><span>map_selsss</span></span><span> </span><span class="entity"><span>rel_selss</span></span><span>
          </span><span class="entity"><span>rel_intross</span></span><span> </span><span class="entity"><span>rel_casess</span></span><span> </span><span class="entity"><span>pred_injectss</span></span><span> </span><span class="entity"><span>set_thmss</span></span><span> </span><span class="entity"><span>set_selsssss</span></span><span> </span><span class="entity"><span>set_introsssss</span></span><span> </span><span class="entity"><span>set_casess</span></span><span>
          </span><span class="entity"><span>ctr_transferss</span></span><span> </span><span class="entity"><span>case_transferss</span></span><span> </span><span class="entity"><span>disc_transferss</span></span><span> </span><span class="entity"><span>sel_transferss</span></span><span> </span><span class="entity"><span>corec_disc_iff_thmss</span></span><span>
          </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>single</span><span> </span><span class="entity"><span>corec_code_thms</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>corec_transfer_thmss</span></span><span> </span><span class="entity"><span>common_rel_coinduct_thms</span></span><span>
          </span><span class="entity"><span>rel_coinduct_thmss</span></span><span> </span><span class="entity"><span>set_induct_thms</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>nn</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>set_induct_thms</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>map_o_corec_thmss</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>live</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span>?</span><span> </span><span>fold2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>register_bnf_raw</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>bnf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="entity"><span>fp_bnfs</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 29</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>define_ctrs_dtrs_for_type_etc</span></span><span> </span><span class="entity"><span>fp_bnfs</span></span><span> </span><span class="entity"><span>fp_bs</span></span><span> </span><span class="entity"><span>fpTs</span></span><span> </span><span class="entity"><span>Cs</span></span><span> </span><span class="entity"><span>Es</span></span><span> </span><span class="entity"><span>ctors</span></span><span> </span><span class="entity"><span>dtors</span></span><span>
        </span><span class="entity"><span>xtor_co_recs</span></span><span> </span><span class="entity"><span>ctor_dtors</span></span><span> </span><span class="entity"><span>dtor_ctors</span></span><span> </span><span class="entity"><span>ctor_injects</span></span><span> </span><span class="entity"><span>pre_map_defs</span></span><span> </span><span class="entity"><span>pre_set_defss</span></span><span> </span><span class="entity"><span>pre_rel_defs</span></span><span>
        </span><span class="entity"><span>xtor_maps</span></span><span> </span><span class="entity"><span>xtor_setss</span></span><span> </span><span class="entity"><span>xtor_rels</span></span><span> </span><span class="entity"><span>ns</span></span><span> </span><span class="entity"><span>kss</span></span><span> </span><span class="entity"><span>mss</span></span><span> </span><span class="entity"><span>abss</span></span><span> </span><span class="entity"><span>abs_injects</span></span><span> </span><span class="entity"><span>type_definitions</span></span><span> </span><span class="entity"><span>ctr_bindingss</span></span><span>
        </span><span class="entity"><span>ctr_mixfixess</span></span><span> </span><span class="entity"><span>ctr_Tsss</span></span><span> </span><span class="entity"><span>disc_bindingss</span></span><span> </span><span class="entity"><span>sel_bindingsss</span></span><span> </span><span class="entity"><span>raw_sel_default_eqss</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>wrap_ctrs_derive_map_set_rel_pred_thms_define_co_rec_for_types</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>case_fp</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="entity"><span>derive_note_induct_recs_thms_for_types</span></span><span>
        </span><span class="entity"><span>derive_note_coinduct_corecs_thms_for_types</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>time</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timer</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Constructors, discriminators, selectors, etc., for the new "</span></span><span> </span><span>^</span><span>
      </span><span class="entity"><span>co_prefix</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"datatype"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>lthy</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>co_datatypes</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>define_co_datatypes</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>I</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>I</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>I</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>I</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fp</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>co_datatype_cmd</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="entity"><span>construct_fp</span></span><span> </span><span class="entity"><span>options</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>define_co_datatypes</span></span><span> </span><span class="entity"><span>Plugin_Name.make_filter</span></span><span> </span><span class="entity"><span>Typedecl.read_constraint</span></span><span> </span><span>Syntax.parse_typ</span><span>
    </span><span>Syntax.parse_term</span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="entity"><span>construct_fp</span></span><span> </span><span class="entity"><span>options</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
  </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span class="entity"><span>EMPTY_DATATYPE</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Cannot define empty datatype "</span></span><span> </span><span>^</span><span> </span><span>quote</span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parse_ctr_arg</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword2"><span>(</span></span><span>›</span></span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_binding_colon</span></span><span> </span><span>--</span><span> </span><span>Parse.typ</span><span> </span><span>--|</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword2"><span>)</span></span><span>›</span></span></span><span>
  </span><span>||</span><span> </span><span>Parse.typ</span><span> </span><span>&gt;&gt;</span><span> </span><span>pair</span><span> </span><span>Binding.empty</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parse_ctr_specs</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Parse.enum1</span><span> </span><span class="inner_quoted"><span>"|"</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>parse_ctr_spec</span></span><span> </span><span>Parse.binding</span><span> </span><span class="entity"><span>parse_ctr_arg</span></span><span> </span><span>--</span><span> </span><span>Parse.opt_mixfix</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parse_spec</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>parse_type_args_named_constrained</span></span><span> </span><span>--</span><span> </span><span>Parse.binding</span><span> </span><span>--</span><span> </span><span>Parse.opt_mixfix</span><span> </span><span>--</span><span>
  </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword2"><span>=</span></span><span>›</span></span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_ctr_specs</span></span><span class="main"><span>)</span></span><span> </span><span>--</span><span> </span><span class="entity"><span>parse_map_rel_pred_bindings</span></span><span> </span><span>--</span><span> </span><span class="entity"><span>parse_sel_default_eqs</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parse_co_datatype</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>parse_ctr_options</span></span><span> </span><span>--</span><span> </span><span>Parse.and_list1</span><span> </span><span class="entity"><span>parse_spec</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_co_datatype_cmd</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="entity"><span>construct_fp</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>parse_co_datatype</span></span><span> </span><span>&gt;&gt;</span><span> </span><span class="entity"><span>co_datatype_cmd</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="entity"><span>construct_fp</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span></pre>
</body>

</html>