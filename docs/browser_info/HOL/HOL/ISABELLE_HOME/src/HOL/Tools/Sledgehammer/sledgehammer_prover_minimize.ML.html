<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Tools/Sledgehammer/sledgehammer_prover_minimize.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Tools/Sledgehammer/sledgehammer_prover_minimize.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      HOL/Tools/Sledgehammer/sledgehammer_prover_minimize.ML
    Author:     Philipp Meyer, TU Muenchen
    Author:     Jasmin Blanchette, TU Muenchen

Minimization of fact list for Metis using external provers.
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>SLEDGEHAMMER_PROVER_MINIMIZE</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>stature</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ATP_Problem_Generate.stature</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>proof_method</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Sledgehammer_Proof_Methods.proof_method</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>play_outcome</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Sledgehammer_Proof_Methods.play_outcome</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Sledgehammer_Prover.mode</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Sledgehammer_Prover.params</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>prover</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Sledgehammer_Prover.prover</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>prover_slice</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Sledgehammer_Prover.prover_slice</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_prover_supported </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> is_prover_installed </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> get_prover </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>prover</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> get_slices </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>prover_slice</span></span><span> </span><span>list</span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> binary_min_facts </span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>Config.T</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> minimize_facts </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>unit</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>prover_slice</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.state</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>string</span><span> * </span><span class="entity"><span>stature</span></span><span class="main"><span>)</span></span><span> * </span><span>thm</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>string</span><span> * </span><span class="entity"><span>stature</span></span><span class="main"><span>)</span></span><span> * </span><span>thm</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span>option</span><span>
    * </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>unit</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span class="entity"><span>stature</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span> * </span><span class="main"><span>(</span></span><span class="entity"><span>proof_method</span></span><span> * </span><span class="entity"><span>play_outcome</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> get_minimizing_prover </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>unit</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>prover</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Sledgehammer_Prover_Minimize</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>SLEDGEHAMMER_PROVER_MINIMIZE</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>ATP_Util</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>ATP_Proof</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>ATP_Problem_Generate</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>ATP_Proof_Reconstruct</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Sledgehammer_Util</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Sledgehammer_Fact</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Sledgehammer_Proof_Methods</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Sledgehammer_Isar</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Sledgehammer_ATP_Systems</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Sledgehammer_Prover</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Sledgehammer_Prover_ATP</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Sledgehammer_Prover_SMT</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_prover_supported</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>is_atp</span></span><span> </span><span>orf</span><span> </span><span class="entity"><span>is_smt_prover</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_prover_installed</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prover_name</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_atp</span></span><span> </span><span class="entity"><span>prover_name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="entity"><span>is_atp_installed</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>prover_name</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
    </span><span class="entity"><span>is_smt_prover_installed</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prover_name</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>get_prover</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_atp</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>run_atp</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="entity"><span>name</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_smt_prover</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>run_smt_solver</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="entity"><span>name</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"No such prover: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>get_slices</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_atp</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span class="entity"><span>ATP_Slice</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>good_slices </span><span class="main"><span>(</span></span><span class="entity"><span>get_atp</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_smt_prover</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span class="entity"><span>SMT_Slice</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>SMT_Solver.good_slices</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"No such prover: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="comment1"><span>(* wrapper for calling external prover *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>n_facts</span></span><span> </span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>names</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span>string_of_int</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" fact"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>plural_s</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span>^</span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>": "</span></span><span> </span><span>^</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>fst</span><span> </span><span>|&gt;</span><span> </span><span>sort</span><span> </span><span>string_ord</span><span> </span><span>|&gt;</span><span> </span><span>space_implode</span><span> </span><span class="inner_quoted"><span>" "</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print</span></span><span> </span><span class="entity"><span>silent</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>silent</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>writeln</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>test_facts</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="entity"><span>debug</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>verbose</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>overlord</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>spy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>provers</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_mono_iters</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_new_mono_instances</span></span><span class="main"><span>,</span></span><span>
      </span><span class="entity"><span>type_enc</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>strict</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lam_trans</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>uncurried_aliases</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>isar_proofs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>compress</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>try0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>smt_proofs</span></span><span class="main"><span>,</span></span><span>
      </span><span class="entity"><span>minimize</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>preplay_timeout</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>induction_rules</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>slice</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>falsify</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fact_filter</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>slice_extra</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>silent</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prover</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>prover</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>n</span></span><span>
    </span><span class="entity"><span>state</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="entity"><span>facts</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>print</span></span><span> </span><span class="entity"><span>silent</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"Testing "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>n_facts</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>verbose</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>" (timeout: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_of_time</span></span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"..."</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>facts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>facts</span></span><span> </span><span>|&gt;</span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ths</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>pair</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ths</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>{</span></span><span>debug </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>debug</span></span><span class="main"><span>,</span></span><span> verbose </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>verbose</span></span><span class="main"><span>,</span></span><span> overlord </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>overlord</span></span><span class="main"><span>,</span></span><span> spy </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>spy</span></span><span class="main"><span>,</span></span><span> provers </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>provers</span></span><span class="main"><span>,</span></span><span>
       type_enc </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>type_enc</span></span><span class="main"><span>,</span></span><span> abduce </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> falsify </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span>false</span><span class="main"><span>,</span></span><span> strict </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>strict</span></span><span class="main"><span>,</span></span><span>
       lam_trans </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lam_trans</span></span><span class="main"><span>,</span></span><span> uncurried_aliases </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>uncurried_aliases</span></span><span class="main"><span>,</span></span><span> learn </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span>
       fact_filter </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> induction_rules </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>induction_rules</span></span><span class="main"><span>,</span></span><span> max_facts </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       fact_thresholds </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1.01</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>1.01</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> max_mono_iters </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>max_mono_iters</span></span><span class="main"><span>,</span></span><span>
       max_new_mono_instances </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>max_new_mono_instances</span></span><span class="main"><span>,</span></span><span> max_proofs </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span>
       isar_proofs </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>isar_proofs</span></span><span class="main"><span>,</span></span><span> compress </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>compress</span></span><span class="main"><span>,</span></span><span> try0 </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>try0</span></span><span class="main"><span>,</span></span><span> smt_proofs </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>smt_proofs</span></span><span class="main"><span>,</span></span><span>
       minimize </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>minimize</span></span><span class="main"><span>,</span></span><span> slices </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> timeout </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>timeout</span></span><span class="main"><span>,</span></span><span> preplay_timeout </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>preplay_timeout</span></span><span class="main"><span>,</span></span><span>
       expect </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>}</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>{</span></span><span>comment </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> state </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>state</span></span><span class="main"><span>,</span></span><span> goal </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>goal</span></span><span class="main"><span>,</span></span><span> subgoal </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> subgoal_count </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span>
       factss </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> has_already_found_something </span><span class="main"><span>=</span></span><span> </span><span>K</span><span> </span><span>false</span><span class="main"><span>,</span></span><span> found_something </span><span class="main"><span>=</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>}</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>result0</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span>outcome </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>outcome0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>used_facts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>used_from</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>preferred_methss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>run_time</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>message</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>prover</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>facts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fact_filter</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>slice_extra</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>result</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>outcome</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>is_none</span><span> </span><span class="entity"><span>outcome0</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
         </span><span>forall</span><span> </span><span class="main"><span>(</span></span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>s'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>s'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>used_from</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>used_facts</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="entity"><span>result0</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span class="main"><span>{</span></span><span>outcome </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>MaybeUnprovable</span></span><span class="main"><span>,</span></span><span> used_facts </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> used_from </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>used_from</span></span><span class="main"><span>,</span></span><span>
         preferred_methss </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>preferred_methss</span></span><span class="main"><span>,</span></span><span> run_time </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>run_time</span></span><span class="main"><span>,</span></span><span> message </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>message</span></span><span class="main"><span>}</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>print</span></span><span> </span><span class="entity"><span>silent</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>outcome</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span>SOME</span><span> </span><span class="entity"><span>failure</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>string_of_atp_failure</span></span><span> </span><span class="entity"><span>failure</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="inner_quoted"><span>"Found "</span></span><span> </span><span>^</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>falsify</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"falsification"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"proof"</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
         </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>used_facts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>facts</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>" with "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>n_facts</span></span><span> </span><span class="entity"><span>used_facts</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
         </span><span class="inner_quoted"><span>" ("</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>string_of_time</span></span><span> </span><span class="entity"><span>run_time</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="entity"><span>result</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="comment1"><span>(* Give the external prover some slack. The ATP gets further slack because the
   Sledgehammer preprocessing time is included in the estimate below but isn't
   part of the timeout. *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>slack_msecs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>200</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>new_timeout</span></span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span class="entity"><span>run_time</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Int.min</span><span> </span><span class="main"><span>(</span></span><span>Time.toMilliseconds</span><span> </span><span class="entity"><span>timeout</span></span><span class="main"><span>,</span></span><span> </span><span>Time.toMilliseconds</span><span> </span><span class="entity"><span>run_time</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>slack_msecs</span></span><span class="main"><span>)</span></span><span>
  </span><span>|&gt;</span><span> </span><span>Time.fromMilliseconds</span><span>

</span><span class="comment1"><span>(* The linear algorithm usually outperforms the binary algorithm when over 60%
   of the facts are actually needed. The binary algorithm is much more
   appropriate for provers that cannot return the list of used facts and hence
   returns all facts as used. Since we cannot know in advance how many facts are
   actually needed, we heuristically set the threshold to 10 facts. *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>binary_min_facts</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Attrib.setup_config_int</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="entity_def" id="Sledgehammer.sledgehammer_minimize_binary_min_facts|attribute"><span>sledgehammer_minimize_binary_min_facts</span></span><span>›</span></span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="inner_numeral"><span>20</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>linear_minimize</span></span><span> </span><span class="entity"><span>test</span></span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span class="entity"><span>result</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>min</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>p</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>min</span></span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>seen</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>result</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>test</span></span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>seen</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span class="entity"><span>result</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span>outcome </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>used_facts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>run_time</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>prover_result</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>min</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>new_timeout</span></span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span class="entity"><span>run_time</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>filter_used_facts</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>used_facts</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>filter_used_facts</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>used_facts</span></span><span> </span><span class="entity"><span>seen</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>result</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>min</span></span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>seen</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>result</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>min</span></span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>result</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>binary_minimize</span></span><span> </span><span class="entity"><span>test</span></span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span class="entity"><span>result</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>min</span></span><span> </span><span class="entity"><span>depth</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>result</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>run_time</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>prover_result</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sup</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xs</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>chop</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>xs</span></span><span> </span><span>div</span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span>
</span><span class="comment1"><span>(*
          val _ = warning (replicate_string depth " " ^ "{ " ^ "sup: " ^ n_facts (map fst sup))
          val _ = warning (replicate_string depth " " ^ " " ^ "xs: " ^ n_facts (map fst xs))
          val _ = warning (replicate_string depth " " ^ " " ^ "l0: " ^ n_facts (map fst l0))
          val _ = warning (replicate_string depth " " ^ " " ^ "r0: " ^ n_facts (map fst r0))
*)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>depth</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>depth</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>new_timeout</span></span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span class="entity"><span>run_time</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>test</span></span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sup</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>l0</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span class="entity"><span>result</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span>outcome </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>used_facts</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="entity"><span>min</span></span><span> </span><span class="entity"><span>depth</span></span><span> </span><span class="entity"><span>result</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>filter_used_facts</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>used_facts</span></span><span> </span><span class="entity"><span>sup</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>filter_used_facts</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>used_facts</span></span><span> </span><span class="entity"><span>l0</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>test</span></span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sup</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>r0</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
              </span><span class="entity"><span>result</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span>outcome </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>used_facts</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="entity"><span>min</span></span><span> </span><span class="entity"><span>depth</span></span><span> </span><span class="entity"><span>result</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>filter_used_facts</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>used_facts</span></span><span> </span><span class="entity"><span>sup</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>filter_used_facts</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>used_facts</span></span><span> </span><span class="entity"><span>r0</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sup_r0</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>result</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>min</span></span><span> </span><span class="entity"><span>depth</span></span><span> </span><span class="entity"><span>result</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sup</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>r0</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>l0</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sup</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sup</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r0</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>filter_used_facts</span></span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>sup_r0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sup_l</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>result</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>min</span></span><span> </span><span class="entity"><span>depth</span></span><span> </span><span class="entity"><span>result</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sup</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>l</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>r0</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sup</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sup</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>filter_used_facts</span></span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>sup_l</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sup</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>result</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span><span class="comment1"><span>(*
        |&gt; tap (fn _ =&gt; warning (replicate_string depth " " ^ "}"))
*)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>min</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>result</span></span><span> </span><span class="entity"><span>sup</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sup</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>result</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>snd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>min</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="entity"><span>result</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>result</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>run_time</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>test</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>new_timeout</span></span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span class="entity"><span>run_time</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span class="entity"><span>result</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span>outcome </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>result</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>result</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>minimize_facts</span></span><span> </span><span class="entity"><span>do_learn</span></span><span> </span><span class="entity"><span>prover_name</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>params</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>learn</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>timeout</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>slice</span></span><span> </span><span class="entity"><span>silent</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>state</span></span><span>
    </span><span class="entity"><span>goal</span></span><span> </span><span class="entity"><span>facts</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Proof.context_of</span></span><span> </span><span class="entity"><span>state</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prover</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>get_prover</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Minimize</span></span><span> </span><span class="entity"><span>prover_name</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>chained</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>non_chained</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>List.partition</span><span> </span><span class="entity"><span>is_fact_chained</span></span><span> </span><span class="entity"><span>facts</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>test</span></span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span class="entity"><span>non_chained</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>test_facts</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>slice</span></span><span> </span><span class="entity"><span>silent</span></span><span> </span><span class="entity"><span>prover</span></span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>state</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>chained</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>non_chained</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>print</span></span><span> </span><span class="entity"><span>silent</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"Sledgehammer minimizer: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>prover_name</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
     </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>test</span></span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span class="entity"><span>non_chained</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
       </span><span class="entity"><span>result</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span>outcome </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>used_facts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>run_time</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
         </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>non_chained</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>filter_used_facts</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>used_facts</span></span><span> </span><span class="entity"><span>non_chained</span></span><span>
         </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>min</span></span><span> </span><span class="main"><span>=</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>non_chained</span></span><span> </span><span>&gt;=</span><span> </span><span>Config.get</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>binary_min_facts</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>binary_minimize</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>linear_minimize</span></span><span>
         </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>min_facts</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>message</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
           </span><span class="entity"><span>min</span></span><span> </span><span class="entity"><span>test</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>new_timeout</span></span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span class="entity"><span>run_time</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>result</span></span><span> </span><span class="entity"><span>non_chained</span></span><span>
         </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>min_facts_and_chained</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>chained</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>min_facts</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
         </span><span class="entity"><span>print</span></span><span> </span><span class="entity"><span>silent</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>cat_lines</span><span>
           </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"Minimized to "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>n_facts</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>min_facts</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span>^</span><span>
            </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>chained</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
              </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>" (plus "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" chained)"</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
         </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>learn</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>do_learn</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span>snd</span><span> </span><span class="entity"><span>min_facts_and_chained</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
         </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>min_facts_and_chained</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>message</span></span><span class="main"><span>)</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>{</span></span><span>outcome </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>TimedOut</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
       </span><span class="main"><span>(</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="inner_quoted"><span>"Timeout: You can increase the time limit using the \"timeout\" option (e.g., \
          \timeout = "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>10</span></span><span> </span><span>+</span><span> </span><span>Time.toMilliseconds</span><span> </span><span class="entity"><span>timeout</span></span><span> </span><span>div</span><span> </span><span class="inner_numeral"><span>1000</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"\")"</span></span><span class="main"><span>)</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>message</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span>prefix</span><span> </span><span class="inner_quoted"><span>"Prover error: "</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>message</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>ERROR</span><span> </span><span class="entity"><span>msg</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"Warning: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>msg</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>maybe_minimize</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="entity"><span>do_learn</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>params</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>verbose</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>minimize</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="entity"><span>state</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>goal</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>subgoal</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>subgoal_count</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>prover_problem</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>slice</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>result</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>outcome</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>used_facts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>used_from</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>preferred_methss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>run_time</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>message</span></span><span class="main"><span>}</span></span><span>
     </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>prover_result</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>is_some</span><span> </span><span class="entity"><span>outcome</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
    </span><span class="entity"><span>result</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>used_facts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>message</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>minimize</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="entity"><span>minimize_facts</span></span><span> </span><span class="entity"><span>do_learn</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>slice</span></span><span>
            </span><span class="main"><span>(</span></span><span>not</span><span> </span><span class="entity"><span>verbose</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mode</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="entity"><span>Normal</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span>&lt;&gt;</span><span> </span><span class="entity"><span>MaSh</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>subgoal</span></span><span> </span><span class="entity"><span>subgoal_count</span></span><span> </span><span class="entity"><span>state</span></span><span>
            </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>filter_used_facts</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>used_facts</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span>single</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>used_from</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;&gt;</span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
          </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>used_facts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>message</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>used_facts</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span>SOME</span><span> </span><span class="entity"><span>used_facts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="main"><span>{</span></span><span>outcome </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> used_facts </span><span class="main"><span>=</span></span><span> </span><span>sort_by</span><span> </span><span>fst</span><span> </span><span class="entity"><span>used_facts</span></span><span class="main"><span>,</span></span><span> used_from </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>used_from</span></span><span class="main"><span>,</span></span><span>
         preferred_methss </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>preferred_methss</span></span><span class="main"><span>,</span></span><span> run_time </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>run_time</span></span><span class="main"><span>,</span></span><span> message </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>message</span></span><span class="main"><span>}</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>result</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>get_minimizing_prover</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="entity"><span>do_learn</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="entity"><span>slice</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>get_prover</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="entity"><span>slice</span></span><span>
  </span><span>|&gt;</span><span> </span><span class="entity"><span>maybe_minimize</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="entity"><span>do_learn</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>problem</span></span><span> </span><span class="entity"><span>slice</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span></pre>
</body>

</html>