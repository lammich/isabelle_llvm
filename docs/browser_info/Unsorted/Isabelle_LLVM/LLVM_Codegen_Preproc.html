<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory LLVM_Codegen_Preproc</title>
</head>


<body>
<div class="head">
<h1>Theory LLVM_Codegen_Preproc</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Preprocessor and Code-Generator User Interface›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>theory</span></span></span><span> </span><a href="LLVM_Codegen_Preproc.html"><span>LLVM_Codegen_Preproc</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>imports</span></span></span><span> 
  </span><span class="quoted"><span>"</span><a href="LLVM_Codegen.html"><span>../kernel/LLVM_Codegen</span></a><span>"</span></span><span>
  </span><span class="quoted"><span>"</span><a href="Monadify.html"><span>Monadify</span></a><span>"</span></span><span>
  </span><span class="quoted"><span>"</span><a href="Definition_Utils.html"><span>../../lib/Definition_Utils</span></a><span>"</span></span><span> 
  </span><span class="quoted"><span>"</span><a href="Named_Simpsets.html"><span>../../lib/Named_Simpsets</span></a><span>"</span></span><span> 
</span><span class="keyword2"><span class="keyword"><span>keywords</span></span></span><span> </span><span class="quoted"><span>"export_llvm"</span></span><span> </span><span class="quoted"><span>"llvm_deps"</span></span><span> </span><span class="main"><span>::</span></span><span> thy_decl
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Fixed-Point Unfolding Setup›</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>declaration</span></span></span><span> </span><span class="quoted"><span>‹</span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Definition_Utils.declare_extraction_group</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>binding</span></span><span> </span><span>LLVM</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>#&gt;</span><span> </span><span>snd</span><span>›</span></span><span>
  </span><span class="keyword1"><span class="command"><span>declaration</span></span></span><span> </span><span class="quoted"><span>‹</span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Definition_Utils.declare_extraction_group</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>binding</span></span><span> </span><span>LLVM_while</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>#&gt;</span><span> </span><span>snd</span><span>›</span></span><span>
    
  </span><span class="keyword1"><span class="command"><span>declaration</span></span></span><span> </span><span class="quoted"><span>‹ </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="entity"><span>Definition_Utils.add_extraction</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>extraction_group</span></span><span> </span><span>LLVM_while</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>{</span></span><span>
      pattern </span><span class="main"><span>=</span></span><span> </span><span>Logic.varify_global</span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.llc_while|const"><span>llc_while</span></a><span> </span><span class="free"><span>b</span></span><span> </span><span class="free"><span>body</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span>
      gen_thm </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.gen_code_thm_llc_while|fact"><span>gen_code_thm_llc_while</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
      gen_tac </span><span class="main"><span>=</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>no_tac</span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>}</span></span><span>
  ›</span></span><span>

  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.REC_unfold_extr|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.REC_unfold_extr|thm"><span>REC_unfold_extr</span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_772..775">DEF</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>f</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="MMonad.html#MMonad.REC|const"><span>REC</span></a><span> </span><span class="free"><span>F</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_801..805">MONO</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="MMonad.html#MMonad.M_mono&apos;|const"><span>M_mono'</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>fa</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>fa</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>f</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="free"><span>f</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#offset_772..775"><span>DEF</span></a><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#offset_801..805"><span>MONO</span></a><span> </span><a class="entity_ref" href="MMonad.html#MMonad.REC_unfold|fact"><span>REC_unfold</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
  
  </span><span class="keyword1"><span class="command"><span>declaration</span></span></span><span> </span><span class="quoted"><span>‹</span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="entity"><span>Definition_Utils.add_extraction</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>extraction_group</span></span><span> </span><span>LLVM</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>{</span></span><span>
      pattern </span><span class="main"><span>=</span></span><span> </span><span>Logic.varify_global</span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="MMonad.html#MMonad.REC|const"><span>REC</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>B</span></span><span class="main"><span>::</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llM|type"><span>llM</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llM|type"><span>llM</span></a><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span>
      gen_thm </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.REC_unfold_extr|fact"><span>REC_unfold_extr</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
      gen_tac </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Partial_Function.mono_tac</span></span><span>
    </span><span class="main"><span>}</span></span><span>
  ›</span></span><span>

</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Preprocessor›</span></span></span><span>  
  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹
    The actual code generator expects a set of monomorphic, well-shaped equations.
    The preprocessor processes user specified equations, monomorphizes them and 
    brings them into the right shape.
  ›</span></span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>named_simpset</span></span></span><span> </span><span>llvm_pre_simp</span><span> </span><span class="main"><span>=</span></span><span> </span><span>HOL_ss</span><span>

  </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="USER_HOME/devel/isabelle/isabelle_llvm_2023/thys/lib/named_simpsets.ML.html#Named_Simpsets.named_ss|attribute"><span class="operator"><span>named_ss</span></span></a><span> </span><span>llvm_pre_simp</span><span> </span><span class="quasi_keyword"><span>cong</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Monadify.html#Monadify.M_CONST|const"><span>M_CONST</span></a><span> </span><span class="free"><span>c</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span>for</span></span></span></span><span> </span><span class="free"><span>c</span></span><span class="main"><span>]</span></span><span>

  </span><span class="comment1"><span>(* TODO: Also add preprocessing step for complex constant defs *)</span></span><span>  
  </span><span class="keyword1"><span class="command"><span>attribute_setup</span></span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.llvm_pre_simp|attribute"><span>llvm_pre_simp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹
    </span><span class="entity"><span>Attrib.add_del</span></span><span> 
      </span><span class="main"><span>(</span></span><span class="entity"><span>Named_Simpsets.add_attr</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_simpset</span></span><span> </span><span>llvm_pre_simp</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span> 
      </span><span class="main"><span>(</span></span><span class="entity"><span>Named_Simpsets.del_attr</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_simpset</span></span><span> </span><span>llvm_pre_simp</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span>
  ›</span></span><span>
    
  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.llvm_inline_bind_laws|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.llvm_inline_bind_laws(2)|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.llvm_inline_bind_laws(1)|thm"><span>llvm_inline_bind_laws</span></span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_pre_simp|attribute"><span class="operator"><span>llvm_pre_simp</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="MMonad.html#MMonad.Mbind|const"><span>Mbind</span></a><span> </span><span class="free"><span>m</span></span><span> </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>m</span></span><span>"</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="MMonad.html#MMonad.Mbind|const"><span>Mbind</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="MMonad.html#MMonad.Mbind|const"><span>Mbind</span></a><span> </span><span class="free"><span>m</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>g</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="MMonad.html#MMonad.Mbind|const"><span>Mbind</span></a><span> </span><span class="free"><span>m</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="MMonad.html#MMonad.Mbind|const"><span>Mbind</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.unit_meta_eq|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.unit_meta_eq|thm"><span>unit_meta_eq</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>x</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Unity|const"><span>()</span></a></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.pull_lambda_case|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.pull_lambda_case|thm"><span>pull_lambda_case</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="keyword1"><span>case</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="keyword1"><span>of</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>a</span></span><span class="main"><span>,</span></span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>λ</span></span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>t</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>case</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="keyword1"><span>of</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>a</span></span><span class="main"><span>,</span></span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="free"><span>t</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.ext|fact"><span>ext</span></a><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="free"><span>x</span></span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>

  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹First part of setup, for processing of code and inline theorems›</span></span></span><span>  
  
  </span><span class="keyword1"><span class="command"><span>named_theorems</span></span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.llvm_code_raw|attribute"><span class="entity_def" id="LLVM_Codegen_Preproc.llvm_code_raw|fact"><span>llvm_code_raw</span></span></span><span> </span><span class="quoted"><span>‹Isabelle-LLVM code theorems›</span></span><span>
  
  </span><span class="comment1"><span>(* These code theorems are used to mark external functions *)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.LLVM_EXTERNAL_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.LLVM_EXTERNAL_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.LLVM_EXTERNAL_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="LLVM_Codegen_Preproc.LLVM_EXTERNAL|const"><span>LLVM_EXTERNAL</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/String.html#String.string|type"><span>string</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>LLVM_EXTERNAL</span></span><span> </span><span class="main"><span class="bound"><span class="entity"><span>_</span></span></span></span><span> </span><span class="main"><span class="bound"><span class="entity"><span>_</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span>"</span></span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.LLVM_EXTERNALI|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.LLVM_EXTERNALI|thm"><span>LLVM_EXTERNALI</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.LLVM_EXTERNAL|const"><span>LLVM_EXTERNAL</span></a><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.LLVM_EXTERNAL_def|fact"><span>LLVM_EXTERNAL_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    
  
  </span><span class="keyword1"><span class="command"><span>ML</span></span></span><span> </span><span class="quoted"><span>‹ </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>LLC_Preprocessor</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>
    </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>LLC_Lib</span><span>
        
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cfg_llvm_preproc_timing</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Attrib.setup_config_bool</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>binding</span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.llvm_preproc_timing|attribute"><span>llvm_preproc_timing</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>false</span><span class="main"><span>)</span></span><span>
    
    </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Monadify</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span> 
      </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>BT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Gen_Monadify_Cong_Basis</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span class="entity"><span>BT</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_return</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="var"><span>?x</span></span><span> </span><span class="main"><span>::</span></span><span class="main"><span>_</span></span><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llM|type"><span>llM</span></a><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bind</span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="MMonad.html#MMonad.Mbind|const"><span>Mbind</span></a><span> </span><span class="var"><span>?m</span></span><span> </span><span class="var"><span>?f</span></span><span> </span><span class="main"><span>::</span></span><span class="main"><span>_</span></span><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llM|type"><span>llM</span></a><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
    
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dest_return</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="var"><span>?x</span></span><span> </span><span class="main"><span>::</span></span><span class="main"><span>_</span></span><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llM|type"><span>llM</span></a><span>"</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>dest_return</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dest_bind</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="MMonad.html#MMonad.Mbind|const"><span>Mbind</span></a><span> </span><span class="var"><span>?m</span></span><span> </span><span class="var"><span>?f</span></span><span> </span><span class="main"><span>::</span></span><span class="main"><span>_</span></span><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llM|type"><span>llM</span></a><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>m</span></span><span class="main"><span>,</span></span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>dest_bind</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span>
      
      
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dest_monadT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>try</span><span> </span><span class="entity"><span>dest_llM</span></span><span>  
      </span><span class="comment1"><span>(*fun dest_monadT (Type (@{type_name M},[T,@{typ llvm_memory},@{typ "llvm_macc"}])) = SOME T | dest_monadT _ = NONE*)</span></span><span>

      
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>strip_op</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>‹</span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.llc_par|const"><span>llc_par</span></a><span> </span><span class="var"><span>?fa</span></span><span> </span><span class="var"><span>?fb</span></span><span> </span><span class="var"><span>?a</span></span><span> </span><span class="var"><span>?b</span></span><span>›</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.llc_par|const"><span>llc_par</span></a><span> </span><span class="var"><span>?fa</span></span><span> </span><span class="var"><span>?fb</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span class="entity"><span>b</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>strip_op</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>BT.strip_op</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t</span></span><span>  
      
      
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bind_return_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>lemma</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="MMonad.html#MMonad.Mbind|const"><span>Mbind</span></a><span> </span><span class="free"><span>m</span></span><span> </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>m</span></span><span>"</span></span><span> </span><span class="quasi_keyword"><span>by</span></span><span> </span><span class="operator"><span>simp</span></span><span class="antiquote"><span>}</span></span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>return_bind_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>lemma</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="MMonad.html#MMonad.Mbind|const"><span>Mbind</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>x</span></span><span>"</span></span><span> </span><span class="quasi_keyword"><span>by</span></span><span> </span><span class="operator"><span>simp</span></span><span class="antiquote"><span>}</span></span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bind_bind_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>lemma</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="MMonad.html#MMonad.Mbind|const"><span>Mbind</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="MMonad.html#MMonad.Mbind|const"><span>Mbind</span></a><span> </span><span class="free"><span>m</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>g</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="MMonad.html#MMonad.Mbind|const"><span>Mbind</span></a><span> </span><span class="free"><span>m</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="MMonad.html#MMonad.Mbind|const"><span>Mbind</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>g</span></span><span class="main"><span>)</span></span><span>"</span></span><span> </span><span class="quasi_keyword"><span>by</span></span><span> </span><span class="operator"><span>simp</span></span><span class="antiquote"><span>}</span></span></span></span><span>
      
      </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Gen_Monadify</span></span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_return</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_return</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_bind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bind</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dest_return</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_return</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dest_bind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_bind</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dest_monadT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_monadT</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>strip_op</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>strip_op</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bind_return_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bind_return_thm</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>return_bind_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>return_bind_thm</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bind_bind_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bind_bind_thm</span></span><span>
      </span><span class="main"><span>)</span></span><span>
      </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span class="entity"><span>T</span></span><span>
      
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>        
    
    </span><span class="comment1"><span>(********* Identification of complex constant heads *)</span></span><span>
    </span><span class="comment1"><span>(* Get head of equation and conversion on this head. 
      If inline is set, TYPE() and higher-order variable arguments are treated like normal first-order arguments
    *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>get_eqn_head</span></span><span> </span><span class="entity"><span>inline</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Conv</span><span>
      
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>app</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>h</span></span><span class="main"><span>,</span></span><span class="entity"><span>cnv</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>h</span></span><span class="main"><span>,</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>cc</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cnv</span></span><span> </span><span class="entity"><span>cc</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_typarg</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>‹</span><span class="keyword1"><span>TYPE</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>›</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_typarg</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
      
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_fo_argument</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> 
        </span><span class="main"><span>(</span></span><span>is_Var</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>is_Free</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inline</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>is_typarg</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inline</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Monadify.is_ho_operand</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      
      
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="var"><span>?t</span></span><span>›</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>app</span></span><span> </span><span>arg_conv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>‹</span><span class="var"><span>?lhs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>_</span></span><span>›</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>app</span></span><span> </span><span>arg1_conv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>lhs</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>‹</span><span class="var"><span>?lhs</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>app</span></span><span> </span><span>arg1_conv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>lhs</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>f</span></span><span>$</span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_fo_argument</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>app</span></span><span> </span><span>fun_conv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> 
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span>I</span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span>  
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span>I</span><span class="main"><span>)</span></span><span>
    
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="entity"><span>aux</span></span><span> </span><span class="entity"><span>t</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    
    </span><span class="comment1"><span>(* Handle adding of M_CONST and constant registration to monadifier *)</span></span><span>
    
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>gen_prep_code_eq</span></span><span> </span><span class="entity"><span>h_reg</span></span><span> </span><span class="entity"><span>t_reg</span></span><span> </span><span class="entity"><span>inline</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.prop_of</span><span> </span><span class="entity"><span>thm</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_eqn</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>THM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"prep_code_eq: not an equation"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
    
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>h</span></span><span class="main"><span>,</span></span><span class="entity"><span>cnv</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>get_eqn_head</span></span><span> </span><span class="entity"><span>inline</span></span><span> </span><span class="entity"><span>t</span></span><span> 
      
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prep</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span class="entity"><span>context</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Conv</span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Conv.fconv_rule</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cnv</span></span><span> </span><span class="main"><span>(</span></span><span>rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Monadify.html#Monadify.M_CONST_def|fact"><span>M_CONST_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thm</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>h_reg</span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="entity"><span>context</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> 
        </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span class="entity"><span>context</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>need_prep</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>need_prep</span></span><span> </span><span class="main"><span>(</span></span><span>Free</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>need_prep</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>‹</span><a class="entity_ref" href="Monadify.html#Monadify.M_CONST|const"><span>M_CONST</span></a><span> </span><span class="main"><span>_</span></span><span>›</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>need_prep</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span class="entity"><span>context</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span class="entity"><span>context</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>need_prep</span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>prep</span></span><span>  
              
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>t_reg</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="entity"><span>context</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>context</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>gen_prep_code_eq_add</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_prep_code_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Monadify.prepare_add_const_decl</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>gen_prep_code_eq_del</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_prep_code_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Monadify.prepare_remove_const_decl</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>add_inline_eq</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_prep_code_eq_add</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Named_Simpsets.add_simp</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_simpset</span></span><span> </span><span>llvm_pre_simp</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span> </span><span>true</span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>del_inline_eq</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_prep_code_eq_del</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Named_Simpsets.del_simp</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_simpset</span></span><span> </span><span>llvm_pre_simp</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span> </span><span>true</span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>add_code_eq</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_prep_code_eq_add</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Named_Theorems.add_thm</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> llvm_code_raw</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span> </span><span>false</span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>del_code_eq</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_prep_code_eq_del</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Named_Theorems.del_thm</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> llvm_code_raw</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span> </span><span>false</span><span>
        
    </span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span> 
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>to_attr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.declaration_attribute</span><span> 
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>add_inline_eq_attr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>to_attr</span></span><span> </span><span class="entity"><span>add_inline_eq</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>del_inline_eq_attr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>to_attr</span></span><span> </span><span class="entity"><span>del_inline_eq</span></span><span> 
  
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>add_code_eq_attr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>to_attr</span></span><span> </span><span class="entity"><span>add_code_eq</span></span><span> 
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>del_code_eq_attr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>to_attr</span></span><span> </span><span class="entity"><span>del_code_eq</span></span><span> 
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    
    
    </span><span class="comment1"><span>(*    
    fun prep_code_eq thm context = let
      val t = Thm.prop_of thm
      val _ = is_eqn t orelse raise THM ("prep_code_eq: not an equation",~1,[thm])
    
      val (h,cnv) = get_eqn_head t
      
      fun prep context = let
        open Conv
        val thm = Conv.fconv_rule (cnv (rewr_conv @{thm M_CONST_def[symmetric]})) thm
        val context = Monadify.prepare_add_const_decl true h context
      in 
        (thm,context)
      end
      
      
      fun need_prep (Const _) = false
        | need_prep (Free _) = false
        | need_prep @{mpat ‹M_CONST _›} = false
        | need_prep _ = true
      
    in
      if need_prep h then prep context
      else (thm,context)
    end
    
    fun prep_code_attr attr = Thm.mixed_attribute (fn (context,thm) =&gt; let
      val (thm,context) = prep_code_eq thm context
      val (thm,context) = Thm.apply_attribute attr thm context
    in
      (context,thm)
    end)
    *)</span></span><span>
    
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  ›</span></span><span>      
   
  </span><span class="keyword1"><span class="command"><span>attribute_setup</span></span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.llvm_inline|attribute"><span>llvm_inline</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹
    </span><span class="entity"><span>Attrib.add_del</span></span><span> 
      </span><span class="main"><span>(</span></span><span class="entity"><span>LLC_Preprocessor.add_inline_eq_attr</span></span><span class="main"><span>)</span></span><span> 
      </span><span class="main"><span>(</span></span><span class="entity"><span>LLC_Preprocessor.del_inline_eq_attr</span></span><span class="main"><span>)</span></span><span>
  ›</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>attribute_setup</span></span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.llvm_code|attribute"><span>llvm_code</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹
    </span><span class="entity"><span>Attrib.add_del</span></span><span> 
      </span><span class="main"><span>(</span></span><span class="entity"><span>LLC_Preprocessor.add_code_eq_attr</span></span><span class="main"><span>)</span></span><span> 
      </span><span class="main"><span>(</span></span><span class="entity"><span>LLC_Preprocessor.del_code_eq_attr</span></span><span class="main"><span>)</span></span><span>
  ›</span></span><span>
  
  
  
  </span><span class="keyword1"><span class="command"><span>ML</span></span></span><span> </span><span class="quoted"><span>‹ </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>LLC_Preprocessor</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>
    </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>LLC_Preprocessor</span><span>  
    </span><span class="comment1"><span>(********* Normalization of code theorems *)</span></span><span>
    

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>cthm_inline</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Named_Simpsets.put</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_simpset</span></span><span> </span><span>llvm_pre_simp</span><span class="antiquote"><span>}</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="comment1"><span>(* TODO: Simplifier.rewrite may introduce beta redexes. 
        Currently we eliminate them right away. Or is it OK to have beta-redexes? *)</span></span><span>
      </span><span>Conv.fconv_rule</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rhs_conv</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Simplifier.rewrite</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span>then_conv</span><span> </span><span>Thm.beta_conversion</span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thm</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cthm_monadify</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Conv.fconv_rule</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rhs_conv</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Monadify.monadify_conv</span></span><span class="main"><span>)</span></span><span>
          
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inline_iteration_limit</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Attrib.setup_config_int</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>binding</span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.inline_iteration_limit|attribute"><span>inline_iteration_limit</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>)</span></span><span>
    
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>monadify_inline_cthm</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rpt</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="entity"><span>thm'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>THM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"inline_iteration_limit exceeded"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span class="entity"><span>thm'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>rpt</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>cthm_monadify</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>cthm_inline</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Thm.eq_thm_prop</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span class="entity"><span>thm'</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> 
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>rpt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span>-</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thm'</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>it_limit</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Config.get</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>inline_iteration_limit</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="entity"><span>thm</span></span><span> 
      </span><span>|&gt;</span><span> </span><span class="entity"><span>cthm_inline</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>rpt</span></span><span> </span><span class="entity"><span>it_limit</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>  
    
    </span><span class="comment1"><span>(*
      Bring code theorem into parseable format. To be applied after inlining, 
        immediately before parsing.
      
      Applies eta-expansion, return-expansion, and converts ≡ to =.
      Finally, it will replace unit-binds by () constants and anonymous bind.
      
      May fail on non-well-formed theorems.
    *)</span></span><span>
    
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_valid_fname</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_ground_term</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>LLC_Compiler.is_llvm_instr_t</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>check_valid_fname</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_valid_fname</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>TYPE</span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Expected (ground) function name"</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span>fastype_of</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
    
    
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>cthm_format</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>check_valid_op</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>assert_ground_term</span></span><span> </span><span class="entity"><span>t</span></span><span>
    
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>check_valid_op'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.llc_par|const"><span>llc_par</span></a><span> </span><span class="var"><span>?f</span></span><span> </span><span class="var"><span>?g</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="entity"><span>is_valid_fname</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>is_valid_fname</span></span><span> </span><span class="entity"><span>g</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> 
          </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>TERM</span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"cthm_format: llc_par expects function names"</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="entity"><span>t</span></span><span>
        </span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>check_valid_op'</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>check_valid_op</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
    
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>normalize_bind1</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Monadify.strip_op</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>check_valid_op'</span></span><span> </span><span class="entity"><span>f</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>args_is_M</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>f</span></span><span> </span><span>|&gt;</span><span> </span><span>binder_types</span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_llM</span></span><span> </span><span>o</span><span> </span><span>body_type</span><span class="main"><span>)</span></span><span>
                
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>args_is_M</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>TYPE</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"cthm_format: All arguments must be explicit"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span>fastype_of</span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
        
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>isM</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>isM</span></span><span>?</span><span class="main"><span>(</span></span><span class="entity"><span>normalize</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>expand_eta_all</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args_is_M</span></span><span> </span><span class="entity"><span>args</span></span><span>
        
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>  
        
      </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity"><span>normalize</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="MMonad.html#MMonad.Mbind|const"><span>Mbind</span></a><span> </span><span class="var"><span>?m</span></span><span> </span><span class="var"><span>?f</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>normalize_bind1</span></span><span> </span><span class="entity"><span>m</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="comment1"><span>(*ensure_abs f*)</span></span><span> </span><span class="entity"><span>expand_eta_all</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>normalize</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="MMonad.html#MMonad.Mbind|const"><span>Mbind</span></a><span> </span><span class="var"><span>?m</span></span><span> </span><span class="var"><span>?f</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>normalize</span></span><span> </span><span class="main"><span>(</span></span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span class="entity"><span>normalize</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>normalize</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>t</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>normalize</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>normalize_bind1</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="MMonad.html#MMonad.Mbind|const"><span>Mbind</span></a><span> </span><span class="var"><span>?t</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>normalize_eq</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><span class="var"><span>?a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="var"><span>?b</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>normalize</span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><span class="var"><span>?a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="var"><span>?b</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>normalize_eq</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><span class="var"><span>?a</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="var"><span>?b</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>normalize</span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mk_term</span></span><span> </span><span class="quoted"><span>"</span><span class="var"><span>?a</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="var"><span>?b</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span></span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>normalize_eq</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>TERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"format_code_thm: normalize_eq"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
    
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>norm_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>ALLGOALS</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>simp_tac</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>addsimps</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="MMonad.html#MMonad.M_monad_laws|fact"><span>M_monad_laws</span></a><span> </span><a class="entity_ref" href="Monadify.html#Monadify.M_CONST_def|fact"><span>M_CONST_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>cthm_norm_lambda</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Local_Defs.unfold</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.pull_lambda_case|fact"><span>pull_lambda_case</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>thm</span></span><span>
      
        </span><span class="comment1"><span>(*fun r thm = case Thm.concl_of thm of
          @{mpat "Trueprop (_ = (λ_. _))"} =&gt; r (thm RS @{thm fun_cong})
        | @{mpat "_ ≡ (λ_. _)"} =&gt; r (thm RS @{thm meta_fun_cong})
        | _ =&gt; thm
        *)</span></span><span>
        
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>try</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.fun_cong|fact"><span>fun_cong</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="entity"><span>thm</span></span><span>  
        
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>r</span></span><span> </span><span class="entity"><span>thm</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="entity"><span>thm</span></span><span> 
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>simplify</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>addsimps</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="MMonad.html#MMonad.M_monad_laws|fact"><span>M_monad_laws</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>cthm_norm_lambda</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>Conv.fconv_rule</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Refine_Util.f_tac_conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>normalize_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>norm_tac</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>Conv.fconv_rule</span><span> </span><span class="main"><span>(</span></span><span>Conv.top_sweep_conv</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.unit_meta_eq|fact"><span>unit_meta_eq</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    
    </span><span class="comment1"><span>(********* Gathering of code equations *)</span></span><span>
    </span><span class="comment1"><span>(* TODO: Use net *)</span></span><span>

    
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_external_cthm</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.prop_of</span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.LLVM_EXTERNAL|const"><span>LLVM_EXTERNAL</span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span>  

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>check_external_fun</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span class="entity"><span>name</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>check_valid_fname</span></span><span> </span><span class="entity"><span>c</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>is_Const</span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>TERM</span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"check_external_fun: expected simple constant"</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>c</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symbol.is_ascii_identifier</span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>TERM</span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"check_external_fun: expected ascii id, but got '"</span></span><span>^</span><span class="entity"><span>name</span></span><span>^</span><span class="inner_quoted"><span>"'"</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>c</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span class="entity"><span>name</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    
    
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dest_external_cthm</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.prop_of</span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span class="antiquoted"><span class="entity"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.LLVM_EXTERNAL|const"><span>LLVM_EXTERNAL</span></a><span> </span><span class="var"><span>?c</span></span><span> </span><span class="var"><span>?n</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>check_external_fun</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.dest_string</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>THM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"dest_external_cthm"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
    
    
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dep_prep_code_thm</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> 
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_external_cthm</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dest_external_cthm</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> 
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>LLC_Compiler.analyze_eqn_thm</span></span><span> </span><span class="entity"><span>thm</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    
    </span><span class="comment1"><span>(*
    fun dep_prep_code_thm thm = let
      val ((_,(c,_)),_) = LLC_Compiler.analyze_eqn_thm thm
    in
      (c,thm)
    end
    *)</span></span><span>
    
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dep_try_instantiate_code_thm</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span class="main"><span>,</span></span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>c</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>incr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.maxidx_of_cterm</span><span> </span><span class="entity"><span>c</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.incr_indexes</span><span> </span><span class="entity"><span>incr</span></span><span> </span><span class="entity"><span>thm</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span>|&gt;</span><span> </span><span>Thm.incr_indexes_cterm</span><span> </span><span class="entity"><span>incr</span></span><span>
    
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>try</span><span> </span><span>Thm.match</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span class="main"><span>,</span></span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.instantiate</span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dep_find_code_thm</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>pthms</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span> 
      </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>get_first</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dep_try_instantiate_code_thm</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pthms</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span>SOME</span><span> </span><span class="entity"><span>eqn</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>eqn</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>TERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"No code equation"</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>c</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
    
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cmd_name_prefix</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Long_Name.qualify</span><span> </span><span class="main"><span>(</span></span><span>Long_Name.qualifier</span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_add|const"><span>ll_add</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"ll_"</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>comb_name_prefix</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Long_Name.qualify</span><span> </span><span class="main"><span>(</span></span><span>Long_Name.qualifier</span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.llc_while|const"><span>llc_while</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"llc_"</span></span><span>
        
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dep_is_ll_comb_name</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span>
             </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="MMonad.html#MMonad.Mbind|const"><span>Mbind</span></a><span class="antiquote"><span>}</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span class="antiquote"><span>}</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>String.isPrefix</span><span> </span><span class="entity"><span>cmd_name_prefix</span></span><span> </span><span class="entity"><span>name</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>String.isPrefix</span><span> </span><span class="entity"><span>comb_name_prefix</span></span><span> </span><span class="entity"><span>name</span></span><span>
      
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dep_is_ll_comb_t</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dep_is_ll_comb_name</span></span><span> </span><span class="entity"><span>name</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>dep_is_ll_comb_t</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
      
      
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fold_aterms_mc</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>‹</span><a class="entity_ref" href="Monadify.html#Monadify.M_CONST|const"><span>M_CONST</span></a><span> </span><span class="main"><span>_</span></span><span>›</span></span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>t</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fold_aterms_mc</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fold_aterms_mc</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>fold_aterms_mc</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>u</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fold_aterms_mc</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fold_aterms_mc</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>t</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fold_aterms_mc</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>a</span></span><span class="main"><span>;</span></span><span>
      
      
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dep_is_call_const</span></span><span> </span><span class="main"><span>(</span></span><span>Bound</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>dep_is_call_const</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> 
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>t</span></span><span> 
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dep_is_ll_comb_t</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>      </span><span class="comment1"><span>(* Not an internal name *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>is_llM</span></span><span> </span><span class="main"><span>(</span></span><span>body_type</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span>  </span><span class="comment1"><span>(* Yields a monadic result *)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      
    </span><span class="comment1"><span>(*fun dep_is_call_const t = case try dest_head t of
      NONE =&gt; false
    | SOME (name,T) =&gt; 
                not (dep_is_ll_comb_name name) (* Not an internal name *)
        andalso is_llM (body_type T)           (* Yields a monadic result *)
        andalso not (exists (exists_subtype is_llM) (binder_types T)) (* No monadic parameters *)
    *)</span></span><span>
      
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>calls_of_cthm</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fold_aterms_mc</span></span><span> 
      </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>dep_is_call_const</span></span><span> </span><span class="entity"><span>t</span></span><span>?</span><span>cons</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> 
      </span><span class="main"><span>(</span></span><span class="entity"><span>rhs_of_eqn</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.prop_of</span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
    
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>default_extractions</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> 
        </span><span class="entity"><span>Definition_Utils.get_extraction_group</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>extraction_group</span></span><span> </span><span>LLVM</span><span class="antiquote"><span>}</span></span></span><span>
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>not</span><span> </span><span class="main"><span>(</span></span><span>Config.get</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>llc_compile_while</span></span><span class="main"><span>)</span></span><span> </span><span>?</span><span> 
            </span><span>append</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Definition_Utils.get_extraction_group</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>extraction_group</span></span><span> </span><span>LLVM_while</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>  
    
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>gather_code_thms</span></span><span> </span><span class="entity"><span>roots</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>lthy</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pthms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> llvm_code_raw</span><span class="antiquote"><span>}</span></span></span><span>
        </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>dep_prep_code_thm</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="entity"><span>Refine_Util.subsume_sort</span></span><span> </span><span>fst</span><span> </span><span class="entity"><span>thy</span></span><span>
        
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tim</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Config.get</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>cfg_llvm_preproc_timing</span></span><span>  
        
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>trace</span></span><span> </span><span class="entity"><span>msg</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>tim</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>msg</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>tracing</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
      
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>process_root</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctab</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>check_valid_fname</span></span><span> </span><span class="entity"><span>c</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>basename</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>name_of_head</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span>|&gt;</span><span> </span><span>Long_Name.base_name</span><span>
        
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>process_code_eqn</span></span><span> </span><span class="entity"><span>teqn</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>trace</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"Processing "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>basename</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>startt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Time.now</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
        
          </span><span class="comment1"><span>(* Monadify and inline RHS *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>teqn</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>monadify_inline_cthm</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>teqn</span></span><span>
          
          </span><span class="comment1"><span>(* Extract recursion equations *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>exs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>default_extractions</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
          
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>teqn</span></span><span class="main"><span>,</span></span><span class="entity"><span>add_eqns</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Definition_Utils.extract_recursion_eqs</span></span><span> </span><span class="entity"><span>exs</span></span><span> </span><span class="entity"><span>basename</span></span><span> </span><span class="entity"><span>teqn</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>teqns</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>teqn</span></span><span>::</span><span class="entity"><span>add_eqns</span></span><span>
          
          </span><span class="comment1"><span>(* Inline and format again *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>teqns</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>monadify_inline_cthm</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>cthm_format</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>teqns</span></span><span>

          </span><span class="comment1"><span>(* Update table *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctab</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span>Termtab.update_new</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>dep_prep_code_thm</span></span><span> </span><span class="entity"><span>teqns</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctab</span></span><span>
                        
          </span><span class="comment1"><span>(* Find calls *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>calls</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>calls_of_cthm</span></span><span> </span><span class="entity"><span>teqns</span></span><span> </span><span>|&gt;</span><span> </span><span>flat</span><span>
          
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>stopt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Time.now</span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>trace</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"Done "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>basename</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>": "</span></span><span> </span><span>^</span><span> </span><span>Time.toString</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>stopt</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>startt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

          
          </span><span class="comment1"><span>(* Recurse *)</span></span><span>

          </span><span class="comment1"><span>(** Recursion error traceback message *)</span></span><span>                            
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>msg</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>p_msg</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Pretty.block</span><span class="main"><span>[</span></span><span> </span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"from "</span></span><span class="main"><span>,</span></span><span> </span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>]</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>p_eqns</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.pretty_thm</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>teqns</span></span><span> </span><span>|&gt;</span><span> </span><span>Pretty.fbreaks</span><span> </span><span>|&gt;</span><span> </span><span>Pretty.block</span><span>
            
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p_msg</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.fbrk</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p_eqns</span></span><span class="main"><span>]</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Pretty.string_of</span><span> </span><span class="entity"><span>p</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctab</span></span><span class="main"><span>,</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>trace_exn</span></span><span> </span><span class="entity"><span>msg</span></span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span class="entity"><span>process_root</span></span><span> </span><span class="entity"><span>calls</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctab</span></span><span class="main"><span>,</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>ctab</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        
        
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>process_external_cthm</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctab</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Termtab.update_new</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dep_prep_code_thm</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctab</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> 
            </span><span class="main"><span>(</span></span><span class="entity"><span>ctab</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        
        
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Termtab.lookup</span><span> </span><span class="entity"><span>ctab</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span>SOME</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctab</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="comment1"><span>(* Get code theorem *)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cthm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dep_find_code_thm</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>pthms</span></span><span> </span><span class="entity"><span>c</span></span><span> 
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_external_cthm</span></span><span> </span><span class="entity"><span>cthm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                </span><span class="entity"><span>process_external_cthm</span></span><span> </span><span class="entity"><span>cthm</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                </span><span class="entity"><span>process_code_eqn</span></span><span> </span><span class="entity"><span>cthm</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
            
            
            
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span> 
      
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctab</span></span><span class="main"><span>,</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="entity"><span>process_root</span></span><span> </span><span class="entity"><span>roots</span></span><span> </span><span class="main"><span>(</span></span><span>Termtab.empty</span><span class="main"><span>,</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Termtab.dest</span><span> </span><span class="entity"><span>ctab</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>snd</span><span>
      
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eqn_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>filter_out</span><span> </span><span class="entity"><span>is_external_cthm</span></span><span> </span><span class="entity"><span>thms</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ext_funs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>filter</span><span> </span><span class="entity"><span>is_external_cthm</span></span><span> </span><span class="entity"><span>thms</span></span><span>
        </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>dest_external_cthm</span></span><span>
      
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>eqn_thms</span></span><span class="main"><span>,</span></span><span class="entity"><span>ext_funs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  ›</span></span><span>

  </span><span class="keyword1"><span class="command"><span>declaration</span></span></span><span> </span><span class="quoted"><span>‹</span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>LLC_Preprocessor.Monadify.prepare_add_const_decl</span></span><span> </span><span>false</span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Num.html#Num.numeral_class.numeral|const"><span>numeral</span></a><span> </span><span class="free"><span>a</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span>›</span></span><span>  
  </span><span class="keyword1"><span class="command"><span>declaration</span></span></span><span> </span><span class="quoted"><span>‹</span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>LLC_Preprocessor.Monadify.prepare_add_const_decl</span></span><span> </span><span>false</span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.double_of_word|const"><span>double_of_word</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Num.html#Num.numeral_class.numeral|const"><span>numeral</span></a><span> </span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span>›</span></span><span>  
  
  </span><span class="keyword1"><span class="command"><span>attribute_setup</span></span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.llvm_dbg_pre_monadified|attribute"><span>llvm_dbg_pre_monadified</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹</span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span>
    </span><span>Thm.rule_attribute</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>LLC_Preprocessor.cthm_monadify</span></span><span> </span><span>o</span><span> </span><span>Context.proof_of</span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>)</span></span><span>›</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>attribute_setup</span></span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.llvm_dbg_pre_inlined|attribute"><span>llvm_dbg_pre_inlined</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹</span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span>
    </span><span>Thm.rule_attribute</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>LLC_Preprocessor.cthm_inline</span></span><span> </span><span>o</span><span> </span><span>Context.proof_of</span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>)</span></span><span>›</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>attribute_setup</span></span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.llvm_dbg_pre_monadify_inlined|attribute"><span>llvm_dbg_pre_monadify_inlined</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹</span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span>
    </span><span>Thm.rule_attribute</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>LLC_Preprocessor.monadify_inline_cthm</span></span><span> </span><span>o</span><span> </span><span>Context.proof_of</span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>)</span></span><span>›</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>attribute_setup</span></span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.llvm_dbg_pre_formatted|attribute"><span>llvm_dbg_pre_formatted</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹</span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span>
    </span><span>Thm.rule_attribute</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>LLC_Preprocessor.cthm_format</span></span><span> </span><span>o</span><span> </span><span>Context.proof_of</span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>)</span></span><span>›</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>attribute_setup</span></span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.llvm_dbg_preprocessed|attribute"><span>llvm_dbg_preprocessed</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹</span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span>
    </span><span>Thm.rule_attribute</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Context.proof_of</span><span> </span><span class="entity"><span>context</span></span><span> 
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>LLC_Preprocessor.monadify_inline_cthm</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>LLC_Preprocessor.cthm_format</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> 
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>)</span></span><span>›</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>attribute_setup</span></span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.llvm_dbg_instantiated|attribute"><span>llvm_dbg_instantiated</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹</span><span>Args.term</span><span> </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> 
    </span><span>Thm.rule_attribute</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> 
        </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>LLC_Preprocessor</span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Context.proof_of</span><span> </span><span class="entity"><span>context</span></span><span> 
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pthm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dep_prep_code_thm</span></span><span> </span><span class="entity"><span>thm</span></span><span>        
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>the</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dep_try_instantiate_code_thm</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="entity"><span>pthm</span></span><span class="main"><span>)</span></span><span>
        
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> 
        </span><span class="entity"><span>thm</span></span><span>   
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>)</span></span><span>›</span></span><span>
  
</span><span class="keyword1"><span class="command"><span>declare</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="operator"><span>Pure.of</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>
    
</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Code Generator Driver›</span></span></span><span>  
  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹
    The driver combines preeprocessing and code generation, 
    and defines the user interface of the code generator, namely the commands
    </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>command</span></span><span> export_llvm</span><span class="antiquote"><span>}</span></span></span><span> and </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>command</span></span><span> llvm_deps</span><span class="antiquote"><span>}</span></span></span><span>.
  ›</span></span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>ML</span></span></span><span> </span><span class="quoted"><span>‹ </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>LLC_Driver</span></span><span> 
    </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>
    
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cfg_llvm_debug</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Attrib.setup_config_bool</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>binding</span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.llvm_debug|attribute"><span>llvm_debug</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>false</span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cfg_llvm_timing</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Attrib.setup_config_bool</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>binding</span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.llvm_timing|attribute"><span>llvm_timing</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>false</span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cfg_llvm_gen_header</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Attrib.setup_config_bool</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>binding</span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.llvm_gen_header|attribute"><span>llvm_gen_header</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>true</span><span class="main"><span>)</span></span><span>
    
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pretty_extfun</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span class="entity"><span>fname</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> 
        </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> 
          </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"::"</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span>Syntax.pretty_typ</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"is"</span></span><span class="main"><span>,</span></span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span>Pretty.str</span><span> </span><span class="entity"><span>fname</span></span><span class="main"><span>]</span></span><span>
      
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pretty_extfuns</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>extfuns</span></span><span>  </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Config.put</span><span> </span><span>Syntax_Trans.eta_contract</span><span> </span><span>false</span><span> </span><span class="entity"><span>ctxt</span></span><span>      
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Pretty.big_list</span><span> </span><span class="inner_quoted"><span>"External Functions"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pretty_extfun</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>extfuns</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      
      
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pretty_cthms</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>cthms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> 
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Config.put</span><span> </span><span>Syntax_Trans.eta_contract</span><span> </span><span>false</span><span> </span><span class="entity"><span>ctxt</span></span><span>      
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Pretty.big_list</span><span> </span><span class="inner_quoted"><span>"Code Theorems"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.pretty_thm</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cthms</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pretty_ftab_entry</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>":: "</span></span><span class="main"><span>,</span></span><span> </span><span>Syntax.pretty_typ</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> 
        </span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"→"</span></span><span class="main"><span>,</span></span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span>Pretty.str</span><span> </span><span class="entity"><span>n</span></span><span>
      </span><span class="main"><span>]</span></span><span>
          
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pretty_ftab</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ftab</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Pretty.big_list</span><span> </span><span class="inner_quoted"><span>"Symbol table:"</span></span><span> 
        </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pretty_ftab_entry</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Termtab.dest</span><span> </span><span class="entity"><span>ftab</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                
        
        
        
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>consts_to_llvm</span></span><span> </span><span class="entity"><span>hfname</span></span><span> </span><span class="entity"><span>cns</span></span><span> </span><span class="entity"><span>tydefs</span></span><span> </span><span class="entity"><span>nt_ovr</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dbg</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Config.get</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>cfg_llvm_debug</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tim</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Config.get</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>cfg_llvm_timing</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>gen_header</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Config.get</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>cfg_llvm_gen_header</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>trace</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>dbg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Pretty.string_of</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>tracing</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
                                       
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>trtimed</span></span><span> </span><span class="entity"><span>msg</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dbg</span></span><span class="main"><span>,</span></span><span class="entity"><span>tim</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>timeap_msg</span><span> </span><span class="entity"><span>msg</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>x</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>true</span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>trace</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Pretty.str</span><span> </span><span class="entity"><span>msg</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>x</span></span><span>
        
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>cthms</span></span><span class="main"><span>,</span></span><span class="entity"><span>extfuns</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>trtimed</span></span><span> </span><span class="inner_quoted"><span>"Gathering code theorems"</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>LLC_Preprocessor.gather_code_thms</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>cns</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>trace</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>pretty_cthms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>cthms</span></span><span class="main"><span>)</span></span><span>
        
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>cmp_fixes</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fx</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fx</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cn</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>csig</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cn</span></span><span class="main"><span>,</span></span><span class="entity"><span>C_Interface.name_of_sig</span></span><span> </span><span class="entity"><span>csig</span></span><span class="main"><span>)</span></span><span>
        
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fixes</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map_filter</span><span> </span><span class="entity"><span>fx</span></span><span> </span><span class="entity"><span>cns</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>fixes</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        
        
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fixes</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>trtimed</span></span><span> </span><span class="inner_quoted"><span>"Computing fixes table"</span></span><span> </span><span class="entity"><span>cmp_fixes</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
        </span><span class="comment1"><span>(*val _ = trace (fn () =&gt; pretty_ftab lthy ftab)*)</span></span><span>
                  
        
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tys</span></span><span class="main"><span>,</span></span><span class="entity"><span>eqns</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>trtimed</span></span><span> </span><span class="inner_quoted"><span>"Translating code theorems to IL"</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>LLC_Compiler.parse_cthms</span></span><span> </span><span class="entity"><span>fixes</span></span><span> </span><span class="entity"><span>nt_ovr</span></span><span> </span><span class="entity"><span>extfuns</span></span><span> </span><span class="entity"><span>cthms</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>trace</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>LLC_Intermediate.pretty_llc</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tys</span></span><span class="main"><span>,</span></span><span class="entity"><span>eqns</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>trace</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"Writing LLVM"</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>res</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>trtimed</span></span><span> </span><span class="inner_quoted"><span>"Writing LLVM"</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>LLC_Backend.compile_to_llvm</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tys</span></span><span class="main"><span>,</span></span><span class="entity"><span>eqns</span></span><span class="main"><span>)</span></span><span>
        
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>hdres</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>gen_header</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_hd</span></span><span> </span><span class="entity"><span>eqns</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sigspecs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map_filter</span><span> </span><span>snd</span><span> </span><span class="entity"><span>cns</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dest_sig</span></span><span> </span><span class="entity"><span>sg</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>C_Interface.name_of_sig</span></span><span> </span><span class="entity"><span>sg</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sg</span></span><span class="main"><span>)</span></span><span> 
          
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sigtab</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symtab.make</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>dest_sig</span></span><span> </span><span class="entity"><span>sigspecs</span></span><span class="main"><span>)</span></span><span>
              
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>match_eqn</span></span><span> </span><span class="entity"><span>eqn</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Symtab.lookup</span><span> </span><span class="entity"><span>sigtab</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>LLC_Intermediate.name_of_eqn</span></span><span> </span><span class="entity"><span>eqn</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span>
              </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>sg</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>eqn</span></span><span class="main"><span>,</span></span><span class="entity"><span>sg</span></span><span class="main"><span>)</span></span><span>  
              
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eqnsxsigs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map_filter</span><span> </span><span class="entity"><span>match_eqn</span></span><span> </span><span class="entity"><span>eqns</span></span><span>
              
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>hdres</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>LLC_HeaderGen.make_header</span></span><span> </span><span class="entity"><span>hfname</span></span><span> </span><span class="entity"><span>tydefs</span></span><span> </span><span class="entity"><span>tys</span></span><span> </span><span class="entity"><span>eqnsxsigs</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>hdres</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>hdres</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>trtimed</span></span><span> </span><span class="inner_quoted"><span>"Preparing Header"</span></span><span> </span><span class="entity"><span>mk_hd</span></span><span> </span><span class="entity"><span>eqns</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>hdres</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span>
        
        
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>cthms</span></span><span class="main"><span>,</span></span><span class="entity"><span>res</span></span><span class="main"><span>,</span></span><span class="entity"><span>hdres</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      
      </span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>using_master_directory</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>File.full_path</span><span> </span><span>o</span><span> </span><span class="entity"><span>Resources.master_directory</span></span><span> </span><span>o</span><span> </span><span>Proof_Context.theory_of</span><span class="main"><span>;</span></span><span>
          
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prepare_path</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Position.report</span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="main"><span>(</span></span><span>Markup.language_path</span><span> </span><span>false</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>path</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Path.explode</span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Position.report</span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="main"><span>(</span></span><span>Markup.path</span><span> </span><span class="main"><span>(</span></span><span>Path.implode</span><span> </span><span class="entity"><span>path</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>path</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>using_master_directory</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>path</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>path</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>remove_ext</span></span><span> </span><span class="entity"><span>ext</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p'</span></span><span class="main"><span>,</span></span><span class="entity"><span>ext'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Path.split_ext</span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>ext</span></span><span class="main"><span>=</span></span><span class="entity"><span>ext'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>p'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>remove_all_ext</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Path.split_ext</span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>remove_all_ext</span></span><span> </span><span class="entity"><span>p</span></span><span>
        
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prepare_hpath</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"HEADER_NAME"</span></span><span class="main"><span>,</span></span><span>NONE</span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>prepare_hpath</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>spos</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>path</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prepare_path</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>spos</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>remove_ext</span></span><span> </span><span class="inner_quoted"><span>"ll"</span></span><span>
                </span><span>|&gt;</span><span> </span><span>Path.ext</span><span> </span><span class="inner_quoted"><span>"h"</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>hfname</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>remove_all_ext</span></span><span> </span><span class="main"><span>(</span></span><span>Path.base</span><span> </span><span class="entity"><span>path</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>Path.implode</span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>hfname</span></span><span class="main"><span>,</span></span><span>SOME</span><span> </span><span class="entity"><span>path</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        
        
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>write_out</span></span><span> </span><span>NONE</span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>writeln</span><span> </span><span class="entity"><span>s</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>write_out</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>path</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>File.write</span><span> </span><span class="entity"><span>path</span></span><span> </span><span class="entity"><span>s</span></span><span>
          
        </span><span class="comment1"><span>(*  
        (*
          Contains a name (used as name for generated LLVM function) and 
          an optional signature (used for header file generation).
          
          Note that this information is redundant, the name in the signature must match
          the LLVM-name. This redundancy, however, reflects the split of LLVM code 
          generator and Header file generator.
        *)  
        datatype siginfo = SIGI of string * LLC_HeaderGen.raw_sig option  
          
        fun sigi_of_sig (rsg as (LLC_HeaderGen.RSIG (_,name,_))) = SIGI (name,SOME rsg)
        fun sigi_of_name name = SIGI (name,NONE)
        
        fun sigi_name (SIGI (name,_)) = name
        fun sigi_has_sig (SIGI (_,NONE)) = false
          | sigi_has_sig (SIGI (_,SOME _)) = true
        
        fun sigi_the_sig (SIGI (_,SOME sg)) = sg
          | sigi_the_sig _ = raise Match 
          
        val parse_sigi = 
             (Parse.short_ident || Parse.string) &gt;&gt; sigi_of_name  
          || xxx, string needs inner parser!
          
        *)</span></span><span>  
          
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>export_llvm</span></span><span> </span><span class="entity"><span>cns</span></span><span> </span><span class="entity"><span>tydefs</span></span><span> </span><span class="entity"><span>nt_ovr</span></span><span> </span><span class="entity"><span>path</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>hfname</span></span><span class="main"><span>,</span></span><span class="entity"><span>hfpath</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Config.put</span><span> </span><span>Syntax_Trans.eta_contract</span><span> </span><span>false</span><span> </span><span class="entity"><span>lthy</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>cthms</span></span><span class="main"><span>,</span></span><span class="entity"><span>llvm_code</span></span><span class="main"><span>,</span></span><span class="entity"><span>hcode</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>consts_to_llvm</span></span><span> </span><span class="entity"><span>hfname</span></span><span> </span><span class="entity"><span>cns</span></span><span> </span><span class="entity"><span>tydefs</span></span><span> </span><span class="entity"><span>nt_ovr</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>write_out</span></span><span> </span><span class="entity"><span>path</span></span><span> </span><span class="entity"><span>llvm_code</span></span><span>      
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>hcode</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>write_out</span></span><span> </span><span class="entity"><span>hfpath</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>cthms</span></span><span class="main"><span>,</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parse_ty_overrides</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Scan.repeat1</span><span> </span><span class="main"><span>(</span></span><span>Parse.typ</span><span> </span><span>--|</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>keyword</span></span><span> "</span><span class="keyword2"><span>=</span></span><span>"</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>--</span><span> </span><span>Parse.name</span><span class="main"><span>)</span></span><span>
        
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>export_llvm_cmd</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="main"><span>(</span></span><span>Args.mode</span><span> </span><span class="inner_quoted"><span>"debug"</span></span><span> 
          </span><span>--</span><span> </span><span>Args.mode</span><span> </span><span class="inner_quoted"><span>"timing"</span></span><span> 
          </span><span>--</span><span> </span><span>Args.mode</span><span> </span><span class="inner_quoted"><span>"no_while"</span></span><span> 
          </span><span>--</span><span> </span><span>Args.mode</span><span> </span><span class="inner_quoted"><span>"no_header"</span></span><span> 
          </span><span>--</span><span> </span><span class="entity"><span>Parse_Spec.opt_thm_name</span></span><span> </span><span class="inner_quoted"><span>":"</span></span><span> 
          </span><span>--</span><span> </span><span>Scan.repeat1</span><span> </span><span class="main"><span>(</span></span><span>Parse.term</span><span> </span><span>--</span><span> </span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>keyword</span></span><span> "</span><span class="keyword2"><span>is</span></span><span>"</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>LLC_HeaderGen.parse_raw_sig</span></span><span> </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> 
          </span><span>--</span><span> </span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>keyword</span></span><span> "</span><span class="keyword2"><span>defines</span></span><span>"</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>LLC_HeaderGen.parse_raw_tydefs</span></span><span class="main"><span>)</span></span><span>
          </span><span>--</span><span> </span><span>Scan.optional</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>keyword</span></span><span> "</span><span class="keyword2"><span>rewrites</span></span><span>"</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>|--</span><span> </span><span class="entity"><span>parse_ty_overrides</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
          </span><span>--</span><span> </span><span>Scan.option</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>keyword</span></span><span> "</span><span class="keyword2"><span>file</span></span><span>"</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>|--</span><span> </span><span>Parse.position</span><span> </span><span>Parse.path</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span>
           
            </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>dbg</span></span><span class="main"><span>,</span></span><span class="entity"><span>timing</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>nowhile</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>no_header</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>bnd</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>cns</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>tydefs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>nt_ovr</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>path_spos</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> 
            
              </span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>timing</span></span><span>?</span><span>Config.put</span><span> </span><span class="entity"><span>cfg_llvm_timing</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dbg</span></span><span>?</span><span>Config.put</span><span> </span><span class="entity"><span>cfg_llvm_debug</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nowhile</span></span><span>?</span><span>Config.put</span><span> </span><span class="entity"><span>LLC_Lib.llc_compile_while</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>no_header</span></span><span>?</span><span>Config.put</span><span> </span><span class="entity"><span>cfg_llvm_gen_header</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cns</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>Syntax.read_term</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cns</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cns</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_option</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>LLC_HeaderGen.check_raw_sig</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cns</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tydefs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_option</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>LLC_HeaderGen.check_raw_tydefs</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tydefs</span></span><span class="main"><span>)</span></span><span>
                
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nt_ovr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>Syntax.read_typ</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>nt_ovr</span></span><span>
                
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>path</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prepare_path</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>path_spos</span></span><span> 
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>hfnpath</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prepare_hpath</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>path_spos</span></span><span>
                
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cthms</span></span><span class="main"><span>,</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>export_llvm</span></span><span> </span><span class="entity"><span>cns</span></span><span> </span><span class="entity"><span>tydefs</span></span><span> </span><span class="entity"><span>nt_ovr</span></span><span> </span><span class="entity"><span>path</span></span><span> </span><span class="entity"><span>hfnpath</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
              
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Local_Theory.note</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnd</span></span><span class="main"><span>,</span></span><span class="entity"><span>cthms</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span> 
              
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>llvm_deps_cmd</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Parse_Spec.opt_thm_name</span></span><span> </span><span class="inner_quoted"><span>":"</span></span><span> </span><span>--</span><span> </span><span>Scan.repeat1</span><span> </span><span>Parse.term</span><span>
          </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnd</span></span><span class="main"><span>,</span></span><span class="entity"><span>cns</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cns</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Syntax.read_term</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cns</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>writeln</span><span> </span><span class="inner_quoted"><span>"Gathering code theorems"</span></span><span>
              
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>cthms</span></span><span class="main"><span>,</span></span><span class="entity"><span>extfuns</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>LLC_Preprocessor.gather_code_thms</span></span><span> </span><span class="entity"><span>cns</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Local_Theory.note</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnd</span></span><span class="main"><span>,</span></span><span class="entity"><span>cthms</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span> 
              
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>writeln</span><span> </span><span class="inner_quoted"><span>"Done"</span></span><span>
              
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pretty_cthms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>cthms</span></span><span> </span><span>|&gt;</span><span> </span><span>Pretty.string_of</span><span> </span><span>|&gt;</span><span> </span><span>writeln</span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pretty_extfuns</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>extfuns</span></span><span> </span><span>|&gt;</span><span> </span><span>Pretty.string_of</span><span> </span><span>|&gt;</span><span> </span><span>writeln</span><span>
          
             </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span> 
          </span><span class="main"><span>)</span></span><span>
        
            
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
                                                                                                                   
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Outer_Syntax.local_theory</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>command_keyword</span></span><span> </span><span class="keyword1"><span>export_llvm</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="inner_quoted"><span>"generate LLVM code for constants"</span></span><span> </span><span class="entity"><span>export_llvm_cmd</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Outer_Syntax.local_theory</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>command_keyword</span></span><span> </span><span class="keyword1"><span>llvm_deps</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="inner_quoted"><span>"Print LLVM code theorems for constants"</span></span><span> </span><span class="entity"><span>llvm_deps_cmd</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  ›</span></span><span>                                                      
  
  </span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Setup for Product Type›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹We prepare a setup to compile product types to anonymous 2-element structures›</span></span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.struct_of_prod|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.struct_of_prod|thm"><span>struct_of_prod</span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen.html#LLVM_Codegen.ll_struct_of|attribute"><span class="operator"><span>ll_struct_of</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.llvm_rep_class.struct_of|const"><span>struct_of</span></a><span> </span><span class="keyword1"><span>TYPE</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.llvm_rep|class"><span>llvm_rep</span></a><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span class="tfree"><span>'b</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.llvm_rep|class"><span>llvm_rep</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llvm_struct.VS_STRUCT|const"><span>VS_STRUCT</span></a><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.llvm_rep_class.struct_of|const"><span>struct_of</span></a><span> </span><span class="keyword1"><span>TYPE</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.llvm_rep_class.struct_of|const"><span>struct_of</span></a><span> </span><span class="keyword1"><span>TYPE</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'b</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  
  
  </span><span class="comment1"><span>(*lemma to_val_prod[ll_to_val]: "to_val x = LL_STRUCT [to_val (fst x), to_val (snd x)]"
    by (cases x; simp)
  *)</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.prod_insert_fst_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.prod_insert_fst_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.prod_insert_fst_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="LLVM_Codegen_Preproc.prod_insert_fst|const"><span>prod_insert_fst</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.llvm_rep|class"><span>llvm_rep</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.llvm_rep|class"><span>llvm_rep</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>_</span></span><span>"</span></span></span><span> 
    </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_inline|attribute"><span class="operator"><span>llvm_inline</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>prod_insert_fst</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_insert_value|const"><span>ll_insert_value</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.prod_insert_snd_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.prod_insert_snd_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.prod_insert_snd_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="LLVM_Codegen_Preproc.prod_insert_snd|const"><span>prod_insert_snd</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.llvm_rep|class"><span>llvm_rep</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.llvm_rep|class"><span>llvm_rep</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>_</span></span><span>"</span></span></span><span> 
    </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_inline|attribute"><span class="operator"><span>llvm_inline</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>prod_insert_snd</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_insert_value|const"><span>ll_insert_value</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.prod_extract_fst_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.prod_extract_fst_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.prod_extract_fst_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="LLVM_Codegen_Preproc.prod_extract_fst|const"><span>prod_extract_fst</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.llvm_rep|class"><span>llvm_rep</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.llvm_rep|class"><span>llvm_rep</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llM|type"><span>llM</span></a><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_inline|attribute"><span class="operator"><span>llvm_inline</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>prod_extract_fst</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_extract_value|const"><span>ll_extract_value</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.prod_extract_snd_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.prod_extract_snd_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.prod_extract_snd_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="LLVM_Codegen_Preproc.prod_extract_snd|const"><span>prod_extract_snd</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.llvm_rep|class"><span>llvm_rep</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.llvm_rep|class"><span>llvm_rep</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llM|type"><span>llM</span></a><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_inline|attribute"><span class="operator"><span>llvm_inline</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>prod_extract_snd</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_extract_value|const"><span>ll_extract_value</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>"</span></span></span><span>
  </span><span class="comment1"><span>(*definition prod_gep_fst :: "('a::llvm_rep × 'b::llvm_rep) ptr ⇒ 'a ptr llM"
    where [llvm_inline]: "prod_gep_fst p ≡ ll_gep_struct p 0"
  definition prod_gep_snd :: "('a::llvm_rep × 'b::llvm_rep) ptr ⇒ 'b ptr llM"
    where [llvm_inline]: "prod_gep_snd p ≡ ll_gep_struct p 1"
  *)</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.prod_ops_simp|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.prod_ops_simp(4)|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.prod_ops_simp(3)|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.prod_ops_simp(2)|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.prod_ops_simp(1)|thm"><span>prod_ops_simp</span></span></span></span></span></span><span class="main"><span>:</span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.prod_insert_fst|const"><span>prod_insert_fst</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>,</span></span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>a</span></span><span class="main"><span>,</span></span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.prod_insert_snd|const"><span>prod_insert_snd</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>a</span></span><span class="main"><span>,</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>a</span></span><span class="main"><span>,</span></span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.prod_extract_fst|const"><span>prod_extract_fst</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>a</span></span><span class="main"><span>,</span></span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.prod_extract_snd|const"><span>prod_extract_snd</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="main"><span>(</span></span><span class="bound"><span>a</span></span><span class="main"><span>,</span></span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> 
      </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.prod_insert_fst_def|fact"><span>prod_insert_fst_def</span></a><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.prod_insert_snd_def|fact"><span>prod_insert_snd_def</span></a><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_insert_value_def|fact"><span>ll_insert_value_def</span></a><span>
      </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.prod_extract_fst_def|fact"><span>prod_extract_fst_def</span></a><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.prod_extract_snd_def|fact"><span>prod_extract_snd_def</span></a><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_extract_value_def|fact"><span>ll_extract_value_def</span></a><span> 
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llvm_insert_value_def|fact"><span>llvm_insert_value_def</span></a><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llvm_extract_value_def|fact"><span>llvm_extract_value_def</span></a><span>  
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/HOL-Eisbach.Eisbach.html#Eisbach.all|method"><span class="operator"><span>all</span></span></a><span> </span><span class="quoted"><span>‹</span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.ext|fact"><span>ext</span></a><span>›</span></span><span>  </span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> 
      </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.to_val_prod_def|fact"><span>to_val_prod_def</span></a><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.from_val_prod_def|fact"><span>from_val_prod_def</span></a><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.checked_from_val_def|fact"><span>checked_from_val_def</span></a><span>
      </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.splits|fact"><span>prod.splits</span></a><span>
      </span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
  
    
  </span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Ad-Hoc Regression Tests›</span></span></span><span>
  
</span><span class="keyword1"><span class="command"><span>experiment</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>  
  
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.exp_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.exp_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.exp_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.exp|const"><span>exp</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="numeral"><span>64</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="numeral"><span>64</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llM|type"><span>llM</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>exp</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><span class="bound"><span>s</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.prod_insert_fst|const"><span>prod_insert_fst</span></a><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.llvm_rep_class.init|const"><span>init</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>s</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.prod_insert_snd|const"><span>prod_insert_snd</span></a><span> </span><span class="bound"><span>s</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>s</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.llc_while|const"><span>llc_while</span></a><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span>
        </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.prod_extract_snd|const"><span>prod_extract_snd</span></a><span> </span><span class="bound"><span>s</span></span><span class="main"><span>;</span></span><span>
        </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_icmp_ne|const"><span>ll_icmp_ne</span></a><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span>
      </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span>
        </span><span class="bound"><span>c</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.prod_extract_fst|const"><span>prod_extract_fst</span></a><span> </span><span class="bound"><span>s</span></span><span class="main"><span>;</span></span><span>
        </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.prod_extract_snd|const"><span>prod_extract_snd</span></a><span> </span><span class="bound"><span>s</span></span><span class="main"><span>;</span></span><span>
        
        </span><span class="bound"><span>c</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_mul|const"><span>ll_mul</span></a><span> </span><span class="bound"><span>c</span></span><span> </span><span class="numeral"><span>2</span></span><span class="main"><span>;</span></span><span>
        </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_sub|const"><span>ll_sub</span></a><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>;</span></span><span>
        
        </span><span class="bound"><span>s</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.prod_insert_fst|const"><span>prod_insert_fst</span></a><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.llvm_rep_class.init|const"><span>init</span></a><span> </span><span class="bound"><span>c</span></span><span class="main"><span>;</span></span><span>
        </span><span class="bound"><span>s</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.prod_insert_snd|const"><span>prod_insert_snd</span></a><span> </span><span class="bound"><span>s</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>;</span></span><span>
        
        </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="bound"><span>s</span></span><span>
      </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>
      </span><span class="bound"><span>s</span></span><span class="main"><span>;</span></span><span>
  
    </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.prod_extract_fst|const"><span>prod_extract_fst</span></a><span> </span><span class="bound"><span>s</span></span><span>
  </span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  
  
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.streq_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.streq_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.streq_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.streq|const"><span>streq</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="numeral"><span>8</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ptr|type"><span>ptr</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="numeral"><span>8</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ptr|type"><span>ptr</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>1</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llM|type"><span>llM</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>streq</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s<span class="hidden">⇩</span><sub>1</sub></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s<span class="hidden">⇩</span><sub>2</sub></span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span>
      </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_load|const"><span>ll_load</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>s<span class="hidden">⇩</span><sub>1</sub></span></span></span></span><span class="main"><span>;</span></span><span>
      </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_load|const"><span>ll_load</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>s<span class="hidden">⇩</span><sub>2</sub></span></span></span></span><span class="main"><span>;</span></span><span>
      </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_icmp_eq|const"><span>ll_icmp_eq</span></a><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span>
    </span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>export_llvm</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.streq|const"><span>streq</span></a></span><span>  
  
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test2_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test2_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test2_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test2|const"><span>test2</span></span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span class="main"><span>::</span></span><span class="numeral"><span>32</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><span class="bound"><span>n</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_add|const"><span>ll_add</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="numeral"><span>42</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>p</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_malloc|const"><span>ll_malloc</span></a><span> </span><span class="keyword1"><span>TYPE</span></span><span class="main"><span>(</span></span><span class="numeral"><span>16</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span class="main"><span>)</span></span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>p</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_ofs_ptr|const"><span>ll_ofs_ptr</span></a><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><span>(</span></span><span class="numeral"><span>5</span></span><span class="main"><span>::</span></span><span class="numeral"><span>32</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_store|const"><span>ll_store</span></a><span> </span><span class="numeral"><span>42</span></span><span> </span><span class="bound"><span>p</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>r</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_load|const"><span>ll_load</span></a><span> </span><span class="bound"><span>p</span></span><span class="main"><span>;</span></span><span> 
    </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="bound"><span>r</span></span><span>  
  </span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.add_add_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.add_add_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.add_add_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.add_add|const"><span>add_add</span></span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span class="main"><span>::</span></span><span class="main"><span>_</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_add|const"><span>ll_add</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_add|const"><span>ll_add</span></a><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>;</span></span><span>
    </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="bound"><span>x</span></span><span>
  </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.add_add_driver_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.add_add_driver_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.add_add_driver_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.add_add_driver|const"><span>add_add_driver</span></span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span class="main"><span>::</span></span><span class="numeral"><span>32</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span class="main"><span>::</span></span><span class="numeral"><span>64</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.add_add|const"><span>add_add</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>b</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.add_add|const"><span>add_add</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_zext|const"><span>ll_zext</span></a><span> </span><span class="bound"><span>a</span></span><span> </span><span class="keyword1"><span>TYPE</span></span><span class="main"><span>(</span></span><span class="numeral"><span>64</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>b</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_add|const"><span>ll_add</span></a><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>;</span></span><span>
    </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="bound"><span>b</span></span><span>
  </span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>export_llvm</span></span></span><span> </span><span class="main"><span>(</span></span><span>debug</span><span class="main"><span>)</span></span><span> </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.add_add_driver|const"><span>add_add_driver</span></a></span><span>
  
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.main_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.main_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.main_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.main|const"><span>main</span></span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>argc</span></span></span></span><span class="main"><span>::</span></span><span class="numeral"><span>32</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>argv</span></span></span></span><span class="main"><span>::</span></span><span class="numeral"><span>8</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ptr|type"><span>ptr</span></a><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ptr|type"><span>ptr</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><span class="bound"><span>r</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.test2|const"><span>test2</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>argc</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>r</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_zext|const"><span>ll_zext</span></a><span> </span><span class="bound"><span>r</span></span><span> </span><span class="keyword1"><span>TYPE</span></span><span class="main"><span>(</span></span><span class="numeral"><span>32</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="bound"><span>r</span></span><span>
  </span><span class="main"><span>}</span></span><span>"</span></span></span><span> 

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.main_exp_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.main_exp_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.main_exp_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.main_exp|const"><span>main_exp</span></span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>argc</span></span></span></span><span class="main"><span>::</span></span><span class="numeral"><span>32</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>argv</span></span></span></span><span class="main"><span>::</span></span><span class="numeral"><span>8</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ptr|type"><span>ptr</span></a><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ptr|type"><span>ptr</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><span class="bound"><span>argc</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_zext|const"><span>ll_zext</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>argc</span></span></span></span><span> </span><span class="keyword1"><span>TYPE</span></span><span class="main"><span>(</span></span><span class="numeral"><span>64</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>r</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.exp|const"><span>exp</span></a><span> </span><span class="bound"><span>argc</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>r</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_trunc|const"><span>ll_trunc</span></a><span> </span><span class="bound"><span>r</span></span><span> </span><span class="keyword1"><span>TYPE</span></span><span class="main"><span>(</span></span><span class="numeral"><span>32</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="bound"><span>r</span></span><span>
  </span><span class="main"><span>}</span></span><span>"</span></span></span><span> 

  
</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.testx_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.testx_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.testx_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.testx|const"><span>testx</span></span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span class="main"><span>::</span></span><span class="numeral"><span>64</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.llc_while|const"><span>llc_while</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_icmp_ult|const"><span>ll_icmp_ult</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_sub|const"><span>ll_sub</span></a><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>export_llvm</span></span></span><span> </span><span class="main"><span>(</span></span><span>debug</span><span class="main"><span>)</span></span><span> </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.testx|const"><span>testx</span></a></span><span>

</span><span class="keyword1"><span class="command"><span>export_llvm</span></span></span><span> </span><span class="main"><span>(</span></span><span>debug</span><span class="main"><span>)</span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.exp_thms1|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.exp_thms1|thm"><span class="entity_def" id="offset_33671..33680">exp_thms1</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.exp|const"><span>exp</span></a></span><span>  


</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.exp.f_07596470_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.exp.f_07596470_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.exp.f_07596470_def_raw|axiom"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.exp.f_07596470|const"><span>export_llvm</span></span></span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span>debug</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>no_while</span><span class="main"><span>)</span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.exp_thms2|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.exp_thms2(2)|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.exp_thms2(1)|thm"><span class="entity_def" id="offset_33721..33730">exp_thms2</span></span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.exp|const"><span>exp</span></a></span><span>  
</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.exp.f_07603100_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.exp.f_07603100_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.exp.f_07603100_def_raw|axiom"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.exp.f_07603100|const"><span>export_llvm</span></span></span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span>debug</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>no_while</span><span class="main"><span>)</span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.exp_thms3|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.exp_thms3(2)|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.exp_thms3(1)|thm"><span class="entity_def" id="offset_33769..33778">exp_thms3</span></span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.exp|const"><span>exp</span></a></span><span>  

</span><span class="keyword1"><span class="command"><span>thm</span></span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#offset_33671..33680"><span>exp_thms1</span></a><span>
</span><span class="keyword1"><span class="command"><span>thm</span></span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#offset_33721..33730"><span>exp_thms2</span></a><span>
</span><span class="keyword1"><span class="command"><span>thm</span></span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#offset_33769..33778"><span>exp_thms3</span></a><span>


</span><span class="keyword1"><span class="command"><span>export_llvm</span></span></span><span> </span><span class="main"><span>(</span></span><span>debug</span><span class="main"><span>)</span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.foobar|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.foobar(2)|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.foobar(1)|thm"><span>foobar</span></span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.main_exp|const"><span>main_exp</span></a></span><span> </span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> main
</span><span class="keyword1"><span class="command"><span>export_llvm</span></span></span><span> </span><span class="main"><span>(</span></span><span>debug</span><span class="main"><span>)</span></span><span> </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.main|const"><span>main</span></a></span><span> </span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> main



</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_if_names_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_if_names_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_if_names_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_if_names|const"><span>test_if_names</span></span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span class="main"><span>::</span></span><span class="numeral"><span>32</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><span class="bound"><span>tmp</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_icmp_eq|const"><span>ll_icmp_eq</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.llc_if|const"><span>llc_if</span></a><span> </span><span class="bound"><span>tmp</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.null|const"><span>null</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span>
                                     </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_malloc|const"><span>ll_malloc</span></a><span> </span><span class="keyword1"><span>TYPE</span></span><span class="main"><span>(</span></span><span class="numeral"><span>8</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span class="main"><span>;</span></span><span>
                                     </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="bound"><span>x</span></span><span>
                                   </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>p</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_ofs_ptr|const"><span>ll_ofs_ptr</span></a><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>::</span></span><span class="numeral"><span>32</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_store|const"><span>ll_store</span></a><span> </span><span class="numeral"><span>0x2A</span></span><span> </span><span class="bound"><span>p</span></span><span class="main"><span>;</span></span><span>
    </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_free|const"><span>ll_free</span></a><span> </span><span class="bound"><span>a</span></span><span class="main"><span>;</span></span><span>
    </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.Unity|const"><span>()</span></a></span><span>
  </span><span class="main"><span>}</span></span><span>"</span></span></span><span>
 
</span><span class="keyword1"><span class="command"><span>export_llvm</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.test_if_names|const"><span>test_if_names</span></a></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.fib_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.fib_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.fib_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.fib|const"><span>fib</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="numeral"><span>64</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="numeral"><span>64</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llM|type"><span>llM</span></a><span>"</span></span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>fib</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="MMonad.html#MMonad.REC|const"><span>REC</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>fib</span></span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span> 
    </span><span class="bound"><span>t</span></span><span class="main"><span>←</span></span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_icmp_ule|const"><span>ll_icmp_ule</span></a><span> </span><span class="bound"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>;</span></span><span> 
    </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.llc_if|const"><span>llc_if</span></a><span> </span><span class="bound"><span>t</span></span><span> 
      </span><span class="main"><span>(</span></span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="bound"><span>n</span></span><span class="main"><span>)</span></span><span> 
      </span><span class="main"><span>(</span></span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span> 
        </span><span class="bound"><span>n<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_sub|const"><span>ll_sub</span></a><span> </span><span class="bound"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>;</span></span><span> 
        </span><span class="bound"><span>a</span></span><span class="main"><span>←</span></span><span class="bound"><span>fib</span></span><span> </span><span class="bound"><span>n<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span>;</span></span><span> 
        </span><span class="bound"><span>n<span class="hidden">⇩</span><sub>2</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_sub|const"><span>ll_sub</span></a><span> </span><span class="bound"><span>n</span></span><span> </span><span class="numeral"><span>2</span></span><span class="main"><span>;</span></span><span> 
        </span><span class="bound"><span>b</span></span><span class="main"><span>←</span></span><span class="bound"><span>fib</span></span><span> </span><span class="bound"><span>n<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>;</span></span><span> 
        </span><span class="bound"><span>c</span></span><span class="main"><span>←</span></span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_add|const"><span>ll_add</span></a><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>;</span></span><span> 
        </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="bound"><span>c</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.fib.f_07620600_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.fib.f_07620600_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.fib.f_07620600_def_raw|axiom"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.fib.f_07620600|const"><span>export_llvm</span></span></span></span></span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.fib|const"><span>fib</span></a></span><span> </span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> fib


</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.triple_sum_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.triple_sum_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.triple_sum_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.triple_sum|const"><span>triple_sum</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="numeral"><span>64</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="numeral"><span>64</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="numeral"><span>64</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ptr|type"><span>ptr</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="numeral"><span>64</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llM|type"><span>llM</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>triple_sum</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>abc</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><span class="bound"><span>abc</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_load|const"><span>ll_load</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>abc</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_extract_value|const"><span>ll_extract_value</span></a><span> </span><span class="bound"><span>abc</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>bc</span></span><span class="main"><span>::</span></span><span class="numeral"><span>64</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>×</span></a></span><span> </span><span class="numeral"><span>64</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_extract_value|const"><span>ll_extract_value</span></a><span> </span><span class="bound"><span>abc</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>b</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_extract_value|const"><span>ll_extract_value</span></a><span> </span><span class="bound"><span>bc</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>c</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_extract_value|const"><span>ll_extract_value</span></a><span> </span><span class="bound"><span>bc</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>r</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_add|const"><span>ll_add</span></a><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>r</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_add|const"><span>ll_add</span></a><span> </span><span class="bound"><span>r</span></span><span> </span><span class="bound"><span>c</span></span><span class="main"><span>;</span></span><span>
    </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="bound"><span>r</span></span><span>
   </span><span class="main"><span>}</span></span><span>"</span></span></span><span>
   
</span><span class="keyword1"><span class="command"><span>export_llvm</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.triple_sum|const"><span>triple_sum</span></a></span><span> </span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span>‹_ triple_sum</span><span class="main"><span>(</span></span><span>triple</span><span class="main"><span>*</span></span><span class="main"><span>)</span></span><span>›</span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>defines</span></span></span><span> </span><span class="quoted"><span>‹</span><span class="keyword1"><span>typedef</span></span><span> </span><span class="keyword1"><span>struct</span></span><span> </span><span class="main"><span>{</span></span><span class="keyword2"><span>int64_t</span></span><span> a</span><span class="main"><span>;</span></span><span> </span><span class="keyword1"><span>struct</span></span><span> </span><span class="main"><span>{</span></span><span class="keyword2"><span>int64_t</span></span><span> b</span><span class="main"><span>;</span></span><span> </span><span class="keyword2"><span>int64_t</span></span><span> c</span><span class="main"><span>;</span></span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span class="main"><span>}</span></span><span> triple</span><span class="main"><span>;</span></span><span>›</span></span><span>
 
  
</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_ppar_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_ppar_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_ppar_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_ppar|const"><span>test_ppar</span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.llc_par|const"><span>llc_par</span></a><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.fib|const"><span>fib</span></a><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.test2|const"><span>test2</span></a><span> </span><span class="numeral"><span>3</span></span><span> </span><span class="numeral"><span>3</span></span><span>"</span></span></span><span>
  
</span><span class="keyword1"><span class="command"><span>declare</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen.html#LLVM_Codegen.llc_compile_par_call|attribute"><span class="operator"><span>llc_compile_par_call</span></span></a><span class="main"><span class="main"><span>=</span></span></span><span class="quasi_keyword"><span>true</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.fib.f_07626588_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.fib.f_07626588_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.fib.f_07626588_def_raw|axiom"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.fib.f_07626588|const"><span>export_llvm</span></span></span></span></span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.test_ppar|const"><span>test_ppar</span></a></span><span> </span><span class="keyword2"><span class="keyword"><span>file</span></span></span><span> </span><span class="quoted"><span>"test_par.ll"</span></span><span>
 
</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.external_fun_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.external_fun_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.external_fun_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.external_fun|const"><span>external_fun</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="numeral"><span>64</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="numeral"><span>64</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llM|type"><span>llM</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>external_fun</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.undefined|const"><span>undefined</span></a><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.uses_external_fun_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.uses_external_fun_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.uses_external_fun_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.uses_external_fun|const"><span>uses_external_fun</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.external_fun|const"><span>external_fun</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.external_fun|const"><span>external_fun</span></a><span> </span><span class="bound"><span>y</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>context</span></span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>notes</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code_raw|attribute"><span class="operator"><span>llvm_code_raw</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.LLVM_EXTERNALI|fact"><span>LLVM_EXTERNALI</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.external_fun|const"><span>external_fun</span></a></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="inner_quoted"><span>''external_fun''</span></span><span>"</span></span></span><span class="main"><span>]</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>export_llvm</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.uses_external_fun|const"><span>uses_external_fun</span></a></span><span> </span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span>"</span><span class="keyword2"><span>uint64_t</span></span><span> uses_external_fun</span><span class="main"><span>(</span></span><span class="keyword2"><span>uint64_t</span></span><span class="main"><span>)</span></span><span>"</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>file</span></span></span><span> </span><span class="quoted"><span>"../../../regression/gencode/test_external_fun.ll"</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

  
</span><span class="comment1"><span>(* Higher-Order stuff *)</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.repeat2_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.repeat2_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.repeat2_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.repeat2|const"><span>repeat2</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>_</span></span><span> </span><a class="entity_ref" href="../../AFP/Refine_Monadic/HOL-Library.Word.html#Word.word|type"><span>word</span></a><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llM|type"><span>llM</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>_</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>repeat2</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span>
  </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>←</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span class="main"><span>;</span></span><span>
  </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="bound"><span>x</span></span><span>
</span><span class="main"><span>}</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.fibfib_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.fibfib_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.fibfib_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.fibfib|const"><span>fibfib</span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.repeat2|const"><span>repeat2</span></a><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.fib|const"><span>fib</span></a><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.fib.f_07634404_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.fib.f_07634404_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.fib.f_07634404_def_raw|axiom"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.fib.f_07634404|const"><span>export_llvm</span></span></span></span></span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.fibfib|const"><span>fibfib</span></a></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.times3_f_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.times3_f_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.times3_f_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.times3_f|const"><span>times3_f</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.single|type"><span>single</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.single|type"><span>single</span></a><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llM|type"><span>llM</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>times3_f</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><span class="bound"><span>x'</span></span><span class="main"><span>←</span></span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_fadd_f|const"><span>ll_fadd_f</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>x'</span></span><span class="main"><span>←</span></span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_fadd_f|const"><span>ll_fadd_f</span></a><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>x'</span></span><span class="main"><span>←</span></span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_fadd_f|const"><span>ll_fadd_f</span></a><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.single_of_word|const"><span>single_of_word</span></a><span> </span><span class="numeral"><span>0x3FD55555</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="bound"><span>x'</span></span><span>
  </span><span class="main"><span>}</span></span><span>"</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>export_llvm</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.times3_f|const"><span>times3_f</span></a></span><span> </span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span>"</span><span class="keyword2"><span>float</span></span><span> times3_f </span><span class="main"><span>(</span></span><span class="keyword2"><span>float</span></span><span class="main"><span>)</span></span><span>"</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.times3_pf_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.times3_pf_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.times3_pf_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.times3_pf|const"><span>times3_pf</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.single|type"><span>single</span></a><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>*</span></a></span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.single|type"><span>single</span></a><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ptr|type"><span>ptr</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.single|type"><span>single</span></a><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llM|type"><span>llM</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>times3_pf</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_load|const"><span>ll_load</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_extract_value|const"><span>ll_extract_value</span></a><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>b</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_extract_value|const"><span>ll_extract_value</span></a><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>x'</span></span><span class="main"><span>←</span></span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_fadd_f|const"><span>ll_fadd_f</span></a><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>x'</span></span><span class="main"><span>←</span></span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_fadd_f|const"><span>ll_fadd_f</span></a><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>;</span></span><span>
    </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="bound"><span>x'</span></span><span>
  </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>export_llvm</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.times3_pf|const"><span>times3_pf</span></a></span><span> </span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span>"</span><span class="keyword2"><span>float</span></span><span> times3_f </span><span class="main"><span>(</span></span><span>dpair</span><span class="main"><span>*</span></span><span class="main"><span>)</span></span><span>"</span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>defines</span></span></span><span> </span><span class="quoted"><span>‹</span><span class="keyword1"><span>typedef</span></span><span> </span><span class="keyword1"><span>struct</span></span><span> </span><span class="main"><span>{</span></span><span class="keyword2"><span>float</span></span><span> a</span><span class="main"><span>;</span></span><span> </span><span class="keyword2"><span>float</span></span><span> b</span><span class="main"><span>;</span></span><span class="main"><span>}</span></span><span> dpair</span><span class="main"><span>;</span></span><span>›</span></span><span>


</span><span class="keyword1"><span class="command"><span>value</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.real_of_single|const"><span>real_of_single</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.single_of_word|const"><span>single_of_word</span></a><span> </span><span class="numeral"><span>0x3F000000</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="comment1"><span>(* TODO: More meaningful tests, and check results! 

  f (a,b) = (sqrt (a<span class="hidden">⇧</span><sup>2</sup> + b<span class="hidden">⇧</span><sup>2</sup>) - a/b) fmod (a+b)

*)</span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_float_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_float_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_float_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_float|const"><span>test_float</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.single|type"><span>single</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.single|type"><span>single</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.single|type"><span>single</span></a><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llM|type"><span>llM</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>test_float</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><span class="bound"><span>aa</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_fmul_f|const"><span>ll_fmul_f</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>bb</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_fmul_f|const"><span>ll_fmul_f</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_fadd_f|const"><span>ll_fadd_f</span></a><span> </span><span class="bound"><span>aa</span></span><span> </span><span class="bound"><span>bb</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_sqrt_f32|const"><span>ll_sqrt_f32</span></a><span> </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>2</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_fdiv_f|const"><span>ll_fdiv_f</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_fsub_f|const"><span>ll_fsub_f</span></a><span> </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>2</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_fadd_f|const"><span>ll_fadd_f</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_frem_f|const"><span>ll_frem_f</span></a><span> </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_fadd_f|const"><span>ll_fadd_f</span></a><span> </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.single_of_word|const"><span>single_of_word</span></a><span> </span><span class="numeral"><span>0x3F000000</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  
    </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span>
  </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

  
</span><span class="keyword1"><span class="command"><span>export_llvm</span></span></span><span> 
  </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.test_float|const"><span>test_float</span></a></span><span> </span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span>"</span><span class="keyword2"><span>float</span></span><span> test_float</span><span class="main"><span>(</span></span><span class="keyword2"><span>float</span></span><span class="main"><span>,</span></span><span class="keyword2"><span>float</span></span><span class="main"><span>)</span></span><span>"</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>file</span></span></span><span> </span><span class="quoted"><span>"../../../regression/gencode/test_float.ll"</span></span><span>


</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.times3_d_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.times3_d_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.times3_d_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.times3_d|const"><span>times3_d</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.double|type"><span>double</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.double|type"><span>double</span></a><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llM|type"><span>llM</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>times3_d</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><span class="bound"><span>x'</span></span><span class="main"><span>←</span></span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_fadd_d|const"><span>ll_fadd_d</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>x'</span></span><span class="main"><span>←</span></span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_fadd_d|const"><span>ll_fadd_d</span></a><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>x'</span></span><span class="main"><span>←</span></span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_fadd_d|const"><span>ll_fadd_d</span></a><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.double_of_word|const"><span>double_of_word</span></a><span> </span><span class="numeral"><span>0x3FD5555555555555</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="bound"><span>x'</span></span><span>
  </span><span class="main"><span>}</span></span><span>"</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>export_llvm</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.times3_d|const"><span>times3_d</span></a></span><span> </span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span>"</span><span class="keyword2"><span>double</span></span><span> times3_d </span><span class="main"><span>(</span></span><span class="keyword2"><span>double</span></span><span class="main"><span>)</span></span><span>"</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.times3_pd_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.times3_pd_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.times3_pd_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.times3_pd|const"><span>times3_pd</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.double|type"><span>double</span></a><span class="main"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>*</span></a></span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.double|type"><span>double</span></a><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ptr|type"><span>ptr</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.double|type"><span>double</span></a><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llM|type"><span>llM</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>times3_pd</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_load|const"><span>ll_load</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_extract_value|const"><span>ll_extract_value</span></a><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>b</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_extract_value|const"><span>ll_extract_value</span></a><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>x'</span></span><span class="main"><span>←</span></span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_fadd_d|const"><span>ll_fadd_d</span></a><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>x'</span></span><span class="main"><span>←</span></span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_fadd_d|const"><span>ll_fadd_d</span></a><span> </span><span class="bound"><span>x'</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>;</span></span><span>
    </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="bound"><span>x'</span></span><span>
  </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>export_llvm</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.times3_pd|const"><span>times3_pd</span></a></span><span> </span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span>"</span><span class="keyword2"><span>double</span></span><span> times3_d </span><span class="main"><span>(</span></span><span>dpair</span><span class="main"><span>*</span></span><span class="main"><span>)</span></span><span>"</span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>defines</span></span></span><span> </span><span class="quoted"><span>‹</span><span class="keyword1"><span>typedef</span></span><span> </span><span class="keyword1"><span>struct</span></span><span> </span><span class="main"><span>{</span></span><span class="keyword2"><span>double</span></span><span> a</span><span class="main"><span>;</span></span><span> </span><span class="keyword2"><span>double</span></span><span> b</span><span class="main"><span>;</span></span><span class="main"><span>}</span></span><span> dpair</span><span class="main"><span>;</span></span><span>›</span></span><span>


</span><span class="keyword1"><span class="command"><span>value</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.real_of_double|const"><span>real_of_double</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.double_of_word|const"><span>double_of_word</span></a><span> </span><span class="numeral"><span>0x3FE0000000000000</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="comment1"><span>(* TODO: More meaningful tests, and check results! 

  f (a,b) = (sqrt (a<span class="hidden">⇧</span><sup>2</sup> + b<span class="hidden">⇧</span><sup>2</sup>) - a/b) fmod (a+b)

*)</span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_double_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_double_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_double_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_double|const"><span>test_double</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.double|type"><span>double</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.double|type"><span>double</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.double|type"><span>double</span></a><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llM|type"><span>llM</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>test_double</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span>
    </span><span class="bound"><span>aa</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_fmul_d|const"><span>ll_fmul_d</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>bb</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_fmul_d|const"><span>ll_fmul_d</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_fadd_d|const"><span>ll_fadd_d</span></a><span> </span><span class="bound"><span>aa</span></span><span> </span><span class="bound"><span>bb</span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_sqrt_f64|const"><span>ll_sqrt_f64</span></a><span> </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>2</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_fdiv_d|const"><span>ll_fdiv_d</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_fsub_d|const"><span>ll_fsub_d</span></a><span> </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>2</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_fadd_d|const"><span>ll_fadd_d</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_frem_d|const"><span>ll_frem_d</span></a><span> </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>;</span></span><span>
    </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_fadd_d|const"><span>ll_fadd_d</span></a><span> </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.double_of_word|const"><span>double_of_word</span></a><span> </span><span class="numeral"><span>0x3FE0000000000000</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  
    </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span>
  </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

  
</span><span class="keyword1"><span class="command"><span>export_llvm</span></span></span><span> 
  </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.test_double|const"><span>test_double</span></a></span><span> </span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span>"</span><span class="keyword2"><span>double</span></span><span> test_double</span><span class="main"><span>(</span></span><span class="keyword2"><span>double</span></span><span class="main"><span>,</span></span><span class="keyword2"><span>double</span></span><span class="main"><span>)</span></span><span>"</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>file</span></span></span><span> </span><span class="quoted"><span>"../../../regression/gencode/test_double.ll"</span></span><span>
  
  
  
</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.rm_opposite_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.rm_opposite_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.rm_opposite_def_raw|axiom"><span class="entity_def" id="offset_38479..38489">definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.rm_opposite|const"><span>rm_opposite</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>rm</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> 
  </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>rm</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.AVX512_FROUND_TO_POS_INF_NO_EXC|const"><span>AVX512_FROUND_TO_POS_INF_NO_EXC</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.AVX512_FROUND_TO_NEG_INF_NO_EXC|const"><span>AVX512_FROUND_TO_NEG_INF_NO_EXC</span></a><span>
  </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>rm</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.AVX512_FROUND_TO_NEG_INF_NO_EXC|const"><span>AVX512_FROUND_TO_NEG_INF_NO_EXC</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.AVX512_FROUND_TO_POS_INF_NO_EXC|const"><span>AVX512_FROUND_TO_POS_INF_NO_EXC</span></a><span>
  </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>rm</span></span></span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.rm_opposite_inlines|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.rm_opposite_inlines(4)|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.rm_opposite_inlines(3)|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.rm_opposite_inlines(2)|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.rm_opposite_inlines(1)|thm"><span>rm_opposite_inlines</span></span></span></span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_pre_simp|attribute"><span class="operator"><span>llvm_pre_simp</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.rm_opposite|const"><span>rm_opposite</span></a><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.AVX512_FROUND_TO_POS_INF_NO_EXC|const"><span>AVX512_FROUND_TO_POS_INF_NO_EXC</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.AVX512_FROUND_TO_NEG_INF_NO_EXC|const"><span>AVX512_FROUND_TO_NEG_INF_NO_EXC</span></a><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.rm_opposite|const"><span>rm_opposite</span></a><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.AVX512_FROUND_TO_NEG_INF_NO_EXC|const"><span>AVX512_FROUND_TO_NEG_INF_NO_EXC</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.AVX512_FROUND_TO_POS_INF_NO_EXC|const"><span>AVX512_FROUND_TO_POS_INF_NO_EXC</span></a><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.rm_opposite|const"><span>rm_opposite</span></a><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.AVX512_FROUND_TO_NEAREST_NO_EXC|const"><span>AVX512_FROUND_TO_NEAREST_NO_EXC</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.AVX512_FROUND_TO_NEAREST_NO_EXC|const"><span>AVX512_FROUND_TO_NEAREST_NO_EXC</span></a><span>"</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.rm_opposite|const"><span>rm_opposite</span></a><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.AVX512_FROUND_TO_ZERO_NO_EXC|const"><span>AVX512_FROUND_TO_ZERO_NO_EXC</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.AVX512_FROUND_TO_ZERO_NO_EXC|const"><span>AVX512_FROUND_TO_ZERO_NO_EXC</span></a><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#offset_38479..38489"><span>rm_opposite_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  

</span><span class="comment1"><span>(*
  f (a,b) = (sqrt (a<span class="hidden">⇧</span><sup>2</sup> + b<span class="hidden">⇧</span><sup>2</sup>) - a/b) + a
                      ^ fused multiply-add
                               ^ needs to round opposite way
*)</span></span><span>


</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_tmpl_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_tmpl_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_tmpl_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_tmpl|const"><span>test_avx512f_ss_tmpl</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.single|type"><span>single</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.single|type"><span>single</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.single|type"><span>single</span></a><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llM|type"><span>llM</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_pre_simp|attribute"><span class="operator"><span>llvm_pre_simp</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>test_avx512f_ss_tmpl</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>rm</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span>
  </span><span class="bound"><span>aa</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_x86_avx512_mul_ss_round|const"><span>ll_x86_avx512_mul_ss_round</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>rm</span></span></span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>;</span></span><span>
  </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_x86_avx512_vfmadd_f32|const"><span>ll_x86_avx512_vfmadd_f32</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>rm</span></span></span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="bound"><span>aa</span></span><span class="main"><span>;</span></span><span>
  </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_x86_avx512_sqrt_ss|const"><span>ll_x86_avx512_sqrt_ss</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>rm</span></span></span></span><span> </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span>;</span></span><span>
  </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>2</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_x86_avx512_div_ss_round|const"><span>ll_x86_avx512_div_ss_round</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.rm_opposite|const"><span>rm_opposite</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>rm</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>;</span></span><span>
  </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_x86_avx512_sub_ss_round|const"><span>ll_x86_avx512_sub_ss_round</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>rm</span></span></span></span><span> </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>;</span></span><span>
  </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_x86_avx512_add_ss_round|const"><span>ll_x86_avx512_add_ss_round</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>rm</span></span></span></span><span> </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>;</span></span><span>

  </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span>
</span><span class="main"><span>}</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_to_nearest_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_to_nearest_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_to_nearest_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_to_nearest|const"><span>test_avx512f_ss_to_nearest</span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_tmpl|const"><span>test_avx512f_ss_tmpl</span></a><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.AVX512_FROUND_TO_NEAREST_NO_EXC|const"><span>AVX512_FROUND_TO_NEAREST_NO_EXC</span></a><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_to_pinf_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_to_pinf_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_to_pinf_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_to_pinf|const"><span>test_avx512f_ss_to_pinf</span></span></span><span>    </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_tmpl|const"><span>test_avx512f_ss_tmpl</span></a><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.AVX512_FROUND_TO_POS_INF_NO_EXC|const"><span>AVX512_FROUND_TO_POS_INF_NO_EXC</span></a><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_to_ninf_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_to_ninf_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_to_ninf_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_to_ninf|const"><span>test_avx512f_ss_to_ninf</span></span></span><span>    </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_tmpl|const"><span>test_avx512f_ss_tmpl</span></a><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.AVX512_FROUND_TO_NEG_INF_NO_EXC|const"><span>AVX512_FROUND_TO_NEG_INF_NO_EXC</span></a><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_to_zero_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_to_zero_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_to_zero_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_to_zero|const"><span>test_avx512f_ss_to_zero</span></span></span><span>    </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_tmpl|const"><span>test_avx512f_ss_tmpl</span></a><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.AVX512_FROUND_TO_ZERO_NO_EXC|const"><span>AVX512_FROUND_TO_ZERO_NO_EXC</span></a><span>"</span></span></span><span>



</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_tmpl_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_tmpl_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_tmpl_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_tmpl|const"><span>test_avx512f_sd_tmpl</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.double|type"><span>double</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.double|type"><span>double</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="LLVM_Float_Types.html#LLVM_Float_Types.double|type"><span>double</span></a><span> </span><a class="entity_ref" href="Simple_Memory.html#Simple_Memory.llM|type"><span>llM</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_pre_simp|attribute"><span class="operator"><span>llvm_pre_simp</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>test_avx512f_sd_tmpl</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>rm</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>λ</span></span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>doM</span></span><span> </span><span class="main"><span>{</span></span><span>
  </span><span class="bound"><span>aa</span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_x86_avx512_mul_sd_round|const"><span>ll_x86_avx512_mul_sd_round</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>rm</span></span></span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>;</span></span><span>
  </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_x86_avx512_vfmadd_f64|const"><span>ll_x86_avx512_vfmadd_f64</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>rm</span></span></span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="bound"><span>aa</span></span><span class="main"><span>;</span></span><span>
  </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_x86_avx512_sqrt_sd|const"><span>ll_x86_avx512_sqrt_sd</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>rm</span></span></span></span><span> </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span>;</span></span><span>
  </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>2</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_x86_avx512_div_sd_round|const"><span>ll_x86_avx512_div_sd_round</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.rm_opposite|const"><span>rm_opposite</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>rm</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>;</span></span><span>
  </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_x86_avx512_sub_sd_round|const"><span>ll_x86_avx512_sub_sd_round</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>rm</span></span></span></span><span> </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>;</span></span><span>
  </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="main"><span>←</span></span><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.ll_x86_avx512_add_sd_round|const"><span>ll_x86_avx512_add_sd_round</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>rm</span></span></span></span><span> </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>;</span></span><span>

  </span><a class="entity_ref" href="MMonad.html#MMonad.Mreturn|const"><span>Mreturn</span></a><span> </span><span class="bound"><span>t<span class="hidden">⇩</span><sub>1</sub></span></span><span>
</span><span class="main"><span>}</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_to_nearest_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_to_nearest_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_to_nearest_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_to_nearest|const"><span>test_avx512f_sd_to_nearest</span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_tmpl|const"><span>test_avx512f_sd_tmpl</span></a><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.AVX512_FROUND_TO_NEAREST_NO_EXC|const"><span>AVX512_FROUND_TO_NEAREST_NO_EXC</span></a><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_to_pinf_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_to_pinf_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_to_pinf_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_to_pinf|const"><span>test_avx512f_sd_to_pinf</span></span></span><span>    </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_tmpl|const"><span>test_avx512f_sd_tmpl</span></a><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.AVX512_FROUND_TO_POS_INF_NO_EXC|const"><span>AVX512_FROUND_TO_POS_INF_NO_EXC</span></a><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_to_ninf_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_to_ninf_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_to_ninf_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_to_ninf|const"><span>test_avx512f_sd_to_ninf</span></span></span><span>    </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_tmpl|const"><span>test_avx512f_sd_tmpl</span></a><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.AVX512_FROUND_TO_NEG_INF_NO_EXC|const"><span>AVX512_FROUND_TO_NEG_INF_NO_EXC</span></a><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_to_zero_def|fact"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_to_zero_def|thm"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_to_zero_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.llvm_code|attribute"><span class="operator"><span>llvm_code</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_to_zero|const"><span>test_avx512f_sd_to_zero</span></span></span><span>    </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_tmpl|const"><span>test_avx512f_sd_tmpl</span></a><span> </span><a class="entity_ref" href="LLVM_Shallow.html#LLVM_Shallow.AVX512_FROUND_TO_ZERO_NO_EXC|const"><span>AVX512_FROUND_TO_ZERO_NO_EXC</span></a><span>"</span></span></span><span>




</span><span class="keyword1"><span class="command"><span>declare</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><a class="entity_ref" href="LLVM_Codegen.html#LLVM_Codegen.llc_compile_avx512f|attribute"><span class="operator"><span>llc_compile_avx512f</span></span></a><span class="main"><span class="main"><span>=</span></span></span><span class="quasi_keyword"><span>true</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>  
</span><span class="keyword1"><span class="command"><span>export_llvm</span></span></span><span> 
  </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_to_nearest|const"><span>test_avx512f_ss_to_nearest</span></a></span><span> </span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span>"</span><span class="keyword2"><span>float</span></span><span> test_avx512f_ss_to_nearest</span><span class="main"><span>(</span></span><span class="keyword2"><span>float</span></span><span class="main"><span>,</span></span><span class="keyword2"><span>float</span></span><span class="main"><span>)</span></span><span>"</span></span><span>
  </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_to_pinf|const"><span>test_avx512f_ss_to_pinf</span></a></span><span>    </span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span>"</span><span class="keyword2"><span>float</span></span><span> test_avx512f_ss_to_pinf   </span><span class="main"><span>(</span></span><span class="keyword2"><span>float</span></span><span class="main"><span>,</span></span><span class="keyword2"><span>float</span></span><span class="main"><span>)</span></span><span>"</span></span><span>
  </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_to_ninf|const"><span>test_avx512f_ss_to_ninf</span></a></span><span>    </span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span>"</span><span class="keyword2"><span>float</span></span><span> test_avx512f_ss_to_ninf   </span><span class="main"><span>(</span></span><span class="keyword2"><span>float</span></span><span class="main"><span>,</span></span><span class="keyword2"><span>float</span></span><span class="main"><span>)</span></span><span>"</span></span><span>
  </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.test_avx512f_ss_to_zero|const"><span>test_avx512f_ss_to_zero</span></a></span><span>    </span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span>"</span><span class="keyword2"><span>float</span></span><span> test_avx512f_ss_to_zero   </span><span class="main"><span>(</span></span><span class="keyword2"><span>float</span></span><span class="main"><span>,</span></span><span class="keyword2"><span>float</span></span><span class="main"><span>)</span></span><span>"</span></span><span>
  </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_to_nearest|const"><span>test_avx512f_sd_to_nearest</span></a></span><span> </span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span>"</span><span class="keyword2"><span>double</span></span><span> test_avx512f_sd_to_nearest</span><span class="main"><span>(</span></span><span class="keyword2"><span>double</span></span><span class="main"><span>,</span></span><span class="keyword2"><span>double</span></span><span class="main"><span>)</span></span><span>"</span></span><span>
  </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_to_pinf|const"><span>test_avx512f_sd_to_pinf</span></a></span><span>    </span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span>"</span><span class="keyword2"><span>double</span></span><span> test_avx512f_sd_to_pinf   </span><span class="main"><span>(</span></span><span class="keyword2"><span>double</span></span><span class="main"><span>,</span></span><span class="keyword2"><span>double</span></span><span class="main"><span>)</span></span><span>"</span></span><span>
  </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_to_ninf|const"><span>test_avx512f_sd_to_ninf</span></a></span><span>    </span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span>"</span><span class="keyword2"><span>double</span></span><span> test_avx512f_sd_to_ninf   </span><span class="main"><span>(</span></span><span class="keyword2"><span>double</span></span><span class="main"><span>,</span></span><span class="keyword2"><span>double</span></span><span class="main"><span>)</span></span><span>"</span></span><span>
  </span><span class="quoted"><a class="entity_ref" href="LLVM_Codegen_Preproc.html#LLVM_Codegen_Preproc.experiment7574766.test_avx512f_sd_to_zero|const"><span>test_avx512f_sd_to_zero</span></a></span><span>    </span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span>"</span><span class="keyword2"><span>double</span></span><span> test_avx512f_sd_to_zero   </span><span class="main"><span>(</span></span><span class="keyword2"><span>double</span></span><span class="main"><span>,</span></span><span class="keyword2"><span>double</span></span><span class="main"><span>)</span></span><span>"</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>file</span></span></span><span> </span><span class="quoted"><span>"../../../regression/gencode/test_avx512f.ll"</span></span><span>

    
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span></pre>
</body>

</html>