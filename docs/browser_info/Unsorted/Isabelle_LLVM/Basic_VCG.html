<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Basic_VCG</title>
</head>


<body>
<div class="head">
<h1>Theory Basic_VCG</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Generic VCG Framework›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>theory</span></span></span><span> </span><a href="Basic_VCG.html"><span>Basic_VCG</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>imports</span></span></span><span> </span><a href="../../HOL/HOL/Main.html"><span>Main</span></a><span> </span><a href="Defer_Slot.html"><span>Defer_Slot</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹
  This theory provides a generic VCG framework. The main features are:
  
  </span><span class="antiquoted"><span>▪</span></span><span> Automatic creation of framed rules from frame-rules and vcg-rules:
    The frame-rules are combined with the vcg rules to form the actual rule to be applied.
  
  </span><span class="antiquoted"><span>▪</span></span><span> Backtracking control via rule priorities and PRECOND-tag:
      </span><span class="antiquoted"><span>▪</span></span><span> The rules are ordered by user-specifiable priorities
      </span><span class="antiquoted"><span>▪</span></span><span> Assumptions marked with PRECOND must be solved in order for the rule to be applicable.
        The VCG is the iterated on the remaining subgoals. 
    
  </span><span class="antiquoted"><span>▪</span></span><span> Solver infrastructure. The user can register solvers, that are activated 
    for subgoals that match a solver-specific shape.

›</span></span></span><span>


  </span><span class="keyword1"><span class="command"><span>ML_file</span></span></span><span> </span><span class="quoted"><a href="USER_HOME/devel/isabelle/isabelle_llvm_2023/thys/lib/subgoal_focus_some.ML.html"><span>‹subgoal_focus_some.ML›</span></a></span><span>

  </span><span class="keyword1"><span class="command"><span>named_theorems</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_tag_defs|attribute"><span class="entity_def" id="Basic_VCG.vcg_tag_defs|fact"><span>vcg_tag_defs</span></span></span><span> </span><span class="quoted"><span>‹Definitions of internal tags›</span></span><span>


  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Basic_VCG.PROTECT_def|fact"><span class="entity_def" id="Basic_VCG.PROTECT_def|thm"><span class="entity_def" id="Basic_VCG.PROTECT_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_tag_defs|attribute"><span class="operator"><span>vcg_tag_defs</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Basic_VCG.PROTECT|const"><span>PROTECT</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.PROTECT_cong|fact"><span class="entity_def" id="Basic_VCG.PROTECT_cong|thm"><span>PROTECT_cong</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>cong</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.PROTECT|const"><span>PROTECT</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.PROTECT|const"><span>PROTECT</span></a><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>..</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.PROTECTI|fact"><span class="entity_def" id="Basic_VCG.PROTECTI|thm"><span>PROTECTI</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Φ</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.PROTECT|const"><span>PROTECT</span></a><span> </span><span class="free"><span>Φ</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.PROTECTD|fact"><span class="entity_def" id="Basic_VCG.PROTECTD|thm"><span>PROTECTD</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.PROTECT|const"><span>PROTECT</span></a><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Φ</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.PROTECT_def|fact"><span>PROTECT_def</span></a><span class="main"><span>)</span></span><span>


  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Basic_VCG.CONCLUSION_def|fact"><span class="entity_def" id="Basic_VCG.CONCLUSION_def|thm"><span class="entity_def" id="Basic_VCG.CONCLUSION_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_tag_defs|attribute"><span class="operator"><span>vcg_tag_defs</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Basic_VCG.CONCLUSION|const"><span>CONCLUSION</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.CONCLUSIONI|fact"><span class="entity_def" id="Basic_VCG.CONCLUSIONI|thm"><span>CONCLUSIONI</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Φ</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.CONCLUSION|const"><span>CONCLUSION</span></a><span> </span><span class="free"><span>Φ</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.CONCLUSIOND|fact"><span class="entity_def" id="Basic_VCG.CONCLUSIOND|thm"><span>CONCLUSIOND</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.CONCLUSION|const"><span>CONCLUSION</span></a><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Φ</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.CONCLUSION_def|fact"><span>CONCLUSION_def</span></a><span class="main"><span>)</span></span><span>
    
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.recover_CONCLUSIONE|fact"><span class="entity_def" id="Basic_VCG.recover_CONCLUSIONE|thm"><span>recover_CONCLUSIONE</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.CONCLUSION|const"><span>CONCLUSION</span></a><span> </span><span class="free"><span>P</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>thesis</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>thesis</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.CONCLUSION_def|fact"><span>CONCLUSION_def</span></a><span class="main"><span>)</span></span><span>
    
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.CONCLUSION_intro|fact"><span class="entity_def" id="Basic_VCG.CONCLUSION_intro(3)|thm"><span class="entity_def" id="Basic_VCG.CONCLUSION_intro(2)|thm"><span class="entity_def" id="Basic_VCG.CONCLUSION_intro(1)|thm"><span>CONCLUSION_intro</span></span></span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.intro|attribute"><span class="operator"><span>intro</span></span></a><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span>!</span></span></span></span></span></span></span></span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.CONCLUSION|const"><span>CONCLUSION</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span>"</span></span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>P</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.CONCLUSION|const"><span>CONCLUSION</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.CONCLUSION|const"><span>CONCLUSION</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>P</span></span><span> </span><span class="bound"><span>Q</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>⟦</span></span><span> </span><span class="bound"><span>P</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.CONCLUSION|const"><span>CONCLUSION</span></a><span> </span><span class="bound"><span>Q</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.CONCLUSION|const"><span>CONCLUSION</span></a><span> </span><span class="main"><span>(</span></span><span class="bound"><span>P</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span class="bound"><span>Q</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.CONCLUSION_def|fact"><span>CONCLUSION_def</span></a><span class="main"><span>)</span></span><span>
    
  </span><span class="keyword1"><span class="command"><span>ML</span></span></span><span> </span><span class="quoted"><span>‹
    </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>VCG_Lib</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>
    
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>simp_only_tac</span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>simp_tac</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> 
        </span><span>addsimps</span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span>
    
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>simp_named_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>simp_only_tac</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>  

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>full_simp_only_tac</span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>full_simp_tac</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> 
        </span><span>addsimps</span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span>
    
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>full_simp_named_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>full_simp_only_tac</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>  

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>asm_simp_only_tac</span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>asm_simp_tac</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> 
        </span><span>addsimps</span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span>
    
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>asm_simp_named_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>asm_simp_only_tac</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>  
      
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>simp_named_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>simp_tac</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Named_Simpsets.put</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>full_simp_named_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>full_simp_tac</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Named_Simpsets.put</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>asm_simp_named_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>asm_simp_tac</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Named_Simpsets.put</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>asm_full_simp_named_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>asm_full_simp_tac</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Named_Simpsets.put</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
      
      

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rewrite_only_conv</span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Simplifier.rewrite</span></span><span> </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> 
        </span><span>addsimps</span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span>
                  
          
      </span><span class="comment1"><span>(* Apply conversion on given constant and its arguments *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tag_conv</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="entity"><span>cv</span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>head_of</span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name'</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>=</span></span><span class="entity"><span>name'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>cv</span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"tag_conv "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ct</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"tag_conv "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ct</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>  
        
  
      </span><span class="comment1"><span>(* Apply conversion on all premises tagged with constant (and Trueprop!)*)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>in_tag_prems_conv</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="entity"><span>cv</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Conv.params_conv</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Conv.prems_conv</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span>Conv.try_conv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.Trueprop_conv</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tag_conv</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>)</span></span><span>

      </span><span class="comment1"><span>(* Simplify only given tag in premises *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>simplify_tag_tac</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>CONVERSION</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>in_tag_prems_conv</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Simplifier.rewrite</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
      
      </span><span class="comment1"><span>(* Simplify premises, may solve goal *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>simplify_prems_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> 
        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.PROTECTD|fact"><span>PROTECTD</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>asm_full_simp_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>THEN_ALL_NEW</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.PROTECTI|fact"><span>PROTECTI</span></a><span class="antiquote"><span>}</span></span></span></span><span>
      
        
      </span><span class="comment1"><span>(* Recover conclusion if the argument tactic put it into the assumptions in negated form.
        rc_tac is invoked on goal with recovered conclusion, if recovery took place.
        It's allowed for tac to solve the goal, in which case no recovery is attempted.
        
        This tactic is useful to clarify subgoals, but with the guarantee that the 
        conclusion is preserved.
        
        Note that you should have the CONCLUSION_intro rule.
        
      *)</span></span><span>  
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>RECOVER_CONCLUSION'</span></span><span> </span><span class="entity"><span>rc_tac</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> 
        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.CONCLUSIOND|fact"><span>CONCLUSIOND</span></a><span class="antiquote"><span>}</span></span></span></span><span>
        </span><span>THEN'</span><span> </span><span class="entity"><span>tac</span></span><span>
        </span><span>THEN_ALL_NEW</span><span> </span><span class="main"><span>(</span></span><span>
          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.CONCLUSIONI|fact"><span>CONCLUSIONI</span></a><span class="antiquote"><span>}</span></span></span></span><span>
          </span><span>ORELSE'</span><span>
          </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.recover_CONCLUSIONE|fact"><span>recover_CONCLUSIONE</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>rc_tac</span></span><span>
        </span><span class="main"><span>)</span></span><span>
        
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>RECOVER_CONCLUSION</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>RECOVER_CONCLUSION'</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>all_tac</span><span class="main"><span>)</span></span><span>
        
      
      </span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>apply_decl_attribute</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>attr</span></span><span class="main"><span>:</span></span><span>attribute</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>attr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>context</span></span><span class="main"><span>,</span></span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>fst</span><span> </span><span>|&gt;</span><span> </span><span>the_default</span><span> </span><span class="entity"><span>context</span></span><span>
    
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>          
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>chain_decl_attribs</span></span><span> </span><span class="entity"><span>attrs</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span>attribute</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>context</span></span><span class="main"><span>,</span></span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>apply_decl_attribute</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>attrs</span></span><span> </span><span class="entity"><span>context</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
    
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_attribs</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>attrs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Attrib.attribute</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>attrs</span></span><span>
        
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>chained_decl_attr</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>attrs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>chain_decl_attribs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>parse_attribs</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>attrs</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>    
      
      
      
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  ›</span></span><span>


  </span><span class="comment1"><span>(* Tag for preconditions that must be solved in order for rule to apply *)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Basic_VCG.PRECOND_def|fact"><span class="entity_def" id="Basic_VCG.PRECOND_def|thm"><span class="entity_def" id="Basic_VCG.PRECOND_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_tag_defs|attribute"><span class="operator"><span>vcg_tag_defs</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Basic_VCG.PRECOND|const"><span>PRECOND</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Φ</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Φ</span></span></span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.PRECONDI|fact"><span class="entity_def" id="Basic_VCG.PRECONDI|thm"><span>PRECONDI</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Φ</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.PRECOND|const"><span>PRECOND</span></a><span> </span><span class="free"><span>Φ</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.PRECOND_def|fact"><span>PRECOND_def</span></a><span class="main"><span>)</span></span><span>  

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Basic_VCG.PRIO_def|fact"><span class="entity_def" id="Basic_VCG.PRIO_def|thm"><span class="entity_def" id="Basic_VCG.PRIO_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Basic_VCG.PRIO|const"><span>PRIO</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'a</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../HOL/HOL/Num.html#Num.numeral|class"><span>numeral</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_tag_defs|attribute"><span class="operator"><span>vcg_tag_defs</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>PRIO</span></span><span> </span><span class="main"><span class="bound"><span class="entity"><span>_</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.PRIOI|fact"><span class="entity_def" id="Basic_VCG.PRIOI|thm"><span>PRIOI</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.PRIO|const"><span>PRIO</span></a><span> </span><span class="free"><span>i</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.PRIO_def|fact"><span>PRIO_def</span></a><span class="main"><span>)</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>named_theorems</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_normalize_simps|attribute"><span class="entity_def" id="Basic_VCG.vcg_normalize_simps|fact"><span>vcg_normalize_simps</span></span></span><span> </span><span class="quoted"><span>‹Additional normalization rules›</span></span><span>
  </span><span class="keyword1"><span class="command"><span>named_theorems</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_normalize_congs|attribute"><span class="entity_def" id="Basic_VCG.vcg_normalize_congs|fact"><span>vcg_normalize_congs</span></span></span><span> </span><span class="quoted"><span>‹Additional normalization congruences›</span></span><span>
  </span><span class="keyword1"><span class="command"><span>named_theorems</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_normalize_nosplits|attribute"><span class="entity_def" id="Basic_VCG.vcg_normalize_nosplits|fact"><span>vcg_normalize_nosplits</span></span></span><span> </span><span class="quoted"><span>‹Split rules to be removed for normalization›</span></span><span> 
    </span><span class="comment1"><span>(* TODO/FIXME: How to specify the positive set here? Can we erase all split rules? *)</span></span><span>
 
  </span><span class="keyword1"><span class="command"><span>declare</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.if_split|fact"><span>if_split</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_normalize_nosplits|attribute"><span class="operator"><span>vcg_normalize_nosplits</span></span></a><span class="main"><span>]</span></span><span>
    
  </span><span class="comment1"><span>(*
    Either apply decomposition rule, 
    or apply a frame-rule instantiated with a rule
  *)</span></span><span>
     
  </span><span class="keyword1"><span class="command"><span>named_theorems</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_decomp_rules|attribute"><span class="entity_def" id="Basic_VCG.vcg_decomp_rules|fact"><span>vcg_decomp_rules</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>named_theorems</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_decomp_erules|attribute"><span class="entity_def" id="Basic_VCG.vcg_decomp_erules|fact"><span>vcg_decomp_erules</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>named_theorems</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_rules|attribute"><span class="entity_def" id="Basic_VCG.vcg_rules|fact"><span>vcg_rules</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>named_theorems</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_frame_rules|attribute"><span class="entity_def" id="Basic_VCG.vcg_frame_rules|fact"><span>vcg_frame_rules</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>named_theorems</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_frame_erules|attribute"><span class="entity_def" id="Basic_VCG.vcg_frame_erules|fact"><span>vcg_frame_erules</span></span></span><span>

  
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Basic_VCG.VCG_DECOMP_RULE_def|fact"><span class="entity_def" id="Basic_VCG.VCG_DECOMP_RULE_def|thm"><span class="entity_def" id="Basic_VCG.VCG_DECOMP_RULE_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Basic_VCG.VCG_DECOMP_RULE|const"><span>VCG_DECOMP_RULE</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_tag_defs|attribute"><span class="operator"><span>vcg_tag_defs</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>VCG_DECOMP_RULE</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Basic_VCG.VCG_DECOMP_ERULE_def|fact"><span class="entity_def" id="Basic_VCG.VCG_DECOMP_ERULE_def|thm"><span class="entity_def" id="Basic_VCG.VCG_DECOMP_ERULE_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Basic_VCG.VCG_DECOMP_ERULE|const"><span>VCG_DECOMP_ERULE</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_tag_defs|attribute"><span class="operator"><span>vcg_tag_defs</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>VCG_DECOMP_ERULE</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Basic_VCG.VCG_RULE_def|fact"><span class="entity_def" id="Basic_VCG.VCG_RULE_def|thm"><span class="entity_def" id="Basic_VCG.VCG_RULE_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Basic_VCG.VCG_RULE|const"><span>VCG_RULE</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_tag_defs|attribute"><span class="operator"><span>vcg_tag_defs</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>VCG_RULE</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span>"</span></span></span><span>
    
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> 
    </span><span class="entity_def" id="Basic_VCG.VCG_DECOMP_RULEI|fact"><span class="entity_def" id="Basic_VCG.VCG_DECOMP_RULEI|thm"><span>VCG_DECOMP_RULEI</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>x</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.VCG_DECOMP_RULE|const"><span>VCG_DECOMP_RULE</span></a><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span>
    </span><span class="entity_def" id="Basic_VCG.VCG_DECOMP_RULED|fact"><span class="entity_def" id="Basic_VCG.VCG_DECOMP_RULED|thm"><span>VCG_DECOMP_RULED</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.VCG_DECOMP_RULE|const"><span>VCG_DECOMP_RULE</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span>
    </span><span class="entity_def" id="Basic_VCG.VCG_DECOMP_ERULEI|fact"><span class="entity_def" id="Basic_VCG.VCG_DECOMP_ERULEI|thm"><span>VCG_DECOMP_ERULEI</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>x</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.VCG_DECOMP_ERULE|const"><span>VCG_DECOMP_ERULE</span></a><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span>
    </span><span class="entity_def" id="Basic_VCG.VCG_DECOMP_ERULED|fact"><span class="entity_def" id="Basic_VCG.VCG_DECOMP_ERULED|thm"><span>VCG_DECOMP_ERULED</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.VCG_DECOMP_ERULE|const"><span>VCG_DECOMP_ERULE</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span>
    </span><span class="entity_def" id="Basic_VCG.VCG_RULEI|fact"><span class="entity_def" id="Basic_VCG.VCG_RULEI|thm"><span>VCG_RULEI</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>x</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.VCG_RULE|const"><span>VCG_RULE</span></a><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span>
    </span><span class="entity_def" id="Basic_VCG.VCG_RULED|fact"><span class="entity_def" id="Basic_VCG.VCG_RULED|thm"><span>VCG_RULED</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.VCG_RULE|const"><span>VCG_RULE</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_tag_defs|fact"><span class="dynamic"><span class="dynamic"><span>vcg_tag_defs</span></span></span></a><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>
  
    
  </span><span class="keyword1"><span class="command"><span>ML</span></span></span><span> </span><span class="quoted"><span>‹
    </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Basic_VCG</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Static_Xform_Data</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Generic_Data</span><span>
      </span><span class="main"><span>(</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span class="main"><span>)</span></span><span> </span><span>Name_Space.table</span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>empty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name_Space.empty_table</span><span> </span><span class="inner_quoted"><span>"static rule transformers"</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>merge</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name_Space.merge_tables</span><span>
      </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    
      
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_rule_xformers</span></span><span> </span><span class="entity"><span>verbose</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Static_Xform_Data.get</span><span> </span><span class="main"><span>(</span></span><span>Context.Proof</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pretty_xformer</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Pretty.mark_str</span><span> </span><span class="entity"><span>name</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>Pretty.writeln_chunks</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>pretty_xformer</span></span><span> </span><span class="main"><span>(</span></span><span>Name_Space.markup_table</span><span> </span><span class="entity"><span>verbose</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>table</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>static_xform_rl</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> 
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Static_Xform_Data.get</span><span> </span><span class="main"><span>(</span></span><span>Context.Proof</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cnvs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name_Space.fold_table</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>cnv</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>cnv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>table</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>Conv.fconv_rule</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cnvs</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>  
    
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_static_xformer</span></span><span> </span><span class="entity"><span>bnd</span></span><span> </span><span class="entity"><span>cnv</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span>Static_Xform_Data.map</span><span> </span><span class="main"><span>(</span></span><span>Name_Space.define</span><span> </span><span class="entity"><span>context</span></span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bnd</span></span><span class="main"><span>,</span></span><span class="entity"><span>cnv</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>context</span></span><span>
    
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>get_prio_thm</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> 
        </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.prems_of</span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> 
          </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.PRIO|const"><span>PRIO</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Num.html#Num.numeral_class.numeral|const"><span>numeral</span></a><span> </span><span class="var"><span>?p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span></span><span>::</span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> 
            </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>try</span><span> </span><span class="entity"><span>HOLogic.dest_numeral</span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
              </span><span>SOME</span><span> </span><span class="entity"><span>pr</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pr</span></span><span class="main"><span>,</span></span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.PRIOI|fact"><span>PRIOI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>
              </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"Invalid Priority: "</span></span><span class="main"><span>,</span></span><span> </span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span>
              </span><span>|&gt;</span><span> </span><span>Pretty.string_of</span><span> </span><span>|&gt;</span><span> </span><span>warning</span><span class="main"><span>;</span></span><span>
              </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>100</span></span><span class="main"><span>,</span></span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>  
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>100</span></span><span class="main"><span>,</span></span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span>
            
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_framed_rl_aux</span></span><span> </span><span class="entity"><span>fr_thm</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.nprems_of</span><span> </span><span class="entity"><span>fr_thm</span></span><span>
        
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tr</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>tr</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>ls</span></span><span> </span><span class="main"><span>=</span></span><span> 
              </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>try</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>OF</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fr_thm</span></span><span class="main"><span>,</span></span><span class="entity"><span>ls</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> 
                </span><span>SOME</span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>thm</span></span><span> 
              </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>tr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span>-</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>asm_rl</span><span>::</span><span class="entity"><span>ls</span></span><span class="main"><span>)</span></span><span>
        
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>tr</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_framed_rl</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>simplify_thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>static_xform_rl</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fr_thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> 
          </span><span class="entity"><span>mk_framed_rl_aux</span></span><span> </span><span class="entity"><span>fr_thm</span></span><span> </span><span class="entity"><span>thm</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>map_option</span></span><span> </span><span class="entity"><span>simplify_thm</span></span><span>

      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>frame_rl</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fr_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> vcg_frame_rules</span><span class="antiquote"><span>}</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fr_ethms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> vcg_frame_erules</span><span class="antiquote"><span>}</span></span></span><span>
        
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_frl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_framed_rl</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>                 
          </span><span class="main"><span>(</span></span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fr_thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_frl</span></span><span> </span><span class="entity"><span>fr_thm</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fr_thms</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>false</span><span class="main"><span>,</span></span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>@</span><span>
          </span><span class="main"><span>(</span></span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fr_thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_frl</span></span><span> </span><span class="entity"><span>fr_thm</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fr_ethms</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>true</span><span class="main"><span>,</span></span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>get_rules</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>rl_mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>RULE</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ERULE</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>FRAME</span></span><span>
      
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rls1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> vcg_decomp_rules</span><span class="antiquote"><span>}</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rls1e</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> vcg_decomp_erules</span><span class="antiquote"><span>}</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rls2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> vcg_rules</span><span class="antiquote"><span>}</span></span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rls</span></span><span> </span><span class="main"><span>=</span></span><span> 
            </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>RULE</span></span><span class="main"><span>,</span></span><span class="entity"><span>get_prio_thm</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rls1</span></span><span> 
          </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ERULE</span></span><span class="main"><span>,</span></span><span class="entity"><span>get_prio_thm</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rls1e</span></span><span> 
          </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FRAME</span></span><span class="main"><span>,</span></span><span class="entity"><span>get_prio_thm</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rls2</span></span><span> 
        </span><span>|&gt;</span><span> </span><span>sort</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>int_ord</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>rev_order</span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_frl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>frame_rl</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rls</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> 
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> 
            </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
              </span><span class="entity"><span>FRAME</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_frl</span></span><span> </span><span class="entity"><span>thm</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>RULE</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span>false</span><span class="main"><span>,</span></span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>ERULE</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span>true</span><span class="main"><span>,</span></span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
          </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rls</span></span><span>
        </span><span>|&gt;</span><span> </span><span>flat</span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>rls</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>clear_rules</span></span><span> </span><span class="main"><span>=</span></span><span> 
        </span><span>Context.proof_map</span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>Named_Theorems.clear</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> vcg_decomp_rules</span><span class="antiquote"><span>}</span></span></span><span>
          </span><span>#&gt;</span><span> </span><span class="entity"><span>Named_Theorems.clear</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> vcg_decomp_erules</span><span class="antiquote"><span>}</span></span></span><span>
          </span><span>#&gt;</span><span> </span><span class="entity"><span>Named_Theorems.clear</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> vcg_rules</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>all_framed_rls</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>get_rules</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>|&gt;</span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span>not</span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>snd</span><span>
        
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>all_framed_erls</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>get_rules</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>|&gt;</span><span> </span><span>filter</span><span> </span><span>fst</span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>snd</span><span>
          
          
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>vcg_rl_from_ctxt_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>biresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>get_rules</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
        </span><span class="comment1"><span>(* TODO/ FIXME: Use a net! *)</span></span><span>
              
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>vcg_rl_from_prems_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>clear_rules</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ntadd</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Context.proof_map</span><span> </span><span>oo</span><span> </span><span class="entity"><span>Named_Theorems.add_thm</span></span><span>
        
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_vcg_rl</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Logic.strip_assums_concl</span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.VCG_DECOMP_RULE|const"><span>VCG_DECOMP_RULE</span></a><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.VCG_DECOMP_ERULE|const"><span>VCG_DECOMP_ERULE</span></a><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.VCG_RULE|const"><span>VCG_RULE</span></a><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>declare_vcg_rl</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.concl_of</span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.VCG_DECOMP_RULE|const"><span>VCG_DECOMP_RULE</span></a><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.VCG_DECOMP_RULED|fact"><span>VCG_DECOMP_RULED</span></a><span class="antiquote"><span>}</span></span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ntadd</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> vcg_decomp_rules</span><span class="antiquote"><span>}</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.VCG_DECOMP_ERULE|const"><span>VCG_DECOMP_ERULE</span></a><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.VCG_DECOMP_ERULED|fact"><span>VCG_DECOMP_ERULED</span></a><span class="antiquote"><span>}</span></span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ntadd</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> vcg_decomp_erules</span><span class="antiquote"><span>}</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.VCG_RULE|const"><span>VCG_RULE</span></a><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.VCG_RULED|fact"><span>VCG_RULED</span></a><span class="antiquote"><span>}</span></span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ntadd</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> vcg_rules</span><span class="antiquote"><span>}</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>THM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"declare_vcg_rl: Not a vcg-rule"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
    
      
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>Subgoal_Focus_Some.FOCUS_SOME_PREMS</span></span><span> </span><span class="entity"><span>is_vcg_rl</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="entity"><span>declare_vcg_rl</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span>FIRSTGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vcg_rl_from_ctxt_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
                  
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>vcg_rl_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>vcg_rl_from_ctxt_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>ORELSE'</span><span> </span><span class="entity"><span>vcg_rl_from_prems_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span class="comment1"><span>(* This uses rules from premises only as a fallback.
          TODO: Another option would be to always look for rules in premises,
            and treat them like any other rule!
        *)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Solver_Data</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Generic_Data</span><span> </span><span class="comment1"><span>(* TODO: Non-canonical (possibly wrong) use of binding *)</span></span><span>
      </span><span class="main"><span>(</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>thm</span><span> * </span><span>bool</span><span> * </span><span>binding</span><span> * </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>Item_Net.T</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>empty</span></span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Item_Net.init</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>3</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>3</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>single</span><span> </span><span>o</span><span> </span><span>Thm.concl_of</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>             
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>merge</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>T</span></span><span> * </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Item_Net.merge</span><span class="main"><span>;</span></span><span>
      </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>try_solvers_dflt</span></span><span> </span><span class="entity"><span>keep</span></span><span> </span><span class="entity"><span>dflt_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>net</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Solver_Data.get</span><span> </span><span class="main"><span>(</span></span><span>Context.Proof</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>SUBGOAL</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prem</span></span><span class="main"><span>,</span></span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> 
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>krls</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Item_Net.retrieve_matching</span><span> </span><span class="entity"><span>net</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.strip_assums_concl</span><span> </span><span class="entity"><span>prem</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tacs</span></span><span> </span><span class="main"><span>=</span></span><span> 
            </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span class="entity"><span>is_xform</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>tac</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> 
                </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span> </span><span class="entity"><span>is_xform</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>not</span><span> </span><span class="entity"><span>keep</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>SOLVED'</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>I</span><span class="main"><span>)</span></span><span> 
                </span><span class="main"><span>(</span></span><span>CHANGED</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span class="comment1"><span>(* TODO: Is this CHANGED actually needed? *)</span></span><span>
              </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>krls</span></span><span>
          </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span> </span><span class="entity"><span>keep</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>SOLVED'</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>I</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dflt_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="entity"><span>APPEND_LIST'</span></span><span> </span><span class="entity"><span>tacs</span></span><span> </span><span class="entity"><span>i</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
            
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>try_solvers</span></span><span> </span><span class="entity"><span>keep</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>try_solvers_dflt</span></span><span> </span><span class="entity"><span>keep</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>no_tac</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>try_solve</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>try_solvers</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>solve</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>DETERM</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>try_solvers</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
      
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>try_solve_dflt</span></span><span> </span><span class="entity"><span>dflt_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>try_solvers_dflt</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>dflt_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>solve_dflt</span></span><span> </span><span class="entity"><span>dflt_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>DETERM</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>try_solvers_dflt</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>dflt_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
      
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>gen_add_solver</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span class="entity"><span>is_xform</span></span><span class="main"><span>,</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span class="entity"><span>solver</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> 
        </span><span class="main"><span>(</span></span><span>Solver_Data.map</span><span> </span><span class="main"><span>(</span></span><span>Item_Net.update</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span class="entity"><span>is_xform</span></span><span class="main"><span>,</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span class="entity"><span>solver</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_solver</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thms</span></span><span class="main"><span>,</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span class="entity"><span>solver</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>gen_add_solver</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span>false</span><span class="main"><span>,</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span class="entity"><span>solver</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thms</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_xformer</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thms</span></span><span class="main"><span>,</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span class="entity"><span>solver</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>gen_add_solver</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span>true</span><span class="main"><span>,</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span class="entity"><span>solver</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thms</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rem_solver</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span> 
        </span><span class="main"><span>(</span></span><span>Solver_Data.map</span><span> </span><span class="main"><span>(</span></span><span>Item_Net.remove</span><span> </span><span class="main"><span>(</span></span><span>asm_rl</span><span class="main"><span>,</span></span><span>false</span><span class="main"><span>,</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>no_tac</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>get_solvers</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Context.Proof</span><span> </span><span>#&gt;</span><span> </span><span>Solver_Data.get</span><span> </span><span>#&gt;</span><span> </span><span>Item_Net.content</span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_solvers</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>      
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>solvers</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>get_solvers</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pretty_solver</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span class="entity"><span>is_xform</span></span><span class="main"><span>,</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Pretty.block</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span>Binding.pretty</span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span>Pretty.str</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_xform</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"(xform)"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"(solve)"</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>":"</span></span><span class="main"><span>,</span></span><span>Pretty.brk</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span>Thm.pretty_thm</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> 
        </span><span>Pretty.fbreaks</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>pretty_solver</span></span><span> </span><span class="entity"><span>solvers</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>Pretty.block</span><span> </span><span>|&gt;</span><span> </span><span>Pretty.string_of</span><span> </span><span>|&gt;</span><span> </span><span>tracing</span><span class="main"><span>;</span></span><span>
        </span><span class="entity"><span>solvers</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>      

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>solve_precond_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.PRECONDI|fact"><span>PRECONDI</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>THEN_ELSE'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>solve</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span>all_tac</span><span class="main"><span>)</span></span><span>
      
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>step_precond_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>=</span></span><span> 
        </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>THEN_ALL_NEW_FWD</span></span><span> </span><span class="entity"><span>solve_precond_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>vcg_normalize_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
          </span><span>addsimps</span><span> </span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> vcg_normalize_simps</span><span class="antiquote"><span>}</span></span></span><span>
          </span><span>|&gt;</span><span> </span><span>fold</span><span> </span><span class="entity"><span>Simplifier.add_cong</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> vcg_normalize_congs</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>fold</span><span> </span><span class="entity"><span>Splitter.del_split</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> vcg_normalize_nosplits</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span>
          
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_Trueprop</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>mpat</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_Trueprop</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>CONCL_COND'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_Trueprop</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>THEN_ELSE'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>VCG_Lib.RECOVER_CONCLUSION</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>clarsimp_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span>all_tac</span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span> 
        
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>vcg_step_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>vcg_normalize_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>THEN_ALL_NEW</span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>step_precond_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vcg_rl_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
          </span><span class="comment1"><span>(*ORELSE' REPEAT_DETERM1 o (match_tac ctxt @{thms conjI impI allI exI})*)</span></span><span>
          </span><span>ORELSE'</span><span> </span><span class="entity"><span>solve</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>  
        
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>defer_if_no_schematics_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SUBGOAL</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> 
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>has_Var</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>no_tac</span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>Defer_Slot.to_slot_tac</span></span><span> </span><span class="entity"><span>i</span></span><span>
      </span><span class="main"><span>)</span></span><span> 
      
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cfg_defer_goals</span></span><span> </span><span class="main"><span>=</span></span><span> 
        </span><span class="entity"><span>Attrib.setup_config_bool</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>binding</span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_defer_goals|attribute"><span>vcg_defer_goals</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>false</span><span class="main"><span>)</span></span><span>
      
                      
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>local_setup</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>I</span><span>
        </span><span>#&gt;</span><span> </span><span>Local_Theory.add_thms_dynamic</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>binding</span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_framed_rules|fact"><span>vcg_framed_rules</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>all_framed_rls</span></span><span> </span><span>o</span><span> </span><span>Context.proof_of</span><span class="main"><span>)</span></span><span>  
        </span><span>#&gt;</span><span> </span><span>Local_Theory.add_thms_dynamic</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>binding</span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_framed_erules|fact"><span>vcg_framed_erules</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>all_framed_erls</span></span><span> </span><span>o</span><span> </span><span>Context.proof_of</span><span class="main"><span>)</span></span><span>  
      
      
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    
  ›</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>local_setup</span></span></span><span> </span><span class="quoted"><span>‹</span><span class="entity"><span>Basic_VCG.local_setup</span></span><span>›</span></span><span>

  </span><span class="keyword1"><span class="command"><span>method_setup</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_ensure_defer_slot|method"><span>vcg_ensure_defer_slot</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹</span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>SIMPLE_METHOD</span></span><span> </span><span class="main"><span>(</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Config.get</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Basic_VCG.cfg_defer_goals</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Defer_Slot.ensure_slot_tac</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>all_tac</span><span>
  </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>method_setup</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_try_solve|method"><span>vcg_try_solve</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹</span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>SIMPLE_METHOD'</span></span><span> </span><span class="main"><span>(</span></span><span>TRY</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.PRECONDI|fact"><span>PRECONDI</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>Basic_VCG.try_solve</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span><span>
  </span><span class="keyword1"><span class="command"><span>method_setup</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_solve|method"><span>vcg_solve</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹</span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>SIMPLE_METHOD'</span></span><span> </span><span class="main"><span>(</span></span><span>TRY</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.PRECONDI|fact"><span>PRECONDI</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>Basic_VCG.solve</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span><span>

  </span><span class="keyword1"><span class="command"><span>method_setup</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_rl_internal|method"><span>vcg_rl_internal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹</span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>SIMPLE_METHOD'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Basic_VCG.vcg_rl_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span><span>
  </span><span class="keyword1"><span class="command"><span>method_setup</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_step_internal|method"><span>vcg_step_internal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹</span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>SIMPLE_METHOD'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Basic_VCG.vcg_step_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span><span>
  </span><span class="keyword1"><span class="command"><span>method_setup</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_normalize|method"><span>vcg_normalize</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹</span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>SIMPLE_METHOD'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Basic_VCG.vcg_normalize_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span><span>

  </span><span class="keyword1"><span class="command"><span>attribute_setup</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_static_xformed|attribute"><span>vcg_static_xformed</span></span><span> </span><span class="main"><span>=</span></span><span> 
    </span><span class="quoted"><span>‹</span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span>Thm.rule_attribute</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Basic_VCG.static_xform_rl</span></span><span> </span><span class="main"><span>(</span></span><span>Context.proof_of</span><span> </span><span class="entity"><span>context</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span><span>
    </span><span class="quoted"><span>‹Apply static rule transformations›</span></span><span>
    
    
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Basic_VCG.vcg_rl.vcg_rl|method"><span>method</span></span></span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_rl|method"><span>vcg_rl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_ensure_defer_slot|method"><span class="operator"><span>vcg_ensure_defer_slot</span></span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_rl_internal|method"><span class="operator"><span>vcg_rl_internal</span></span></a><span>  
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Basic_VCG.vcg_step.vcg_step|method"><span>method</span></span></span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_step|method"><span>vcg_step</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_ensure_defer_slot|method"><span class="operator"><span>vcg_ensure_defer_slot</span></span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_step_internal|method"><span class="operator"><span>vcg_step_internal</span></span></a><span>  
        
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Basic_VCG.vcg_solve_precond.vcg_solve_precond|method"><span>method</span></span></span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_solve_precond|method"><span>vcg_solve_precond</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="More_Eisbach_Tools.html#More_Eisbach_Tools.then_else|method"><span class="operator"><span>then_else</span></span></a><span> </span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.PRECONDI|fact"><span>PRECONDI</span></a><span>›</span></span><span> </span><span class="quoted"><span>‹</span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_solve|method"><span class="operator"><span>vcg_solve</span></span></a><span>›</span></span><span> </span><span class="operator"><span>succeed</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Basic_VCG.vcg.vcg|method"><span>method</span></span></span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg|method"><span>vcg</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_ensure_defer_slot|method"><span class="operator"><span>vcg_ensure_defer_slot</span></span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_step_internal|method"><span class="operator"><span>vcg_step_internal</span></span></a><span class="main"><span class="keyword3"><span>+</span></span></span><span>

  
  </span><span class="comment1"><span>(* Tag for solving by assumption*)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Basic_VCG.SOLVE_ASM_def|fact"><span class="entity_def" id="Basic_VCG.SOLVE_ASM_def|thm"><span class="entity_def" id="Basic_VCG.SOLVE_ASM_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_tag_defs|attribute"><span class="operator"><span>vcg_tag_defs</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Basic_VCG.SOLVE_ASM|const"><span>SOLVE_ASM</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Φ</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Φ</span></span></span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.SOLVE_ASMI|fact"><span class="entity_def" id="Basic_VCG.SOLVE_ASMI|thm"><span>SOLVE_ASMI</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Φ</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.SOLVE_ASM|const"><span>SOLVE_ASM</span></a><span> </span><span class="free"><span>Φ</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.SOLVE_ASM_def|fact"><span>SOLVE_ASM_def</span></a><span class="main"><span>)</span></span><span>
  
  </span><span class="comment1"><span>(*
  definition [vcg_tag_defs]: "SOLVE_SIMP Φ ≡ Φ"
  lemma SOLVE_SIMPI: "Φ ⟹ SOLVE_SIMP Φ" by (auto simp: SOLVE_SIMP_def)
  *)</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.thin_TrueE|fact"><span class="entity_def" id="Basic_VCG.thin_TrueE|thm"><span>thin_TrueE</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>;</span></span><span> </span><span class="free"><span>P</span></span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.imp_trans|fact"><span class="entity_def" id="Basic_VCG.imp_trans|thm"><span>imp_trans</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>B</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>C</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>C</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.imp_ball_cong|fact"><span class="entity_def" id="Basic_VCG.imp_ball_cong|thm"><span>imp_ball_cong</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span class="free"><span>S</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>P'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>∀</span></span><span class="bound"><span>x</span></span><span class="main"><span>∈</span></span><span class="free"><span>S</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>∀</span></span><span class="bound"><span>x</span></span><span class="main"><span>∈</span></span><span class="free"><span>S</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P'</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.imp_all_cong|fact"><span class="entity_def" id="Basic_VCG.imp_all_cong|thm"><span>imp_all_cong</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span class="main"><span>⋀</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>P'</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="free"><span>P'</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  
  
  </span><span class="keyword1"><span class="command"><span>named_theorems_rev</span></span></span><span> 
        </span><span class="entity_def" id="Basic_VCG.vcg_prep_ext_rules|attribute"><span class="entity_def" id="Basic_VCG.vcg_prep_ext_rules|fact"><span>vcg_prep_ext_rules</span></span></span><span> </span><span class="quoted"><span>‹Normalization rules to prepare external solving›</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_prep_ext_congs|attribute"><span class="entity_def" id="Basic_VCG.vcg_prep_ext_congs|fact"><span>vcg_prep_ext_congs</span></span></span><span> </span><span class="quoted"><span>‹Congruence rules for external solving normalization›</span></span><span>
  
  </span><span class="comment1"><span>(* named_theorems_rev vcg_prep_ext_start_rules ‹Rules to start external solving normalization› *)</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_prep_ext_congs|attribute"><span class="operator"><span>vcg_prep_ext_congs</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.conj_mono|fact"><span>Set.conj_mono</span></a><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.imp_ball_cong|fact"><span>imp_ball_cong</span></a><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.imp_all_cong|fact"><span>imp_all_cong</span></a><span>
  
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Basic_VCG.EXT_TAG_def|fact"><span class="entity_def" id="Basic_VCG.EXT_TAG_def|thm"><span class="entity_def" id="Basic_VCG.EXT_TAG_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Basic_VCG.EXT_TAG|const"><span>EXT_TAG</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.EXT_TAGI|fact"><span class="entity_def" id="Basic_VCG.EXT_TAGI|thm"><span>EXT_TAGI</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.EXT_TAG|const"><span>EXT_TAG</span></a><span> </span><span class="free"><span>P</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.EXT_TAG_def|fact"><span>EXT_TAG_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.EXT_TAGD|fact"><span class="entity_def" id="Basic_VCG.EXT_TAGD|thm"><span>EXT_TAGD</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.EXT_TAG|const"><span>EXT_TAG</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.EXT_TAG_def|fact"><span>EXT_TAG_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.EXT_TAG_fold|fact"><span class="entity_def" id="Basic_VCG.EXT_TAG_fold|thm"><span>EXT_TAG_fold</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.EXT_TAG|const"><span>EXT_TAG</span></a><span> </span><span class="free"><span>P</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.EXT_TAG_def|fact"><span>EXT_TAG_def</span></a><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span> 
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_prep_ext_start|fact"><span class="entity_def" id="Basic_VCG.vcg_prep_ext_start|thm"><span>vcg_prep_ext_start</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⟦</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.EXT_TAG|const"><span>EXT_TAG</span></a><span> </span><span class="free"><span>P</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="main"><span>⟧</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Q</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span> </span><span class="quasi_keyword"><span>dest</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.EXT_TAGD|fact"><span>EXT_TAGD</span></a><span class="main"><span>)</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>ML</span></span></span><span> </span><span class="quoted"><span>‹
    </span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>VCG_External_Solving</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>
    
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tag_prems_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Conv</span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>CONVERSION</span><span> </span><span class="main"><span>(</span></span><span>
        </span><span>params_conv</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>prems_conv</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="main"><span>(</span></span><span>try_conv</span><span> </span><span class="main"><span>(</span></span><span>rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.EXT_TAG_fold|fact"><span>EXT_TAG_fold</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>so_norm_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>refl_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.imp_refl|fact"><span>imp_refl</span></a><span class="antiquote"><span>}</span></span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>trans_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.imp_trans|fact"><span>imp_trans</span></a><span class="antiquote"><span>}</span></span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cong_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Named_Theorems_Rev.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems_rev</span></span><span> vcg_prep_ext_congs</span><span class="antiquote"><span>}</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rule_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Named_Theorems_Rev.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems_rev</span></span><span> vcg_prep_ext_rules</span><span class="antiquote"><span>}</span></span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Local_Defs.unfold</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.atomize_imp|fact"><span>atomize_imp</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
      
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>refl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOLVED'</span><span> </span><span class="main"><span>(</span></span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl_thms</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>congs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>cong_thms</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>transs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans_thms</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rules</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>rule_thms</span></span><span>
        
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rec_tac</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>app_cong</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>congs</span></span><span> </span><span class="entity"><span>THEN_ALL_NEW_FWD</span></span><span> </span><span class="entity"><span>rec_tac</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>app_rl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rules</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="entity"><span>REPEAT_DETERM'</span></span><span> </span><span class="main"><span>(</span></span><span>CHANGED</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transs</span></span><span> </span><span>THEN'</span><span> </span><span>SOLVED'</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>app_cong</span></span><span> </span><span>ORELSE'</span><span> </span><span class="entity"><span>app_rl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>THEN'</span><span> 
          </span><span class="entity"><span>refl</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>st</span></span><span> 
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> 
        </span><span class="entity"><span>rec_tac</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prepare_subgoal_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>norm_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>dresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_prep_ext_start|fact"><span>vcg_prep_ext_start</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>THEN'</span><span> </span><span>SOLVED'</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>so_norm_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>tag_prems_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span>THEN'</span><span> </span><span class="entity"><span>REPEAT_DETERM'</span></span><span> </span><span class="entity"><span>norm_tac</span></span><span> 
        </span><span>THEN'</span><span> </span><span class="entity"><span>REPEAT_DETERM'</span></span><span> </span><span class="main"><span>(</span></span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.thin_TrueE|fact"><span>thin_TrueE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjE|fact"><span>conjE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.impE|fact"><span>impE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.exE|fact"><span>exE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  ›</span></span><span>

  </span><span class="keyword1"><span class="command"><span>method_setup</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_prepare_external|method"><span>vcg_prepare_external</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span>‹</span><span>Scan.succeed</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>SIMPLE_METHOD'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>VCG_External_Solving.prepare_subgoal_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Basic_VCG.SOLVE_AUTO_def|fact"><span class="entity_def" id="Basic_VCG.SOLVE_AUTO_def|thm"><span class="entity_def" id="Basic_VCG.SOLVE_AUTO_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_tag_defs|attribute"><span class="operator"><span>vcg_tag_defs</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Basic_VCG.SOLVE_AUTO|const"><span>SOLVE_AUTO</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Φ</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Φ</span></span></span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.SOLVE_AUTOI|fact"><span class="entity_def" id="Basic_VCG.SOLVE_AUTOI|thm"><span>SOLVE_AUTOI</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Φ</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.SOLVE_AUTO|const"><span>SOLVE_AUTO</span></a><span> </span><span class="free"><span>Φ</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.SOLVE_AUTO_def|fact"><span>SOLVE_AUTO_def</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Basic_VCG.SOLVE_DEFAULT_AUTO_def|fact"><span class="entity_def" id="Basic_VCG.SOLVE_DEFAULT_AUTO_def|thm"><span class="entity_def" id="Basic_VCG.SOLVE_DEFAULT_AUTO_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_tag_defs|attribute"><span class="operator"><span>vcg_tag_defs</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Basic_VCG.SOLVE_DEFAULT_AUTO|const"><span>SOLVE_DEFAULT_AUTO</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Φ</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Φ</span></span></span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.SOLVE_DEFAULT_AUTOI|fact"><span class="entity_def" id="Basic_VCG.SOLVE_DEFAULT_AUTOI|thm"><span>SOLVE_DEFAULT_AUTOI</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Φ</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.SOLVE_DEFAULT_AUTO|const"><span>SOLVE_DEFAULT_AUTO</span></a><span> </span><span class="free"><span>Φ</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.SOLVE_DEFAULT_AUTO_def|fact"><span>SOLVE_DEFAULT_AUTO_def</span></a><span class="main"><span>)</span></span><span>
  
    
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Basic_VCG.SOLVE_AUTO_DEFER_def|fact"><span class="entity_def" id="Basic_VCG.SOLVE_AUTO_DEFER_def|thm"><span class="entity_def" id="Basic_VCG.SOLVE_AUTO_DEFER_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_tag_defs|attribute"><span class="operator"><span>vcg_tag_defs</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Basic_VCG.SOLVE_AUTO_DEFER|const"><span>SOLVE_AUTO_DEFER</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Φ</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Φ</span></span></span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.SOLVE_AUTO_DEFERI|fact"><span class="entity_def" id="Basic_VCG.SOLVE_AUTO_DEFERI|thm"><span>SOLVE_AUTO_DEFERI</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Φ</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.SOLVE_AUTO_DEFER|const"><span>SOLVE_AUTO_DEFER</span></a><span> </span><span class="free"><span>Φ</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.SOLVE_AUTO_DEFER_def|fact"><span>SOLVE_AUTO_DEFER_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.SOLVE_AUTO_DEFERD|fact"><span class="entity_def" id="Basic_VCG.SOLVE_AUTO_DEFERD|thm"><span>SOLVE_AUTO_DEFERD</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.SOLVE_AUTO_DEFER|const"><span>SOLVE_AUTO_DEFER</span></a><span> </span><span class="free"><span>Φ</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>Φ</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.SOLVE_AUTO_DEFER_def|fact"><span>SOLVE_AUTO_DEFER_def</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Basic_VCG.NORMALIZE_def|fact"><span class="entity_def" id="Basic_VCG.NORMALIZE_def|thm"><span class="entity_def" id="Basic_VCG.NORMALIZE_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_tag_defs|attribute"><span class="operator"><span>vcg_tag_defs</span></span></a><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Basic_VCG.NORMALIZE|const"><span>NORMALIZE</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Φ</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>Φ</span></span></span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.NORMALIZEI|fact"><span class="entity_def" id="Basic_VCG.NORMALIZEI|thm"><span>NORMALIZEI</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Φ</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.NORMALIZE|const"><span>NORMALIZE</span></a><span> </span><span class="free"><span>Φ</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.NORMALIZE_def|fact"><span>NORMALIZE_def</span></a><span class="main"><span>)</span></span><span>
  
  
  </span><span class="keyword1"><span class="command"><span>ML</span></span></span><span> </span><span class="quoted"><span>‹</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>solve_auto_try_defer_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Config.get</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Basic_VCG.cfg_defer_goals</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.SOLVE_AUTO_DEFERD|fact"><span>SOLVE_AUTO_DEFERD</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>Basic_VCG.defer_if_no_schematics_tac</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>K</span><span> </span><span>no_tac</span><span>›</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>declaration</span></span></span><span> </span><span class="quoted"><span>‹</span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Basic_VCG.add_solver</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.SOLVE_ASMI|fact"><span>SOLVE_ASMI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>binding</span></span><span> solve_asm</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>ORELSE'</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.TrueI|fact"><span>TrueI</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.order_refl|fact"><span>order_refl</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>declaration</span></span></span><span> </span><span class="quoted"><span>‹</span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Basic_VCG.add_solver</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.SOLVE_AUTOI|fact"><span>SOLVE_AUTOI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>binding</span></span><span> solve_auto</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>VCG_External_Solving.prepare_subgoal_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>THEN'</span><span> </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>auto_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span><span>
  </span><span class="keyword1"><span class="command"><span>declaration</span></span></span><span> </span><span class="quoted"><span>‹</span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Basic_VCG.add_solver</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.SOLVE_AUTO_DEFERI|fact"><span>SOLVE_AUTO_DEFERI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>binding</span></span><span> solve_auto_defer</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> 
    </span><span class="entity"><span>VCG_External_Solving.prepare_subgoal_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>THEN'</span><span> </span><span class="main"><span>(</span></span><span>
      </span><span>SOLVED'</span><span> </span><span class="main"><span>(</span></span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>auto_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> 
      </span><span>ORELSE'</span><span> </span><span class="entity"><span>solve_auto_try_defer_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span>ORELSE'</span><span> </span><span class="main"><span>(</span></span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>auto_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  ›</span></span><span>

  </span><span class="keyword1"><span class="command"><span>declaration</span></span></span><span> </span><span class="quoted"><span>‹</span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Basic_VCG.add_solver</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.SOLVE_DEFAULT_AUTOI|fact"><span>SOLVE_DEFAULT_AUTOI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>binding</span></span><span> solve_default_auto</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> 
      </span><span class="entity"><span>VCG_External_Solving.prepare_subgoal_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>THEN'</span><span>
      </span><span class="main"><span>(</span></span><span>SOLVED'</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Basic_VCG.try_solve_dflt</span></span><span> </span><span class="main"><span>(</span></span><span>SELECT_GOAL</span><span> </span><span>o</span><span> </span><span class="entity"><span>auto_tac</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
        </span><span>ORELSE'</span><span> </span><span class="entity"><span>solve_auto_try_defer_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span>ORELSE'</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Basic_VCG.try_solve_dflt</span></span><span> </span><span class="main"><span>(</span></span><span>SELECT_GOAL</span><span> </span><span>o</span><span> </span><span class="entity"><span>auto_tac</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span><span>
  
    
  </span><span class="keyword1"><span class="command"><span>declaration</span></span></span><span> </span><span class="quoted"><span>‹</span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Basic_VCG.add_xformer</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.NORMALIZEI|fact"><span>NORMALIZEI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>binding</span></span><span> xform_normalize</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Basic_VCG.vcg_normalize_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>declaration</span></span></span><span> </span><span class="quoted"><span>‹</span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Basic_VCG.add_solver</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="Defer_Slot.html#Defer_Slot.remove_slot|fact"><span>Defer_Slot.remove_slot</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>binding</span></span><span> remove_empty_defer_slot</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>K</span><span> </span><span>all_tac</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span><span>
  
  
  </span><span class="keyword1"><span class="command"><span>ML_val</span></span></span><span> </span><span class="quoted"><span>‹</span><span class="entity"><span>Basic_VCG.get_solvers</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>context</span></span><span class="antiquote"><span>}</span></span></span></span><span>›</span></span><span>
  

  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Basic_VCG.vcg&apos;.vcg&apos;|method"><span>method</span></span></span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg&apos;|method"><span>vcg'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/match_method.ML.html#Eisbach.match|method"><span class="operator"><span>match</span></span></a><span> </span><span class="main"><span class="main"><span>[</span></span></span><span class="main"><span class="main"><span>[</span></span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_defer_goals|attribute"><span class="operator"><span>vcg_defer_goals</span></span></a><span> </span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span> </span><span class="quasi_keyword"><span class="quasi_keyword"><span>true</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span>in</span></span></span></span><span> </span><span class="quoted"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>⇒</span></span></span><span> 
    </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg|method"><span class="operator"><span>vcg</span></span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> 
    </span><a class="entity_ref" href="Defer_Slot.html#Defer_Slot.defer_slot_dest|method"><span class="operator"><span>defer_slot_dest</span></span></a><span class="main"><span class="keyword3"><span>?</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span>
    </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/HOL-Eisbach.Eisbach.html#Eisbach.all|method"><span class="operator"><span>all</span></span></a><span> </span><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/classical.ML.html#HOL.rule|method"><span class="operator"><span>rule</span></span></a><span> </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.SOLVE_AUTO_DEFERI|fact"><span>SOLVE_AUTO_DEFERI</span></a><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>?</span></span></span><span>›</span></span><span>
    
  </span><span class="keyword1"><span class="command"><span class="entity_def" id="Basic_VCG.vcg_step&apos;.vcg_step&apos;|method"><span>method</span></span></span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_step&apos;|method"><span>vcg_step'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../../AFP/Automatic_Refinement/ISABELLE_HOME/src/HOL/Eisbach/match_method.ML.html#Eisbach.match|method"><span class="operator"><span>match</span></span></a><span> </span><span class="main"><span class="main"><span>[</span></span></span><span class="main"><span class="main"><span>[</span></span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_defer_goals|attribute"><span class="operator"><span>vcg_defer_goals</span></span></a><span> </span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span> </span><span class="quasi_keyword"><span class="quasi_keyword"><span>true</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span>in</span></span></span></span><span> </span><span class="quoted"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>⇒</span></span></span><span> 
    </span><a class="entity_ref" href="Defer_Slot.html#Defer_Slot.defer_slot_ensure|method"><span class="operator"><span>defer_slot_ensure</span></span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span>
    </span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_step|method"><span class="operator"><span>vcg_step</span></span></a><span>
  
  </span><span class="comment1"><span>(* Static rule simplifier *)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>named_theorems</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.vcg_static_rl_simps|attribute"><span class="entity_def" id="Basic_VCG.vcg_static_rl_simps|fact"><span>vcg_static_rl_simps</span></span></span><span> </span><span class="quoted"><span>‹Rewrite rules to be applied to 
    framed rules, to prune trivial cases, etc.›</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="entity_def" id="Basic_VCG.dflt_prune_thm_simps|fact"><span class="entity_def" id="Basic_VCG.dflt_prune_thm_simps(4)|thm"><span class="entity_def" id="Basic_VCG.dflt_prune_thm_simps(3)|thm"><span class="entity_def" id="Basic_VCG.dflt_prune_thm_simps(2)|thm"><span class="entity_def" id="Basic_VCG.dflt_prune_thm_simps(1)|thm"><span>dflt_prune_thm_simps</span></span></span></span></span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_static_rl_simps|attribute"><span class="operator"><span>vcg_static_rl_simps</span></span></a><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> 
    </span><span>triv_forall_equality</span><span>  </span><span class="comment1"><span>― ‹prunes params›</span></span><span>
    </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True_implies_equals|fact"><span>True_implies_equals</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies_True_equals|fact"><span>implies_True_equals</span></a><span>  </span><span class="comment1"><span>― ‹prune </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>‹</span></span><span>True›</span></span></span><span> in asms›</span></span><span>
    </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False_implies_equals|fact"><span>False_implies_equals</span></a><span>  </span><span class="comment1"><span>― ‹prune </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>‹</span></span><span>False›</span></span></span><span> in asms›</span></span><span>

    
  </span><span class="keyword1"><span class="command"><span>declaration</span></span></span><span> </span><span class="quoted"><span>‹</span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Basic_VCG.add_static_xformer</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>binding</span></span><span> </span><span>static_rule_simplifier</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Simplifier.full_rewrite</span></span><span> 
     </span><span class="main"><span>(</span></span><span>put_simpset</span><span> </span><span class="entity"><span>HOL_basic_ss</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>addsimps</span><span> </span><span class="entity"><span>Named_Theorems.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>named_theorems</span></span><span> vcg_static_rl_simps</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span>  
  </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>›</span></span><span>
  
  </span><span class="comment1"><span>(*
  named_theorems vcg_struct_simps ‹Simplification rules on command structure›
  *)</span></span><span>
  
  
  </span><span class="keyword1"><span class="command"><span>declare</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="Basic_VCG.html#Basic_VCG.vcg_decomp_rules|attribute"><span class="operator"><span>vcg_decomp_rules</span></span></a><span class="main"><span>]</span></span><span>
  
      
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span></pre>
</body>

</html>